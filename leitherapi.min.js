(function(Q){function E(L){if(J[L])return J[L].exports;var H=J[L]={exports:{},id:L,loaded:!1};Q[L].call(H.exports,H,H.exports,E);H.loaded=!0;return H.exports}var J={};E.m=Q;E.c=J;E.p="";return E(0)})([function(Q,E,J){function L(){function a(c,b,z){c.invoke(function(a,c){var p=D.some(function(a){return-1!==c.name.indexOf(a)});debug.log("do cache? : ",p,c.name,c.args);if(!p||c.nocache||null===a)return b(a);p=null;"string"==typeof a&&"{"==a[0]?p={__is:"string",value:JSON.parse(a)}:"object"==typeof a&&
null!=a?p=Array.isArray(a)?{__is:"array",value:a}:{__is:"object",value:a}:null===a&&(p={__is:"null",value:"__null__"});var e=1<c.args.length?c.args.slice(1).join(""):null;p&&e&&(p.__id=e,p.__score=0,p.__ts=Date.now(),A.db[A.table].put(p).then(function(a){},function(a){debug.warn("save to db error: ",a)}));c.skipResolve?"function"==typeof c.asyncCall&&c.asyncCall(a):b(a)},z,c)}function b(c,z,f){var g=null;D.some(function(a){return-1!==c.name.indexOf(a)})&&(g=1<c.args.length?c.args.slice(1).join(""):
null);g?A.db[A.table].get(g).then(function(b){if(b){var D=null;if("string"==b.__is)D=JSON.stringify(b.value);else{if("null"==b.__is)return a(c,z,f);D=b.value}c.background||"undefined"==typeof c.background&&A.background?(debug.log("fetching from icache.db with background enabled: ",g,D,c.name,c.args),z(D),c.skipResolve=!0,a(c,z,f)):("undefined"==typeof c.ttl?"undefined"==typeof b.__ttl&&(b.__ttl=A.DEFAULT_TTL):b.__ttl=c.ttl,b.__ttl<Date.now()-b.__ts?(debug.log("ttl timeout, reload from server: ",g,
c.name,c),a(c,z,f)):(debug.log("fetching from icache.db: ",g,D,c.name,c.args),z(D)))}else a(c,z,f)},function(b){debug.log("not in icache.db, fetching from server");a(c,z,f)}):a(c,z,f)}debug.log("in initcache 0");var D=["get"],A={};window.icache=A;A.db=new k(c.AppName);var f={};A.table="icache";f[A.table]="__id,__score,__ts";try{A.db.version(2).stores(f),A.db.open()}catch(p){debug.warn("can't use indexedDB: ",p);return}A.DEFAULT_TTL=72E5;A.handler=b;window.hprose.userdefInvoke=b;A.tools={};A.tools.makeurl=
function(a,b,z,g){return"http://"+a+"/loadres?type=text/html&AppName="+b+"&AppBid="+z+"&ip="+a+"&bid="+c.SystemBid+"&name=AppTemplate&ver=last&userid="+g}}function H(a){var c=2;"boolean"===typeof a?a||(c=X.length):"number"===typeof a&&(c=a);a=function(){};for(var b=c;b<X.length;b++)window.debug[X[b]]=window.console[X[b]].bind(window.console);for(b=0;b<c;b++)window.debug[X[b]]=a}function x(a){var b=c.ayFE[a];return b?(debug.log("PE: seted"),b):function(b){debug.log("PE:default mark");if(c.ayFE[a])return c.ayFE[a](b);
c.ayErr[a]=b;debug.error(a+":"+b)}}function C(){return null!=c.api}function b(a){debug.log("setMain: ",a);if(c.Running)debug.warn("setMain: app running");else if("function"==typeof InitErrFunc&&InitErrFunc(),"undefined"!=typeof main)if(debug.log("main function ok run it"),c.Main=main,debug.log("isok",C),C()){c.Running=!0;debug.log("s1");for(var b=0;b<c.InitFunc.length;b++)c.InitFunc[b]();debug.log("s2",L);L();debug.log("s3");main();debug.log("called main()")}else for(b in debug.log("Leither is not OK"),
c.ayErr)a=c.ayFE[b],err=c.ayErr[b],null!=err&&null!=a&&(c.ayErr[b]=null,debug.log("errReply err:",err),a(err))}function B(a,c){var b=localStorage[a];if(b)return JSON.parse(b);"undefined"!=typeof c&&(localStorage[a]=JSON.stringify(c));return c}function m(){debug.log("InitDb");var a=new hprose.Future,b=b||2,D=window.indexedDB.open("LeitherApi",b);c.ApptbName=c.appBid+"_"+c.AppName;debug.log(c.ApptbName);D.onerror=function(c){debug.error(c.currentTarget.error.message);a.reject(c)};D.onsuccess=function(b){debug.log("InitDb ok");
b=b.target.result;c.LeitherDb=b;a.resolve(b)};D.onupgradeneeded=function(a){a=a.target.result;a.objectStoreNames.contains("res")||a.createObjectStore("res",{keyPath:"id"});a.objectStoreNames.contains(c.ApptbName)&&a.deleteObjectStore(c.ApptbName);debug.log("DB version changed to "+b)};return a}function y(a){var b=c.LeitherDb.transaction("res","readwrite").objectStore("res"),D=new hprose.Future;debug.log("getdbdata ");request=b.get(a);request.onerror=function(a){D.reject(a)};request.onsuccess=function(a){D.resolve(a.target.result);
debug.log("getdbdata2 ",a.target.result)};return D}function h(a){var b=c.LeitherDb.transaction("res","readwrite").objectStore("res"),D=new hprose.Future;request=b.put(a);request.onerror=function(a){debug.log("setdbdata err",a);D.reject(a)};request.onsuccess=function(a){D.resolve(a.target.result);debug.log("setdbdata: ",a.target.result)};return D}function w(b,c,D){var f=new hprose.Future,h=JSON.parse(D),p=function(a,c){var g="last";if("last"==c||"release"==c)g=a[c];debug.log("loading resfiles for app: ",
b,", version:",g,h);return a.ResFile[g]}(h,c);(function(c){for(var D=[];c<p.length;c++){var g=p[c];debug.log("load resfile with key:",g);""==g?debug.error("invliad key:",g):D.push(a(b,g))}hprose.Future.all(D).then(function(a){debug.log("all promise",a);f.resolve()},function(a){debug.log(a);f.reject(a)})})(0);return f}function r(a){c.loginData=a;c.sid=a.sid;c.user=a.user;c.username=c.user.name;c.bid=null!==a.user?a.user.id:c.uid;c.leClient=c.api;c.swarm=a.swarm}function R(a){0<a.length?c.currentIP=
a:a=c.currentIP;c.api=t(a);m().then(function(a){debug.log("hprose ready",a);c.api.ready(function(a){debug.log("hprose ready ok");debug.log("G.uid=",c.uid);f(a,c.AppName,c.AppBid,c.AppVer).then(function(){var f=x("login");c.postLogin=r;"undefined"!==typeof ENABLE_UAC&&ENABLE_UAC?b("UAC enabled, must redirect to the login page first"):a.login(c.uid,c.userppt).then(function(a){debug.log("login ok");r(a);c.swarm=a.swarm;debug.log("LeitherIsOK:",C());debug.log("login ok sid=",a.sid);debug.log("user= ",
a.user);debug.log("swarm=",a.swarm);debug.log("appName=",c.AppName);b("after loaded app and logedin")},f);c.Local||(debug.log("use remote files"),a.getresbyname(c.sid,c.SystemBid,"LeitherApi",c.AppVer,{handler:icache.handler,ttl:0}).then(function(a){var c=new FileReader;c.onload=function(a){debug.log("leitherApi re get ok");localStorage.leitherApi=a.target.result};c.readAsText(new Blob([a]))}),a.hget(c.sid,c.AppBid,"applist",c.AppName,{handler:icache.handler,ttl:0}).then(function(a){debug.log("manifest re hget ok");
h({id:c.AppName,data:a,tbname:c.ApptbName}).then()}))})},x("api.ready"))},x("InitDb"))}function a(a,b){var f=new hprose.Future;debug.log("load js ",b);var k=document.createElement("script");k.type="text/javascript";y(b).then(function(t){if(t)k.textContent=t.data,document.getElementsByTagName("head")[0].appendChild(k),f.resolve(b);else if(debug.log("check leither"),"function"==typeof C&&C()){debug.log("check leither ok");var p=function(a){debug.error(a);f.reject(b)};c.api.ready(function(t){debug.log(" G.api.ready");
t.get("",a,b,function(p){debug.log("get ok: (appBid, key)  ",a,b);if(p){debug.log(" if (data)");var g=new FileReader;g.onload=function(a){debug.log(" SetDbData");h({id:b,data:a.target.result,tbname:c.ApptbName});k.textContent=a.target.result;document.getElementsByTagName("head")[0].appendChild(k);f.resolve(b)};g.readAsText(new Blob([p]))}else debug.error("data is null"),f.reject(b)},p)},p)}else debug.error("leither is not ok"),f.reject(b)},function(a){debug.error(a);f.reject(a)});return f}function f(a,
b,f,k){debug.log("load app name:",b,", appBid:",f);var t=new hprose.Future;if(c.Local)return debug.log("use local file"),t.resolve(),t;y(b).then(function(c){c?(debug.log("get app manifest from db successed: ",b),w(f,k,c.data).then(function(){t.resolve()},function(a){debug.warn("LoadApp: ",a);t.reject(a)})):(debug.log("app :",b," resfiles not found in DB, fetching ... "),a.hget("",f,"applist",b).then(function(a){h({id:b,data:a,tbname:f+"_"+b});w(f,k,a).then(function(a){t.resolve()},function(a){debug.warn("LoadApp 2: ",
a);t.reject(a)})}))},function(a){debug.error(a)});return t}var k=J(1);J(4);"use strict";var t=function(a){if("http://"==a.substr(0,7)){a=a.substr(7);var b=a.indexOf("/");0<b&&(a=a.substr(0,b))}b="ws://"+a+"/ws/";-1!=navigator.userAgent.indexOf("Firefox")&&(b="http://"+a+"/webapi/");return hprose.Client.create(b,"login register getvar act setdata set get del expire hmclear hset hget hdel hlen hkeys hgetall hmset hmget exit restart lpush lpop rpush rpop lrange zadd zrange sadd scard sclear sdiff sinter smclear smembers srem sunion sendmsg readmsg pullmsg invite accept test veni sethostip proxyget createinvcode getinvcodeinfo updateinvcode deleteinvcode setinvtemplate getinvtemplate getappdownloadkey getresbyname getgshorturlkey getlshorturlkey incr zcard zcount zrem zscore zrank zrangebyscore lindex lexpire lexpireat lttl lpersist llen sendmail lset".split(" "))},
X=["log","info","warn","error"];window.debug={};window.setLog=H;var c={ayFE:{},ayErr:{},IPList:[],InitFunc:[]};window.G=c;window.LeitherIsOK=C;window.RunApp=function(a,b){if(0!=arguments.length){"undefined"===typeof a.Log?H(!1):H(a.Log);c.I=a;c.appBid=a.AppBid;c.Running=!1;c.AppVer=a.AppVer?a.AppVer:"last";debug.log("RunApp");var f;if(f=0==b)debug.log("InitCfg"),c.Local=a.Local,c.SystemBid=a.SystemBid,c.AppBid=a.AppBid,c.IPList=a.IPList&&a.IPList.length&&0<a.IPList.length?a.IPList:B(c.AppBid+"/iplist"),
c.userppt=a.userppt||B(window.location.pathname+"/"+c.AppBid+"/ppt"),c.AppName=a.AppName||B(c.AppBid+"/appname"),c.uid=a.userid||B(window.location.pathname+"/"+c.AppBid+"/uid"),f=!1;f||(c.IPList.length<=b?console.error("iplist.length [",c.IPList.length,"]<ipnum[",b,"]"):R(c.IPList[b]))}};window.RunApp()},function(Q,E,J){var L;(function(H){(function(x,C,b){function B(a,d){return"object"!=typeof d&&(d=d()),Object.keys(d).forEach(function(b){a[b]=d[b]}),a}function m(a){return{from:function(d){return a.prototype=
Object.create(d.prototype),a.prototype.constructor=a,{extend:function(b){B(a.prototype,"object"!=typeof b?b(d.prototype):b)}}}}}function y(a,d){return d(a)}function h(a,ka){function la(a){this._cfg={version:a,storesSource:null,dbschema:{},tables:{},contentUpgrade:null};this.stores({})}function t(a,c,e,g){var l,v,n,ba,Z;if(0===a)Object.keys(T).forEach(function(a){A(c,a,T[a].primKey,T[a].indexes)}),l=G._createTransaction(V,ca,T),l.idbtrans=c,l.idbtrans.onerror=u(e,["populating database"]),l.on("error").subscribe(e),
d.newPSD(function(){d.PSD.trans=l;try{G.on("populate").fire(l)}catch(a){g.onerror=c.onerror=function(a){a.preventDefault()};try{c.abort()}catch(n){}c.db.close();e(a)}});else{if(v=[],n=da.filter(function(n){return n._cfg.version===a})[0],!n)throw new I("Dexie specification of currently installed DB version is missing");T=G._dbSchema=n._cfg.dbschema;ba=!1;n=da.filter(function(n){return n._cfg.version>a});n.forEach(function(a){var n=T,l=a._cfg.dbschema;xa(n,c);xa(l,c);T=G._dbSchema=l;n=M(n,l);n.add.forEach(function(a){v.push(function(n,
l){A(n,a[0],a[1].primKey,a[1].indexes);l()})});n.change.forEach(function(a){if(a.recreate)throw new I("Not yet support for changing primary key");v.push(function(n,l){var v=n.objectStore(a.name);a.add.forEach(function(a){x(v,a)});a.change.forEach(function(a){v.deleteIndex(a.name);x(v,a)});a.del.forEach(function(a){v.deleteIndex(a)});l()})});a._cfg.contentUpgrade&&v.push(function(n,v){var d,b;ba=!0;d=G._createTransaction(V,[].slice.call(n.db.objectStoreNames,0),l);d.idbtrans=n;b=0;d._promise=y(d._promise,
function(a){return function(n,l,d){function c(a){return function(){a.apply(this,arguments);0==--b&&v()}}return++b,a.call(this,n,function(a,n){arguments[0]=c(a);arguments[1]=c(n);l.apply(this,arguments)},d)}});n.onerror=u(e,["running upgrader function for version",a._cfg.version]);d.on("error").subscribe(e);a._cfg.contentUpgrade(d);0===b&&v()});ba&&(0<=navigator.userAgent.indexOf("Trident")||0<=navigator.userAgent.indexOf("MSIE"))||v.push(function(a,n){for(var v,d=0;d<a.db.objectStoreNames.length;++d)v=
a.db.objectStoreNames[d],null!==l[v]&&l[v]!==b||a.db.deleteObjectStore(v);n()})});Z=function(){try{v.length?v.shift()(c,Z):wa(T,c)}catch(a){g.onerror=c.onerror=function(a){a.preventDefault()};try{c.abort()}catch(n){}c.db.close();e(a)}};Z()}}function M(a,d){var b={del:[],add:[],change:[]},c,l,v,n,ba,e,u,g;for(c in a)d[c]||b.del.push(c);for(c in d)if(l=a[c],v=d[c],l)if(n={name:c,def:d[c],recreate:!1,del:[],add:[],change:[]},l.primKey.src!==v.primKey.src)n.recreate=!0,b.change.push(n);else{ba=l.indexes.reduce(function(a,
n){return a[n.name]=n,a},{});v=v.indexes.reduce(function(a,n){return a[n.name]=n,a},{});for(e in ba)v[e]||n.del.push(e);for(e in v)u=ba[e],g=v[e],u?u.src!==g.src&&n.change.push(g):n.add.push(g);(n.recreate||0<n.del.length||0<n.add.length||0<n.change.length)&&b.change.push(n)}else b.add.push([c,v]);return b}function A(a,d,b,c){var l=a.db.createObjectStore(d,b.keyPath?{keyPath:b.keyPath,autoIncrement:b.auto}:{autoIncrement:b.auto});return c.forEach(function(a){x(l,a)}),l}function wa(a,d){Object.keys(a).forEach(function(b){d.db.objectStoreNames.contains(b)||
A(d,b,a[b].primKey,a[b].indexes)})}function x(a,d){a.createIndex(d.name,d.keyPath,{unique:d.unique,multiEntry:d.multi})}function C(a,d){throw new I("Table "+d[0]+" not part of transaction. Original Scope Function Source: "+h.Promise.PSD.trans.scopeFunc.toString());}function ha(a,d,b,e){this.name=a;this.schema=b;this.hook=W[a]?W[a].hook:z(null,{creating:[f,w],reading:[R,r],updating:[k,w],deleting:[c,w]});this._tpf=d;this._collClass=e||ea}function ya(a,d,b,c){ha.call(this,a,d,b,c||J)}function H(a,d,
b,c){function l(a,n,l,d){return v._promise(a,l,d)}var v=this,n,ba;this.db=G;this.mode=a;this.storeNames=d;this.idbtrans=null;this.on=z(this,["complete","error"],"abort");this._reculock=0;this._blockedFuncs=[];this._psd=null;this.active=!0;this._dbschema=b;c&&(this.parent=c);this._tpf=l;this.tables=Object.create(ma);for(c=d.length-1;-1!==c;--c)n=d[c],ba=G._tableFactory(a,b[n],l),this.tables[n]=ba,this[n]||(this[n]=ba)}function na(a,d,b){this._ctx={table:a,index:":id"===d?null:d,collClass:a._collClass,
or:b}}function ea(a,d){var b=null,c=null,l;if(d)try{b=d()}catch(v){c=v}l=a._ctx;this._ctx={table:l.table,index:l.index,isPrimKey:!l.index||l.table.schema.primKey.keyPath&&l.index===l.table.schema.primKey.name,range:b,op:"openCursor",dir:"next",unique:"",algorithm:null,filter:null,isMatch:null,offset:0,limit:Infinity,error:c,or:l.or}}function J(){ea.apply(this,arguments)}function Q(a,d){return a._cfg.version-d._cfg.version}function Ia(a,b,c,e,l,v){c.forEach(function(n){var c=G._tableFactory(e,l[n],
b);a.forEach(function(a){a[n]||(v?Object.defineProperty(a,n,{configurable:!0,enumerable:!0,get:function(){var a=d.PSD&&d.PSD.trans;return a&&a.db===G?a.tables[n]:c}}):a[n]=c)})})}function Na(a){a.forEach(function(a){for(var d in a)a[d]instanceof ha&&delete a[d]})}function ra(a,b,c,e,l,v){var n=d.PSD;v=v||r;a.onerror||(a.onerror=u(l));a.onsuccess=b?Ka(function(){var n=a.result,d;n?(d=function(){n.continue()},b(n,function(a){d=a},e,l)&&c(v(n.value),n,function(a){d=a}),d()):e()},l,n):Ka(function(){var n=
a.result,l;n?(l=function(){n.continue()},c(v(n.value),n,function(a){l=a}),l()):e()},l,n)}function za(a){var d=[];return a.split(",").forEach(function(a){a=a.trim();var b=a.replace("&","").replace("++","").replace("*",""),l=0!==b.indexOf("[")?b:a.substring(a.indexOf("[")+1,a.indexOf("]")).split("+");d.push(new sa(b,l||null,-1!==a.indexOf("&"),-1!==a.indexOf("*"),-1!==a.indexOf("++"),Array.isArray(l),-1!==l.indexOf(".")))}),d}function aa(a,d){return a<d?-1:a>d?1:0}function Aa(a,d){return a<d?1:a>d?
-1:0}function Ba(a){return function(d,b){for(var c=0,l;;){if(l=a(d[c],b[c]),0!==l)return l;if(++c,c===d.length||c===b.length)return a(d.length,b.length)}}}function ia(a,d){return a?d?function(){return a.apply(this,arguments)&&d.apply(this,arguments)}:a:d}function Ea(){if(G.verno=U.version/10,G._dbSchema=T={},ca=[].slice.call(U.objectStoreNames,0),0!==ca.length){var a=U.transaction(E(ca),"readonly");ca.forEach(function(d){for(var b,c=a.objectStore(d),l=c.keyPath,v=l&&"string"==typeof l&&-1!==l.indexOf("."),
n=new sa(l,l||"",!1,!1,!!c.autoIncrement,l&&"string"!=typeof l,v),e=[],Z=0;Z<c.indexNames.length;++Z)b=c.index(c.indexNames[Z]),v=(l=b.keyPath)&&"string"==typeof l&&-1!==l.indexOf("."),b=new sa(b.name,l,!!b.unique,!!b.multiEntry,!1,l&&"string"!=typeof l,v),e.push(b);T[d]=new Ca(d,n,e,{})});Ia([W],G._transPromiseFactory,Object.keys(T),V,T)}}function xa(a,d){for(var b,c,l,v,n=d.db.objectStoreNames,e=0;e<n.length;++e)for(b=n[e],c=d.objectStore(b),l=0;l<c.indexNames.length;++l){var Z=c.indexNames[l],
g=c.index(Z).keyPath,g="string"==typeof g?g:"["+[].slice.call(g).join("+")+"]";a[b]&&(v=a[b].idxByName[g],v&&(v.name=Z))}}var Ha=ka&&ka.addons||h.addons,oa=h.dependencies,pa=oa.indexedDB,Y=oa.IDBKeyRange,ta=oa.TypeError,I=oa.Error,T=this._dbSchema={},da=[],ca=[],W={},ma={},U=null,ua=!0,qa=null,Da=!1,V="readwrite",G=this,ja=[],va=!0,Ja=!!L();this.version=function(a){if(U)throw new I("Cannot add version when database is open");this.verno=Math.max(this.verno,a);var d=da.filter(function(d){return d._cfg.version===
a})[0];return d?d:(d=new la(a),da.push(d),da.sort(Q),d)};B(la.prototype,{stores:function(a){var d,b;return this._cfg.storesSource=this._cfg.storesSource?B(this._cfg.storesSource,a):a,d={},da.forEach(function(a){B(d,a._cfg.storesSource)}),b=this._cfg.dbschema={},this._parseStoresSpec(d,b),T=G._dbSchema=b,Na([W,G,ma]),Ia([ma],C,Object.keys(b),V,b),Ia([W,G,this._cfg.tables],G._transPromiseFactory,Object.keys(b),V,b,!0),ca=Object.keys(b),this},upgrade:function(a){var d=this;return F(function(){a(G._createTransaction(V,
Object.keys(d._cfg.dbschema),d._cfg.dbschema))}),this._cfg.contentUpgrade=a,this},_parseStoresSpec:function(a,d){Object.keys(a).forEach(function(b){if(null!==a[b]){var c={},l=za(a[b]),v=l.shift();if(v.multi)throw new I("Primary key cannot be multi-valued");v.keyPath&&N(c,v.keyPath,v.auto?0:v.keyPath);l.forEach(function(a){if(a.auto)throw new I("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new I("Index must have a name and cannot be an empty string");N(c,a.keyPath,a.compound?
a.keyPath.map(function(){return""}):"")});d[b]=new Ca(b,v,l,c)}})}});this._allTables=W;this._tableFactory=function(a,d,b){return"readonly"===a?new ha(d.name,b,d,ea):new ya(d.name,b,d)};this._createTransaction=function(a,d,b,c){return new H(a,d,b,c)};this._transPromiseFactory=function(a,b,c){var e,l;return!ua||d.PSD&&d.PSD.letThrough?(l=G._createTransaction(a,b,T),l._promise(a,function(a,n){l.error(function(a){G.on("error").fire(a)});c(function(n){l.complete(function(){a(n)})},n,l)})):e=new d(function(d,
n){ja.push({resume:function(){var l=G._transPromiseFactory(a,b,c);e.onuncatched=l.onuncatched;l.then(d,n)}})})};this._whenReady=function(a){return P||!ua||d.PSD&&d.PSD.letThrough?new d(a):new d(function(d,b){ja.push({resume:function(){a(d,b)}})})};this.verno=0;this.open=function(){return new d(function(b,c){function e(a){try{g.transaction.abort()}catch(d){}Da=!1;qa=a;ua=!1;c(qa);ja.forEach(function(a){a.resume()});ja=[]}if(P&&b(G),U||Da)throw new I("Database already opened or being opened");var g;
try{if(qa=null,Da=!0,0<da.length&&(va=!1),!pa)throw new I("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");if(g=va?pa.open(a):pa.open(a,Math.round(10*G.verno)),!g)throw new I("IndexedDB API not available");g.onerror=u(e,["opening database",a]);g.onblocked=function(a){G.on("blocked").fire(a)};g.onupgradeneeded=Ka(function(d){var b,n;va&&!G._allowEmptyDB?(g.onerror=function(a){a.preventDefault()},
g.transaction.abort(),g.result.close(),b=pa.deleteDatabase(a),b.onsuccess=b.onerror=function(){e(new I("Database '"+a+"' doesnt exist"))}):(g.transaction.onerror=u(e),n=d.oldVersion>Math.pow(2,62)?0:d.oldVersion,t(n/10,g.transaction,e,g))},e);g.onsuccess=Ka(function(){Da=!1;U=g.result;va?Ea():0<U.objectStoreNames.length&&xa(T,U.transaction(E(U.objectStoreNames),"readonly"));U.onversionchange=G.on("versionchange").fire;Ja||Oa(function(d){if(-1===d.indexOf(a))return d.push(a)});d.newPSD(function(){function a(){ua=
!1;ja.forEach(function(a){a.resume()});ja=[];b(G)}d.PSD.letThrough=!0;try{var v=G.on.ready.fire();v&&"function"==typeof v.then?v.then(a,function(a){U.close();U=null;e(a)}):D(a)}catch(n){e(n)}})},e)}catch(l){e(l)}})};this.close=function(){U&&(U.close(),U=null,ua=!0,qa=null)};this.delete=function(){var b=arguments;return new d(function(d,c){function e(){G.close();var b=pa.deleteDatabase(a);b.onsuccess=function(){Ja||Oa(function(d){var n=d.indexOf(a);if(0<=n)return d.splice(n,1)});d()};b.onerror=u(c,
["deleting",a]);b.onblocked=function(){G.on("blocked").fire()}}if(0<b.length)throw new I("Arguments not allowed in db.delete()");Da?ja.push({resume:e}):e()})};this.backendDB=function(){return U};this.isOpen=function(){return null!==U};this.hasFailed=function(){return null!==qa};this.dynamicallyOpened=function(){return va};this.name=a;Object.defineProperty(this,"tables",{get:function(){return Object.keys(W).map(function(a){return W[a]})}});this.on=z(this,"error","populate","blocked",{ready:[Ya,w],
versionchange:[X,w]});this.on.ready.subscribe=y(this.on.ready.subscribe,function(a){return function(d,b){function c(){return b||G.on.ready.unsubscribe(c),d.apply(this,arguments)}a.call(this,c);G.isOpen()&&(ua?ja.push({resume:c}):c())}});F(function(){G.on("populate").fire(G._createTransaction(V,ca,T));G.on("error").fire(new I)});this.transaction=function(a,b,c){function e(b,v){var g=null,u,f,S;try{if(n)throw n;g=G._createTransaction(a,ba,T,l);u=ba.map(function(a){return g.tables[a]});u.push(g);S=0;
d.newPSD(function(){d.PSD.trans=g;g.scopeFunc=c;l&&(g.idbtrans=l.idbtrans,g._promise=y(g._promise,function(a){return function(n,b,l){function c(a){return function(n){var b;return d._rootExec(function(){b=a(n);d._tickFinalize(function(){0==--S&&g.active&&(g.active=!1,g.on.complete.fire())})}),b}}return++S,a.call(this,n,function(a,n,d){return b(c(a),c(n),d)},l)}}));g.complete(function(){b(f)});g.error(function(a){g.idbtrans&&(g.idbtrans.onerror=Xa);try{g.abort()}catch(n){}l&&(l.active=!1,l.on.error.fire(a));
var d=v(a);l||d||G.on.error.fire(a)});d._rootExec(function(){f=c.apply(g,u)})});(!g.idbtrans||l&&0===S)&&g._nop()}catch(p){g&&g.idbtrans&&(g.idbtrans.onerror=Xa),g&&g.abort(),l&&l.on.error.fire(p),D(function(){v(p)||G.on("error").fire(p)})}}var l,v;b=[].slice.call(arguments,1,arguments.length-1);c=arguments[arguments.length-1];(l=d.PSD&&d.PSD.trans)&&l.db===G&&-1===a.indexOf("!")||(l=null);v=-1!==a.indexOf("?");a=a.replace("!","").replace("?","");var n=null,ba=(Array.isArray(b[0])?b.reduce(function(a,
n){return a.concat(n)}):b).map(function(a){return"string"==typeof a?a:(a instanceof ha||(n=n||new ta("Invalid type. Arguments following mode must be instances of Table or String")),a.name)});return"r"==a||"readonly"==a?a="readonly":"rw"==a||a==V?a=V:n=new I("Invalid transaction mode: "+a),l&&(n||(l&&"readonly"===l.mode&&a===V&&(v?l=null:n=n||new I("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")),l&&ba.forEach(function(a){l.tables.hasOwnProperty(a)||(v?l=null:
n=n||new I("Table "+a+" not included in parent transaction. Parent Transaction function: "+l.scopeFunc.toString()))}))),l?l._promise(a,e,"lock"):G._whenReady(e)};this.table=function(a){if(P&&va)return new ya(a);if(!W.hasOwnProperty(a))throw new I("Table does not exist");return W[a]};B(ha.prototype,function(){function a(){throw new I("Current Transaction is READONLY");}return{_trans:function(a,d,b){return this._tpf(a,[this.name],d,b)},_idbstore:function(a,b,c){if(P)return new d(b);var l=this;return this._tpf(a,
[this.name],function(a,d,c){b(a,d,c.idbtrans.objectStore(l.name),c)},c)},get:function(a,d){var b=this;return this._idbstore("readonly",function(d,c,n){P&&d(b.schema.instanceTemplate);var e=n.get(a);e.onerror=u(c,["getting",a,"from",b.name]);e.onsuccess=function(){d(b.hook.reading.fire(e.result))}}).then(d)},where:function(a){return new na(this,a)},count:function(a){return this.toCollection().count(a)},offset:function(a){return this.toCollection().offset(a)},limit:function(a){return this.toCollection().limit(a)},
reverse:function(){return this.toCollection().reverse()},filter:function(a){return this.toCollection().and(a)},each:function(a){var d=this;return P&&a(d.schema.instanceTemplate),this._idbstore("readonly",function(b,c,v){v=v.openCursor();v.onerror=u(c,["calling","Table.each()","on",d.name]);ra(v,null,a,b,c,d.hook.reading.fire)})},toArray:function(a){var d=this;return this._idbstore("readonly",function(a,b,c){P&&a([d.schema.instanceTemplate]);var n=[];c=c.openCursor();c.onerror=u(b,["calling","Table.toArray()",
"on",d.name]);ra(c,null,function(a){n.push(a)},function(){a(n)},b,d.hook.reading.fire)}).then(a)},orderBy:function(a){return new this._collClass(new na(this,a))},toCollection:function(){return new this._collClass(new na(this))},mapToClass:function(a,d){var b,c;return this.schema.mappedClass=a,b=Object.create(a.prototype),d&&e(b,d),this.schema.instanceTemplate=b,c=function(d){var n,b;if(!d)return d;n=Object.create(a.prototype);for(b in d)d.hasOwnProperty(b)&&(n[b]=d[b]);return n},this.schema.readHook&&
this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=c,this.hook("reading",c),a},defineClass:function(a){return this.mapToClass(h.defineClass(a),a)},add:a,put:a,"delete":a,clear:a,update:a}});m(ya).from(ha).extend(function(){return{add:function(a,d){var c=this,e=this.hook.creating.fire;return this._idbstore(V,function(l,v,n,g){var Z={},S,f,F;e!==w&&(S=d||(n.keyPath?p(a,n.keyPath):b),f=e.call(Z,S,a,g),S===b&&f!==b&&(n.keyPath?N(a,n.keyPath,f):d=f));F=d?n.add(a,d):n.add(a);F.onerror=
u(function(a){if(Z.onerror)Z.onerror(a);return v(a)},["adding",a,"into",c.name]);F.onsuccess=function(d){var b=n.keyPath;if(b&&N(a,b,d.target.result),Z.onsuccess)Z.onsuccess(d.target.result);l(F.result)}})},put:function(a,d){var c=this,e=this.hook.updating.fire;return this.hook.creating.fire!==w||e!==w?this._trans(V,function(l,v,n){var e=d||c.schema.primKey.keyPath&&p(a,c.schema.primKey.keyPath);e===b?n.tables[c.name].add(a).then(l,v):(n._lock(),a=g(a),n.tables[c.name].where(":id").equals(e).modify(function(){this.value=
a}).then(function(b){return 0===b?n.tables[c.name].add(a,d):e}).finally(function(){n._unlock()}).then(l,v))}):this._idbstore(V,function(b,v,n){var e=d?n.put(a,d):n.put(a);e.onerror=u(v,["putting",a,"into",c.name]);e.onsuccess=function(d){var c=n.keyPath;c&&N(a,c,d.target.result);b(e.result)}})},"delete":function(a){return this.hook.deleting.subscribers.length?this.where(":id").equals(a).delete():this._idbstore(V,function(d,b,c){var l=c.delete(a);l.onerror=u(b,["deleting",a,"from",c.name]);l.onsuccess=
function(){d(l.result)}})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(V,function(a,d,b){var c=b.clear();c.onerror=u(d,["clearing",b.name]);c.onsuccess=function(){a(c.result)}})},update:function(a,c){if("object"!=typeof c||Array.isArray(c))throw new I("db.update(keyOrObject, modifications). modifications must be an object.");if("object"!=typeof a||Array.isArray(a))return this.where(":id").equals(a).modify(c);Object.keys(c).forEach(function(d){N(a,
d,c[d])});var e=p(a,this.schema.primKey.keyPath);return e===b&&d.reject(new I("Object does not contain its primary key")),this.where(":id").equals(e).modify(c)}}});B(H.prototype,{_lock:function(){return++this._reculock,1===this._reculock&&d.PSD&&(d.PSD.lockOwnerFor=this),this},_unlock:function(){if(0==--this._reculock)for(d.PSD&&(d.PSD.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var a=this._blockedFuncs.shift();try{a()}catch(b){}}return this},_locked:function(){return this._reculock&&
(!d.PSD||d.PSD.lockOwnerFor!==this)},_nop:function(a){this.tables[this.storeNames[0]].get(0).then(a)},_promise:function(a,b,c){var e=this;return d.newPSD(function(){var l;return e._locked()?l=new d(function(d,n){e._blockedFuncs.push(function(){e._promise(a,b,c).then(d,n)})}):(l=e.active?new d(function(d,n){if(!e.idbtrans&&a){if(!U)throw qa?new I("Database not open. Following error in populate, ready or upgrade function made Dexie.open() fail: "+qa):new I("Database not open");var l=e.idbtrans=U.transaction(E(e.storeNames),
e.mode);l.onerror=function(a){e.on("error").fire(a&&a.target.error);a.preventDefault();e.abort()};l.onabort=function(a){D(function(){e.on("error").fire(new I("Transaction aborted for unknown reason"))});e.active=!1;e.on("abort").fire(a)};l.oncomplete=function(a){e.active=!1;e.on("complete").fire(a)}}c&&e._lock();try{b(d,n,e)}catch(g){h.ignoreTransaction(function(){e.on("error").fire(g)}),e.abort(),n(g)}}):d.reject(fa(new I("Transaction is inactive. Original Scope Function Source: "+e.scopeFunc.toString()))),
e.active&&c&&l.finally(function(){e._unlock()})),l.onuncatched=function(a){h.ignoreTransaction(function(){e.on("error").fire(a)});e.abort()},l})},complete:function(a){return this.on("complete",a)},error:function(a){return this.on("error",a)},abort:function(){if(this.idbtrans&&this.active)try{this.active=!1,this.idbtrans.abort(),this.on.error.fire(new I("Transaction Aborted"))}catch(a){}},table:function(a){if(!this.tables.hasOwnProperty(a))throw new I("Table "+a+" not in transaction");return this.tables[a]}});
B(na.prototype,function(){function a(d,b){try{throw b;}catch(c){d._ctx.error=c}return d}function d(a){return Array.prototype.slice.call(1===a.length&&Array.isArray(a[0])?a[0]:a)}function b(a){return"next"===a?function(a){return a.toUpperCase()}:function(a){return a.toLowerCase()}}function c(a){return"next"===a?function(a){return a.toLowerCase()}:function(a){return a.toUpperCase()}}function l(a,d,b,c,l,e){for(var v,g=Math.min(a.length,c.length),u=-1,f=0;f<g;++f){if(v=d[f],v!==c[f])return 0>l(a[f],
b[f])?a.substr(0,f)+b[f]+b.substr(f+1):0>l(a[f],c[f])?a.substr(0,f)+c[f]+b.substr(f+1):0<=u?a.substr(0,u)+d[u]+b.substr(u+1):null;0>l(a[f],v)&&(u=f)}return g<c.length&&"next"===e?a+b.substr(a.length):g<a.length&&"prev"===e?a.substr(0,b.length):0>u?null:a.substr(0,u)+c[u]+b.substr(u+1)}function e(a,d,v){function g(a){u=b(a);f=c(a);S="next"===a?aa:Aa;p=u(v);F=f(v);ka=a}var u,f,S,p,F,ka;g("next");a._ondirectionchange=function(a){g(a)};a._addAlgorithm(function(a,b,c){var n=a.key,e,v;return"string"!=typeof n?
!1:(e=f(n),d(e,F)?(b(function(){a.continue()}),!0):(v=l(n,e,p,F,S,ka),v?b(function(){a.continue(v)}):b(c),!1))})}return{between:function(a,d,b,c){return(b=!1!==b,c=!0===c,a>d||!(a!==d||!b&&!c||b&&c))?(new this._ctx.collClass(this,function(){return Y.only(a)})).limit(0):new this._ctx.collClass(this,function(){return Y.bound(a,d,!b,!c)})},equals:function(a){return new this._ctx.collClass(this,function(){return Y.only(a)})},above:function(a){return new this._ctx.collClass(this,function(){return Y.lowerBound(a,
!0)})},aboveOrEqual:function(a){return new this._ctx.collClass(this,function(){return Y.lowerBound(a)})},below:function(a){return new this._ctx.collClass(this,function(){return Y.upperBound(a,!0)})},belowOrEqual:function(a){return new this._ctx.collClass(this,function(){return Y.upperBound(a)})},startsWith:function(d){return"string"!=typeof d?a(new this._ctx.collClass(this),new ta("String expected")):this.between(d,d+String.fromCharCode(65535),!0,!0)},startsWithIgnoreCase:function(d){if("string"!=
typeof d)return a(new this._ctx.collClass(this),new ta("String expected"));if(""===d)return this.startsWith(d);var b=new this._ctx.collClass(this,function(){return Y.bound(d.toUpperCase(),d.toLowerCase()+String.fromCharCode(65535))});return e(b,function(a,d){return 0===a.indexOf(d)},d),b._ondirectionchange=function(){a(b,new I("reverse() not supported with WhereClause.startsWithIgnoreCase()"))},b},equalsIgnoreCase:function(d){if("string"!=typeof d)return a(new this._ctx.collClass(this),new ta("String expected"));
var b=new this._ctx.collClass(this,function(){return Y.bound(d.toUpperCase(),d.toLowerCase())});return e(b,function(a,d){return a===d},d),b},anyOf:function(){var a=this._ctx,b=a.table.schema,c=(a=a.index?b.idxByName[a.index]:b.primKey)&&a.compound,l=d(arguments),e=c?Ba(aa):aa,v,g;return(l.sort(e),0===l.length)?(new this._ctx.collClass(this,function(){return Y.only("")})).limit(0):(v=new this._ctx.collClass(this,function(){return Y.bound(l[0],l[l.length-1])}),v._ondirectionchange=function(a){e="next"===
a?aa:Aa;c&&(e=Ba(e));l.sort(e)},g=0,v._addAlgorithm(function(a,d,b){for(var c=a.key;0<e(c,l[g]);)if(++g,g===l.length)return d(b),!1;return 0===e(c,l[g])?(d(function(){a.continue()}),!0):(d(function(){a.continue(l[g])}),!1)}),v)},notEqual:function(a){return this.below(a).or(this._ctx.index).above(a)},noneOf:function(){var a=this._ctx,b=a.table.schema,b=(b=a.index?b.idxByName[a.index]:b.primKey)&&b.compound,c=d(arguments),l,e,v,g;return 0===c.length?new this._ctx.collClass(this):(l=b?Ba(aa):aa,c.sort(l),
e=c.reduce(function(a,d){return a?a.concat([[a[a.length-1][1],d]]):[[null,d]]},null),e.push([c[c.length-1],null]),v=this,g=a.index,e.reduce(function(a,d){return a?null===d[1]?a.or(g).above(d[0]):a.or(g).between(d[0],d[1],!1,!1):v.below(d[1])},null))},startsWithAnyOf:function(){function b(a){return a>v[u]}function c(a){return a<e[u]}var l=this._ctx,e=d(arguments),v,g,u,f,S;return e.every(function(a){return"string"==typeof a})?0===e.length?(new l.collClass(this,function(){return Y.only("")})).limit(0):
(v=e.map(function(a){return a+String.fromCharCode(65535)}),g=aa,e.sort(g),u=0,f=b,S=new l.collClass(this,function(){return Y.bound(e[0],e[e.length-1]+String.fromCharCode(65535))}),S._ondirectionchange=function(a){"next"===a?(f=b,g=aa):(f=c,g=Aa);e.sort(g);v.sort(g)},S._addAlgorithm(function(a,d,b){for(var c=a.key;f(c);)if(++u,u===e.length)return d(b),!1;return c>=e[u]&&c<=v[u]?(d(function(){a.continue()}),!0):(d(function(){g===aa?a.continue(e[u]):a.continue(v[u])}),!1)}),S):a(new l.collClass(this),
new ta("startsWithAnyOf() only works with strings"))}}});B(ea.prototype,function(){function a(d,b){d.filter=ia(d.filter,b)}function b(a,d){a.isMatch=ia(a.isMatch,d)}function c(a,d){if(a.isPrimKey)return d;var b=a.table.schema.idxByName[a.index];if(!b)throw new I("KeyPath "+a.index+" on object store "+d.name+" is not indexed");return a.isPrimKey?d:d.index(b.name)}function e(a,d){return c(a,d)[a.op](a.range||null,a.dir+a.unique)}function l(a,d,b,c,l){a.or?function(){function g(){2==++F&&b()}function u(a,
b,e){if(!f||f(b,e,g,c)){var l=b.primaryKey.toString();S.hasOwnProperty(l)||(S[l]=!0,d(a,b,e))}}var f=a.filter,S={},F=0;a.or._iterate(u,g,c,l);ra(e(a,l),a.algorithm,u,g,c,a.table.hook.reading.fire)}():ra(e(a,l),ia(a.algorithm,a.filter),d,b,c,a.table.hook.reading.fire)}return{_read:function(a,d){var b=this._ctx;return b.error?b.table._trans(null,function(a,d){d(b.error)}):b.table._idbstore("readonly",a).then(d)},_write:function(a){var d=this._ctx;return d.error?d.table._trans(null,function(a,b){b(d.error)}):
d.table._idbstore(V,a,"locked")},_addAlgorithm:function(a){var d=this._ctx;d.algorithm=ia(d.algorithm,a)},_iterate:function(a,d,b,c){return l(this._ctx,a,d,b,c)},each:function(a){var d=this._ctx;return P&&a(d.table.schema.instanceTemplate),this._read(function(b,c,e){l(d,a,b,c,e)})},count:function(a){var b,e,g;return P?d.resolve(0).then(a):(b=this,e=this._ctx,e.filter||e.algorithm||e.or?(g=0,this._read(function(a,d,b){l(e,function(){return++g,!1},function(){a(g)},d,b)},a)):this._read(function(a,d,
l){l=c(e,l);l=e.range?l.count(e.range):l.count();l.onerror=u(d,["calling","count()","on",b.name]);l.onsuccess=function(d){a(Math.min(d.target.result,Math.max(0,e.limit-e.offset)))}},a))},sortBy:function(a,d){function b(a,d){return d?b(a[e[d]],d-1):a[l]}function c(a,d){var e=b(a,g),l=b(d,g);return e<l?-u:e>l?u:0}var e=a.split(".").reverse(),l=e[0],g=e.length-1,u="next"===this._ctx.dir?1:-1;return this.toArray(function(a){return a.sort(c)}).then(d)},toArray:function(a){var d=this._ctx;return this._read(function(a,
b,c){P&&a([d.table.schema.instanceTemplate]);var e=[];l(d,function(a){e.push(a)},function(){a(e)},b,c)},a)},offset:function(d){var b=this._ctx;return 0>=d?this:(b.offset+=d,b.or||b.algorithm||b.filter?a(b,function(){return 0>--d}):a(b,function(a,b){return 0===d?!0:1===d?(--d,!1):(b(function(){a.advance(d);d=0}),!1)}),this)},limit:function(d){return this._ctx.limit=Math.min(this._ctx.limit,d),a(this._ctx,function(a,b,c){return 0>=--d&&b(c),0<=d}),this},until:function(d,b){var c=this._ctx;return P&&
d(c.table.schema.instanceTemplate),a(this._ctx,function(a,c,e){return d(a.value)?(c(e),b):!0}),this},first:function(a){return this.limit(1).toArray(function(a){return a[0]}).then(a)},last:function(a){return this.reverse().first(a)},and:function(d){return P&&d(this._ctx.table.schema.instanceTemplate),a(this._ctx,function(a){return d(a.value)}),b(this._ctx,d),this},or:function(a){return new na(this._ctx.table,a,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&
this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(a){var d=this._ctx;return P&&a(p(this._ctx.table.schema.instanceTemplate,this._ctx.index?this._ctx.table.schema.idxByName[this._ctx.index].keyPath:this._ctx.table.schema.primKey.keyPath)),d.isPrimKey||(d.op="openKeyCursor"),this.each(function(d,b){a(b.key,b)})},eachUniqueKey:function(a){return this._ctx.unique="unique",this.eachKey(a)},keys:function(a){var b=this._ctx,c;return(b.isPrimKey||(b.op="openKeyCursor"),
c=[],P)?(new d(this.eachKey.bind(this))).then(function(a){return[a]}).then(a):this.each(function(a,d){c.push(d.key)}).then(function(){return c}).then(a)},uniqueKeys:function(a){return this._ctx.unique="unique",this.keys(a)},firstKey:function(a){return this.limit(1).keys(function(a){return a[0]}).then(a)},lastKey:function(a){return this.reverse().firstKey(a)},distinct:function(){var d={};return a(this._ctx,function(a){a=a.primaryKey.toString();var b=d.hasOwnProperty(a);return d[a]=!0,!b}),this}}});
m(J).from(ea).extend({modify:function(a){var d=this,b=this._ctx,c=b.table.hook,e=c.updating.fire,v=c.deleting.fire;return P&&"function"==typeof a&&a.call({value:b.table.schema.instanceTemplate},b.table.schema.instanceTemplate),this._write(function(c,f,S,F){function ka(a){return a&&(z.push(a),A.push(X)),f(new q("Error modifying one or more objects",z,k,A))}function fa(){P&&k+z.length===D&&(0<z.length?ka():c(k))}var la,h,t,M;"function"==typeof a?la=e===w&&v===w?a:function(d){var b=g(d),c,n;if(!1===
a.call(this,d))return!1;this.hasOwnProperty("value")?(c=O(b,this.value),n=e.call(this,c,this.primKey,b,F),n&&(d=this.value,Object.keys(n).forEach(function(a){N(d,a,n[a])}))):v.call(this,this.primKey,d,F)}:e===w?(h=Object.keys(a),t=h.length,la=function(d){for(var b,c,e=!1,l=0;l<t;++l)b=h[l],c=a[b],p(d,b)!==c&&(N(d,b,c),e=!0);return e}):(M=a,a=K(M),la=function(d){var b=!1,c=e.call(this,a,this.primKey,g(d),F);return c&&B(a,c),Object.keys(a).forEach(function(c){var e=a[c];p(d,c)!==e&&(N(d,c,e),b=!0)}),
c&&(a=K(M)),b});var D=0,k=0,P=!1,z=[],A=[],X=null;d._iterate(function(a,d){var c,e,l;if(X=d.primaryKey,c={primKey:d.primaryKey,value:a},!1!==la.call(c,a))l=(e=!c.hasOwnProperty("value"))?d.delete():d.update(c.value),++D,l.onerror=u(function(a){if(z.push(a),A.push(c.primKey),c.onerror)c.onerror(a);return fa(),!0},e?["deleting",a,"from",b.table.name]:["modifying",a,"on",b.table.name]),l.onsuccess=function(){if(c.onsuccess)c.onsuccess(c.value);++k;fa()};else if(c.onsuccess)c.onsuccess(c.value)},function(){P=
!0;fa()},ka,S)})},"delete":function(){return this.modify(function(){delete this.value})}});B(this,{Collection:ea,Table:ha,Transaction:H,Version:la,WhereClause:na,WriteableCollection:J,WriteableTable:ya});(function(){G.on("versionchange",function(){G.close();G.on("error").fire(new I("Database version changed by other database connection."))})})();Ha.forEach(function(a){a(G)})}function w(){}function r(a){return a}function R(a,d){return a===r?d:function(b){return d(a(b))}}function a(a,d){return function(){a.apply(this,
arguments);d.apply(this,arguments)}}function f(d,c){return d===w?c:function(){var e=d.apply(this,arguments),g,u,f;return e!==b&&(arguments[0]=e),g=this.onsuccess,u=this.onerror,delete this.onsuccess,delete this.onerror,f=c.apply(this,arguments),g&&(this.onsuccess=this.onsuccess?a(g,this.onsuccess):g),u&&(this.onerror=this.onerror?a(u,this.onerror):u),f!==b?f:e}}function k(d,c){return d===w?c:function(){var e=d.apply(this,arguments),g,u,f;return e!==b&&B(arguments[0],e),g=this.onsuccess,u=this.onerror,
delete this.onsuccess,delete this.onerror,f=c.apply(this,arguments),g&&(this.onsuccess=this.onsuccess?a(g,this.onsuccess):g),u&&(this.onerror=this.onerror?a(u,this.onerror):u),e===b?f===b?b:f:f===b?e:B(e,f)}}function t(a,d){return a===w?d:function(){return!1===a.apply(this,arguments)?!1:d.apply(this,arguments)}}function X(a,d){return a===w?d:function(){return!1===d.apply(this,arguments)?!1:a.apply(this,arguments)}}function c(a,d){return a===w?d:function(){a.apply(this,arguments);d.apply(this,arguments)}}
function Ya(a,d){return a===w?d:function(){var b=a.apply(this,arguments),c,e;return b&&"function"==typeof b.then?(c=this,e=arguments,b.then(function(){return d.apply(c,e)})):d.apply(this,arguments)}}function z(a){function d(a,e,f){if(Array.isArray(a))return c(a);if("object"==typeof a)return b(a);e||(e=t);f||(f=w);var F={subscribers:[],fire:f,subscribe:function(a){F.subscribers.push(a);F.fire=e(F.fire,a)},unsubscribe:function(a){F.subscribers=F.subscribers.filter(function(d){return d!==a});F.fire=
F.subscribers.reduce(e,f)}};return g[a]=u[a]=F,F}function b(a){Object.keys(a).forEach(function(b){var c=a[b],e;if(Array.isArray(c))d(b,a[b][0],a[b][1]);else if("asap"===c)e=d(b,null,function(){var a=arguments;e.subscribers.forEach(function(d){D(function(){d.apply(x,a)})})}),e.subscribe=function(a){-1===e.subscribers.indexOf(a)&&e.subscribers.push(a)},e.unsubscribe=function(a){a=e.subscribers.indexOf(a);-1!==a&&e.subscribers.splice(a,1)};else throw Error("Invalid event config");})}function c(a){function b(){if(e)return!1;
e=!0}var e=!1;a.forEach(function(a){d(a).subscribe(b)})}var e=arguments,g={},u=function(d,b){if(b){var c=[].slice.call(arguments,1),e=g[d];return e.subscribe.apply(e,c),a}if("string"==typeof d)return g[d]},f,F;u.addEventType=d;f=1;for(F=e.length;f<F;++f)d(e[f]);return u}function D(a){x.setImmediate?H(a):setTimeout(a,0)}function A(a){a=setTimeout(a,1E3);clearTimeout(a)}function Ka(a,b,c){return function(){var e=d.PSD;d.PSD=c;try{a.apply(this,arguments)}catch(g){b(g)}finally{d.PSD=e}}}function p(a,
d){var c,e,g,u;if(a.hasOwnProperty(d))return a[d];if(!d)return a;if("string"!=typeof d){c=[];e=0;for(g=d.length;e<g;++e)u=p(a,d[e]),c.push(u);return c}return(c=d.indexOf("."),-1!==c)?(e=a[d.substr(0,c)],e===b?b:p(e,d.substr(c+1))):b}function N(a,d,c){var e,g,u,f;if(a&&d!==b)if("string"!=typeof d&&"length"in d){if(!("string"!=typeof c&&"length"in c))throw Error("Assertion failed");e=0;for(g=d.length;e<g;++e)N(a,d[e],c[e])}else e=d.indexOf("."),-1!==e?(g=d.substr(0,e),u=d.substr(e+1),""===u?c===b?delete a[g]:
a[g]=c:(f=a[g],f||(f=a[g]={}),N(f,u,c))):c===b?delete a[d]:a[d]=c}function K(a){var d={},b;for(b in a)a.hasOwnProperty(b)&&(d[b]=a[b]);return d}function g(a){var d,b,c;if(!a||"object"!=typeof a)return a;if(Array.isArray(a))for(d=[],b=0,c=a.length;b<c;++b)d.push(g(a[b]));else if(a instanceof Date)d=new Date,d.setTime(a.getTime());else for(b in d=a.constructor?Object.create(a.constructor.prototype):{},a)a.hasOwnProperty(b)&&(d[b]=g(a[b]));return d}function O(a,d){var c={},e;for(e in a)a.hasOwnProperty(e)&&
(d.hasOwnProperty(e)?a[e]!==d[e]&&JSON.stringify(a[e])!=JSON.stringify(d[e])&&(c[e]=d[e]):c[e]=b);for(e in d)d.hasOwnProperty(e)&&!a.hasOwnProperty(e)&&(c[e]=d[e]);return c}function M(a){if("function"==typeof a)return new a;if(Array.isArray(a))return[M(a[0])];if(a&&"object"==typeof a){var d={};return e(d,a),d}return a}function e(a,d){Object.keys(d).forEach(function(b){var c=M(d[b]);a[b]=c})}function u(a,d){return function(b){var c=b&&b.target.error||Error(),e;return d&&(e=" occurred when "+d.map(function(a){switch(typeof a){case "function":return a();
case "string":return a;default:return JSON.stringify(a)}}).join(" "),c.name?c.toString=function(){return c.name+e+(c.message?". "+c.message:"")}:c+=e),a(c),b&&(b.stopPropagation&&b.stopPropagation(),b.preventDefault&&b.preventDefault()),!1}}function fa(a){try{throw a;}catch(d){return d}}function Xa(a){a.preventDefault()}function Oa(a){var d,b=h.dependencies.localStorage;if(!b)return a([]);try{d=JSON.parse(b.getItem("Dexie.DatabaseNames")||"[]")}catch(c){d=[]}a(d)&&b.setItem("Dexie.DatabaseNames",
JSON.stringify(d))}function sa(a,d,b,c,e,g,u){this.name=a;this.keyPath=d;this.unique=b;this.multi=c;this.auto=e;this.compound=g;this.dotted=u;a="string"==typeof d?d:d&&"["+[].join.call(d,"+")+"]";this.src=(b?"&":"")+(c?"*":"")+(e?"++":"")+a}function Ca(a,d,b,c){this.name=a;this.primKey=d||new sa;this.indexes=b||[new sa];this.instanceTemplate=c;this.mappedClass=null;this.idxByName=b.reduce(function(a,d){return a[d.name]=d,a},{})}function q(a,d,b,c){this.name="ModifyError";this.failures=d;this.failedKeys=
c;this.successCount=b;this.message=d.join("\n")}function E(a){return 1===a.length?a[0]:a}function L(){var a=h.dependencies.indexedDB,d=a&&(a.getDatabaseNames||a.webkitGetDatabaseNames);return d&&d.bind(a)}var d=function(){function a(d){O.push([d,fa.call(arguments,1)])}function d(){var a=O,b,c,e;O=[];b=0;for(c=a.length;b<c;++b)e=a[b],e[0].apply(x,e[1])}function b(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");
this._value=this._state=null;this._deferreds=[];this._catched=!1;var d=this,c=!0;this._PSD=b.PSD;try{p(this,a,function(a){c?M(g,d,a):g(d,a)},function(a){return c?(M(u,d,a),!1):u(d,a)})}finally{c=!1}}function c(g,u){var f,F,p,fa,q,D;if(null===g._state)g._deferreds.push(u);else{if(f=g._state?u.onFulfilled:u.onRejected,null===f)return(g._state?u.resolve:u.reject)(g._value);p=t;t=!1;M=a;try{fa=b.PSD,b.PSD=g._PSD,F=f(g._value),g._state||F&&"function"==typeof F.then&&!1===F._state||e(g),u.resolve(F)}catch(P){if(q=
u.reject(P),!q&&g.onuncatched)try{g.onuncatched(P)}catch(z){}}finally{if(b.PSD=fa,p){do{for(;0<O.length;)d();if(D=k.pop(),D)try{D()}catch(P){}}while(0<k.length||0<O.length);M=h;t=!0}}}}function e(a){a._catched=!0;a._parent&&e(a._parent)}function g(a,d){var c=b.PSD;b.PSD=a._PSD;try{if(d===a)throw new TypeError("A promise cannot be resolved with itself.");!d||"object"!=typeof d&&"function"!=typeof d||"function"!=typeof d.then?(a._state=!0,a._value=d,f.call(a)):p(a,function(a,b){d.then(a,b)},function(d){g(a,
d)},function(d){u(a,d)})}catch(e){u(e)}finally{b.PSD=c}}function u(a,d){var c=b.PSD;if(b.PSD=a._PSD,a._state=!1,a._value=d,f.call(a),!a._catched)try{if(a.onuncatched)a.onuncatched(a._value);b.on.error.fire(a._value)}catch(e){}return b.PSD=c,a._catched}function f(){for(var a=0,d=this._deferreds.length;a<d;a++)c(this,this._deferreds[a]);this._deferreds=[]}function F(a,d,b,c){this.onFulfilled="function"==typeof a?a:null;this.onRejected="function"==typeof d?d:null;this.resolve=b;this.reject=c}function p(a,
d,b,c){var e=!1;try{d(function(a){e||(e=!0,b(a))},function(d){return e?a._catched:(e=!0,c(d))})}catch(g){return e?void 0:c(g)}}var fa=[].slice,h="undefined"==typeof H?function(a){var d=arguments;setTimeout(function(){a.apply(x,fa.call(d,1))},0)}:H;A(function(){h=M=a=function(a){var d=arguments;setTimeout(function(){a.apply(x,fa.call(d,1))},0)}});var M=h,t=!0,O=[],k=[];return b.on=z(null,"error"),b.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&Array.isArray(arguments[0])?arguments[0]:
arguments);return new b(function(d,b){function c(g,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var f=u.then;if("function"==typeof f){f.call(u,function(a){c(g,a)},b);return}}a[g]=u;0==--e&&d(a)}catch(F){b(F)}}var e,g;if(0===a.length)return d([]);e=a.length;for(g=0;g<a.length;g++)c(g,a[g])})},b.prototype.then=function(a,d){var e=this,g=new b(function(b,g){null===e._state?c(e,new F(a,d,b,g)):M(c,e,new F(a,d,b,g))});return g._PSD=this._PSD,g.onuncatched=this.onuncatched,g._parent=this,g},
b.prototype._then=function(a,d){c(this,new F(a,d,w,w))},b.prototype["catch"]=function(a){if(1===arguments.length)return this.then(null,a);var d=arguments[0],c=arguments[1];return"function"==typeof d?this.then(null,function(a){return a instanceof d?c(a):b.reject(a)}):this.then(null,function(a){return a&&a.name===d?c(a):b.reject(a)})},b.prototype["finally"]=function(a){return this.then(function(d){return a(),d},function(d){return a(),b.reject(d)})},b.prototype.onuncatched=null,b.resolve=function(a){var d=
new b(function(){});return d._state=!0,d._value=a,d},b.reject=function(a){var d=new b(function(){});return d._state=!1,d._value=a,d},b.race=function(a){return new b(function(d,b){a.map(function(a){a.then(d,b)})})},b.PSD=null,b.newPSD=function(a){var d=b.PSD;b.PSD=d?Object.create(d):{};try{return a()}finally{b.PSD=d}},b._rootExec=function(b){var c=t,e;t=!1;M=a;try{b()}finally{if(c){do{for(;0<O.length;)d();if(e=k.pop(),e)try{e()}catch(g){}}while(0<k.length||0<O.length);M=h;t=!0}}},b._tickFinalize=function(a){if(t)throw Error("Not in a virtual tick");
k.push(a)},b}(),F=function(){},P=!1,wa;m(q).from(Error);h.delete=function(a){var d=new h(a);a=d.delete();return a.onblocked=function(a){d.on("blocked",a);return this},a};h.exists=function(a){return(new h(a)).open().then(function(a){return a.close(),!0},function(){return!1})};h.getDatabaseNames=function(a){return(new d(function(a,d){var b=L(),c;b?(c=b(),c.onsuccess=function(d){a([].slice.call(d.target.result,0))},c.onerror=u(d)):Oa(function(d){return a(d),!1})})).then(a)};h.defineClass=function(a){return function(d){d?
B(this,d):P&&e(this,a)}};h.ignoreTransaction=function(a){return d.newPSD(function(){return d.PSD.trans=null,a()})};h.spawn=function(){return x.console&&console.warn("Dexie.spawn() is deprecated. Use Dexie.ignoreTransaction() instead."),h.ignoreTransaction.apply(this,arguments)};h.vip=function(a){return d.newPSD(function(){return d.PSD.letThrough=!0,a()})};Object.defineProperty(h,"currentTransaction",{get:function(){return d.PSD&&d.PSD.trans||null}});h.Promise=d;h.derive=m;h.extend=B;h.override=y;
h.events=z;h.getByKeyPath=p;h.setByKeyPath=N;h.delByKeyPath=function(a,d){"string"==typeof d?N(a,d,b):"length"in d&&[].map.call(d,function(d){N(a,d,b)})};h.shallowClone=K;h.deepClone=g;h.addons=[];h.fakeAutoComplete=F;h.asap=D;h.ModifyError=q;h.MultiModifyError=q;h.IndexSpec=sa;h.TableSchema=Ca;wa=x.idbModules&&x.idbModules.shimIndexedDB?x.idbModules:{};h.dependencies={indexedDB:wa.shimIndexedDB||x.indexedDB||x.mozIndexedDB||x.webkitIndexedDB||x.msIndexedDB,IDBKeyRange:wa.IDBKeyRange||x.IDBKeyRange||
x.webkitIDBKeyRange,IDBTransaction:wa.IDBTransaction||x.IDBTransaction||x.webkitIDBTransaction,Error:x.Error||String,SyntaxError:x.SyntaxError||String,TypeError:x.TypeError||String,DOMError:x.DOMError||String,localStorage:null!=("undefined"!=typeof chrome&&null!==chrome?chrome.storage:void 0)?null:x.localStorage};h.version=1.2;C("Dexie",h);A(function(){h.fakeAutoComplete=F=A;h.fake=P=!0})}).apply(null,[self||window,function(x,C){!(L=function(){return C}.call(E,J,E,Q),void 0!==L&&(Q.exports=L))}])}).call(E,
J(2).setImmediate)},function(Q,E,J){(function(L,H){function x(b,m){this._id=b;this._clearFn=m}var C=J(3).nextTick,b=Function.prototype.apply,B=Array.prototype.slice,m={},y=0;E.setTimeout=function(){return new x(b.call(setTimeout,window,arguments),clearTimeout)};E.setInterval=function(){return new x(b.call(setInterval,window,arguments),clearInterval)};E.clearTimeout=E.clearInterval=function(b){b.close()};x.prototype.unref=x.prototype.ref=function(){};x.prototype.close=function(){this._clearFn.call(window,
this._id)};E.enroll=function(b,m){clearTimeout(b._idleTimeoutId);b._idleTimeout=m};E.unenroll=function(b){clearTimeout(b._idleTimeoutId);b._idleTimeout=-1};E._unrefActive=E.active=function(b){clearTimeout(b._idleTimeoutId);var m=b._idleTimeout;0<=m&&(b._idleTimeoutId=setTimeout(function(){b._onTimeout&&b._onTimeout()},m))};E.setImmediate="function"===typeof L?L:function(b){var w=y++,r=2>arguments.length?!1:B.call(arguments,1);m[w]=!0;C(function(){m[w]&&(r?b.apply(null,r):b.call(null),E.clearImmediate(w))});
return w};E.clearImmediate="function"===typeof H?H:function(b){delete m[b]}}).call(E,J(2).setImmediate,J(2).clearImmediate)},function(Q,E){function J(){B=!1;m.length?b=m.concat(b):y=-1;b.length&&L()}function L(){if(!B){var h=setTimeout(J);B=!0;for(var w=b.length;w;){m=b;for(b=[];++y<w;)m&&m[y].run();y=-1;w=b.length}m=null;B=!1;clearTimeout(h)}}function H(b,m){this.fun=b;this.array=m}function x(){}var C=Q.exports={},b=[],B=!1,m,y=-1;C.nextTick=function(h){var m=Array(arguments.length-1);if(1<arguments.length)for(var r=
1;r<arguments.length;r++)m[r-1]=arguments[r];b.push(new H(h,m));1!==b.length||B||setTimeout(L,0)};H.prototype.run=function(){this.fun.apply(null,this.array)};C.title="browser";C.browser=!0;C.env={};C.argv=[];C.version="";C.versions={};C.on=x;C.addListener=x;C.once=x;C.off=x;C.removeListener=x;C.removeAllListeners=x;C.emit=x;C.binding=function(b){throw Error("process.binding is not supported");};C.cwd=function(){return"/"};C.chdir=function(b){throw Error("process.chdir is not supported");};C.umask=
function(){return 0}},function(Q,E,J){function L(b){Error.call(this);this.message=b;this.name=L.name;"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,L)}var H,x,C;!function(b){b.hprose=Object.create(null)}(function(){return this||(0,eval)("this")}());(function(b){var B="WeakMap"in b,m="Map"in b,y=!0;if(m&&(y="forEach"in new b.Map),!(B&&m&&y)){var h=Object.create(null),w=0,r=function(a){var b=Object.create(null),c=a.valueOf;Object.defineProperty(a,"valueOf",{value:function(f,
k){return this===a&&k in h&&h[k]===f?(k in b||(b[k]=Object.create(null)),b[k]):c.apply(this,arguments)},writable:!0,configurable:!0,enumerable:!1})};if(B||(b.WeakMap=function X(){var a=Object.create(null),b=w++;h[b]=a;var f=function(f){if(f!==Object(f))throw Error("value is not a non-null object");var p=f.valueOf(a,b);return p!==f.valueOf()?p:(r(f),f.valueOf(a,b))},k=Object.create(X.prototype,{get:{value:function(a){return f(a).value}},set:{value:function(a,b){f(a).value=b}},has:{value:function(a){return"value"in
f(a)}},"delete":{value:function(a){return delete f(a).value}},clear:{value:function(){delete h[b];b=w++;h[b]=a}}});if(0<arguments.length&&Array.isArray(arguments[0]))for(var A=arguments[0],m=0,p=A.length;p>m;m++)k.set(A[m][0],A[m][1]);return k}),!m){var R=function(){var a=Object.create(null),b=w++,f=Object.create(null);h[b]=a;var k=function(k){if(null===k)return f;var h=k.valueOf(a,b);return h!==k.valueOf()?h:(r(k),k.valueOf(a,b))};return{get:function(a){return k(a).value},set:function(a,b){k(a).value=
b},has:function(a){return"value"in k(a)},"delete":function(a){return delete k(a).value},clear:function(){delete h[b];b=w++;h[b]=a}}},a=function(){var a=Object.create(null);return{get:function(){return a.value},set:function(b,f){a.value=f},has:function(){return"value"in a},"delete":function(){return delete a.value},clear:function(){a=Object.create(null)}}},f=function(){var a=Object.create(null);return{get:function(b){return a[b]},set:function(b,f){a[b]=f},has:function(b){return b in a},"delete":function(b){return delete a[b]},
clear:function(){a=Object.create(null)}}};b.Map=function c(){var b={number:f(),string:f(),"boolean":f(),object:R(),"function":R(),unknown:R(),undefined:a(),"null":a()},k=0,h=[],m=Object.create(c.prototype,{size:{get:function(){return k}},get:{value:function(a){return b[typeof a].get(a)}},set:{value:function(a,c){this.has(a)||(h.push(a),k++);b[typeof a].set(a,c)}},has:{value:function(a){return b[typeof a].has(a)}},"delete":{value:function(a){return this.has(a)?(k--,h.splice(h.indexOf(a),1),b[typeof a]["delete"](a)):
!1}},clear:{value:function(){h.length=0;for(var a in b)b[a].clear();k=0}},forEach:{value:function(a,b){for(var c=0,f=h.length;f>c;c++)a.call(b,this.get(h[c]),h[c],this)}}});if(0<arguments.length&&Array.isArray(arguments[0]))for(var r=arguments[0],p=0,w=r.length;w>p;p++)m.set(r[p][0],r[p][1]);return m}}if(!y){var k=b.Map;b.Map=function c(){var a=new k,b=0,f=[],h=Object.create(c.prototype,{size:{get:function(){return b}},get:{value:function(b){return a.get(b)}},set:{value:function(c,g){a.has(c)||(f.push(c),
b++);a.set(c,g)}},has:{value:function(b){return a.has(b)}},"delete":{value:function(c){return a.has(c)?(b--,f.splice(f.indexOf(c),1),a["delete"](c)):!1}},clear:{value:function(){if("clear"in a)a.clear();else for(var c=0,g=f.length;g>c;c++)a["delete"](f[c]);b=f.length=0}},forEach:{value:function(a,b){for(var c=0,p=f.length;p>c;c++)a.call(b,this.get(f[c]),f[c],this)}}});if(0<arguments.length&&Array.isArray(arguments[0]))for(var m=arguments[0],p=0,r=m.length;r>p;p++)h.set(m[p][0],m[p][1]);return h}}}})(function(){return this||
(0,eval)("this")}());L.prototype=Object.create(Error.prototype);L.prototype.constructor=L;(function(b,B){function m(a){var b=f(arguments,1);return function(){a.apply(B,b)}}function y(a){if(x)b.setTimeout(m(y,a),0);else{var f=c[a];if(f){x=!0;try{f()}finally{w(a),x=!1}}}}function h(a){return c[X]=m.apply(B,a),X++}function w(a){delete c[a]}function r(){if(b.postMessage&&!b.importScripts){var a=!0,c=b.onmessage;return b.onmessage=function(){a=!1},b.postMessage("","*"),b.onmessage=c,a}}var R=b.navigator&&
/Trident/.test(b.navigator.userAgent);if(!R&&(b.msSetImmediate||b.setImmediate))return void(b.setImmediate||(b.setImmediate=b.msSetImmediate,b.clearImmediate=b.msClearImmediate));var a=b.document,f=Function.prototype.call.bind(Array.prototype.slice),k=Function.prototype.call.bind(Object.prototype.toString),t={},X=1,c={},x=!1;t.messageChannel=function(){var a=new b.MessageChannel;return a.port1.onmessage=function(a){y(Number(a.data))},function(){var b=h(arguments);return a.port2.postMessage(b),b}};
t.nextTick=function(){return function(){var a=h(arguments);return b.process.nextTick(m(y,a)),a}};t.postMessage=function(){var a="setImmediate$"+Math.random()+"$",c=function(c){c.source===b&&"string"==typeof c.data&&0===c.data.indexOf(a)&&y(Number(c.data.slice(a.length)))};return b.addEventListener?b.addEventListener("message",c,!1):b.attachEvent("onmessage",c),function(){var c=h(arguments);return b.postMessage(a+c,"*"),c}};t.readyStateChange=function(){var b=a.documentElement;return function(){var c=
h(arguments),f=a.createElement("script");return f.onreadystatechange=function(){y(c);f.onreadystatechange=null;b.removeChild(f);f=null},b.appendChild(f),c}};t.setTimeout=function(){return function(){var a=h(arguments);return b.setTimeout(m(y,a),0),a}};var z=Object.getPrototypeOf&&Object.getPrototypeOf(b),z=z&&z.setTimeout?z:b;R?z.setImmediate=t.setTimeout():"[object process]"===k(b.process)?z.setImmediate=t.nextTick():r()?z.setImmediate=t.postMessage():b.MessageChannel?z.setImmediate=t.messageChannel():
a&&"onreadystatechange"in a.createElement("script")?z.setImmediate=t.readyStateChange():z.setImmediate=t.setTimeout();z.msSetImmediate=z.setImmediate;z.clearImmediate=w;z.msClearImmediate=w})(function(){return this||(0,eval)("this")}());(function(b,B){function m(a){Object.defineProperties(this,{_subscribers:{value:[]},resolve:{value:this.resolve.bind(this)},reject:{value:this.reject.bind(this)}});var b=this;"function"==typeof a&&N(function(){try{b.resolve(a())}catch(c){b.reject(c)}})}function y(a){return a instanceof
m}function h(a){return y(a)||p&&a instanceof b.Promise&&typeof("function"===a.then)}function w(a){var b=new m;return b.reject(a),b}function r(a){var b=new m;return b.resolve(a),b}function R(a){var b=0;return O(a,function(){++b}),b}function a(a){return a=h(a)?a:r(a),a.then(function(a){var b=a.length,c=R(a),e=Array(b);if(0===c)return r(e);var g=new m;return O(a,function(a,b){(h(a)?a:r(a)).then(function(a){e[b]=a;0===--c&&g.resolve(e)},g.reject)}),g})}function f(a){return a=h(a)?a:r(a),a.then(function(a){var b=
new m;return O(a,function(a){(h(a)?a:r(a)).then(b.resolve,b.reject)}),b})}function k(b,c,g){return a(b).then(function(a){return a.forEach(c,g)})}function t(b,c,g){return a(b).then(function(a){return a.every(c,g)})}function X(b,c,g){return a(b).then(function(a){return a.some(c,g)})}function c(b,c,g){return a(b).then(function(a){return a.filter(c,g)})}function x(b,c,g){return a(b).then(function(a){return a.map(c,g)})}function z(b,c,g){return 2<arguments.length?a(b).then(function(a){return h(g)||(g=
r(g)),g.then(function(b){return a.reduce(c,b)})}):a(b).then(function(a){return a.reduce(c)})}function D(b,c,g){return 2<arguments.length?a(b).then(function(a){return h(g)||(g=r(g)),g.then(function(b){return a.reduceRight(c,b)})}):a(b).then(function(a){return a.reduceRight(c)})}function A(a,b,c){N(function(){try{var g=a(c);b.resolve(g)}catch(f){b.reject(f)}})}function C(a,b,c,g,f){function p(f){C(a,b,c,g,f)}function k(a){b?A(b,g,a):g.reject(a)}if(h(f))return f===c?void k(new TypeError("Self resolution")):
void f.then(p,k);if(null!==f&&"object"==typeof f||"function"==typeof f){var M;try{M=f.then}catch(t){return void k(t)}if("function"==typeof M){var O=!0;try{return void M.call(f,function(a){O&&(O=!1,p(a))},function(a){O&&(O=!1,k(a))})}catch(t){O&&(O=!1,k(t))}return}}a?A(a,g,f):g.resolve(f)}var p="Promise"in b,N=b.setImmediate,K=b.setTimeout,g=b.clearTimeout,O=Function.prototype.call.bind(Array.prototype.forEach),M=Function.prototype.call.bind(Array.prototype.slice);Object.defineProperties(m,{delayed:{value:function(a,
b){var c="function"==typeof b?b:function(){return b},g=new m;return K(function(){try{g.resolve(c())}catch(a){g.reject(a)}},a),g}},error:{value:w},sync:{value:function(a){try{var b=a();return r(b)}catch(c){return w(c)}}},value:{value:r},all:{value:a},race:{value:f},resolve:{value:r},reject:{value:w},promise:{value:function(a){var b=new m;return a(b.resolve,b.reject),b}},isFuture:{value:y},isPromise:{value:h},join:{value:function(){return a(arguments)}},any:{value:function(a){return a=h(a)?a:r(a),a.then(function(a){var b=
a.length,c=R(a);if(0===c)throw new RangeError("any(): array must not be empty");var e=Array(b),g=new m;return O(a,function(a,b){(h(a)?a:r(a)).then(g.resolve,function(a){e[b]=a;0===--c&&g.reject(e)})}),g})}},settle:{value:function(a){return a=h(a)?a:r(a),a.then(function(a){var b=a.length,c=R(a),e=Array(b);if(0===c)return r(e);var g=new m;return O(a,function(a,b){var f=h(a)?a:r(a);f.whenComplete(function(){e[b]=f.inspect();0===--c&&g.resolve(e)})}),g})}},attempt:{value:function(b){var c=M(arguments,
1);return a(c).then(function(a){return b.apply(B,a)})}},run:{value:function(b,c){var g=M(arguments,2);return a(g).then(function(a){return b.apply(c,a)})}},wrap:{value:function(b,c){return function(){return a(arguments).then(function(a){return b.apply(c,a)})}}},forEach:{value:k},every:{value:t},some:{value:X},filter:{value:c},map:{value:x},reduce:{value:z},reduceRight:{value:D}});Object.defineProperties(m.prototype,{_value:{writable:!0},_reason:{writable:!0},_state:{value:0,writable:!0},resolve:{value:function(a){if(0===
this._state){this._state=1;this._value=a;for(var b=this._subscribers;0<b.length;){var c=b.shift();C(c.onfulfill,c.onreject,this,c.next,a)}}}},reject:{value:function(a){if(0===this._state){this._state=2;this._reason=a;for(var b=this._subscribers;0<b.length;){var c=b.shift();c.onreject?A(c.onreject,c.next,a):c.next.reject(a)}}}},then:{value:function(a,b){if("function"!=typeof a&&(a=null),"function"!=typeof b&&(b=null),a||b){var c=new m;return 1===this._state?a?C(a,b,this,c,this._value):c.resolve(this._value):
2===this._state?b?A(b,c,this._reason):c.reject(this._reason):this._subscribers.push({onfulfill:a,onreject:b,next:c}),c}return this}},inspect:{value:function(){switch(this._state){case 0:return{state:"pending"};case 1:return{state:"fulfilled",value:this._value};case 2:return{state:"rejected",reason:this._reason}}}},catchError:{value:function(a,b){if("function"==typeof b){var c=this;return this["catch"](function(g){if(b(g))return c["catch"](a);throw g;})}return this["catch"](a)}},"catch":{value:function(a){return this.then(null,
a)}},whenComplete:{value:function(a){return this.then(function(b){var c=a();return c===B?b:(c=h(c)?c:r(c),c.then(function(){return b}))},function(b){var c=a();if(c===B)throw b;return c=h(c)?c:r(c),c.then(function(){throw b;})})}},timeout:{value:function(a,b){var c=new m,f=K(function(){c.reject(b||new L("timeout"))},a);return this.whenComplete(function(){g(f)}).then(c.resolve,c.reject),c}},delay:{value:function(a){var b=new m;return this.then(function(c){K(function(){b.resolve(c)},a)},b.reject),b}},
tap:{value:function(a,b){return this.then(function(c){return a.call(b,c),c})}},spread:{value:function(a,b){return this.then(function(c){return a.apply(b,c)})}},get:{value:function(a){return this.then(function(b){return b[a]})}},set:{value:function(a,b){return this.then(function(c){return c[a]=b,c})}},apply:{value:function(b,c){return c=c||[],this.then(function(g){return a(c).then(function(a){return g[b].apply(g,a)})})}},call:{value:function(b){var c=M(arguments,1);return this.then(function(g){return a(c).then(function(a){return g[b].apply(g,
a)})})}},bind:{value:function(b){var c=M(arguments);if(!Array.isArray(b)){c.shift();var g=this;return Object.defineProperty(this,b,{value:function(){var f=M(arguments);return g.then(function(g){return a(c.concat(f)).then(function(a){return g[b].apply(g,a)})})}}),this}for(var f=0,p=b.length;p>f;++f)c[0]=b[f],this.bind.apply(this,c)}},forEach:{value:function(a,b){return k(this,a,b)}},every:{value:function(a,b){return t(this,a,b)}},some:{value:function(a,b){return X(this,a,b)}},filter:{value:function(a,
b){return c(this,a,b)}},map:{value:function(a,b){return x(this,a,b)}},reduce:{value:function(a,b){return 1<arguments.length?z(this,a,b):z(this,a)}},reduceRight:{value:function(a,b){return 1<arguments.length?D(this,a,b):D(this,a)}}});b.hprose.Future=m;b.hprose.Completer=function(){var a=new m;Object.defineProperties(this,{future:{value:a},complete:{value:a.resolve},completeError:{value:a.reject},isCompleted:{get:function(){return 0!==a._state}}})};b.hprose.resolved=r;b.hprose.rejected=w;b.hprose.deferred=
function(){var a=new m;return Object.create(null,{promise:{value:a},resolve:{value:a.resolve},reject:{value:a.reject}})};p||(b.Promise=function(a){m.call(this);a(this.resolve,this.reject)},b.Promise.prototype=Object.create(m.prototype),b.Promise.prototype.constructor=m,Object.defineProperties(b.Promise,{all:{value:a},race:{value:f},resolve:{value:r},reject:{value:w}}))})(function(){return this||(0,eval)("this")}());(function(b,B){function m(a,b,k){return a[b++]=k>>>24&255,a[b++]=k>>>16&255,a[b++]=
k>>>8&255,a[b++]=255&k,b}function y(a,b,k){return a[b++]=255&k,a[b++]=k>>>8&255,a[b++]=k>>>16&255,a[b++]=k>>>24&255,b}function h(a,b){(b===B||null===b||0>b)&&(b=a.length);var k;if(0===b)k=["",0];else{var t;if(1E5>b){t=b;k=new Uint16Array(t);for(var h=0,c=0,m=a.length;t>h&&m>c;h++){var r=a[c++];switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:k[h]=r;break;case 12:case 13:if(!(m>c))throw Error("Unfinished UTF-8 octet sequence");k[h]=(31&r)<<6|63&a[c++];break;case 14:if(!(m>c+1))throw Error("Unfinished UTF-8 octet sequence");
k[h]=(15&r)<<12|(63&a[c++])<<6|63&a[c++];break;case 15:if(!(m>c+2))throw Error("Unfinished UTF-8 octet sequence");r=((7&r)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;if(!(0<=r&&1048575>=r))throw Error("Character outside valid Unicode range: 0x"+r.toString(16));k[h++]=r>>10&1023|55296;k[h]=1023&r|56320;break;default:throw Error("Bad UTF-8 encoding 0x"+r.toString(16));}}t=(t>h&&(k=k.subarray(0,h)),[String.fromCharCode.apply(String,k),c])}else{k=b;t=[];h=new Uint16Array(65535);c=r=0;for(m=a.length;k>
r&&m>c;r++){var w=a[c++];switch(w>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:h[r]=w;break;case 12:case 13:if(!(m>c))throw Error("Unfinished UTF-8 octet sequence");h[r]=(31&w)<<6|63&a[c++];break;case 14:if(!(m>c+1))throw Error("Unfinished UTF-8 octet sequence");h[r]=(15&w)<<12|(63&a[c++])<<6|63&a[c++];break;case 15:if(!(m>c+2))throw Error("Unfinished UTF-8 octet sequence");w=((7&w)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;if(!(0<=w&&1048575>=w))throw Error("Character outside valid Unicode range: 0x"+
w.toString(16));h[r++]=w>>10&1023|55296;h[r]=1023&w|56320;break;default:throw Error("Bad UTF-8 encoding 0x"+w.toString(16));}65534<=r&&(r+=1,t.push(String.fromCharCode.apply(String,h.subarray(0,r))),k-=r,r=-1)}t=(0<r&&t.push(String.fromCharCode.apply(String,h.subarray(0,r))),[t.join(""),c])}k=t}return k}function w(){var a=arguments;switch(a.length){case 1:switch(a[0].constructor){case Uint8Array:this._bytes=a[0];this._length=a[0].length;break;case w:this._bytes=a[0].toBytes();this._length=a[0].length;
break;case String:this.writeString(a[0]);break;case Number:this._bytes=new Uint8Array(a[0]);break;default:this._bytes=new Uint8Array(a[0]),this._length=this._bytes.length}break;case 2:this._bytes=new Uint8Array(a[0],a[1]);this._length=a[1];break;case 3:this._bytes=new Uint8Array(a[0],a[1],a[2]),this._length=a[2]}this.mark()}var r=(b.hprose.Future,new Uint8Array(0)),R=Function.prototype.call.bind(Array.prototype.indexOf);Object.defineProperties(w.prototype,{_bytes:{value:null,writable:!0},_length:{value:0,
writable:!0},_wmark:{value:0,writable:!0},_off:{value:0,writable:!0},_rmark:{value:0,writable:!0},_grow:{value:function(a){var b=this._bytes,k=this._length+a;a=(--k,k|=k>>1,k|=k>>2,k|=k>>4,k|=k>>8,k|=k>>16,k+1);if(b){if(a*=2,a>b.length)a=new Uint8Array(a),a.set(b),this._bytes=a}else a=Math.max(a,1024),this._bytes=new Uint8Array(a)}},length:{get:function(){return this._length}},capacity:{get:function(){return this._bytes?this._bytes.length:0}},position:{get:function(){return this._off}},bytes:{get:function(){return null===
this._bytes?r:this._bytes.subarray(0,this._length)}},mark:{value:function(){this._wmark=this._length;this._rmark=this._off}},reset:{value:function(){this._length=this._wmark;this._off=this._rmark}},clear:{value:function(){this._bytes=null;this._rmark=this._off=this._wmark=this._length=0}},writeByte:{value:function(a){this._grow(1);this._bytes[this._length++]=a}},writeInt32BE:{value:function(a){if(a===(0|a)&&2147483647>=a)return this._grow(4),void(this._length=m(this._bytes,this._length,a));throw new TypeError("value is out of bounds");
}},writeUInt32BE:{value:function(a){if(a===(0|a)&&0<=a)return this._grow(4),void(this._length=m(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},writeInt32LE:{value:function(a){if(a===(0|a)&&2147483647>=a)return this._grow(4),void(this._length=y(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},writeUInt32LE:{value:function(a){if(a===(0|a)&&0<=a)return this._grow(4),void(this._length=y(this._bytes,this._length,a));throw new TypeError("value is out of bounds");
}},write:{value:function(a){var b=a.byteLength||a.length;if(0!==b){this._grow(b);var k=this._bytes,h=this._length;switch(a.constructor){case ArrayBuffer:k.set(new Uint8Array(a),h);break;case Uint8Array:k.set(a,h);break;case w:k.set(a.bytes,h);break;default:for(var m=0;b>m;m++)k[h+m]=a[m]}this._length+=b}}},writeAsciiString:{value:function(a){var b=a.length;if(0!==b){this._grow(b);for(var k=this._bytes,h=this._length,m=0;b>m;++m,++h)k[h]=a.charCodeAt(m);this._length=h}}},writeString:{value:function(a){var b=
a.length;if(0!==b){this._grow(3*b);for(var b=this._bytes,k=this._length,h=a.length,m=0;h>m;++m){var c=a.charCodeAt(m);if(128>c)b[k++]=c;else{if(2048>c)b[k++]=192|c>>6;else{if(!(55296>c||57343<c)){if(h>m+1){var r=a.charCodeAt(m+1);if(56320>c&&56320<=r&&57343>=r){c=((1023&c)<<10|1023&r)+65536;b[k++]=240|c>>18;b[k++]=128|c>>12&63;b[k++]=128|c>>6&63;b[k++]=128|63&c;++m;continue}}throw Error("Malformed string");}b[k++]=224|c>>12;b[k++]=128|c>>6&63}b[k++]=128|63&c}}this._length=k}}},readByte:{value:function(){return this._off<
this._length?this._bytes[this._off++]:-1}},readInt32BE:{value:function(){var a=this._bytes,b=this._off;if(b+3<this._length)return a=a[b++]<<24|a[b++]<<16|a[b++]<<8|a[b++],this._off=b,a;throw Error("EOF");}},readUInt32BE:{value:function(){var a=this.readInt32BE();return 0>a?(2147483647&a)+2147483648:a}},readInt32LE:{value:function(){var a=this._bytes,b=this._off;if(b+3<this._length)return a=a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24,this._off=b,a;throw Error("EOF");}},readUInt32LE:{value:function(){var a=
this.readInt32LE();return 0>a?(2147483647&a)+2147483648:a}},read:{value:function(a){return this._off+a>this._length&&(a=this._length-this._off),0===a?r:this._bytes.subarray(this._off,this._off+=a)}},skip:{value:function(a){return this._off+a>this._length?(a=this._length-this._off,this._off=this._length):this._off+=a,a}},readBytes:{value:function(a){var b;a=R(this._bytes,a,this._off);return-1===a?(b=this._bytes.subarray(this._off,this._length),this._off=this._length):(b=this._bytes.subarray(this._off,
a+1),this._off=a+1),b}},readUntil:{value:function(a){a=R(this._bytes,a,this._off);var b="";return a===this._off?this._off++:-1===a?(b=h(this._bytes.subarray(this._off,this._length))[0],this._off=this._length):(b=h(this._bytes.subarray(this._off,a))[0],this._off=a+1),b}},readAsciiString:{value:function(a){if(this._off+a>this._length&&(a=this._length-this._off),0===a)return"";var b=this._bytes.subarray(this._off,this._off+=a);if(1E5>a)return String.fromCharCode.apply(String,b);for(var k=65535&a,h=a>>
16,m=Array(k?h+1:h),c=0;h>c;++c)m[c]=String.fromCharCode.apply(String,b.subarray(c<<16,c+1<<16));return k&&(m[h]=String.fromCharCode.apply(String,b.subarray(h<<16,a))),m.join("")}},readStringAsBytes:{value:function(a){var b;b=this._bytes.subarray(this._off,this._length);if(a===B&&(a=b.length),0===a)b=r;else{for(var k=0,h=0,m=b.length;a>k&&m>h;k++){var c=b[h++];switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:if(!(m>h))throw Error("Unfinished UTF-8 octet sequence");
h++;break;case 14:if(!(m>h+1))throw Error("Unfinished UTF-8 octet sequence");h+=2;break;case 15:if(!(m>h+2))throw Error("Unfinished UTF-8 octet sequence");c=((7&c)<<18|(63&b[h++])<<12|(63&b[h++])<<6|63&b[h++])-65536;if(!(0<=c&&1048575>=c))throw Error("Character outside valid Unicode range: 0x"+c.toString(16));k++;break;default:throw Error("Bad UTF-8 encoding 0x"+c.toString(16));}}b=[b.subarray(0,h),h]}return this._off+=b[1],b[0]}},readString:{value:function(a){a=h(this._bytes.subarray(this._off,this._length),
a);return this._off+=a[1],a[0]}},takeBytes:{value:function(){var a=this.bytes;return this.clear(),a}},toBytes:{value:function(){return new Uint8Array(this.bytes)}},toString:{value:function(){return h(this.bytes,this._length)[0]}},clone:{value:function(){return new w(this.toBytes())}},trunc:{value:function(){this._bytes=this._bytes.subarray(this._off,this._length);this._length=this._bytes.length;this._rmark=this._wmark=this._off=0}}});Object.defineProperty(w,"toString",{value:function(a){if(0===a.length)return"";
switch(a.constructor){case String:return a;case w:a=a.bytes;case ArrayBuffer:a=new Uint8Array(a);case Uint8Array:return h(a,a.length)[0];default:return String.fromCharCode.apply(String,a)}}});b.hprose.BytesIO=w})(function(){return this||(0,eval)("this")}());(function(b){b.hprose.Tags={TagInteger:105,TagLong:108,TagDouble:100,TagNull:110,TagEmpty:101,TagTrue:116,TagFalse:102,TagNaN:78,TagInfinity:73,TagDate:68,TagTime:84,TagUTC:90,TagBytes:98,TagUTF8Char:117,TagString:115,TagGuid:103,TagList:97,TagMap:109,
TagClass:99,TagObject:111,TagRef:114,TagPos:43,TagNeg:45,TagSemicolon:59,TagOpenbrace:123,TagClosebrace:125,TagQuote:34,TagPoint:46,TagFunctions:70,TagCall:67,TagResult:82,TagArgument:65,TagError:69,TagEnd:122}})(function(){return this||(0,eval)("this")}());(function(b){function B(b,m){h.set(b,m);y[m]=b}var m=b.WeakMap,y=Object.create(null),h=new m;b.hprose.ClassManager=Object.create(null,{register:{value:B},getClassAlias:{value:function(b){return h.get(b)}},getClass:{value:function(b){return y[b]}}});
b.hprose.register=B;B(Object,"Object")})(function(){return this||(0,eval)("this")}());(function(b,B){function m(a){var b=a.constructor,c=N.getClassAlias(b);if(c)return c;if(b.name)c=b.name;else{var e=b.toString();if(c=e.substr(0,e.indexOf("(")).replace(/(^\s*function\s*)|(\s*$)/gi,""),""===c||"Object"===c)return"function"==typeof a.getClassName?a.getClassName():"Object"}return"Object"!==c&&N.register(b,c),c}function y(a){Object.defineProperties(this,{_stream:{value:a},_ref:{value:new A,writable:!0}})}
function h(a,b){Object.defineProperties(this,{stream:{value:a},_classref:{value:Object.create(null),writable:!0},_fieldsref:{value:[],writable:!0},_refer:{value:b?K:new y(a)}})}function w(a,b){var f=a.stream;if(b===B||null===b)return void f.writeByte(p.TagNull);switch(b.constructor){case Function:return void f.writeByte(p.TagNull);case Number:var e=a.stream,f=b.valueOf();f===(0|f)?0<=f&&9>=f?e.writeByte(f+48):(e.writeByte(p.TagInteger),e.writeAsciiString(""+f),e.writeByte(p.TagSemicolon)):isNaN(f)?
e.writeByte(p.TagNaN):isFinite(f)?(e.writeByte(p.TagDouble),e.writeAsciiString(""+f),e.writeByte(p.TagSemicolon)):(e.writeByte(p.TagInfinity),e.writeByte(0<f?p.TagPos:p.TagNeg));break;case Boolean:a.stream.writeByte(b.valueOf()?p.TagTrue:p.TagFalse);break;case String:switch(b.length){case 0:return void f.writeByte(p.TagEmpty);case 1:return f.writeByte(p.TagUTF8Char),void f.writeString(b)}return void a.writeStringWithRef(b);case Date:return void a.writeDateWithRef(b);case A:return void a.writeMapWithRef(b);
case ArrayBuffer:case Uint8Array:case E:return void a.writeBytesWithRef(b);case Int8Array:case Int16Array:case Int32Array:case Uint16Array:case Uint32Array:a._refer.write(b)||c(a,b,r);break;case Float32Array:case Float64Array:a._refer.write(b)||c(a,b,R);break;default:Array.isArray(b)?a.writeListWithRef(b):"Object"===m(b)?a.writeMapWithRef(b):a.writeObjectWithRef(b)}}function r(a,b){var c=a.stream;0<=b&&9>=b?c.writeByte(b+48):(-2147483648>b||2147483647<b?c.writeByte(p.TagLong):c.writeByte(p.TagInteger),
c.writeAsciiString(""+b),c.writeByte(p.TagSemicolon))}function R(a,b){var c=a.stream;isNaN(b)?c.writeByte(p.TagNaN):isFinite(b)?(c.writeByte(p.TagDouble),c.writeAsciiString(""+b),c.writeByte(p.TagSemicolon)):(c.writeByte(p.TagInfinity),c.writeByte(0<b?p.TagPos:p.TagNeg))}function a(a,b){a._refer.set(b);var c=a.stream,e=("0000"+b.getUTCFullYear()).slice(-4),f=("00"+(b.getUTCMonth()+1)).slice(-2),h=("00"+b.getUTCDate()).slice(-2),k=("00"+b.getUTCHours()).slice(-2),m=("00"+b.getUTCMinutes()).slice(-2),
r=("00"+b.getUTCSeconds()).slice(-2),t=("000"+b.getUTCMilliseconds()).slice(-3);c.writeByte(p.TagDate);c.writeAsciiString(e+f+h);c.writeByte(p.TagTime);c.writeAsciiString(k+m+r);"000"!==t&&(c.writeByte(p.TagPoint),c.writeAsciiString(t));c.writeByte(p.TagUTC)}function f(a,b){a._refer.set(b);var c=a.stream,e=("0000"+b.getFullYear()).slice(-4),f=("00"+(b.getMonth()+1)).slice(-2),h=("00"+b.getDate()).slice(-2),k=("00"+b.getHours()).slice(-2),m=("00"+b.getMinutes()).slice(-2),r=("00"+b.getSeconds()).slice(-2),
t=("000"+b.getMilliseconds()).slice(-3);"00"===k&&"00"===m&&"00"===r&&"000"===t?(c.writeByte(p.TagDate),c.writeAsciiString(e+f+h)):"1970"===e&&"01"===f&&"01"===h?(c.writeByte(p.TagTime),c.writeAsciiString(k+m+r),"000"!==t&&(c.writeByte(p.TagPoint),c.writeAsciiString(t))):(c.writeByte(p.TagDate),c.writeAsciiString(e+f+h),c.writeByte(p.TagTime),c.writeAsciiString(k+m+r),"000"!==t&&(c.writeByte(p.TagPoint),c.writeAsciiString(t)));c.writeByte(p.TagSemicolon)}function k(a,b){a._refer.set(b);var c=a.stream,
e=("00"+b.getHours()).slice(-2),f=("00"+b.getMinutes()).slice(-2),h=("00"+b.getSeconds()).slice(-2),k=("000"+b.getMilliseconds()).slice(-3);c.writeByte(p.TagTime);c.writeAsciiString(e+f+h);"000"!==k&&(c.writeByte(p.TagPoint),c.writeAsciiString(k));c.writeByte(p.TagSemicolon)}function t(a,b){a._refer.set(b);var c=a.stream;c.writeByte(p.TagBytes);var e=b.byteLength||b.length;0<e&&c.writeAsciiString(""+e);c.writeByte(p.TagQuote);0<e&&c.write(b);c.writeByte(p.TagQuote)}function x(a,b){a._refer.set(b);
var c=a.stream,e=b.length;c.writeByte(p.TagString);0<e&&c.writeAsciiString(""+e);c.writeByte(p.TagQuote);0<e&&c.writeString(b);c.writeByte(p.TagQuote)}function c(a,b,c){a._refer.set(b);var e=a.stream,f=b.length;e.writeByte(p.TagList);0<f&&e.writeAsciiString(""+f);e.writeByte(p.TagOpenbrace);for(var h=0;f>h;h++)c(a,b[h]);e.writeByte(p.TagClosebrace)}function C(a,b){a._refer.set(b);var c=a.stream,e=[],f;for(f in b)b.hasOwnProperty(f)&&"function"!=typeof b[f]&&(e[e.length]=f);f=e.length;c.writeByte(p.TagMap);
0<f&&c.writeAsciiString(""+f);c.writeByte(p.TagOpenbrace);for(var h=0;f>h;h++)w(a,e[h]),w(a,b[e[h]]);c.writeByte(p.TagClosebrace)}function z(a,b){a._refer.set(b);var c=a.stream,e=b.size;c.writeByte(p.TagMap);0<e&&c.writeAsciiString(""+e);c.writeByte(p.TagOpenbrace);b.forEach(function(b,c){w(a,c);w(a,b)});c.writeByte(p.TagClosebrace)}function D(a,b){var c,e,f=a.stream;e=m(b);if(e in a._classref)e=a._classref[e],c=a._fieldsref[e];else{c=[];for(var h in b)b.hasOwnProperty(h)&&"function"!=typeof b[h]&&
(c[c.length]=h.toString());h=c;var k=a.stream,r=h.length;k.writeByte(p.TagClass);k.writeAsciiString(""+e.length);k.writeByte(p.TagQuote);k.writeString(e);k.writeByte(p.TagQuote);0<r&&k.writeAsciiString(""+r);k.writeByte(p.TagOpenbrace);for(var t=0;r>t;t++)x(a,h[t]);k.writeByte(p.TagClosebrace);k=a._fieldsref.length;e=(a._classref[e]=k,a._fieldsref[k]=h,k)}f.writeByte(p.TagObject);f.writeAsciiString(""+e);f.writeByte(p.TagOpenbrace);a._refer.set(b);e=c.length;for(h=0;e>h;h++)w(a,b[c[h]]);f.writeByte(p.TagClosebrace)}
var A=b.Map,E=b.hprose.BytesIO,p=b.hprose.Tags,N=b.hprose.ClassManager,K=Object.create(null,{set:{value:function(){}},write:{value:function(){return!1}},reset:{value:function(){}}});Object.defineProperties(y.prototype,{_refcount:{value:0,writable:!0},set:{value:function(a){this._ref.set(a,this._refcount++)}},write:{value:function(a){a=this._ref.get(a);return a!==B?(this._stream.writeByte(p.TagRef),this._stream.writeString(""+a),this._stream.writeByte(p.TagSemicolon),!0):!1}},reset:{value:function(){this._ref=
new A;this._refcount=0}}});Object.defineProperties(h.prototype,{serialize:{value:function(a){w(this,a)}},writeInteger:{value:function(a){r(this,a)}},writeDouble:{value:function(a){R(this,a)}},writeBoolean:{value:function(a){this.stream.writeByte(a.valueOf()?p.TagTrue:p.TagFalse)}},writeUTCDate:{value:function(b){a(this,b)}},writeUTCDateWithRef:{value:function(b){this._refer.write(b)||a(this,b)}},writeDate:{value:function(a){f(this,a)}},writeDateWithRef:{value:function(a){this._refer.write(a)||f(this,
a)}},writeTime:{value:function(a){k(this,a)}},writeTimeWithRef:{value:function(a){this._refer.write(a)||k(this,a)}},writeBytes:{value:function(a){t(this,a)}},writeBytesWithRef:{value:function(a){this._refer.write(a)||t(this,a)}},writeString:{value:function(a){x(this,a)}},writeStringWithRef:{value:function(a){this._refer.write(a)||x(this,a)}},writeList:{value:function(a){c(this,a,w)}},writeListWithRef:{value:function(a){this._refer.write(a)||c(this,a,w)}},writeMap:{value:function(a){a instanceof A?
z(this,a):C(this,a)}},writeMapWithRef:{value:function(a){this._refer.write(a)||(a instanceof A?z(this,a):C(this,a))}},writeObject:{value:function(a){D(this,a)}},writeObjectWithRef:{value:function(a){this._refer.write(a)||D(this,a)}},reset:{value:function(){this._classref=Object.create(null);this._fieldsref.length=0;this._refer.reset()}}});b.hprose.Writer=h})(function(){return this||(0,eval)("this")}());(function(b,B){function m(a,b){if(a&&b){var c="";throw c="number"==typeof b?String.fromCharCode(b):
String.fromCharCode.apply(String,b),Error('Tag "'+c+'" expected, but "'+String.fromCharCode(a)+'" found in stream');}throw a?Error('Unexpected serialize tag "'+String.fromCharCode(a)+'" in stream'):Error("No byte found in stream");}function y(a,b,c){switch(b.writeByte(c),c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case q.TagNull:case q.TagEmpty:case q.TagTrue:case q.TagFalse:case q.TagNaN:break;case q.TagInfinity:b.writeByte(a.readByte());break;case q.TagInteger:case q.TagLong:case q.TagDouble:case q.TagRef:do c=
a.readByte(),b.writeByte(c);while(c!==q.TagSemicolon);break;case q.TagDate:case q.TagTime:do c=a.readByte(),b.writeByte(c);while(c!==q.TagSemicolon&&c!==q.TagUTC);break;case q.TagUTF8Char:b.writeString(a.readString(1));break;case q.TagBytes:c=0;var e=48;do c*=10,c+=e-48,e=a.readByte(),b.writeByte(e);while(e!==q.TagQuote);b.write(a.read(c+1));break;case q.TagString:c=0;e=48;do c*=10,c+=e-48,e=a.readByte(),b.writeByte(e);while(e!==q.TagQuote);b.write(a.readStringAsBytes(c+1));break;case q.TagGuid:b.write(a.read(38));
break;case q.TagList:case q.TagMap:case q.TagObject:h(a,b);break;case q.TagClass:h(a,b);y(a,b,a.readByte());break;case q.TagError:y(a,b,a.readByte());break;default:m(c)}}function h(a,b){var c;do c=a.readByte(),b.writeByte(c);while(c!==q.TagOpenbrace);for(;(c=a.readByte())!==q.TagClosebrace;)y(a,b,c);b.writeByte(c)}function w(a){Object.defineProperties(this,{stream:{value:a},readRaw:{value:function(){var b=new Ca;y(a,b,a.readByte());return b.bytes}}})}function r(){Object.defineProperties(this,{ref:{value:[]}})}
function R(a){var c=b,e=a.split(".");for(a=0;a<e.length;a++)if(c=c[e[a]],c===B)return null;return c}function a(b,c,e,g){if(e<c.length){b[c[e]]=g;var f=a(b,c,e+1,".");return e+1<c.length&&null===f&&(f=a(b,c,e+1,"_")),f}b=b.join("");try{return f=R(b),"function"==typeof f?f:null}catch(h){return null}}function f(b){var c=Fa.getClass(b);if(c)return c;if(c=R(b),"function"==typeof c)return Fa.register(c,b),c;for(var e=[],f=b.indexOf("_");0<=f;)e[e.length]=f,f=b.indexOf("_",f+1);return 0<e.length&&(f=b.split(""),
c=a(f,e,0,"."),null===c&&(c=a(f,e,0,"_")),"function"==typeof c)?(Fa.register(c,b),c):(c=function(){},Object.defineProperty(c.prototype,"getClassName",{value:function(){return b}}),Fa.register(c,b),c)}function k(a,b){var c=a.readUntil(b);return 0===c.length?0:parseInt(c,10)}function t(a){var b=a.stream,c=b.readByte();switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return c-48;case q.TagInteger:return k(b,q.TagSemicolon);case q.TagLong:return x(b);case q.TagDouble:return parseFloat(b.readUntil(q.TagSemicolon));
case q.TagNull:return null;case q.TagEmpty:return"";case q.TagTrue:return!0;case q.TagFalse:return!1;case q.TagNaN:return NaN;case q.TagInfinity:return b.readByte()===q.TagNeg?-(1/0):1/0;case q.TagDate:return C(a);case q.TagTime:return z(a);case q.TagBytes:return D(a);case q.TagUTF8Char:return a.stream.readString(1);case q.TagString:return p(a);case q.TagGuid:return K(a);case q.TagList:return g(a);case q.TagMap:return a.useHarmonyMap?M(a):O(a);case q.TagClass:return L(a),u(a);case q.TagObject:return e(a);
case q.TagRef:return H(a);case q.TagError:throw Error(N(a));default:m(c)}}function x(a){a=a.readUntil(q.TagSemicolon);var b=parseInt(a,10);return b.toString()===a?b:a}function c(a){var b=a.readByte();switch(b){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return b-48;case q.TagInteger:case q.TagLong:case q.TagDouble:return parseFloat(a.readUntil(q.TagSemicolon));case q.TagNaN:return NaN;case q.TagInfinity:return a.readByte()===q.TagNeg?-(1/0):1/0;default:m(b)}}function C(a){var b;
b=a.stream;var c=parseInt(b.readAsciiString(4),10),e=parseInt(b.readAsciiString(2),10)-1,f=parseInt(b.readAsciiString(2),10),g=b.readByte();if(g===q.TagTime){var h=parseInt(b.readAsciiString(2),10),k=parseInt(b.readAsciiString(2),10),p=parseInt(b.readAsciiString(2),10),m=0,g=b.readByte();g===q.TagPoint&&(m=parseInt(b.readAsciiString(3),10),g=b.readByte(),48<=g&&57>=g&&(b.skip(2),g=b.readByte(),48<=g&&57>=g&&(b.skip(2),g=b.readByte())));b=g===q.TagUTC?new Date(Date.UTC(c,e,f,h,k,p,m)):new Date(c,e,
f,h,k,p,m)}else b=g===q.TagUTC?new Date(Date.UTC(c,e,f)):new Date(c,e,f);return a.refer.set(b),b}function z(a){var b,c=a.stream,e=parseInt(c.readAsciiString(2),10),f=parseInt(c.readAsciiString(2),10),g=parseInt(c.readAsciiString(2),10),h=0,k=c.readByte();return k===q.TagPoint&&(h=parseInt(c.readAsciiString(3),10),k=c.readByte(),48<=k&&57>=k&&(c.skip(2),k=c.readByte(),48<=k&&57>=k&&(c.skip(2),k=c.readByte()))),b=k===q.TagUTC?new Date(Date.UTC(1970,0,1,e,f,g,h)):new Date(1970,0,1,e,f,g,h),a.refer.set(b),
b}function D(a){var b=a.stream,c=k(b,q.TagQuote),c=b.read(c);return b.skip(1),a.refer.set(c),c}function A(a){var b=a.stream.readByte();switch(b){case q.TagNull:return null;case q.TagEmpty:return new Uint8Array(0);case q.TagBytes:return D(a);case q.TagRef:return H(a);default:m(b)}}function E(a){a=a.stream;var b=a.readString(k(a,q.TagQuote));return a.skip(1),b}function p(a){var b=E(a);return a.refer.set(b),b}function N(a){var b=a.stream.readByte();switch(b){case q.TagNull:return null;case q.TagEmpty:return"";
case q.TagUTF8Char:return a.stream.readString(1);case q.TagString:return p(a);case q.TagRef:return H(a);default:m(b)}}function K(a){var b=a.stream;b.skip(1);var c=b.readAsciiString(36);return b.skip(1),a.refer.set(c),c}function g(a){var b=a.stream,c=[];a.refer.set(c);for(var e=k(b,q.TagOpenbrace),f=0;e>f;f++)c[f]=t(a);return b.skip(1),c}function O(a){var b=a.stream,c={};a.refer.set(c);for(var e=k(b,q.TagOpenbrace),f=0;e>f;f++){var g=t(a),h=t(a);c[g]=h}return b.skip(1),c}function M(a){var b=a.stream,
c=new Q;a.refer.set(c);for(var e=k(b,q.TagOpenbrace),f=0;e>f;f++){var g=t(a),h=t(a);c.set(g,h)}return b.skip(1),c}function e(a){var b=a.stream,c=a.classref[k(b,q.TagOpenbrace)],e=new c.classname;a.refer.set(e);for(var f=0;f<c.count;f++)e[c.fields[f]]=t(a);return b.skip(1),e}function u(a){var b=a.stream.readByte();switch(b){case q.TagNull:return null;case q.TagClass:return L(a),u(a);case q.TagObject:return e(a);case q.TagRef:return H(a);default:m(b)}}function L(a){for(var b=a.stream,c=E(a),e=k(b,q.TagOpenbrace),
g=[],h=0;e>h;h++)g[h]=N(a);b.skip(1);c=f(c);a.classref.push({classname:c,count:e,fields:g})}function H(a){return a.refer.read(k(a.stream,q.TagSemicolon))}function J(a,b,c){w.call(this,a);this.useHarmonyMap=!!c;Object.defineProperties(this,{classref:{value:[]},refer:{value:b?Ga:new r}})}var Q=b.Map,Ca=b.hprose.BytesIO,q=b.hprose.Tags,Fa=b.hprose.ClassManager;b.hprose.RawReader=w;var Ga=Object.create(null,{set:{value:function(){}},read:{value:function(){m(q.TagRef)}},reset:{value:function(){}}});Object.defineProperties(r.prototype,
{set:{value:function(a){this.ref.push(a)}},read:{value:function(a){return this.ref[a]}},reset:{value:function(){this.ref.length=0}}});J.prototype=Object.create(w.prototype);J.prototype.constructor=J;Object.defineProperties(J.prototype,{useHarmonyMap:{value:!1,writable:!0},checkTag:{value:function(a,b){b===B&&(b=this.stream.readByte());b!==a&&m(b,a)}},checkTags:{value:function(a,b){return b===B&&(b=this.stream.readByte()),0<=a.indexOf(b)?b:void m(b,a)}},unserialize:{value:function(){return t(this)}},
readInteger:{value:function(){var a;a:{a=this.stream;var b=a.readByte();switch(b){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:a=b-48;break a;case q.TagInteger:a=k(a,q.TagSemicolon);break a;default:m(b)}a=void 0}return a}},readLong:{value:function(){var a;a:{a=this.stream;var b=a.readByte();switch(b){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:a=b-48;break a;case q.TagInteger:case q.TagLong:a=x(a);break a;default:m(b)}a=void 0}return a}},
readDouble:{value:function(){return c(this.stream)}},readBoolean:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case q.TagTrue:a=!0;break a;case q.TagFalse:a=!1;break a;default:m(a)}a=void 0}return a}},readDateWithoutTag:{value:function(){return C(this)}},readDate:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case q.TagNull:a=null;break a;case q.TagDate:a=C(this);break a;case q.TagRef:a=H(this);break a;default:m(a)}a=void 0}return a}},readTimeWithoutTag:{value:function(){return z(this)}},
readTime:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case q.TagNull:a=null;break a;case q.TagTime:a=z(this);break a;case q.TagRef:a=H(this);break a;default:m(a)}a=void 0}return a}},readBytesWithoutTag:{value:function(){return D(this)}},readBytes:{value:function(){return A(this)}},readStringWithoutTag:{value:function(){return p(this)}},readString:{value:function(){return N(this)}},readGuidWithoutTag:{value:function(){return K(this)}},readGuid:{value:function(){var a;a:{a=this.stream.readByte();
switch(a){case q.TagNull:a=null;break a;case q.TagGuid:a=K(this);break a;case q.TagRef:a=H(this);break a;default:m(a)}a=void 0}return a}},readListWithoutTag:{value:function(){return g(this)}},readList:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case q.TagNull:a=null;break a;case q.TagList:a=g(this);break a;case q.TagRef:a=H(this);break a;default:m(a)}a=void 0}return a}},readMapWithoutTag:{value:function(){return this.useHarmonyMap?M(this):O(this)}},readMap:{value:function(){var a;
if(this.useHarmonyMap)a:{a=this.stream.readByte();switch(a){case q.TagNull:a=null;break a;case q.TagMap:a=M(this);break a;case q.TagRef:a=H(this);break a;default:m(a)}a=void 0}else a:{a=this.stream.readByte();switch(a){case q.TagNull:a=null;break a;case q.TagMap:a=O(this);break a;case q.TagRef:a=H(this);break a;default:m(a)}a=void 0}return a}},readObjectWithoutTag:{value:function(){return e(this)}},readObject:{value:function(){return u(this)}},reset:{value:function(){this.classref.length=0;this.refer.reset()}}});
b.hprose.Reader=J})(function(){return this||(0,eval)("this")}());(function(b){function B(b,m){var a=new y;return(new h(a,m)).serialize(b),a}function m(b,h,a){return b instanceof y||(b=new y(b)),(new w(b,h,a)).unserialize()}var y=b.hprose.BytesIO,h=b.hprose.Writer,w=b.hprose.Reader;b.hprose.Formatter={serialize:function(b,h){return B(b,h).bytes},unserialize:m};b.hprose.serialize=B;b.hprose.unserialize=m})(function(){return this||(0,eval)("this")}());(function(b){b.hprose.ResultMode={Normal:0,Serialized:1,
Raw:2,RawWithEndTag:3};b.hprose.Normal=b.hprose.ResultMode.Normal;b.hprose.Serialized=b.hprose.ResultMode.Serialized;b.hprose.Raw=b.hprose.ResultMode.Raw;b.hprose.RawWithEndTag=b.hprose.ResultMode.RawWithEndTag})(function(){return this||(0,eval)("this")}());(function(b,B){function m(){}function y(h,y,K){function g(a,b){for(var c=0,d=I.length;d>c;c++)a=I[c].outputFilter(a,b);return a}function O(a,b){return a=g(a,b),V(a,b).then(function(a){if(b.oneway)a=void 0;else for(var c=I.length-1;0<=c;c--)a=I[c].inputFilter(a,
b);return a})}function M(a,b){return ga.sendAndReceive(a,b)}function e(a,b,c,d){Da(a,b).then(c,function(e){u(a,b,c,d)||d(e)})}function u(a,c,d,f){if(c.failswitch&&++aa>=za.length&&(aa=0,ra=za[aa]),c.idempotent&&0<=--c.retry){var g=500*(10-c.retry);return 10<c.retry&&(g=500),b.setTimeout(function(){e(a,c,d,f)},g),!0}return!1}function L(b){e(c,{retry:Ea,idempotent:!0,failswitch:!0,timeout:ia,client:ga,userdata:{}},function(c){var d=null;try{var e=new a(c),f=new k(e,!0);switch(e.readByte()){case r.TagError:d=
Error(f.readString());break;case r.TagFunctions:var g=f.readList();f.checkTag(r.TagEnd);sa(b,g);break;default:d=Error("Wrong Response:\r\n"+a.toString(c))}}catch(h){d=h}null!==d?ca.reject(d):ca.resolve(b)},ca.reject)}function J(a,b){return function(){return T?Ga(a,b,C(arguments),!0):t.all(arguments).then(function(c){return Ga(a,b,c,!1)})}}function Q(a,b,c,d,e){if(b[d]===B&&(b[d]={},(typeof e===z||e.constructor===Object)&&(e=[e]),Array.isArray(e)))for(var f=0;f<e.length;f++){var g=e[f];if(typeof g===
z)b[d][g]=J(a,c+d+"_"+g);else for(var h in g)Q(a,b[d],d+"_",h,g[h])}}function sa(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(typeof d===z)a[d]===B&&(a[d]=J(a,d));else for(var e in d)Q(a,a,"",e,d[e])}}function Ca(a,b){for(var c=Math.min(a.length,b.length),d=0;c>d;++d)b[d]=a[d]}function q(b,c,d){var e=new a;e.writeByte(r.TagCall);var g=new f(e,d.simple);return g.writeString(b),(0<c.length||d.byref)&&(g.reset(),g.writeList(c),d.byref&&g.writeBoolean(!0)),e}function Fa(a,b,c,d){return oa?t.promise(function(e,
f){pa.push({batch:d,name:a,args:b,context:c,resolve:e,reject:f})}):d?ka(a,b,c):S(a,b,c)}function Ga(a,b,c,d){var e=Fa;var f=d?{mode:x.Normal,byref:Aa,simple:Ba,onsuccess:B,onerror:B,useHarmonyMap:Y,client:ga,userdata:{}}:{mode:x.Normal,byref:Aa,simple:Ba,timeout:ia,retry:Ea,idempotent:xa,failswitch:Ha,oneway:!1,sync:!1,onsuccess:B,onerror:B,useHarmonyMap:Y,client:ga,userdata:{}};if(b in a){a=a[b];for(var g in a)g in f&&(f[g]=a[g])}g=0;for(a=c.length;a>g&&typeof c[g]!==A;++g);if(g!==a){var h=c.splice(g,
a-g);f.onsuccess=h[0];a=h.length;for(g=1;a>g;++g){var k=h[g];switch(typeof k){case A:f.onerror=k;break;case E:f.byref=k;break;case D:f.mode=k;break;case H:for(var p in k)p in f&&(f[p]=k[p])}}}return e(b,c,f,d)}function d(a,b,c,d){try{c.onerror?c.onerror(a,b):ta(a,b),d(b)}catch(e){d(e)}}function F(b,c,d){var g=d.args,f=d.context,h=q(d.name,g,f);h.writeByte(r.TagEnd);e(h.bytes,f,function(e){if(f.oneway)return void b();var h=null,p=null;try{if(f.mode===x.RawWithEndTag)h=e;else if(f.mode===x.Raw)h=e.subarray(0,
e.byteLength-1);else{var m=new a(e),t=new k(m,!1,f.useHarmonyMap),q=m.readByte();if(q===r.TagResult){if(h=f.mode===x.Serialized?t.readRaw():t.unserialize(),q=m.readByte(),q===r.TagArgument){t.reset();var u=t.readList();Ca(u,g);q=m.readByte()}}else q===r.TagError&&(p=Error(t.readString()),q=m.readByte());q!==r.TagEnd&&(p=Error("Wrong Response:\r\n"+a.toString(e)))}if(p)throw p;}catch(w){p=w}p?c(p,d):b(h,d)},c)}function P(a,c,d){return 0<c.length&&c[c.length-1]&&"function"==typeof c[c.length-1].handler?
t.promise(function(b,e){var f=c[c.length-1],g={name:a,args:c.slice(0,c.length-1),udata:f,invoke:F,context:d},h;for(h in f)"handler"!=h&&f.hasOwnProperty(h)&&(g[h]=f[h]);f.handler(g,b,e)}):"function"==typeof b.hprose.userdefInvoke?t.promise(function(e,f){b.hprose.userdefInvoke({name:a,args:c,udata:null,invoke:F,context:d},e,f)}):t.promise(function(b,e){F(b,e,{name:a,args:c,context:d})})}function wa(a){return function(){a&&(oa=!1,w(function(a){a.forEach(function(a){"settings"in a?Ua(a.settings).then(a.resolve,
a.reject):Fa(a.name,a.args,a.context,a.batch).then(a.resolve,a.reject)})},pa),pa=[])}}function S(a,b,c){c.sync&&(oa=!0);var e=t.promise(function(e,f){ua(a,b,c).then(function(d){try{if(c.onsuccess)try{c.onsuccess(d,b)}catch(g){c.onerror&&c.onerror(a,g),f(g)}e(d)}catch(g){f(g)}},function(b){d(a,b,c,f)})});return e.whenComplete(wa(c.sync)),e}function ka(a,b,c){return t.promise(function(d,e){da.push({args:b,name:a,context:c,resolve:d,reject:e})})}function la(a){var b={timeout:ia,retry:Ea,idempotent:xa,
failswitch:Ha,oneway:!1,sync:!1,client:ga,userdata:{}},c;for(c in a)c in b&&(b[c]=a[c]);return b}function Pa(b,c){var d=b.reduce(function(a,b){return a.write(q(b.name,b.args,b.context)),a},new a);return d.writeByte(r.TagEnd),t.promise(function(f,g){e(d.bytes,c,function(d){if(c.oneway)return void f(b);var e=-1,h=new a(d),n=new k(h,!1),p=h.readByte();try{for(;p!==r.TagEnd;){var m=null,t=null,q=b[++e].context.mode;if(q>=x.Raw&&(m=new a),p===r.TagResult){if(q===x.Serialized?m=n.readRaw():q>=x.Raw?(m.writeByte(r.TagResult),
m.write(n.readRaw())):(n.useHarmonyMap=b[e].context.useHarmonyMap,n.reset(),m=n.unserialize()),p=h.readByte(),p===r.TagArgument){if(q>=x.Raw)m.writeByte(r.TagArgument),m.write(n.readRaw());else{n.reset();var u=n.readList();Ca(u,b[e].args)}p=h.readByte()}}else p===r.TagError&&(q>=x.Raw?(m.writeByte(r.TagError),m.write(n.readRaw())):(n.reset(),t=Error(n.readString())),p=h.readByte());if(0>[r.TagEnd,r.TagResult,r.TagError].indexOf(p))return void g(Error("Wrong Response:\r\n"+a.toString(d)));q>=x.Raw?
(q===x.RawWithEndTag&&m.writeByte(r.TagEnd),b[e].result=m.bytes):b[e].result=m;b[e].error=t}}catch(w){return void g(w)}f(b)},g)})}function Ua(a){if(a=a||{},T=!1,oa)return t.promise(function(b,c){pa.push({batch:!0,settings:a,resolve:b,reject:c})});if(0!==da.length){var b=la(a);b.sync&&(oa=!0);var c=da;da=[];var e=t.promise(function(a,e){qa(c,b).then(function(b){b.forEach(function(a){if(a.error)d(a.name,a.error,a.context,a.reject);else try{if(a.context.onsuccess)try{a.context.onsuccess(a.result,a.args)}catch(b){a.context.onerror&&
a.context.onerror(a.name,b),a.reject(b)}a.resolve(a.result)}catch(b){a.reject(b)}delete a.context;delete a.resolve;delete a.reject});a(b)},function(a){c.forEach(function(b){"reject"in b&&d(b.name,a,b.context,b.reject)});e(a)})});return e.whenComplete(wa(b.sync)),e}}function Ta(){return ta}function Va(a){typeof a===A&&(ta=a)}function La(a){a&&"function"==typeof a.inputFilter&&"function"==typeof a.outputFilter&&I.push(a)}function Ma(a,b,c){c===B&&(typeof b===E&&(c=b,b=!1),b||(typeof a===E?(c=a,a=!1):
(a&&a.constructor===Object||Array.isArray(a))&&(b=a,a=!1)));var d=ga;return c&&(d={}),a||ra?(a&&(ra=a),(typeof b===z||b&&b.constructor===Object)&&(b=[b]),Array.isArray(b)?(sa(d,b),ca.resolve(d),d):(w(L,d),ca)):Error("You should set server uri first!")}function ha(a,b,c){return W[a]?(a=W[a],a[b]?a[b]:null):(c&&(W[a]=Object.create(null)),null)}function ya(a,b,c,d){if(typeof a!==z)throw new TypeError("topic name must be a string.");if(b===B||null===b){if(typeof c!==A)throw new TypeError("callback must be a function.");
b=c}if(typeof b===A)return d=c,c=b,null===ma&&(ma=ea()),void ma.then(function(b){ya(a,b,c,d)});if(typeof c!==A)throw new TypeError("callback must be a function.");if(t.isPromise(b))return void b.then(function(b){ya(a,b,c,d)});d===B&&(d=ia);var e=ha(a,b,!0);if(null===e){var f=function(){Ga(ga,a,[b,e.handler,f,{idempotent:!0,failswitch:!1,timeout:d}],!1)},e={handler:function(c){var d=ha(a,b,!1);if(d){if(null!==c)for(var d=d.callbacks,e=0,g=d.length;g>e;++e)try{d[e](c)}catch(h){}null!==ha(a,b,!1)&&f()}},
callbacks:[c]};W[a][b]=e;f()}else 0>e.callbacks.indexOf(c)&&e.callbacks.push(c)}function Wa(a,b,c){if(a)if(typeof c===A){var d=a[b];d&&(d=d.callbacks,c=d.indexOf(c),0<=c&&(d[c]=d[d.length-1],d.length--),0===d.length&&delete a[b])}else delete a[b]}function na(a,b,c){if(typeof a!==z)throw new TypeError("topic name must be a string.");if(b===B||null===b){if(typeof c!==A)return void delete W[a];b=c}if(typeof b===A&&(c=b,b=null),null===b)if(null===ma){if(W[a]){var d=W[a];for(b in d)Wa(d,b,c)}}else ma.then(function(b){na(a,
b,c)});else t.isPromise(b)?b.then(function(b){na(a,b,c)}):Wa(W[a],b,c)}function ea(){return Ga(ga,"#",[],!1)}function Za(a){G.push(a);ua=G.reduceRight(function(a,b){return function(c,d,e){try{var f=b(c,d,e,a);return t.isFuture(f)?f:t.value(f)}catch(g){return t.error(g)}}},P)}function $a(a){ja.push(a);qa=ja.reduceRight(function(a,b){return function(c,d){try{var e=b(c,d,a);return t.isFuture(e)?e:t.value(e)}catch(f){return t.error(f)}}},Pa)}function Ia(a){va.push(a);Da=va.reduceRight(function(a,b){return function(c,
d){try{var e=b(c,d,a);return t.isFuture(e)?e:t.value(e)}catch(f){return t.error(f)}}},O)}function Na(a){Ja.push(a);V=Ja.reduceRight(function(a,b){return function(c,d){try{var e=b(c,d,a);return t.isFuture(e)?e:t.value(e)}catch(f){return t.error(f)}}},M)}var ra,za=[],aa=-1,Aa=!1,Ba=!1,ia=3E4,Ea=10,xa=!1,Ha=!1,oa=!1,pa=[],Y=!1,ta=m,I=[],T=!1,da=[],ca=new t,W=Object.create(null),ma=null,U=!0,ua=P,qa=Pa,Da=O,V=M,G=[],ja=[],va=[],Ja=[],ga=this;ea.sync=!0;ea.idempotent=!0;ea.failswitch=!0;var Qa=Object.create(null,
{begin:{value:function(){T=!0}},end:{value:Ua},use:{value:function(a){return $a(a),Qa}}}),Ra=Object.create(null,{use:{value:function(a){return Ia(a),Ra}}}),Sa=Object.create(null,{use:{value:function(a){return Na(a),Sa}}});Object.defineProperties(this,{"#":{value:ea},onError:{get:Ta,set:Va},onerror:{get:Ta,set:Va},uri:{get:function(){return ra}},id:{get:function(){return ma}},failswitch:{get:function(){return Ha},set:function(a){Ha=!!a}},timeout:{get:function(){return ia},set:function(a){ia="number"==
typeof a?0|a:0}},retry:{get:function(){return Ea},set:function(a){Ea="number"==typeof a?0|a:0}},idempotent:{get:function(){return xa},set:function(a){xa=!!a}},keepAlive:{get:function(){return U},set:function(a){U=!!a}},byref:{get:function(){return Aa},set:function(a){Aa=!!a}},simple:{get:function(){return Ba},set:function(a){Ba=!!a}},useHarmonyMap:{get:function(){return Y},set:function(a){Y=!!a}},filter:{get:function(){return 0===I.length?null:1===I.length?I[0]:I.slice()},set:function(a){I.length=
0;Array.isArray(a)?a.forEach(function(a){La(a)}):La(a)}},addFilter:{value:La},removeFilter:{value:function(a){a=I.indexOf(a);return-1===a?!1:(I.splice(a,1),!0)}},useService:{value:Ma},invoke:{value:function(a,b,c){var d=arguments.length;if(1>d||typeof a!==z)throw Error("name must be a string");if(1===d&&(b=[]),2===d&&!Array.isArray(b)){var e=[];typeof b!==A&&e.push(m);e.push(b);b=e}if(2<d)for(typeof c!==A&&b.push(m),e=2;d>e;e++)b.push(arguments[e]);return Ga(ga,a,b,T)}},ready:{value:function(a,b){return ca.then(a,
b)}},subscribe:{value:ya},unsubscribe:{value:na},use:{value:function(a){return Za(a),ga}},batch:{value:Qa},beforeFilter:{value:Ra},afterFilter:{value:Sa}});K&&typeof K===H&&"failswitch timeout retry idempotent keepAlive byref simple useHarmonyMap filter".split(" ").forEach(function(a){a in K&&(ga[a]=K[a])});typeof h===z?(za=[h],aa=0,Ma(h,y)):Array.isArray(h)&&(za=h,aa=Math.floor(Math.random()*za.length),Ma(za[aa],y))}function h(a){var b=document.createElement("a");if(b.href=a,"http:"!==b.protocol&&
"https:"!==b.protocol&&"ws:"!==b.protocol&&"wss:"!==b.protocol)throw Error("The "+b.protocol+" client isn't implemented.");}var w=b.setImmediate,r=b.hprose.Tags,x=b.hprose.ResultMode,a=b.hprose.BytesIO,f=b.hprose.Writer,k=b.hprose.Reader,t=b.hprose.Future,C=Function.prototype.call.bind(Array.prototype.slice),c=new Uint8Array(1);c[0]=r.TagEnd;var E="boolean",z="string",D="number",A="function",H="object";Object.defineProperty(y,"create",{value:function(a,c,f){try{return b.hprose.HttpClient.create(a,
c,f)}catch(g){}try{return b.hprose.WebSocketClient.create(a,c,f)}catch(g){}if("string"==typeof a)h(a);else if(Array.isArray(a))throw a.forEach(function(a){h(a)}),Error("Not support multiple protocol.");throw Error("You should set server uri first!");}});b.hprose.Client=y})(function(){return this||(0,eval)("this")}());(function(b,x){function m(){}function y(h,a,f){function k(a,f){var h=new XMLHttpRequest;h.open("POST",D.uri,!0);b.location!==x&&"file:"!==b.location.protocol&&(h.withCredentials="true");
h.responseType="arraybuffer";for(var k in c)h.setRequestHeader(k,c[k]);return h.onload=function(){h.onload=m;h.status&&(200===h.status?f.resolve(new Uint8Array(h.response)):f.reject(Error(h.status+":"+h.statusText)))},h.onerror=function(){f.reject(Error("error"))},h.upload!==x&&(h.upload.onprogress=E),h.onprogress=z,a.constructor===String||ArrayBuffer.isView?h.send(a):a.buffer.slice?h.send(a.buffer.slice(0,a.length)):h.send(a.buffer),h}function t(a){"function"==typeof a&&(E=a)}function C(){return E}
if(this.constructor!==y)return new y(h,a,f);w.call(this,h,a,f);var c=Object.create(null),E=m,z=m,D=this;Object.defineProperties(this,{onProgress:{get:C,set:t},onprogress:{get:C,set:t},onRequestProgress:{get:C,set:t},onResponseProgress:{get:function(){return z},set:function(a){"function"==typeof a&&(z=a)}},setHeader:{value:function(a,b){"content-type"!==a.toLowerCase()&&"content-length"!==a.toLowerCase()&&(b?c[a]=b:delete c[a])}},sendAndReceive:{value:function(a,b){var c=new r,f=k(a,c);return 0<b.timeout&&
(c=c.timeout(b.timeout).catchError(function(a){throw f.onload=m,f.onerror=m,f.abort(),a;},function(a){return a instanceof L})),b.oneway&&c.resolve(),c}}})}function h(b){var a=document.createElement("a");if(a.href=b,"http:"!==a.protocol&&"https:"!==a.protocol)throw Error("This client desn't support "+a.protocol+" scheme.");}var w=b.hprose.Client,r=b.hprose.Future;Object.defineProperty(y,"create",{value:function(b,a,f){if("string"==typeof b)h(b);else{if(!Array.isArray(b))return Error("You should set server uri first!");
b.forEach(function(a){h(a)})}return new y(b,a,f)}});b.hprose.HttpClient=y})(function(){return this||(0,eval)("this")}());(function(b,x){function m(){}function y(a,b,h){function t(a,b){var c=new r;c.writeInt32BE(a);b.constructor===String?c.writeString(b):c.write(b);c=c.bytes;ArrayBuffer.isView?K.send(c):c.buffer.slice?K.send(c.buffer.slice(0,c.length)):K.send(c.buffer)}function E(a){N.resolve(a)}function c(a){a=new r(a.data);var b=a.readInt32BE(),c=J[b];if(delete J[b],c!==x&&(--A,c.resolve(a.read(a.length-
4))),100>A&&0<p.length){++A;var f=p.shift();N.then(function(){t(f[0],f[1])})}0===A&&(g.keepAlive||z())}function H(a){J.forEach(function(b,c){b.reject(Error(a.code+":"+a.reason));delete J[c]});A=0;K=null}function z(){null!==K&&(K.onopen=m,K.onmessage=m,K.onclose=m,K.close())}if(this.constructor!==y)return new y(a,b,h);w.call(this,a,b,h);var D=0,A=0,J=[],p=[],N=null,K=null,g=this;Object.defineProperties(this,{sendAndReceive:{value:function(a,b){if(null===K||K.readyState===WebSocket.CLOSING||K.readyState===
WebSocket.CLOSED)N=new C,K=new WebSocket(g.uri),K.binaryType="arraybuffer",K.onopen=E,K.onmessage=c,K.onerror=m,K.onclose=H;var e=2147483647>D?++D:D=0,f=new C;return J[e]=f,0<g.timeout&&(f=f.timeout(g.timeout).catchError(function(a){throw delete J[e],--A,a;},function(a){return a instanceof L})),100>A?(++A,N.then(function(){t(e,a)})):p.push([e,a]),b.oneway&&f.resolve(),f}},close:{value:z}})}function h(a){var b=document.createElement("a");if(b.href=a,"ws:"!==b.protocol&&"wss:"!==b.protocol)throw Error("This client desn't support "+
b.protocol+" scheme.");}var w=b.hprose.Client,r=b.hprose.BytesIO,C=b.hprose.Future;Object.defineProperty(y,"create",{value:function(a,b,k){if("string"==typeof a)h(a);else{if(!Array.isArray(a))return Error("You should set server uri first!");a.forEach(function(a){h(a)})}return new y(a,b,k)}});b.hprose.WebSocketClient=y})(function(){return this||(0,eval)("this")}());(function(b){function x(b){this.version=b||"2.0"}var m=b.hprose.Tags,y=b.hprose.BytesIO,h=b.hprose.Writer,w=b.hprose.Reader,r=1;x.prototype.inputFilter=
function(b,a){var f=y.toString(b);"{"===f.charAt(0)&&(f="["+f+"]");for(var f=JSON.parse(f),k=new y,t=new h(k,!0),r=0,c=f.length;c>r;++r){var w=f[r];w.error?(k.writeByte(m.TagError),t.writeString(w.error.message)):(k.writeByte(m.TagResult),t.serialize(w.result))}return k.writeByte(m.TagEnd),k.bytes};x.prototype.outputFilter=function(b,a){var f=[],h=new y(b),t=new w(h,!1,!1),x=h.readByte();do{var c={};x===m.TagCall&&(c.method=t.readString(),x=h.readByte(),x===m.TagList&&(c.params=t.readListWithoutTag(),
x=h.readByte()),x===m.TagTrue&&(x=h.readByte()));"1.1"===this.version?c.version="1.1":"2.0"===this.version&&(c.jsonrpc="2.0");c.id=r++;f.push(c)}while(x===m.TagCall);return 1<f.length?JSON.stringify(f):JSON.stringify(f[0])};b.hprose.JSONRPCClientFilter=x})(function(){return this||(0,eval)("this")}());(function(b){b.hprose.common={Completer:b.hprose.Completer,Future:b.hprose.Future,ResultMode:b.hprose.ResultMode};b.hprose.io={BytesIO:b.hprose.BytesIO,ClassManager:b.hprose.ClassManager,Tags:b.hprose.Tags,
RawReader:b.hprose.RawReader,Reader:b.hprose.Reader,Writer:b.hprose.Writer,Formatter:b.hprose.Formatter};b.hprose.client={Client:b.hprose.Client,HttpClient:b.hprose.HttpClient,WebSocketClient:b.hprose.WebSocketClient};b.hprose.filter={JSONRPCClientFilter:b.hprose.JSONRPCClientFilter};J(5).cmd?!(x=[],H=b.hprose,C="function"===typeof H?H.apply(E,x):H,void 0!==C&&(Q.exports=C)):J(6)&&!(x=[],C=function(){return b.hprose}.apply(E,x),void 0!==C&&(Q.exports=C));"object"==typeof Q&&"object"==typeof Q.exports&&
(Q.exports=b.hprose)})(function(){return this||(0,eval)("this")}())},function(Q,E){Q.exports=function(){throw Error("define cannot be used indirect");}},function(Q,E){(function(E){Q.exports=E}).call(E,{})}]);
