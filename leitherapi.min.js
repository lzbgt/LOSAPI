(function(Q){function E(L){if(J[L])return J[L].exports;var H=J[L]={exports:{},id:L,loaded:!1};Q[L].call(H.exports,H,H.exports,E);H.loaded=!0;return H.exports}var J={};E.m=Q;E.c=J;E.p="";return E(0)})([function(Q,E,J){function L(){function a(c,b,w){c.invoke(function(a,c){var n=D.some(function(a){return-1!==c.name.indexOf(a)}),e=n;void 0!==c.ttl&&0>=c.ttl&&(n=!1,e="disabled");debug.log("do cache?: ",e,c.name,c.args,c.udata,a);if(!n||c.nocache||null===a)return b(a);n=null;"string"==typeof a&&"{"==a[0]?
n={__is:"string",value:JSON.parse(a)}:"object"==typeof a&&null!=a?n=Array.isArray(a)?{__is:"array",value:a}:{__is:"object",value:a}:null===a&&(n={__is:"null",value:"__null__"});e=1<c.args.length?c.args.slice(1).join(""):null;n&&e&&(n.__id=e,n.__score=0,n.__ts=Date.now(),A.db[A.table].put(n).then(function(a){},function(a){debug.warn("save to db error: ",a)}));c.skipResolve?"function"==typeof c.asyncCall&&c.asyncCall(a):b(a)},w,c)}function b(c,w,f){var m=null;D.some(function(a){return-1!==c.name.indexOf(a)})&&
(m=1<c.args.length?c.args.slice(1).join(""):null);m?A.db[A.table].get(m).then(function(b){if(b){var D=null;if("string"==b.__is)D=JSON.stringify(b.value);else{if("null"==b.__is)return a(c,w,f);D=b.value}c.background||"undefined"==typeof c.background&&A.background?(debug.log("fetching from icache.db with background enabled: ",m,D,c.name,c.args),w(D),c.skipResolve=!0,a(c,w,f)):("undefined"==typeof c.ttl?"undefined"==typeof b.__ttl&&(b.__ttl=A.DEFAULT_TTL):b.__ttl=c.ttl,b.__ttl<Date.now()-b.__ts?a(c,
w,f):(debug.log("fetching from icache.db: ",m,D,c.name,c.args),w(D)))}else a(c,w,f)},function(b){debug.log("not in icache.db, fetching from server");a(c,w,f)}):a(c,w,f)}var D=["get"],A={};window.icache=A;A.db=new h(c.AppName);var f={};A.table="icache";f[A.table]="__id,__score,__ts";try{A.db.version(2).stores(f),A.db.open()}catch(n){debug.warn("can't use indexedDB: ",n);return}A.DEFAULT_TTL=31536E6;A.handler=b;window.hprose.userdefInvoke=b;A.tools={};A.tools.makeurl=function(a,b,w,m){return"http://"+
a+"/loadres?type=text/html&AppName="+b+"&AppBid="+w+"&ip="+a+"&bid="+c.SystemBid+"&name=AppTemplate&ver=last&userid="+m}}function H(a){a=function(a){var c=2;try{c=eval(a)}catch(b){c=2}"boolean"===typeof c?c=c?2:X.length:"string"===typeof c&&(c=2);return c}(a);console.log("loglevel: ",a);for(var c=function(){},b=a;b<X.length;b++)window.debug[X[b]]=window.console[X[b]].bind(window.console);for(b=0;b<a;b++)window.debug[X[b]]=c}function x(a){var b=c.ayFE[a];return b?(debug.log("PE: seted"),b):function(b){debug.log("PE:default mark");
if(c.ayFE[a])return c.ayFE[a](b);c.ayErr[a]=b;debug.error(a+":"+b)}}function C(){return null!=c.api}function b(a){debug.log("setMain: ",a);if(c.Running)debug.warn("setMain: app running");else if("function"==typeof InitErrFunc&&InitErrFunc(),"undefined"!=typeof main)if(debug.log("main function ok run it"),c.Main=main,debug.log("isok",C),C()){c.Running=!0;debug.log("s1");for(var b=0;b<c.InitFunc.length;b++)c.InitFunc[b]();debug.log("s2",L);L();debug.log("s3");main();debug.log("called main()")}else for(b in debug.log("Leither is not OK"),
c.ayErr)a=c.ayFE[b],err=c.ayErr[b],null!=err&&null!=a&&(c.ayErr[b]=null,debug.log("errReply err:",err),a(err))}function B(a,c){var b=localStorage[a];if(b)return JSON.parse(b);"undefined"!=typeof c&&(localStorage[a]=JSON.stringify(c));return c}function l(){debug.log("InitDb");var a=new hprose.Future,b=b||2,D=window.indexedDB.open("LeitherApi",b);c.ApptbName=c.appBid+"_"+c.AppName;debug.log(c.ApptbName);D.onerror=function(c){debug.error(c.currentTarget.error.message);a.reject(c)};D.onsuccess=function(b){debug.log("InitDb ok");
b=b.target.result;c.LeitherDb=b;a.resolve(b)};D.onupgradeneeded=function(a){a=a.target.result;a.objectStoreNames.contains("res")||a.createObjectStore("res",{keyPath:"id"});a.objectStoreNames.contains(c.ApptbName)&&a.deleteObjectStore(c.ApptbName);debug.log("DB version changed to "+b)};return a}function z(a){var b=c.LeitherDb.transaction("res","readwrite").objectStore("res"),D=new hprose.Future;request=b.get(a);request.onerror=function(a){D.reject(a)};request.onsuccess=function(a){D.resolve(a.target.result)};
return D}function g(a){var b=c.LeitherDb.transaction("res","readwrite").objectStore("res"),D=new hprose.Future;request=b.put(a);request.onerror=function(a){debug.log("setdbdata err",a);D.reject(a)};request.onsuccess=function(a){D.resolve(a.target.result);debug.log("setdbdata: ",a.target.result)};return D}function y(c,b,D){var f=new hprose.Future,g=function(a,c){var b="last";if("last"==c||"release"==c)b=a[c];return a.ResFile[b]}(JSON.parse(D),b);(function(b){for(var D=[];b<g.length;b++){var w=g[b];
""==w?debug.error("invliad key:",w):D.push(a(c,w))}hprose.Future.all(D).then(function(a){debug.log("all promise",a);f.resolve()},function(a){debug.log(a);f.reject(a)})})(0);return f}function u(a){c.loginData=a;c.sid=a.sid;c.user=a.user;c.username=c.user.name;c.bid=null!==a.user?a.user.id:c.uid;c.leClient=c.api;c.swarm=a.swarm}function R(a){0<a.length?c.currentIP=a:a=c.currentIP;c.api=r(a);l().then(function(a){debug.log("hprose ready",a);c.api.ready(function(a){debug.log("hprose ready ok");debug.log("G.uid=",
c.uid);f(a,c.AppName,c.AppBid,c.AppVer).then(function(){var w=x("login");c.postLogin=u;"undefined"!==typeof ENABLE_UAC&&ENABLE_UAC?b("UAC enabled, must redirect to the login page first"):a.login(c.uid,c.userppt).then(function(a){debug.log("login ok");u(a);c.swarm=a.swarm;debug.log("LeitherIsOK:",C());debug.log("login ok sid=",a.sid);debug.log("user= ",a.user);debug.log("swarm=",a.swarm);debug.log("appName=",c.AppName);b("after loaded app and logedin")},w);c.Local||(debug.log("use remote files"),a.getresbyname(c.sid,
c.SystemBid,"LeitherApi",c.AppVer,{handler:icache.handler,ttl:0}).then(function(a){var b=new FileReader;b.onload=function(a){debug.log("leitherApi re get ok");localStorage.leitherApi=a.target.result};b.readAsText(new Blob([a]))}),a.hget(c.sid,c.AppBid,"applist",c.AppName,{handler:icache.handler,ttl:0}).then(function(a){debug.log("manifest re hget ok");g({id:c.AppName,data:a,tbname:c.ApptbName}).then()}))})},x("api.ready"))},x("InitDb"))}function a(a,b){var f=new hprose.Future,h=document.createElement("script");
h.type="text/javascript";z(b).then(function(r){if(r)debug.log("load js from db: ",b),h.textContent=r.data,document.getElementsByTagName("head")[0].appendChild(h),f.resolve(b);else if(debug.log("check leither"),"function"==typeof C&&C()){debug.log("check leither ok");var n=function(a){debug.error(a);f.reject(b)};c.api.ready(function(r){r.get("",a,b,function(n){debug.log("load js from server: ",a,b);if(n){var m=new FileReader;m.onload=function(a){g({id:b,data:a.target.result,tbname:c.ApptbName});h.textContent=
a.target.result;document.getElementsByTagName("head")[0].appendChild(h);f.resolve(b)};m.readAsText(new Blob([n]))}else debug.error("data is null"),f.reject(b)},n)},n)}else debug.error("leither is not ok"),f.reject(b)},function(a){debug.error(a);f.reject(a)});return f}function f(a,b,f,h){debug.log("load app name:",b,", appBid:",f);var r=new hprose.Future;if(c.Local)return debug.log("use local file"),r.resolve(),r;z(b).then(function(c){c?(debug.log("get app manifest from db successed: ",b),y(f,h,c.data).then(function(){r.resolve()},
function(a){debug.warn("LoadApp: ",a);r.reject(a)})):(debug.log("app :",b," resfiles not found in DB, fetching ... "),a.hget("",f,"applist",b).then(function(a){g({id:b,data:a,tbname:f+"_"+b});y(f,h,a).then(function(a){r.resolve()},function(a){debug.warn("LoadApp 2: ",a);r.reject(a)})}))},function(a){debug.error(a)});return r}var h=J(1);J(4);"use strict";var r=function(a){if("http://"==a.substr(0,7)){a=a.substr(7);var b=a.indexOf("/");0<b&&(a=a.substr(0,b))}b="ws://"+a+"/ws/";-1!=navigator.userAgent.indexOf("Firefox")&&
(b="http://"+a+"/webapi/");return hprose.Client.create(b,"login register getvar act setdata set get del expire hmclear hset hget hdel hlen hkeys hgetall hmset hmget exit restart lpush lpop rpush rpop lrange zadd zrange sadd scard sclear sdiff sinter smclear smembers srem sunion sendmsg readmsg pullmsg invite accept test veni sethostip proxyget createinvcode getinvcodeinfo updateinvcode deleteinvcode setinvtemplate getinvtemplate getappdownloadkey getresbyname getgshorturlkey getlshorturlkey incr zcard zcount zrem zscore zrank zrangebyscore lindex lexpire lexpireat lttl lpersist llen sendmail lset".split(" "))},
X=["log","info","warn","error"];window.debug={};window.setLog=H;var c={ayFE:{},ayErr:{},IPList:[],InitFunc:[]};window.G=c;window.LeitherIsOK=C;window.RunApp=function(a,b){if(0!=arguments.length){"undefined"===typeof a.Log?H(!1):H(a.Log);c.I=a;c.appBid=a.AppBid;c.Running=!1;c.AppVer=a.AppVer?a.AppVer:"last";debug.log("RunApp");var f;if(f=0==b)debug.log("InitCfg"),c.Local=a.Local,c.SystemBid=a.SystemBid,c.AppBid=a.AppBid,c.IPList=a.IPList&&a.IPList.length&&0<a.IPList.length?a.IPList:B(c.AppBid+"/iplist"),
c.userppt=a.userppt||B(window.location.pathname+"/"+c.AppBid+"/ppt"),c.AppName=a.AppName||B(c.AppBid+"/appname"),c.uid=a.userid||B(window.location.pathname+"/"+c.AppBid+"/uid"),f=!1;f||(c.IPList.length<=b?console.error("iplist.length [",c.IPList.length,"]<ipnum[",b,"]"):R(c.IPList[b]))}};window.RunApp()},function(Q,E,J){var L;(function(H){(function(x,C,b){function B(a,b){return"object"!=typeof b&&(b=b()),Object.keys(b).forEach(function(d){a[d]=b[d]}),a}function l(a){return{from:function(b){return a.prototype=
Object.create(b.prototype),a.prototype.constructor=a,{extend:function(d){B(a.prototype,"object"!=typeof d?d(b.prototype):d)}}}}}function z(a,b){return b(a)}function g(a,ja){function ka(a){this._cfg={version:a,storesSource:null,dbschema:{},tables:{},contentUpgrade:null};this.stores({})}function r(a,c,e,m){var k,v,p,Z,la;if(0===a)Object.keys(T).forEach(function(a){A(c,a,T[a].primKey,T[a].indexes)}),k=G._createTransaction(V,ba,T),k.idbtrans=c,k.idbtrans.onerror=q(e,["populating database"]),k.on("error").subscribe(e),
d.newPSD(function(){d.PSD.trans=k;try{G.on("populate").fire(k)}catch(a){m.onerror=c.onerror=function(a){a.preventDefault()};try{c.abort()}catch(p){}c.db.close();e(a)}});else{if(v=[],p=ca.filter(function(p){return p._cfg.version===a})[0],!p)throw new I("Dexie specification of currently installed DB version is missing");T=G._dbSchema=p._cfg.dbschema;Z=!1;p=ca.filter(function(p){return p._cfg.version>a});p.forEach(function(a){var p=T,k=a._cfg.dbschema;xa(p,c);xa(k,c);T=G._dbSchema=k;p=M(p,k);p.add.forEach(function(a){v.push(function(p,
k){A(p,a[0],a[1].primKey,a[1].indexes);k()})});p.change.forEach(function(a){if(a.recreate)throw new I("Not yet support for changing primary key");v.push(function(p,k){var v=p.objectStore(a.name);a.add.forEach(function(a){x(v,a)});a.change.forEach(function(a){v.deleteIndex(a.name);x(v,a)});a.del.forEach(function(a){v.deleteIndex(a)});k()})});a._cfg.contentUpgrade&&v.push(function(p,v){var b,d;Z=!0;b=G._createTransaction(V,[].slice.call(p.db.objectStoreNames,0),k);b.idbtrans=p;d=0;b._promise=z(b._promise,
function(a){return function(p,k,b){function c(a){return function(){a.apply(this,arguments);0==--d&&v()}}return++d,a.call(this,p,function(a,p){arguments[0]=c(a);arguments[1]=c(p);k.apply(this,arguments)},b)}});p.onerror=q(e,["running upgrader function for version",a._cfg.version]);b.on("error").subscribe(e);a._cfg.contentUpgrade(b);0===d&&v()});Z&&(0<=navigator.userAgent.indexOf("Trident")||0<=navigator.userAgent.indexOf("MSIE"))||v.push(function(a,p){for(var v,d=0;d<a.db.objectStoreNames.length;++d)v=
a.db.objectStoreNames[d],null!==k[v]&&k[v]!==b||a.db.deleteObjectStore(v);p()})});la=function(){try{v.length?v.shift()(c,la):wa(T,c)}catch(a){m.onerror=c.onerror=function(a){a.preventDefault()};try{c.abort()}catch(p){}c.db.close();e(a)}};la()}}function M(a,b){var d={del:[],add:[],change:[]},c,k,v,p,Z,e,q,m;for(c in a)b[c]||d.del.push(c);for(c in b)if(k=a[c],v=b[c],k)if(p={name:c,def:b[c],recreate:!1,del:[],add:[],change:[]},k.primKey.src!==v.primKey.src)p.recreate=!0,d.change.push(p);else{Z=k.indexes.reduce(function(a,
p){return a[p.name]=p,a},{});v=v.indexes.reduce(function(a,p){return a[p.name]=p,a},{});for(e in Z)v[e]||p.del.push(e);for(e in v)q=Z[e],m=v[e],q?q.src!==m.src&&p.change.push(m):p.add.push(m);(p.recreate||0<p.del.length||0<p.add.length||0<p.change.length)&&d.change.push(p)}else d.add.push([c,v]);return d}function A(a,b,d,c){var k=a.db.createObjectStore(b,d.keyPath?{keyPath:d.keyPath,autoIncrement:d.auto}:{autoIncrement:d.auto});return c.forEach(function(a){x(k,a)}),k}function wa(a,b){Object.keys(a).forEach(function(d){b.db.objectStoreNames.contains(d)||
A(b,d,a[d].primKey,a[d].indexes)})}function x(a,b){a.createIndex(b.name,b.keyPath,{unique:b.unique,multiEntry:b.multi})}function C(a,b){throw new I("Table "+b[0]+" not part of transaction. Original Scope Function Source: "+g.Promise.PSD.trans.scopeFunc.toString());}function ga(a,b,d,e){this.name=a;this.schema=d;this.hook=W[a]?W[a].hook:w(null,{creating:[f,y],reading:[R,u],updating:[h,y],deleting:[c,y]});this._tpf=b;this._collClass=e||da}function ya(a,b,d,c){ga.call(this,a,b,d,c||J)}function H(a,b,
d,c){function k(a,p,k,b){return v._promise(a,k,b)}var v=this,p,Z;this.db=G;this.mode=a;this.storeNames=b;this.idbtrans=null;this.on=w(this,["complete","error"],"abort");this._reculock=0;this._blockedFuncs=[];this._psd=null;this.active=!0;this._dbschema=d;c&&(this.parent=c);this._tpf=k;this.tables=Object.create(ma);for(c=b.length-1;-1!==c;--c)p=b[c],Z=G._tableFactory(a,d[p],k),this.tables[p]=Z,this[p]||(this[p]=Z)}function na(a,b,d){this._ctx={table:a,index:":id"===b?null:b,collClass:a._collClass,
or:d}}function da(a,b){var d=null,c=null,k;if(b)try{d=b()}catch(v){c=v}k=a._ctx;this._ctx={table:k.table,index:k.index,isPrimKey:!k.index||k.table.schema.primKey.keyPath&&k.index===k.table.schema.primKey.name,range:d,op:"openCursor",dir:"next",unique:"",algorithm:null,filter:null,isMatch:null,offset:0,limit:Infinity,error:c,or:k.or}}function J(){da.apply(this,arguments)}function Q(a,b){return a._cfg.version-b._cfg.version}function Ia(a,b,c,e,k,v){c.forEach(function(p){var c=G._tableFactory(e,k[p],
b);a.forEach(function(a){a[p]||(v?Object.defineProperty(a,p,{configurable:!0,enumerable:!0,get:function(){var a=d.PSD&&d.PSD.trans;return a&&a.db===G?a.tables[p]:c}}):a[p]=c)})})}function Na(a){a.forEach(function(a){for(var b in a)a[b]instanceof ga&&delete a[b]})}function ra(a,b,c,e,k,v){var p=d.PSD;v=v||u;a.onerror||(a.onerror=q(k));a.onsuccess=b?Ka(function(){var p=a.result,d;p?(d=function(){p.continue()},b(p,function(a){d=a},e,k)&&c(v(p.value),p,function(a){d=a}),d()):e()},k,p):Ka(function(){var p=
a.result,k;p?(k=function(){p.continue()},c(v(p.value),p,function(a){k=a}),k()):e()},k,p)}function za(a){var b=[];return a.split(",").forEach(function(a){a=a.trim();var d=a.replace("&","").replace("++","").replace("*",""),k=0!==d.indexOf("[")?d:a.substring(a.indexOf("[")+1,a.indexOf("]")).split("+");b.push(new sa(d,k||null,-1!==a.indexOf("&"),-1!==a.indexOf("*"),-1!==a.indexOf("++"),Array.isArray(k),-1!==k.indexOf(".")))}),b}function aa(a,b){return a<b?-1:a>b?1:0}function Aa(a,b){return a<b?1:a>b?
-1:0}function Ba(a){return function(b,d){for(var c=0,k;;){if(k=a(b[c],d[c]),0!==k)return k;if(++c,c===b.length||c===d.length)return a(b.length,d.length)}}}function ha(a,b){return a?b?function(){return a.apply(this,arguments)&&b.apply(this,arguments)}:a:b}function Ea(){if(G.verno=U.version/10,G._dbSchema=T={},ba=[].slice.call(U.objectStoreNames,0),0!==ba.length){var a=U.transaction(E(ba),"readonly");ba.forEach(function(b){for(var d,c=a.objectStore(b),k=c.keyPath,v=k&&"string"==typeof k&&-1!==k.indexOf("."),
p=new sa(k,k||"",!1,!1,!!c.autoIncrement,k&&"string"!=typeof k,v),e=[],la=0;la<c.indexNames.length;++la)d=c.index(c.indexNames[la]),v=(k=d.keyPath)&&"string"==typeof k&&-1!==k.indexOf("."),d=new sa(d.name,k,!!d.unique,!!d.multiEntry,!1,k&&"string"!=typeof k,v),e.push(d);T[b]=new Ca(b,p,e,{})});Ia([W],G._transPromiseFactory,Object.keys(T),V,T)}}function xa(a,b){for(var d,c,k,v,p=b.db.objectStoreNames,e=0;e<p.length;++e)for(d=p[e],c=b.objectStore(d),k=0;k<c.indexNames.length;++k){var la=c.indexNames[k],
q=c.index(la).keyPath,q="string"==typeof q?q:"["+[].slice.call(q).join("+")+"]";a[d]&&(v=a[d].idxByName[q],v&&(v.name=la))}}var Ha=ja&&ja.addons||g.addons,oa=g.dependencies,pa=oa.indexedDB,Y=oa.IDBKeyRange,ta=oa.TypeError,I=oa.Error,T=this._dbSchema={},ca=[],ba=[],W={},ma={},U=null,ua=!0,qa=null,Da=!1,V="readwrite",G=this,ia=[],va=!0,Ja=!!L();this.version=function(a){if(U)throw new I("Cannot add version when database is open");this.verno=Math.max(this.verno,a);var b=ca.filter(function(b){return b._cfg.version===
a})[0];return b?b:(b=new ka(a),ca.push(b),ca.sort(Q),b)};B(ka.prototype,{stores:function(a){var b,d;return this._cfg.storesSource=this._cfg.storesSource?B(this._cfg.storesSource,a):a,b={},ca.forEach(function(a){B(b,a._cfg.storesSource)}),d=this._cfg.dbschema={},this._parseStoresSpec(b,d),T=G._dbSchema=d,Na([W,G,ma]),Ia([ma],C,Object.keys(d),V,d),Ia([W,G,this._cfg.tables],G._transPromiseFactory,Object.keys(d),V,d,!0),ba=Object.keys(d),this},upgrade:function(a){var b=this;return F(function(){a(G._createTransaction(V,
Object.keys(b._cfg.dbschema),b._cfg.dbschema))}),this._cfg.contentUpgrade=a,this},_parseStoresSpec:function(a,b){Object.keys(a).forEach(function(d){if(null!==a[d]){var c={},k=za(a[d]),v=k.shift();if(v.multi)throw new I("Primary key cannot be multi-valued");v.keyPath&&O(c,v.keyPath,v.auto?0:v.keyPath);k.forEach(function(a){if(a.auto)throw new I("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new I("Index must have a name and cannot be an empty string");O(c,a.keyPath,a.compound?
a.keyPath.map(function(){return""}):"")});b[d]=new Ca(d,v,k,c)}})}});this._allTables=W;this._tableFactory=function(a,b,d){return"readonly"===a?new ga(b.name,d,b,da):new ya(b.name,d,b)};this._createTransaction=function(a,b,d,c){return new H(a,b,d,c)};this._transPromiseFactory=function(a,b,c){var e,k;return!ua||d.PSD&&d.PSD.letThrough?(k=G._createTransaction(a,b,T),k._promise(a,function(a,p){k.error(function(a){G.on("error").fire(a)});c(function(p){k.complete(function(){a(p)})},p,k)})):e=new d(function(d,
p){ia.push({resume:function(){var k=G._transPromiseFactory(a,b,c);e.onuncatched=k.onuncatched;k.then(d,p)}})})};this._whenReady=function(a){return N||!ua||d.PSD&&d.PSD.letThrough?new d(a):new d(function(b,d){ia.push({resume:function(){a(b,d)}})})};this.verno=0;this.open=function(){return new d(function(b,c){function e(a){try{m.transaction.abort()}catch(b){}Da=!1;qa=a;ua=!1;c(qa);ia.forEach(function(a){a.resume()});ia=[]}if(N&&b(G),U||Da)throw new I("Database already opened or being opened");var m;
try{if(qa=null,Da=!0,0<ca.length&&(va=!1),!pa)throw new I("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");if(m=va?pa.open(a):pa.open(a,Math.round(10*G.verno)),!m)throw new I("IndexedDB API not available");m.onerror=q(e,["opening database",a]);m.onblocked=function(a){G.on("blocked").fire(a)};m.onupgradeneeded=Ka(function(b){var d,p;va&&!G._allowEmptyDB?(m.onerror=function(a){a.preventDefault()},
m.transaction.abort(),m.result.close(),d=pa.deleteDatabase(a),d.onsuccess=d.onerror=function(){e(new I("Database '"+a+"' doesnt exist"))}):(m.transaction.onerror=q(e),p=b.oldVersion>Math.pow(2,62)?0:b.oldVersion,r(p/10,m.transaction,e,m))},e);m.onsuccess=Ka(function(){Da=!1;U=m.result;va?Ea():0<U.objectStoreNames.length&&xa(T,U.transaction(E(U.objectStoreNames),"readonly"));U.onversionchange=G.on("versionchange").fire;Ja||Oa(function(b){if(-1===b.indexOf(a))return b.push(a)});d.newPSD(function(){function a(){ua=
!1;ia.forEach(function(a){a.resume()});ia=[];b(G)}d.PSD.letThrough=!0;try{var v=G.on.ready.fire();v&&"function"==typeof v.then?v.then(a,function(a){U.close();U=null;e(a)}):D(a)}catch(p){e(p)}})},e)}catch(k){e(k)}})};this.close=function(){U&&(U.close(),U=null,ua=!0,qa=null)};this.delete=function(){var b=arguments;return new d(function(d,c){function e(){G.close();var b=pa.deleteDatabase(a);b.onsuccess=function(){Ja||Oa(function(b){var p=b.indexOf(a);if(0<=p)return b.splice(p,1)});d()};b.onerror=q(c,
["deleting",a]);b.onblocked=function(){G.on("blocked").fire()}}if(0<b.length)throw new I("Arguments not allowed in db.delete()");Da?ia.push({resume:e}):e()})};this.backendDB=function(){return U};this.isOpen=function(){return null!==U};this.hasFailed=function(){return null!==qa};this.dynamicallyOpened=function(){return va};this.name=a;Object.defineProperty(this,"tables",{get:function(){return Object.keys(W).map(function(a){return W[a]})}});this.on=w(this,"error","populate","blocked",{ready:[Ya,y],
versionchange:[X,y]});this.on.ready.subscribe=z(this.on.ready.subscribe,function(a){return function(b,d){function c(){return d||G.on.ready.unsubscribe(c),b.apply(this,arguments)}a.call(this,c);G.isOpen()&&(ua?ia.push({resume:c}):c())}});F(function(){G.on("populate").fire(G._createTransaction(V,ba,T));G.on("error").fire(new I)});this.transaction=function(a,b,c){function e(b,v){var q=null,m,S,f;try{if(p)throw p;q=G._createTransaction(a,Z,T,k);m=Z.map(function(a){return q.tables[a]});m.push(q);f=0;d.newPSD(function(){d.PSD.trans=
q;q.scopeFunc=c;k&&(q.idbtrans=k.idbtrans,q._promise=z(q._promise,function(a){return function(b,p,k){function c(a){return function(b){var p;return d._rootExec(function(){p=a(b);d._tickFinalize(function(){0==--f&&q.active&&(q.active=!1,q.on.complete.fire())})}),p}}return++f,a.call(this,b,function(a,b,d){return p(c(a),c(b),d)},k)}}));q.complete(function(){b(S)});q.error(function(a){q.idbtrans&&(q.idbtrans.onerror=Xa);try{q.abort()}catch(b){}k&&(k.active=!1,k.on.error.fire(a));var p=v(a);k||p||G.on.error.fire(a)});
d._rootExec(function(){S=c.apply(q,m)})});(!q.idbtrans||k&&0===f)&&q._nop()}catch(F){q&&q.idbtrans&&(q.idbtrans.onerror=Xa),q&&q.abort(),k&&k.on.error.fire(F),D(function(){v(F)||G.on("error").fire(F)})}}var k,v;b=[].slice.call(arguments,1,arguments.length-1);c=arguments[arguments.length-1];(k=d.PSD&&d.PSD.trans)&&k.db===G&&-1===a.indexOf("!")||(k=null);v=-1!==a.indexOf("?");a=a.replace("!","").replace("?","");var p=null,Z=(Array.isArray(b[0])?b.reduce(function(a,b){return a.concat(b)}):b).map(function(a){return"string"==
typeof a?a:(a instanceof ga||(p=p||new ta("Invalid type. Arguments following mode must be instances of Table or String")),a.name)});return"r"==a||"readonly"==a?a="readonly":"rw"==a||a==V?a=V:p=new I("Invalid transaction mode: "+a),k&&(p||(k&&"readonly"===k.mode&&a===V&&(v?k=null:p=p||new I("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")),k&&Z.forEach(function(a){k.tables.hasOwnProperty(a)||(v?k=null:p=p||new I("Table "+a+" not included in parent transaction. Parent Transaction function: "+
k.scopeFunc.toString()))}))),k?k._promise(a,e,"lock"):G._whenReady(e)};this.table=function(a){if(N&&va)return new ya(a);if(!W.hasOwnProperty(a))throw new I("Table does not exist");return W[a]};B(ga.prototype,function(){function a(){throw new I("Current Transaction is READONLY");}return{_trans:function(a,b,d){return this._tpf(a,[this.name],b,d)},_idbstore:function(a,b,c){if(N)return new d(b);var k=this;return this._tpf(a,[this.name],function(a,p,d){b(a,p,d.idbtrans.objectStore(k.name),d)},c)},get:function(a,
b){var d=this;return this._idbstore("readonly",function(b,c,p){N&&b(d.schema.instanceTemplate);var e=p.get(a);e.onerror=q(c,["getting",a,"from",d.name]);e.onsuccess=function(){b(d.hook.reading.fire(e.result))}}).then(b)},where:function(a){return new na(this,a)},count:function(a){return this.toCollection().count(a)},offset:function(a){return this.toCollection().offset(a)},limit:function(a){return this.toCollection().limit(a)},reverse:function(){return this.toCollection().reverse()},filter:function(a){return this.toCollection().and(a)},
each:function(a){var b=this;return N&&a(b.schema.instanceTemplate),this._idbstore("readonly",function(d,c,v){v=v.openCursor();v.onerror=q(c,["calling","Table.each()","on",b.name]);ra(v,null,a,d,c,b.hook.reading.fire)})},toArray:function(a){var b=this;return this._idbstore("readonly",function(a,d,c){N&&a([b.schema.instanceTemplate]);var p=[];c=c.openCursor();c.onerror=q(d,["calling","Table.toArray()","on",b.name]);ra(c,null,function(a){p.push(a)},function(){a(p)},d,b.hook.reading.fire)}).then(a)},
orderBy:function(a){return new this._collClass(new na(this,a))},toCollection:function(){return new this._collClass(new na(this))},mapToClass:function(a,b){var d,c;return this.schema.mappedClass=a,d=Object.create(a.prototype),b&&e(d,b),this.schema.instanceTemplate=d,c=function(b){var p,d;if(!b)return b;p=Object.create(a.prototype);for(d in b)b.hasOwnProperty(d)&&(p[d]=b[d]);return p},this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=c,this.hook("reading",
c),a},defineClass:function(a){return this.mapToClass(g.defineClass(a),a)},add:a,put:a,"delete":a,clear:a,update:a}});l(ya).from(ga).extend(function(){return{add:function(a,d){var c=this,e=this.hook.creating.fire;return this._idbstore(V,function(k,v,p,Z){var m={},f,S,F;e!==y&&(f=d||(p.keyPath?n(a,p.keyPath):b),S=e.call(m,f,a,Z),f===b&&S!==b&&(p.keyPath?O(a,p.keyPath,S):d=S));F=d?p.add(a,d):p.add(a);F.onerror=q(function(a){if(m.onerror)m.onerror(a);return v(a)},["adding",a,"into",c.name]);F.onsuccess=
function(b){var d=p.keyPath;if(d&&O(a,d,b.target.result),m.onsuccess)m.onsuccess(b.target.result);k(F.result)}})},put:function(a,d){var c=this,e=this.hook.updating.fire;return this.hook.creating.fire!==y||e!==y?this._trans(V,function(k,v,p){var e=d||c.schema.primKey.keyPath&&n(a,c.schema.primKey.keyPath);e===b?p.tables[c.name].add(a).then(k,v):(p._lock(),a=m(a),p.tables[c.name].where(":id").equals(e).modify(function(){this.value=a}).then(function(b){return 0===b?p.tables[c.name].add(a,d):e}).finally(function(){p._unlock()}).then(k,
v))}):this._idbstore(V,function(b,v,p){var e=d?p.put(a,d):p.put(a);e.onerror=q(v,["putting",a,"into",c.name]);e.onsuccess=function(d){var c=p.keyPath;c&&O(a,c,d.target.result);b(e.result)}})},"delete":function(a){return this.hook.deleting.subscribers.length?this.where(":id").equals(a).delete():this._idbstore(V,function(b,d,c){var k=c.delete(a);k.onerror=q(d,["deleting",a,"from",c.name]);k.onsuccess=function(){b(k.result)}})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():
this._idbstore(V,function(a,b,d){var c=d.clear();c.onerror=q(b,["clearing",d.name]);c.onsuccess=function(){a(c.result)}})},update:function(a,c){if("object"!=typeof c||Array.isArray(c))throw new I("db.update(keyOrObject, modifications). modifications must be an object.");if("object"!=typeof a||Array.isArray(a))return this.where(":id").equals(a).modify(c);Object.keys(c).forEach(function(b){O(a,b,c[b])});var e=n(a,this.schema.primKey.keyPath);return e===b&&d.reject(new I("Object does not contain its primary key")),
this.where(":id").equals(e).modify(c)}}});B(H.prototype,{_lock:function(){return++this._reculock,1===this._reculock&&d.PSD&&(d.PSD.lockOwnerFor=this),this},_unlock:function(){if(0==--this._reculock)for(d.PSD&&(d.PSD.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var a=this._blockedFuncs.shift();try{a()}catch(b){}}return this},_locked:function(){return this._reculock&&(!d.PSD||d.PSD.lockOwnerFor!==this)},_nop:function(a){this.tables[this.storeNames[0]].get(0).then(a)},_promise:function(a,
b,c){var e=this;return d.newPSD(function(){var k;return e._locked()?k=new d(function(d,p){e._blockedFuncs.push(function(){e._promise(a,b,c).then(d,p)})}):(k=e.active?new d(function(d,p){if(!e.idbtrans&&a){if(!U)throw qa?new I("Database not open. Following error in populate, ready or upgrade function made Dexie.open() fail: "+qa):new I("Database not open");var k=e.idbtrans=U.transaction(E(e.storeNames),e.mode);k.onerror=function(a){e.on("error").fire(a&&a.target.error);a.preventDefault();e.abort()};
k.onabort=function(a){D(function(){e.on("error").fire(new I("Transaction aborted for unknown reason"))});e.active=!1;e.on("abort").fire(a)};k.oncomplete=function(a){e.active=!1;e.on("complete").fire(a)}}c&&e._lock();try{b(d,p,e)}catch(q){g.ignoreTransaction(function(){e.on("error").fire(q)}),e.abort(),p(q)}}):d.reject(ea(new I("Transaction is inactive. Original Scope Function Source: "+e.scopeFunc.toString()))),e.active&&c&&k.finally(function(){e._unlock()})),k.onuncatched=function(a){g.ignoreTransaction(function(){e.on("error").fire(a)});
e.abort()},k})},complete:function(a){return this.on("complete",a)},error:function(a){return this.on("error",a)},abort:function(){if(this.idbtrans&&this.active)try{this.active=!1,this.idbtrans.abort(),this.on.error.fire(new I("Transaction Aborted"))}catch(a){}},table:function(a){if(!this.tables.hasOwnProperty(a))throw new I("Table "+a+" not in transaction");return this.tables[a]}});B(na.prototype,function(){function a(b,d){try{throw d;}catch(c){b._ctx.error=c}return b}function b(a){return Array.prototype.slice.call(1===
a.length&&Array.isArray(a[0])?a[0]:a)}function d(a){return"next"===a?function(a){return a.toUpperCase()}:function(a){return a.toLowerCase()}}function c(a){return"next"===a?function(a){return a.toLowerCase()}:function(a){return a.toUpperCase()}}function k(a,b,d,c,k,e){for(var v,q=Math.min(a.length,c.length),m=-1,f=0;f<q;++f){if(v=b[f],v!==c[f])return 0>k(a[f],d[f])?a.substr(0,f)+d[f]+d.substr(f+1):0>k(a[f],c[f])?a.substr(0,f)+c[f]+d.substr(f+1):0<=m?a.substr(0,m)+b[m]+d.substr(m+1):null;0>k(a[f],v)&&
(m=f)}return q<c.length&&"next"===e?a+d.substr(a.length):q<a.length&&"prev"===e?a.substr(0,d.length):0>m?null:a.substr(0,m)+c[m]+d.substr(m+1)}function e(a,b,v){function q(a){m=d(a);f=c(a);S="next"===a?aa:Aa;F=m(v);n=f(v);ja=a}var m,f,S,F,n,ja;q("next");a._ondirectionchange=function(a){q(a)};a._addAlgorithm(function(a,d,c){var p=a.key,e,v;return"string"!=typeof p?!1:(e=f(p),b(e,n)?(d(function(){a.continue()}),!0):(v=k(p,e,F,n,S,ja),v?d(function(){a.continue(v)}):d(c),!1))})}return{between:function(a,
b,d,c){return(d=!1!==d,c=!0===c,a>b||!(a!==b||!d&&!c||d&&c))?(new this._ctx.collClass(this,function(){return Y.only(a)})).limit(0):new this._ctx.collClass(this,function(){return Y.bound(a,b,!d,!c)})},equals:function(a){return new this._ctx.collClass(this,function(){return Y.only(a)})},above:function(a){return new this._ctx.collClass(this,function(){return Y.lowerBound(a,!0)})},aboveOrEqual:function(a){return new this._ctx.collClass(this,function(){return Y.lowerBound(a)})},below:function(a){return new this._ctx.collClass(this,
function(){return Y.upperBound(a,!0)})},belowOrEqual:function(a){return new this._ctx.collClass(this,function(){return Y.upperBound(a)})},startsWith:function(b){return"string"!=typeof b?a(new this._ctx.collClass(this),new ta("String expected")):this.between(b,b+String.fromCharCode(65535),!0,!0)},startsWithIgnoreCase:function(b){if("string"!=typeof b)return a(new this._ctx.collClass(this),new ta("String expected"));if(""===b)return this.startsWith(b);var d=new this._ctx.collClass(this,function(){return Y.bound(b.toUpperCase(),
b.toLowerCase()+String.fromCharCode(65535))});return e(d,function(a,b){return 0===a.indexOf(b)},b),d._ondirectionchange=function(){a(d,new I("reverse() not supported with WhereClause.startsWithIgnoreCase()"))},d},equalsIgnoreCase:function(b){if("string"!=typeof b)return a(new this._ctx.collClass(this),new ta("String expected"));var d=new this._ctx.collClass(this,function(){return Y.bound(b.toUpperCase(),b.toLowerCase())});return e(d,function(a,b){return a===b},b),d},anyOf:function(){var a=this._ctx,
d=a.table.schema,c=(a=a.index?d.idxByName[a.index]:d.primKey)&&a.compound,k=b(arguments),e=c?Ba(aa):aa,v,q;return(k.sort(e),0===k.length)?(new this._ctx.collClass(this,function(){return Y.only("")})).limit(0):(v=new this._ctx.collClass(this,function(){return Y.bound(k[0],k[k.length-1])}),v._ondirectionchange=function(a){e="next"===a?aa:Aa;c&&(e=Ba(e));k.sort(e)},q=0,v._addAlgorithm(function(a,b,d){for(var c=a.key;0<e(c,k[q]);)if(++q,q===k.length)return b(d),!1;return 0===e(c,k[q])?(b(function(){a.continue()}),
!0):(b(function(){a.continue(k[q])}),!1)}),v)},notEqual:function(a){return this.below(a).or(this._ctx.index).above(a)},noneOf:function(){var a=this._ctx,d=a.table.schema,d=(d=a.index?d.idxByName[a.index]:d.primKey)&&d.compound,c=b(arguments),k,e,v,q;return 0===c.length?new this._ctx.collClass(this):(k=d?Ba(aa):aa,c.sort(k),e=c.reduce(function(a,b){return a?a.concat([[a[a.length-1][1],b]]):[[null,b]]},null),e.push([c[c.length-1],null]),v=this,q=a.index,e.reduce(function(a,b){return a?null===b[1]?a.or(q).above(b[0]):
a.or(q).between(b[0],b[1],!1,!1):v.below(b[1])},null))},startsWithAnyOf:function(){function d(a){return a>v[m]}function c(a){return a<e[m]}var k=this._ctx,e=b(arguments),v,q,m,f,S;return e.every(function(a){return"string"==typeof a})?0===e.length?(new k.collClass(this,function(){return Y.only("")})).limit(0):(v=e.map(function(a){return a+String.fromCharCode(65535)}),q=aa,e.sort(q),m=0,f=d,S=new k.collClass(this,function(){return Y.bound(e[0],e[e.length-1]+String.fromCharCode(65535))}),S._ondirectionchange=
function(a){"next"===a?(f=d,q=aa):(f=c,q=Aa);e.sort(q);v.sort(q)},S._addAlgorithm(function(a,b,d){for(var c=a.key;f(c);)if(++m,m===e.length)return b(d),!1;return c>=e[m]&&c<=v[m]?(b(function(){a.continue()}),!0):(b(function(){q===aa?a.continue(e[m]):a.continue(v[m])}),!1)}),S):a(new k.collClass(this),new ta("startsWithAnyOf() only works with strings"))}}});B(da.prototype,function(){function a(b,d){b.filter=ha(b.filter,d)}function b(a,d){a.isMatch=ha(a.isMatch,d)}function c(a,b){if(a.isPrimKey)return b;
var d=a.table.schema.idxByName[a.index];if(!d)throw new I("KeyPath "+a.index+" on object store "+b.name+" is not indexed");return a.isPrimKey?b:b.index(d.name)}function e(a,b){return c(a,b)[a.op](a.range||null,a.dir+a.unique)}function k(a,b,d,c,k){a.or?function(){function q(){2==++F&&d()}function m(a,d,e){if(!f||f(d,e,q,c)){var k=d.primaryKey.toString();S.hasOwnProperty(k)||(S[k]=!0,b(a,d,e))}}var f=a.filter,S={},F=0;a.or._iterate(m,q,c,k);ra(e(a,k),a.algorithm,m,q,c,a.table.hook.reading.fire)}():
ra(e(a,k),ha(a.algorithm,a.filter),b,d,c,a.table.hook.reading.fire)}return{_read:function(a,b){var d=this._ctx;return d.error?d.table._trans(null,function(a,b){b(d.error)}):d.table._idbstore("readonly",a).then(b)},_write:function(a){var b=this._ctx;return b.error?b.table._trans(null,function(a,d){d(b.error)}):b.table._idbstore(V,a,"locked")},_addAlgorithm:function(a){var b=this._ctx;b.algorithm=ha(b.algorithm,a)},_iterate:function(a,b,d,c){return k(this._ctx,a,b,d,c)},each:function(a){var b=this._ctx;
return N&&a(b.table.schema.instanceTemplate),this._read(function(d,c,e){k(b,a,d,c,e)})},count:function(a){var b,e,m;return N?d.resolve(0).then(a):(b=this,e=this._ctx,e.filter||e.algorithm||e.or?(m=0,this._read(function(a,b,d){k(e,function(){return++m,!1},function(){a(m)},b,d)},a)):this._read(function(a,d,k){k=c(e,k);k=e.range?k.count(e.range):k.count();k.onerror=q(d,["calling","count()","on",b.name]);k.onsuccess=function(b){a(Math.min(b.target.result,Math.max(0,e.limit-e.offset)))}},a))},sortBy:function(a,
b){function d(a,b){return b?d(a[e[b]],b-1):a[k]}function c(a,b){var e=d(a,q),k=d(b,q);return e<k?-m:e>k?m:0}var e=a.split(".").reverse(),k=e[0],q=e.length-1,m="next"===this._ctx.dir?1:-1;return this.toArray(function(a){return a.sort(c)}).then(b)},toArray:function(a){var b=this._ctx;return this._read(function(a,d,c){N&&a([b.table.schema.instanceTemplate]);var e=[];k(b,function(a){e.push(a)},function(){a(e)},d,c)},a)},offset:function(b){var d=this._ctx;return 0>=b?this:(d.offset+=b,d.or||d.algorithm||
d.filter?a(d,function(){return 0>--b}):a(d,function(a,d){return 0===b?!0:1===b?(--b,!1):(d(function(){a.advance(b);b=0}),!1)}),this)},limit:function(b){return this._ctx.limit=Math.min(this._ctx.limit,b),a(this._ctx,function(a,d,c){return 0>=--b&&d(c),0<=b}),this},until:function(b,d){var c=this._ctx;return N&&b(c.table.schema.instanceTemplate),a(this._ctx,function(a,c,e){return b(a.value)?(c(e),d):!0}),this},first:function(a){return this.limit(1).toArray(function(a){return a[0]}).then(a)},last:function(a){return this.reverse().first(a)},
and:function(d){return N&&d(this._ctx.table.schema.instanceTemplate),a(this._ctx,function(a){return d(a.value)}),b(this._ctx,d),this},or:function(a){return new na(this._ctx.table,a,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(a){var b=this._ctx;return N&&a(n(this._ctx.table.schema.instanceTemplate,this._ctx.index?this._ctx.table.schema.idxByName[this._ctx.index].keyPath:
this._ctx.table.schema.primKey.keyPath)),b.isPrimKey||(b.op="openKeyCursor"),this.each(function(b,d){a(d.key,d)})},eachUniqueKey:function(a){return this._ctx.unique="unique",this.eachKey(a)},keys:function(a){var b=this._ctx,c;return(b.isPrimKey||(b.op="openKeyCursor"),c=[],N)?(new d(this.eachKey.bind(this))).then(function(a){return[a]}).then(a):this.each(function(a,b){c.push(b.key)}).then(function(){return c}).then(a)},uniqueKeys:function(a){return this._ctx.unique="unique",this.keys(a)},firstKey:function(a){return this.limit(1).keys(function(a){return a[0]}).then(a)},
lastKey:function(a){return this.reverse().firstKey(a)},distinct:function(){var b={};return a(this._ctx,function(a){a=a.primaryKey.toString();var d=b.hasOwnProperty(a);return b[a]=!0,!d}),this}}});l(J).from(da).extend({modify:function(a){var b=this,d=this._ctx,c=d.table.hook,e=c.updating.fire,v=c.deleting.fire;return N&&"function"==typeof a&&a.call({value:d.table.schema.instanceTemplate},d.table.schema.instanceTemplate),this._write(function(c,f,S,F){function ja(a){return a&&(N.push(a),A.push(X)),f(new t("Error modifying one or more objects",
N,h,A))}function ea(){w&&h+N.length===D&&(0<N.length?ja():c(h))}var ka,g,r,M;"function"==typeof a?ka=e===y&&v===y?a:function(b){var d=m(b),c,p;if(!1===a.call(this,b))return!1;this.hasOwnProperty("value")?(c=P(d,this.value),p=e.call(this,c,this.primKey,d,F),p&&(b=this.value,Object.keys(p).forEach(function(a){O(b,a,p[a])}))):v.call(this,this.primKey,b,F)}:e===y?(g=Object.keys(a),r=g.length,ka=function(b){for(var d,c,e=!1,k=0;k<r;++k)d=g[k],c=a[d],n(b,d)!==c&&(O(b,d,c),e=!0);return e}):(M=a,a=K(M),ka=
function(b){var d=!1,c=e.call(this,a,this.primKey,m(b),F);return c&&B(a,c),Object.keys(a).forEach(function(c){var e=a[c];n(b,c)!==e&&(O(b,c,e),d=!0)}),c&&(a=K(M)),d});var D=0,h=0,w=!1,N=[],A=[],X=null;b._iterate(function(a,b){var c,e,k;if(X=b.primaryKey,c={primKey:b.primaryKey,value:a},!1!==ka.call(c,a))k=(e=!c.hasOwnProperty("value"))?b.delete():b.update(c.value),++D,k.onerror=q(function(a){if(N.push(a),A.push(c.primKey),c.onerror)c.onerror(a);return ea(),!0},e?["deleting",a,"from",d.table.name]:
["modifying",a,"on",d.table.name]),k.onsuccess=function(){if(c.onsuccess)c.onsuccess(c.value);++h;ea()};else if(c.onsuccess)c.onsuccess(c.value)},function(){w=!0;ea()},ja,S)})},"delete":function(){return this.modify(function(){delete this.value})}});B(this,{Collection:da,Table:ga,Transaction:H,Version:ka,WhereClause:na,WriteableCollection:J,WriteableTable:ya});(function(){G.on("versionchange",function(){G.close();G.on("error").fire(new I("Database version changed by other database connection."))})})();
Ha.forEach(function(a){a(G)})}function y(){}function u(a){return a}function R(a,b){return a===u?b:function(d){return b(a(d))}}function a(a,b){return function(){a.apply(this,arguments);b.apply(this,arguments)}}function f(d,c){return d===y?c:function(){var e=d.apply(this,arguments),q,m,f;return e!==b&&(arguments[0]=e),q=this.onsuccess,m=this.onerror,delete this.onsuccess,delete this.onerror,f=c.apply(this,arguments),q&&(this.onsuccess=this.onsuccess?a(q,this.onsuccess):q),m&&(this.onerror=this.onerror?
a(m,this.onerror):m),f!==b?f:e}}function h(d,c){return d===y?c:function(){var e=d.apply(this,arguments),q,m,f;return e!==b&&B(arguments[0],e),q=this.onsuccess,m=this.onerror,delete this.onsuccess,delete this.onerror,f=c.apply(this,arguments),q&&(this.onsuccess=this.onsuccess?a(q,this.onsuccess):q),m&&(this.onerror=this.onerror?a(m,this.onerror):m),e===b?f===b?b:f:f===b?e:B(e,f)}}function r(a,b){return a===y?b:function(){return!1===a.apply(this,arguments)?!1:b.apply(this,arguments)}}function X(a,b){return a===
y?b:function(){return!1===b.apply(this,arguments)?!1:a.apply(this,arguments)}}function c(a,b){return a===y?b:function(){a.apply(this,arguments);b.apply(this,arguments)}}function Ya(a,b){return a===y?b:function(){var d=a.apply(this,arguments),c,e;return d&&"function"==typeof d.then?(c=this,e=arguments,d.then(function(){return b.apply(c,e)})):b.apply(this,arguments)}}function w(a){function b(a,e,f){if(Array.isArray(a))return c(a);if("object"==typeof a)return d(a);e||(e=r);f||(f=y);var F={subscribers:[],
fire:f,subscribe:function(a){F.subscribers.push(a);F.fire=e(F.fire,a)},unsubscribe:function(a){F.subscribers=F.subscribers.filter(function(b){return b!==a});F.fire=F.subscribers.reduce(e,f)}};return q[a]=m[a]=F,F}function d(a){Object.keys(a).forEach(function(d){var c=a[d],e;if(Array.isArray(c))b(d,a[d][0],a[d][1]);else if("asap"===c)e=b(d,null,function(){var a=arguments;e.subscribers.forEach(function(b){D(function(){b.apply(x,a)})})}),e.subscribe=function(a){-1===e.subscribers.indexOf(a)&&e.subscribers.push(a)},
e.unsubscribe=function(a){a=e.subscribers.indexOf(a);-1!==a&&e.subscribers.splice(a,1)};else throw Error("Invalid event config");})}function c(a){function d(){if(e)return!1;e=!0}var e=!1;a.forEach(function(a){b(a).subscribe(d)})}var e=arguments,q={},m=function(b,d){if(d){var c=[].slice.call(arguments,1),e=q[b];return e.subscribe.apply(e,c),a}if("string"==typeof b)return q[b]},f,F;m.addEventType=b;f=1;for(F=e.length;f<F;++f)b(e[f]);return m}function D(a){x.setImmediate?H(a):setTimeout(a,0)}function A(a){a=
setTimeout(a,1E3);clearTimeout(a)}function Ka(a,b,c){return function(){var e=d.PSD;d.PSD=c;try{a.apply(this,arguments)}catch(q){b(q)}finally{d.PSD=e}}}function n(a,d){var c,e,q,m;if(a.hasOwnProperty(d))return a[d];if(!d)return a;if("string"!=typeof d){c=[];e=0;for(q=d.length;e<q;++e)m=n(a,d[e]),c.push(m);return c}return(c=d.indexOf("."),-1!==c)?(e=a[d.substr(0,c)],e===b?b:n(e,d.substr(c+1))):b}function O(a,d,c){var e,q,m,f;if(a&&d!==b)if("string"!=typeof d&&"length"in d){if(!("string"!=typeof c&&
"length"in c))throw Error("Assertion failed");e=0;for(q=d.length;e<q;++e)O(a,d[e],c[e])}else e=d.indexOf("."),-1!==e?(q=d.substr(0,e),m=d.substr(e+1),""===m?c===b?delete a[q]:a[q]=c:(f=a[q],f||(f=a[q]={}),O(f,m,c))):c===b?delete a[d]:a[d]=c}function K(a){var b={},d;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);return b}function m(a){var b,d,c;if(!a||"object"!=typeof a)return a;if(Array.isArray(a))for(b=[],d=0,c=a.length;d<c;++d)b.push(m(a[d]));else if(a instanceof Date)b=new Date,b.setTime(a.getTime());
else for(d in b=a.constructor?Object.create(a.constructor.prototype):{},a)a.hasOwnProperty(d)&&(b[d]=m(a[d]));return b}function P(a,d){var c={},e;for(e in a)a.hasOwnProperty(e)&&(d.hasOwnProperty(e)?a[e]!==d[e]&&JSON.stringify(a[e])!=JSON.stringify(d[e])&&(c[e]=d[e]):c[e]=b);for(e in d)d.hasOwnProperty(e)&&!a.hasOwnProperty(e)&&(c[e]=d[e]);return c}function M(a){if("function"==typeof a)return new a;if(Array.isArray(a))return[M(a[0])];if(a&&"object"==typeof a){var b={};return e(b,a),b}return a}function e(a,
b){Object.keys(b).forEach(function(d){var c=M(b[d]);a[d]=c})}function q(a,b){return function(d){var c=d&&d.target.error||Error(),e;return b&&(e=" occurred when "+b.map(function(a){switch(typeof a){case "function":return a();case "string":return a;default:return JSON.stringify(a)}}).join(" "),c.name?c.toString=function(){return c.name+e+(c.message?". "+c.message:"")}:c+=e),a(c),d&&(d.stopPropagation&&d.stopPropagation(),d.preventDefault&&d.preventDefault()),!1}}function ea(a){try{throw a;}catch(b){return b}}
function Xa(a){a.preventDefault()}function Oa(a){var b,d=g.dependencies.localStorage;if(!d)return a([]);try{b=JSON.parse(d.getItem("Dexie.DatabaseNames")||"[]")}catch(c){b=[]}a(b)&&d.setItem("Dexie.DatabaseNames",JSON.stringify(b))}function sa(a,b,d,c,e,q,m){this.name=a;this.keyPath=b;this.unique=d;this.multi=c;this.auto=e;this.compound=q;this.dotted=m;a="string"==typeof b?b:b&&"["+[].join.call(b,"+")+"]";this.src=(d?"&":"")+(c?"*":"")+(e?"++":"")+a}function Ca(a,b,d,c){this.name=a;this.primKey=b||
new sa;this.indexes=d||[new sa];this.instanceTemplate=c;this.mappedClass=null;this.idxByName=d.reduce(function(a,b){return a[b.name]=b,a},{})}function t(a,b,d,c){this.name="ModifyError";this.failures=b;this.failedKeys=c;this.successCount=d;this.message=b.join("\n")}function E(a){return 1===a.length?a[0]:a}function L(){var a=g.dependencies.indexedDB,b=a&&(a.getDatabaseNames||a.webkitGetDatabaseNames);return b&&b.bind(a)}var d=function(){function a(b){P.push([b,ea.call(arguments,1)])}function b(){var a=
P,d,c,e;P=[];d=0;for(c=a.length;d<c;++d)e=a[d],e[0].apply(x,e[1])}function d(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._value=this._state=null;this._deferreds=[];this._catched=!1;var b=this,c=!0;this._PSD=d.PSD;try{n(this,a,function(a){c?M(q,b,a):q(b,a)},function(a){return c?(M(m,b,a),!1):m(b,a)})}finally{c=!1}}function c(q,m){var f,F,n,ea,t,D;if(null===q._state)q._deferreds.push(m);else{if(f=
q._state?m.onFulfilled:m.onRejected,null===f)return(q._state?m.resolve:m.reject)(q._value);n=r;r=!1;M=a;try{ea=d.PSD,d.PSD=q._PSD,F=f(q._value),q._state||F&&"function"==typeof F.then&&!1===F._state||e(q),m.resolve(F)}catch(N){if(t=m.reject(N),!t&&q.onuncatched)try{q.onuncatched(N)}catch(w){}}finally{if(d.PSD=ea,n){do{for(;0<P.length;)b();if(D=h.pop(),D)try{D()}catch(N){}}while(0<h.length||0<P.length);M=g;r=!0}}}}function e(a){a._catched=!0;a._parent&&e(a._parent)}function q(a,b){var c=d.PSD;d.PSD=
a._PSD;try{if(b===a)throw new TypeError("A promise cannot be resolved with itself.");!b||"object"!=typeof b&&"function"!=typeof b||"function"!=typeof b.then?(a._state=!0,a._value=b,f.call(a)):n(a,function(a,d){b.then(a,d)},function(b){q(a,b)},function(b){m(a,b)})}catch(e){m(e)}finally{d.PSD=c}}function m(a,b){var c=d.PSD;if(d.PSD=a._PSD,a._state=!1,a._value=b,f.call(a),!a._catched)try{if(a.onuncatched)a.onuncatched(a._value);d.on.error.fire(a._value)}catch(e){}return d.PSD=c,a._catched}function f(){for(var a=
0,b=this._deferreds.length;a<b;a++)c(this,this._deferreds[a]);this._deferreds=[]}function F(a,b,d,c){this.onFulfilled="function"==typeof a?a:null;this.onRejected="function"==typeof b?b:null;this.resolve=d;this.reject=c}function n(a,b,d,c){var e=!1;try{b(function(a){e||(e=!0,d(a))},function(b){return e?a._catched:(e=!0,c(b))})}catch(q){return e?void 0:c(q)}}var ea=[].slice,g="undefined"==typeof H?function(a){var b=arguments;setTimeout(function(){a.apply(x,ea.call(b,1))},0)}:H;A(function(){g=M=a=function(a){var b=
arguments;setTimeout(function(){a.apply(x,ea.call(b,1))},0)}});var M=g,r=!0,P=[],h=[];return d.on=w(null,"error"),d.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&Array.isArray(arguments[0])?arguments[0]:arguments);return new d(function(b,d){function c(q,m){try{if(m&&("object"==typeof m||"function"==typeof m)){var f=m.then;if("function"==typeof f){f.call(m,function(a){c(q,a)},d);return}}a[q]=m;0==--e&&b(a)}catch(F){d(F)}}var e,q;if(0===a.length)return b([]);e=a.length;for(q=
0;q<a.length;q++)c(q,a[q])})},d.prototype.then=function(a,b){var e=this,q=new d(function(d,q){null===e._state?c(e,new F(a,b,d,q)):M(c,e,new F(a,b,d,q))});return q._PSD=this._PSD,q.onuncatched=this.onuncatched,q._parent=this,q},d.prototype._then=function(a,b){c(this,new F(a,b,y,y))},d.prototype["catch"]=function(a){if(1===arguments.length)return this.then(null,a);var b=arguments[0],c=arguments[1];return"function"==typeof b?this.then(null,function(a){return a instanceof b?c(a):d.reject(a)}):this.then(null,
function(a){return a&&a.name===b?c(a):d.reject(a)})},d.prototype["finally"]=function(a){return this.then(function(b){return a(),b},function(b){return a(),d.reject(b)})},d.prototype.onuncatched=null,d.resolve=function(a){var b=new d(function(){});return b._state=!0,b._value=a,b},d.reject=function(a){var b=new d(function(){});return b._state=!1,b._value=a,b},d.race=function(a){return new d(function(b,d){a.map(function(a){a.then(b,d)})})},d.PSD=null,d.newPSD=function(a){var b=d.PSD;d.PSD=b?Object.create(b):
{};try{return a()}finally{d.PSD=b}},d._rootExec=function(d){var c=r,e;r=!1;M=a;try{d()}finally{if(c){do{for(;0<P.length;)b();if(e=h.pop(),e)try{e()}catch(q){}}while(0<h.length||0<P.length);M=g;r=!0}}},d._tickFinalize=function(a){if(r)throw Error("Not in a virtual tick");h.push(a)},d}(),F=function(){},N=!1,wa;l(t).from(Error);g.delete=function(a){var b=new g(a);a=b.delete();return a.onblocked=function(a){b.on("blocked",a);return this},a};g.exists=function(a){return(new g(a)).open().then(function(a){return a.close(),
!0},function(){return!1})};g.getDatabaseNames=function(a){return(new d(function(a,b){var d=L(),c;d?(c=d(),c.onsuccess=function(b){a([].slice.call(b.target.result,0))},c.onerror=q(b)):Oa(function(b){return a(b),!1})})).then(a)};g.defineClass=function(a){return function(b){b?B(this,b):N&&e(this,a)}};g.ignoreTransaction=function(a){return d.newPSD(function(){return d.PSD.trans=null,a()})};g.spawn=function(){return x.console&&console.warn("Dexie.spawn() is deprecated. Use Dexie.ignoreTransaction() instead."),
g.ignoreTransaction.apply(this,arguments)};g.vip=function(a){return d.newPSD(function(){return d.PSD.letThrough=!0,a()})};Object.defineProperty(g,"currentTransaction",{get:function(){return d.PSD&&d.PSD.trans||null}});g.Promise=d;g.derive=l;g.extend=B;g.override=z;g.events=w;g.getByKeyPath=n;g.setByKeyPath=O;g.delByKeyPath=function(a,d){"string"==typeof d?O(a,d,b):"length"in d&&[].map.call(d,function(d){O(a,d,b)})};g.shallowClone=K;g.deepClone=m;g.addons=[];g.fakeAutoComplete=F;g.asap=D;g.ModifyError=
t;g.MultiModifyError=t;g.IndexSpec=sa;g.TableSchema=Ca;wa=x.idbModules&&x.idbModules.shimIndexedDB?x.idbModules:{};g.dependencies={indexedDB:wa.shimIndexedDB||x.indexedDB||x.mozIndexedDB||x.webkitIndexedDB||x.msIndexedDB,IDBKeyRange:wa.IDBKeyRange||x.IDBKeyRange||x.webkitIDBKeyRange,IDBTransaction:wa.IDBTransaction||x.IDBTransaction||x.webkitIDBTransaction,Error:x.Error||String,SyntaxError:x.SyntaxError||String,TypeError:x.TypeError||String,DOMError:x.DOMError||String,localStorage:null!=("undefined"!=
typeof chrome&&null!==chrome?chrome.storage:void 0)?null:x.localStorage};g.version=1.2;C("Dexie",g);A(function(){g.fakeAutoComplete=F=A;g.fake=N=!0})}).apply(null,[self||window,function(x,C){!(L=function(){return C}.call(E,J,E,Q),void 0!==L&&(Q.exports=L))}])}).call(E,J(2).setImmediate)},function(Q,E,J){(function(L,H){function x(b,l){this._id=b;this._clearFn=l}var C=J(3).nextTick,b=Function.prototype.apply,B=Array.prototype.slice,l={},z=0;E.setTimeout=function(){return new x(b.call(setTimeout,window,
arguments),clearTimeout)};E.setInterval=function(){return new x(b.call(setInterval,window,arguments),clearInterval)};E.clearTimeout=E.clearInterval=function(b){b.close()};x.prototype.unref=x.prototype.ref=function(){};x.prototype.close=function(){this._clearFn.call(window,this._id)};E.enroll=function(b,l){clearTimeout(b._idleTimeoutId);b._idleTimeout=l};E.unenroll=function(b){clearTimeout(b._idleTimeoutId);b._idleTimeout=-1};E._unrefActive=E.active=function(b){clearTimeout(b._idleTimeoutId);var l=
b._idleTimeout;0<=l&&(b._idleTimeoutId=setTimeout(function(){b._onTimeout&&b._onTimeout()},l))};E.setImmediate="function"===typeof L?L:function(b){var y=z++,u=2>arguments.length?!1:B.call(arguments,1);l[y]=!0;C(function(){l[y]&&(u?b.apply(null,u):b.call(null),E.clearImmediate(y))});return y};E.clearImmediate="function"===typeof H?H:function(b){delete l[b]}}).call(E,J(2).setImmediate,J(2).clearImmediate)},function(Q,E){function J(){B=!1;l.length?b=l.concat(b):z=-1;b.length&&L()}function L(){if(!B){var g=
setTimeout(J);B=!0;for(var y=b.length;y;){l=b;for(b=[];++z<y;)l&&l[z].run();z=-1;y=b.length}l=null;B=!1;clearTimeout(g)}}function H(b,l){this.fun=b;this.array=l}function x(){}var C=Q.exports={},b=[],B=!1,l,z=-1;C.nextTick=function(g){var l=Array(arguments.length-1);if(1<arguments.length)for(var u=1;u<arguments.length;u++)l[u-1]=arguments[u];b.push(new H(g,l));1!==b.length||B||setTimeout(L,0)};H.prototype.run=function(){this.fun.apply(null,this.array)};C.title="browser";C.browser=!0;C.env={};C.argv=
[];C.version="";C.versions={};C.on=x;C.addListener=x;C.once=x;C.off=x;C.removeListener=x;C.removeAllListeners=x;C.emit=x;C.binding=function(b){throw Error("process.binding is not supported");};C.cwd=function(){return"/"};C.chdir=function(b){throw Error("process.chdir is not supported");};C.umask=function(){return 0}},function(Q,E,J){function L(b){Error.call(this);this.message=b;this.name=L.name;"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,L)}var H,x,C;!function(b){b.hprose=
Object.create(null)}(function(){return this||(0,eval)("this")}());(function(b){var B="WeakMap"in b,l="Map"in b,z=!0;if(l&&(z="forEach"in new b.Map),!(B&&l&&z)){var g=Object.create(null),y=0,u=function(a){var b=Object.create(null),c=a.valueOf;Object.defineProperty(a,"valueOf",{value:function(f,h){return this===a&&h in g&&g[h]===f?(h in b||(b[h]=Object.create(null)),b[h]):c.apply(this,arguments)},writable:!0,configurable:!0,enumerable:!1})};if(B||(b.WeakMap=function X(){var a=Object.create(null),b=
y++;g[b]=a;var f=function(f){if(f!==Object(f))throw Error("value is not a non-null object");var n=f.valueOf(a,b);return n!==f.valueOf()?n:(u(f),f.valueOf(a,b))},h=Object.create(X.prototype,{get:{value:function(a){return f(a).value}},set:{value:function(a,b){f(a).value=b}},has:{value:function(a){return"value"in f(a)}},"delete":{value:function(a){return delete f(a).value}},clear:{value:function(){delete g[b];b=y++;g[b]=a}}});if(0<arguments.length&&Array.isArray(arguments[0]))for(var A=arguments[0],
l=0,n=A.length;n>l;l++)h.set(A[l][0],A[l][1]);return h}),!l){var R=function(){var a=Object.create(null),b=y++,f=Object.create(null);g[b]=a;var h=function(h){if(null===h)return f;var g=h.valueOf(a,b);return g!==h.valueOf()?g:(u(h),h.valueOf(a,b))};return{get:function(a){return h(a).value},set:function(a,b){h(a).value=b},has:function(a){return"value"in h(a)},"delete":function(a){return delete h(a).value},clear:function(){delete g[b];b=y++;g[b]=a}}},a=function(){var a=Object.create(null);return{get:function(){return a.value},
set:function(b,f){a.value=f},has:function(){return"value"in a},"delete":function(){return delete a.value},clear:function(){a=Object.create(null)}}},f=function(){var a=Object.create(null);return{get:function(b){return a[b]},set:function(b,f){a[b]=f},has:function(b){return b in a},"delete":function(b){return delete a[b]},clear:function(){a=Object.create(null)}}};b.Map=function c(){var b={number:f(),string:f(),"boolean":f(),object:R(),"function":R(),unknown:R(),undefined:a(),"null":a()},h=0,g=[],l=Object.create(c.prototype,
{size:{get:function(){return h}},get:{value:function(a){return b[typeof a].get(a)}},set:{value:function(a,c){this.has(a)||(g.push(a),h++);b[typeof a].set(a,c)}},has:{value:function(a){return b[typeof a].has(a)}},"delete":{value:function(a){return this.has(a)?(h--,g.splice(g.indexOf(a),1),b[typeof a]["delete"](a)):!1}},clear:{value:function(){g.length=0;for(var a in b)b[a].clear();h=0}},forEach:{value:function(a,b){for(var c=0,f=g.length;f>c;c++)a.call(b,this.get(g[c]),g[c],this)}}});if(0<arguments.length&&
Array.isArray(arguments[0]))for(var u=arguments[0],n=0,y=u.length;y>n;n++)l.set(u[n][0],u[n][1]);return l}}if(!z){var h=b.Map;b.Map=function c(){var a=new h,b=0,f=[],g=Object.create(c.prototype,{size:{get:function(){return b}},get:{value:function(b){return a.get(b)}},set:{value:function(c,m){a.has(c)||(f.push(c),b++);a.set(c,m)}},has:{value:function(b){return a.has(b)}},"delete":{value:function(c){return a.has(c)?(b--,f.splice(f.indexOf(c),1),a["delete"](c)):!1}},clear:{value:function(){if("clear"in
a)a.clear();else for(var c=0,m=f.length;m>c;c++)a["delete"](f[c]);b=f.length=0}},forEach:{value:function(a,b){for(var c=0,n=f.length;n>c;c++)a.call(b,this.get(f[c]),f[c],this)}}});if(0<arguments.length&&Array.isArray(arguments[0]))for(var l=arguments[0],n=0,u=l.length;u>n;n++)g.set(l[n][0],l[n][1]);return g}}}})(function(){return this||(0,eval)("this")}());L.prototype=Object.create(Error.prototype);L.prototype.constructor=L;(function(b,B){function l(a){var b=f(arguments,1);return function(){a.apply(B,
b)}}function z(a){if(x)b.setTimeout(l(z,a),0);else{var f=c[a];if(f){x=!0;try{f()}finally{y(a),x=!1}}}}function g(a){return c[X]=l.apply(B,a),X++}function y(a){delete c[a]}function u(){if(b.postMessage&&!b.importScripts){var a=!0,c=b.onmessage;return b.onmessage=function(){a=!1},b.postMessage("","*"),b.onmessage=c,a}}var R=b.navigator&&/Trident/.test(b.navigator.userAgent);if(!R&&(b.msSetImmediate||b.setImmediate))return void(b.setImmediate||(b.setImmediate=b.msSetImmediate,b.clearImmediate=b.msClearImmediate));
var a=b.document,f=Function.prototype.call.bind(Array.prototype.slice),h=Function.prototype.call.bind(Object.prototype.toString),r={},X=1,c={},x=!1;r.messageChannel=function(){var a=new b.MessageChannel;return a.port1.onmessage=function(a){z(Number(a.data))},function(){var b=g(arguments);return a.port2.postMessage(b),b}};r.nextTick=function(){return function(){var a=g(arguments);return b.process.nextTick(l(z,a)),a}};r.postMessage=function(){var a="setImmediate$"+Math.random()+"$",c=function(c){c.source===
b&&"string"==typeof c.data&&0===c.data.indexOf(a)&&z(Number(c.data.slice(a.length)))};return b.addEventListener?b.addEventListener("message",c,!1):b.attachEvent("onmessage",c),function(){var c=g(arguments);return b.postMessage(a+c,"*"),c}};r.readyStateChange=function(){var b=a.documentElement;return function(){var c=g(arguments),f=a.createElement("script");return f.onreadystatechange=function(){z(c);f.onreadystatechange=null;b.removeChild(f);f=null},b.appendChild(f),c}};r.setTimeout=function(){return function(){var a=
g(arguments);return b.setTimeout(l(z,a),0),a}};var w=Object.getPrototypeOf&&Object.getPrototypeOf(b),w=w&&w.setTimeout?w:b;R?w.setImmediate=r.setTimeout():"[object process]"===h(b.process)?w.setImmediate=r.nextTick():u()?w.setImmediate=r.postMessage():b.MessageChannel?w.setImmediate=r.messageChannel():a&&"onreadystatechange"in a.createElement("script")?w.setImmediate=r.readyStateChange():w.setImmediate=r.setTimeout();w.msSetImmediate=w.setImmediate;w.clearImmediate=y;w.msClearImmediate=y})(function(){return this||
(0,eval)("this")}());(function(b,B){function l(a){Object.defineProperties(this,{_subscribers:{value:[]},resolve:{value:this.resolve.bind(this)},reject:{value:this.reject.bind(this)}});var b=this;"function"==typeof a&&O(function(){try{b.resolve(a())}catch(c){b.reject(c)}})}function z(a){return a instanceof l}function g(a){return z(a)||n&&a instanceof b.Promise&&typeof("function"===a.then)}function y(a){var b=new l;return b.reject(a),b}function u(a){var b=new l;return b.resolve(a),b}function R(a){var b=
0;return P(a,function(){++b}),b}function a(a){return a=g(a)?a:u(a),a.then(function(a){var b=a.length,c=R(a),e=Array(b);if(0===c)return u(e);var f=new l;return P(a,function(a,b){(g(a)?a:u(a)).then(function(a){e[b]=a;0===--c&&f.resolve(e)},f.reject)}),f})}function f(a){return a=g(a)?a:u(a),a.then(function(a){var b=new l;return P(a,function(a){(g(a)?a:u(a)).then(b.resolve,b.reject)}),b})}function h(b,c,f){return a(b).then(function(a){return a.forEach(c,f)})}function r(b,c,f){return a(b).then(function(a){return a.every(c,
f)})}function X(b,c,f){return a(b).then(function(a){return a.some(c,f)})}function c(b,c,f){return a(b).then(function(a){return a.filter(c,f)})}function x(b,c,f){return a(b).then(function(a){return a.map(c,f)})}function w(b,c,f){return 2<arguments.length?a(b).then(function(a){return g(f)||(f=u(f)),f.then(function(b){return a.reduce(c,b)})}):a(b).then(function(a){return a.reduce(c)})}function D(b,c,f){return 2<arguments.length?a(b).then(function(a){return g(f)||(f=u(f)),f.then(function(b){return a.reduceRight(c,
b)})}):a(b).then(function(a){return a.reduceRight(c)})}function A(a,b,c){O(function(){try{var f=a(c);b.resolve(f)}catch(m){b.reject(m)}})}function C(a,b,c,f,m){function n(m){C(a,b,c,f,m)}function h(a){b?A(b,f,a):f.reject(a)}if(g(m))return m===c?void h(new TypeError("Self resolution")):void m.then(n,h);if(null!==m&&"object"==typeof m||"function"==typeof m){var M;try{M=m.then}catch(r){return void h(r)}if("function"==typeof M){var P=!0;try{return void M.call(m,function(a){P&&(P=!1,n(a))},function(a){P&&
(P=!1,h(a))})}catch(r){P&&(P=!1,h(r))}return}}a?A(a,f,m):f.resolve(m)}var n="Promise"in b,O=b.setImmediate,K=b.setTimeout,m=b.clearTimeout,P=Function.prototype.call.bind(Array.prototype.forEach),M=Function.prototype.call.bind(Array.prototype.slice);Object.defineProperties(l,{delayed:{value:function(a,b){var c="function"==typeof b?b:function(){return b},f=new l;return K(function(){try{f.resolve(c())}catch(a){f.reject(a)}},a),f}},error:{value:y},sync:{value:function(a){try{var b=a();return u(b)}catch(c){return y(c)}}},
value:{value:u},all:{value:a},race:{value:f},resolve:{value:u},reject:{value:y},promise:{value:function(a){var b=new l;return a(b.resolve,b.reject),b}},isFuture:{value:z},isPromise:{value:g},join:{value:function(){return a(arguments)}},any:{value:function(a){return a=g(a)?a:u(a),a.then(function(a){var b=a.length,c=R(a);if(0===c)throw new RangeError("any(): array must not be empty");var e=Array(b),f=new l;return P(a,function(a,b){(g(a)?a:u(a)).then(f.resolve,function(a){e[b]=a;0===--c&&f.reject(e)})}),
f})}},settle:{value:function(a){return a=g(a)?a:u(a),a.then(function(a){var b=a.length,c=R(a),e=Array(b);if(0===c)return u(e);var f=new l;return P(a,function(a,b){var m=g(a)?a:u(a);m.whenComplete(function(){e[b]=m.inspect();0===--c&&f.resolve(e)})}),f})}},attempt:{value:function(b){var c=M(arguments,1);return a(c).then(function(a){return b.apply(B,a)})}},run:{value:function(b,c){var f=M(arguments,2);return a(f).then(function(a){return b.apply(c,a)})}},wrap:{value:function(b,c){return function(){return a(arguments).then(function(a){return b.apply(c,
a)})}}},forEach:{value:h},every:{value:r},some:{value:X},filter:{value:c},map:{value:x},reduce:{value:w},reduceRight:{value:D}});Object.defineProperties(l.prototype,{_value:{writable:!0},_reason:{writable:!0},_state:{value:0,writable:!0},resolve:{value:function(a){if(0===this._state){this._state=1;this._value=a;for(var b=this._subscribers;0<b.length;){var c=b.shift();C(c.onfulfill,c.onreject,this,c.next,a)}}}},reject:{value:function(a){if(0===this._state){this._state=2;this._reason=a;for(var b=this._subscribers;0<
b.length;){var c=b.shift();c.onreject?A(c.onreject,c.next,a):c.next.reject(a)}}}},then:{value:function(a,b){if("function"!=typeof a&&(a=null),"function"!=typeof b&&(b=null),a||b){var c=new l;return 1===this._state?a?C(a,b,this,c,this._value):c.resolve(this._value):2===this._state?b?A(b,c,this._reason):c.reject(this._reason):this._subscribers.push({onfulfill:a,onreject:b,next:c}),c}return this}},inspect:{value:function(){switch(this._state){case 0:return{state:"pending"};case 1:return{state:"fulfilled",
value:this._value};case 2:return{state:"rejected",reason:this._reason}}}},catchError:{value:function(a,b){if("function"==typeof b){var c=this;return this["catch"](function(f){if(b(f))return c["catch"](a);throw f;})}return this["catch"](a)}},"catch":{value:function(a){return this.then(null,a)}},whenComplete:{value:function(a){return this.then(function(b){var c=a();return c===B?b:(c=g(c)?c:u(c),c.then(function(){return b}))},function(b){var c=a();if(c===B)throw b;return c=g(c)?c:u(c),c.then(function(){throw b;
})})}},timeout:{value:function(a,b){var c=new l,f=K(function(){c.reject(b||new L("timeout"))},a);return this.whenComplete(function(){m(f)}).then(c.resolve,c.reject),c}},delay:{value:function(a){var b=new l;return this.then(function(c){K(function(){b.resolve(c)},a)},b.reject),b}},tap:{value:function(a,b){return this.then(function(c){return a.call(b,c),c})}},spread:{value:function(a,b){return this.then(function(c){return a.apply(b,c)})}},get:{value:function(a){return this.then(function(b){return b[a]})}},
set:{value:function(a,b){return this.then(function(c){return c[a]=b,c})}},apply:{value:function(b,c){return c=c||[],this.then(function(f){return a(c).then(function(a){return f[b].apply(f,a)})})}},call:{value:function(b){var c=M(arguments,1);return this.then(function(f){return a(c).then(function(a){return f[b].apply(f,a)})})}},bind:{value:function(b){var c=M(arguments);if(!Array.isArray(b)){c.shift();var f=this;return Object.defineProperty(this,b,{value:function(){var m=M(arguments);return f.then(function(f){return a(c.concat(m)).then(function(a){return f[b].apply(f,
a)})})}}),this}for(var m=0,n=b.length;n>m;++m)c[0]=b[m],this.bind.apply(this,c)}},forEach:{value:function(a,b){return h(this,a,b)}},every:{value:function(a,b){return r(this,a,b)}},some:{value:function(a,b){return X(this,a,b)}},filter:{value:function(a,b){return c(this,a,b)}},map:{value:function(a,b){return x(this,a,b)}},reduce:{value:function(a,b){return 1<arguments.length?w(this,a,b):w(this,a)}},reduceRight:{value:function(a,b){return 1<arguments.length?D(this,a,b):D(this,a)}}});b.hprose.Future=
l;b.hprose.Completer=function(){var a=new l;Object.defineProperties(this,{future:{value:a},complete:{value:a.resolve},completeError:{value:a.reject},isCompleted:{get:function(){return 0!==a._state}}})};b.hprose.resolved=u;b.hprose.rejected=y;b.hprose.deferred=function(){var a=new l;return Object.create(null,{promise:{value:a},resolve:{value:a.resolve},reject:{value:a.reject}})};n||(b.Promise=function(a){l.call(this);a(this.resolve,this.reject)},b.Promise.prototype=Object.create(l.prototype),b.Promise.prototype.constructor=
l,Object.defineProperties(b.Promise,{all:{value:a},race:{value:f},resolve:{value:u},reject:{value:y}}))})(function(){return this||(0,eval)("this")}());(function(b,B){function l(a,b,h){return a[b++]=h>>>24&255,a[b++]=h>>>16&255,a[b++]=h>>>8&255,a[b++]=255&h,b}function z(a,b,h){return a[b++]=255&h,a[b++]=h>>>8&255,a[b++]=h>>>16&255,a[b++]=h>>>24&255,b}function g(a,b){(b===B||null===b||0>b)&&(b=a.length);var h;if(0===b)h=["",0];else{var r;if(1E5>b){r=b;h=new Uint16Array(r);for(var g=0,c=0,l=a.length;r>
g&&l>c;g++){var w=a[c++];switch(w>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:h[g]=w;break;case 12:case 13:if(!(l>c))throw Error("Unfinished UTF-8 octet sequence");h[g]=(31&w)<<6|63&a[c++];break;case 14:if(!(l>c+1))throw Error("Unfinished UTF-8 octet sequence");h[g]=(15&w)<<12|(63&a[c++])<<6|63&a[c++];break;case 15:if(!(l>c+2))throw Error("Unfinished UTF-8 octet sequence");w=((7&w)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;if(!(0<=w&&1048575>=w))throw Error("Character outside valid Unicode range: 0x"+
w.toString(16));h[g++]=w>>10&1023|55296;h[g]=1023&w|56320;break;default:throw Error("Bad UTF-8 encoding 0x"+w.toString(16));}}r=(r>g&&(h=h.subarray(0,g)),[String.fromCharCode.apply(String,h),c])}else{h=b;r=[];g=new Uint16Array(65535);c=w=0;for(l=a.length;h>w&&l>c;w++){var u=a[c++];switch(u>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:g[w]=u;break;case 12:case 13:if(!(l>c))throw Error("Unfinished UTF-8 octet sequence");g[w]=(31&u)<<6|63&a[c++];break;case 14:if(!(l>c+1))throw Error("Unfinished UTF-8 octet sequence");
g[w]=(15&u)<<12|(63&a[c++])<<6|63&a[c++];break;case 15:if(!(l>c+2))throw Error("Unfinished UTF-8 octet sequence");u=((7&u)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;if(!(0<=u&&1048575>=u))throw Error("Character outside valid Unicode range: 0x"+u.toString(16));g[w++]=u>>10&1023|55296;g[w]=1023&u|56320;break;default:throw Error("Bad UTF-8 encoding 0x"+u.toString(16));}65534<=w&&(w+=1,r.push(String.fromCharCode.apply(String,g.subarray(0,w))),h-=w,w=-1)}r=(0<w&&r.push(String.fromCharCode.apply(String,
g.subarray(0,w))),[r.join(""),c])}h=r}return h}function y(){var a=arguments;switch(a.length){case 1:switch(a[0].constructor){case Uint8Array:this._bytes=a[0];this._length=a[0].length;break;case y:this._bytes=a[0].toBytes();this._length=a[0].length;break;case String:this.writeString(a[0]);break;case Number:this._bytes=new Uint8Array(a[0]);break;default:this._bytes=new Uint8Array(a[0]),this._length=this._bytes.length}break;case 2:this._bytes=new Uint8Array(a[0],a[1]);this._length=a[1];break;case 3:this._bytes=
new Uint8Array(a[0],a[1],a[2]),this._length=a[2]}this.mark()}var u=(b.hprose.Future,new Uint8Array(0)),R=Function.prototype.call.bind(Array.prototype.indexOf);Object.defineProperties(y.prototype,{_bytes:{value:null,writable:!0},_length:{value:0,writable:!0},_wmark:{value:0,writable:!0},_off:{value:0,writable:!0},_rmark:{value:0,writable:!0},_grow:{value:function(a){var b=this._bytes,h=this._length+a;a=(--h,h|=h>>1,h|=h>>2,h|=h>>4,h|=h>>8,h|=h>>16,h+1);if(b){if(a*=2,a>b.length)a=new Uint8Array(a),
a.set(b),this._bytes=a}else a=Math.max(a,1024),this._bytes=new Uint8Array(a)}},length:{get:function(){return this._length}},capacity:{get:function(){return this._bytes?this._bytes.length:0}},position:{get:function(){return this._off}},bytes:{get:function(){return null===this._bytes?u:this._bytes.subarray(0,this._length)}},mark:{value:function(){this._wmark=this._length;this._rmark=this._off}},reset:{value:function(){this._length=this._wmark;this._off=this._rmark}},clear:{value:function(){this._bytes=
null;this._rmark=this._off=this._wmark=this._length=0}},writeByte:{value:function(a){this._grow(1);this._bytes[this._length++]=a}},writeInt32BE:{value:function(a){if(a===(0|a)&&2147483647>=a)return this._grow(4),void(this._length=l(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},writeUInt32BE:{value:function(a){if(a===(0|a)&&0<=a)return this._grow(4),void(this._length=l(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},writeInt32LE:{value:function(a){if(a===
(0|a)&&2147483647>=a)return this._grow(4),void(this._length=z(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},writeUInt32LE:{value:function(a){if(a===(0|a)&&0<=a)return this._grow(4),void(this._length=z(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},write:{value:function(a){var b=a.byteLength||a.length;if(0!==b){this._grow(b);var h=this._bytes,g=this._length;switch(a.constructor){case ArrayBuffer:h.set(new Uint8Array(a),g);break;case Uint8Array:h.set(a,
g);break;case y:h.set(a.bytes,g);break;default:for(var l=0;b>l;l++)h[g+l]=a[l]}this._length+=b}}},writeAsciiString:{value:function(a){var b=a.length;if(0!==b){this._grow(b);for(var h=this._bytes,g=this._length,l=0;b>l;++l,++g)h[g]=a.charCodeAt(l);this._length=g}}},writeString:{value:function(a){var b=a.length;if(0!==b){this._grow(3*b);for(var b=this._bytes,h=this._length,g=a.length,l=0;g>l;++l){var c=a.charCodeAt(l);if(128>c)b[h++]=c;else{if(2048>c)b[h++]=192|c>>6;else{if(!(55296>c||57343<c)){if(g>
l+1){var u=a.charCodeAt(l+1);if(56320>c&&56320<=u&&57343>=u){c=((1023&c)<<10|1023&u)+65536;b[h++]=240|c>>18;b[h++]=128|c>>12&63;b[h++]=128|c>>6&63;b[h++]=128|63&c;++l;continue}}throw Error("Malformed string");}b[h++]=224|c>>12;b[h++]=128|c>>6&63}b[h++]=128|63&c}}this._length=h}}},readByte:{value:function(){return this._off<this._length?this._bytes[this._off++]:-1}},readInt32BE:{value:function(){var a=this._bytes,b=this._off;if(b+3<this._length)return a=a[b++]<<24|a[b++]<<16|a[b++]<<8|a[b++],this._off=
b,a;throw Error("EOF");}},readUInt32BE:{value:function(){var a=this.readInt32BE();return 0>a?(2147483647&a)+2147483648:a}},readInt32LE:{value:function(){var a=this._bytes,b=this._off;if(b+3<this._length)return a=a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24,this._off=b,a;throw Error("EOF");}},readUInt32LE:{value:function(){var a=this.readInt32LE();return 0>a?(2147483647&a)+2147483648:a}},read:{value:function(a){return this._off+a>this._length&&(a=this._length-this._off),0===a?u:this._bytes.subarray(this._off,
this._off+=a)}},skip:{value:function(a){return this._off+a>this._length?(a=this._length-this._off,this._off=this._length):this._off+=a,a}},readBytes:{value:function(a){var b;a=R(this._bytes,a,this._off);return-1===a?(b=this._bytes.subarray(this._off,this._length),this._off=this._length):(b=this._bytes.subarray(this._off,a+1),this._off=a+1),b}},readUntil:{value:function(a){a=R(this._bytes,a,this._off);var b="";return a===this._off?this._off++:-1===a?(b=g(this._bytes.subarray(this._off,this._length))[0],
this._off=this._length):(b=g(this._bytes.subarray(this._off,a))[0],this._off=a+1),b}},readAsciiString:{value:function(a){if(this._off+a>this._length&&(a=this._length-this._off),0===a)return"";var b=this._bytes.subarray(this._off,this._off+=a);if(1E5>a)return String.fromCharCode.apply(String,b);for(var h=65535&a,g=a>>16,l=Array(h?g+1:g),c=0;g>c;++c)l[c]=String.fromCharCode.apply(String,b.subarray(c<<16,c+1<<16));return h&&(l[g]=String.fromCharCode.apply(String,b.subarray(g<<16,a))),l.join("")}},readStringAsBytes:{value:function(a){var b;
b=this._bytes.subarray(this._off,this._length);if(a===B&&(a=b.length),0===a)b=u;else{for(var h=0,g=0,l=b.length;a>h&&l>g;h++){var c=b[g++];switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:if(!(l>g))throw Error("Unfinished UTF-8 octet sequence");g++;break;case 14:if(!(l>g+1))throw Error("Unfinished UTF-8 octet sequence");g+=2;break;case 15:if(!(l>g+2))throw Error("Unfinished UTF-8 octet sequence");c=((7&c)<<18|(63&b[g++])<<12|(63&b[g++])<<6|63&b[g++])-65536;
if(!(0<=c&&1048575>=c))throw Error("Character outside valid Unicode range: 0x"+c.toString(16));h++;break;default:throw Error("Bad UTF-8 encoding 0x"+c.toString(16));}}b=[b.subarray(0,g),g]}return this._off+=b[1],b[0]}},readString:{value:function(a){a=g(this._bytes.subarray(this._off,this._length),a);return this._off+=a[1],a[0]}},takeBytes:{value:function(){var a=this.bytes;return this.clear(),a}},toBytes:{value:function(){return new Uint8Array(this.bytes)}},toString:{value:function(){return g(this.bytes,
this._length)[0]}},clone:{value:function(){return new y(this.toBytes())}},trunc:{value:function(){this._bytes=this._bytes.subarray(this._off,this._length);this._length=this._bytes.length;this._rmark=this._wmark=this._off=0}}});Object.defineProperty(y,"toString",{value:function(a){if(0===a.length)return"";switch(a.constructor){case String:return a;case y:a=a.bytes;case ArrayBuffer:a=new Uint8Array(a);case Uint8Array:return g(a,a.length)[0];default:return String.fromCharCode.apply(String,a)}}});b.hprose.BytesIO=
y})(function(){return this||(0,eval)("this")}());(function(b){b.hprose.Tags={TagInteger:105,TagLong:108,TagDouble:100,TagNull:110,TagEmpty:101,TagTrue:116,TagFalse:102,TagNaN:78,TagInfinity:73,TagDate:68,TagTime:84,TagUTC:90,TagBytes:98,TagUTF8Char:117,TagString:115,TagGuid:103,TagList:97,TagMap:109,TagClass:99,TagObject:111,TagRef:114,TagPos:43,TagNeg:45,TagSemicolon:59,TagOpenbrace:123,TagClosebrace:125,TagQuote:34,TagPoint:46,TagFunctions:70,TagCall:67,TagResult:82,TagArgument:65,TagError:69,TagEnd:122}})(function(){return this||
(0,eval)("this")}());(function(b){function B(b,l){g.set(b,l);z[l]=b}var l=b.WeakMap,z=Object.create(null),g=new l;b.hprose.ClassManager=Object.create(null,{register:{value:B},getClassAlias:{value:function(b){return g.get(b)}},getClass:{value:function(b){return z[b]}}});b.hprose.register=B;B(Object,"Object")})(function(){return this||(0,eval)("this")}());(function(b,B){function l(a){var b=a.constructor,c=O.getClassAlias(b);if(c)return c;if(b.name)c=b.name;else{var e=b.toString();if(c=e.substr(0,e.indexOf("(")).replace(/(^\s*function\s*)|(\s*$)/gi,
""),""===c||"Object"===c)return"function"==typeof a.getClassName?a.getClassName():"Object"}return"Object"!==c&&O.register(b,c),c}function z(a){Object.defineProperties(this,{_stream:{value:a},_ref:{value:new A,writable:!0}})}function g(a,b){Object.defineProperties(this,{stream:{value:a},_classref:{value:Object.create(null),writable:!0},_fieldsref:{value:[],writable:!0},_refer:{value:b?K:new z(a)}})}function y(a,b){var f=a.stream;if(b===B||null===b)return void f.writeByte(n.TagNull);switch(b.constructor){case Function:return void f.writeByte(n.TagNull);
case Number:var e=a.stream,f=b.valueOf();f===(0|f)?0<=f&&9>=f?e.writeByte(f+48):(e.writeByte(n.TagInteger),e.writeAsciiString(""+f),e.writeByte(n.TagSemicolon)):isNaN(f)?e.writeByte(n.TagNaN):isFinite(f)?(e.writeByte(n.TagDouble),e.writeAsciiString(""+f),e.writeByte(n.TagSemicolon)):(e.writeByte(n.TagInfinity),e.writeByte(0<f?n.TagPos:n.TagNeg));break;case Boolean:a.stream.writeByte(b.valueOf()?n.TagTrue:n.TagFalse);break;case String:switch(b.length){case 0:return void f.writeByte(n.TagEmpty);case 1:return f.writeByte(n.TagUTF8Char),
void f.writeString(b)}return void a.writeStringWithRef(b);case Date:return void a.writeDateWithRef(b);case A:return void a.writeMapWithRef(b);case ArrayBuffer:case Uint8Array:case E:return void a.writeBytesWithRef(b);case Int8Array:case Int16Array:case Int32Array:case Uint16Array:case Uint32Array:a._refer.write(b)||c(a,b,u);break;case Float32Array:case Float64Array:a._refer.write(b)||c(a,b,R);break;default:Array.isArray(b)?a.writeListWithRef(b):"Object"===l(b)?a.writeMapWithRef(b):a.writeObjectWithRef(b)}}
function u(a,b){var c=a.stream;0<=b&&9>=b?c.writeByte(b+48):(-2147483648>b||2147483647<b?c.writeByte(n.TagLong):c.writeByte(n.TagInteger),c.writeAsciiString(""+b),c.writeByte(n.TagSemicolon))}function R(a,b){var c=a.stream;isNaN(b)?c.writeByte(n.TagNaN):isFinite(b)?(c.writeByte(n.TagDouble),c.writeAsciiString(""+b),c.writeByte(n.TagSemicolon)):(c.writeByte(n.TagInfinity),c.writeByte(0<b?n.TagPos:n.TagNeg))}function a(a,b){a._refer.set(b);var c=a.stream,e=("0000"+b.getUTCFullYear()).slice(-4),f=("00"+
(b.getUTCMonth()+1)).slice(-2),g=("00"+b.getUTCDate()).slice(-2),h=("00"+b.getUTCHours()).slice(-2),l=("00"+b.getUTCMinutes()).slice(-2),r=("00"+b.getUTCSeconds()).slice(-2),u=("000"+b.getUTCMilliseconds()).slice(-3);c.writeByte(n.TagDate);c.writeAsciiString(e+f+g);c.writeByte(n.TagTime);c.writeAsciiString(h+l+r);"000"!==u&&(c.writeByte(n.TagPoint),c.writeAsciiString(u));c.writeByte(n.TagUTC)}function f(a,b){a._refer.set(b);var c=a.stream,e=("0000"+b.getFullYear()).slice(-4),f=("00"+(b.getMonth()+
1)).slice(-2),g=("00"+b.getDate()).slice(-2),h=("00"+b.getHours()).slice(-2),l=("00"+b.getMinutes()).slice(-2),u=("00"+b.getSeconds()).slice(-2),r=("000"+b.getMilliseconds()).slice(-3);"00"===h&&"00"===l&&"00"===u&&"000"===r?(c.writeByte(n.TagDate),c.writeAsciiString(e+f+g)):"1970"===e&&"01"===f&&"01"===g?(c.writeByte(n.TagTime),c.writeAsciiString(h+l+u),"000"!==r&&(c.writeByte(n.TagPoint),c.writeAsciiString(r))):(c.writeByte(n.TagDate),c.writeAsciiString(e+f+g),c.writeByte(n.TagTime),c.writeAsciiString(h+
l+u),"000"!==r&&(c.writeByte(n.TagPoint),c.writeAsciiString(r)));c.writeByte(n.TagSemicolon)}function h(a,b){a._refer.set(b);var c=a.stream,e=("00"+b.getHours()).slice(-2),f=("00"+b.getMinutes()).slice(-2),g=("00"+b.getSeconds()).slice(-2),h=("000"+b.getMilliseconds()).slice(-3);c.writeByte(n.TagTime);c.writeAsciiString(e+f+g);"000"!==h&&(c.writeByte(n.TagPoint),c.writeAsciiString(h));c.writeByte(n.TagSemicolon)}function r(a,b){a._refer.set(b);var c=a.stream;c.writeByte(n.TagBytes);var e=b.byteLength||
b.length;0<e&&c.writeAsciiString(""+e);c.writeByte(n.TagQuote);0<e&&c.write(b);c.writeByte(n.TagQuote)}function x(a,b){a._refer.set(b);var c=a.stream,e=b.length;c.writeByte(n.TagString);0<e&&c.writeAsciiString(""+e);c.writeByte(n.TagQuote);0<e&&c.writeString(b);c.writeByte(n.TagQuote)}function c(a,b,c){a._refer.set(b);var e=a.stream,f=b.length;e.writeByte(n.TagList);0<f&&e.writeAsciiString(""+f);e.writeByte(n.TagOpenbrace);for(var g=0;f>g;g++)c(a,b[g]);e.writeByte(n.TagClosebrace)}function C(a,b){a._refer.set(b);
var c=a.stream,e=[],f;for(f in b)b.hasOwnProperty(f)&&"function"!=typeof b[f]&&(e[e.length]=f);f=e.length;c.writeByte(n.TagMap);0<f&&c.writeAsciiString(""+f);c.writeByte(n.TagOpenbrace);for(var g=0;f>g;g++)y(a,e[g]),y(a,b[e[g]]);c.writeByte(n.TagClosebrace)}function w(a,b){a._refer.set(b);var c=a.stream,e=b.size;c.writeByte(n.TagMap);0<e&&c.writeAsciiString(""+e);c.writeByte(n.TagOpenbrace);b.forEach(function(b,c){y(a,c);y(a,b)});c.writeByte(n.TagClosebrace)}function D(a,b){var c,e,f=a.stream;e=l(b);
if(e in a._classref)e=a._classref[e],c=a._fieldsref[e];else{c=[];for(var g in b)b.hasOwnProperty(g)&&"function"!=typeof b[g]&&(c[c.length]=g.toString());g=c;var h=a.stream,r=g.length;h.writeByte(n.TagClass);h.writeAsciiString(""+e.length);h.writeByte(n.TagQuote);h.writeString(e);h.writeByte(n.TagQuote);0<r&&h.writeAsciiString(""+r);h.writeByte(n.TagOpenbrace);for(var u=0;r>u;u++)x(a,g[u]);h.writeByte(n.TagClosebrace);h=a._fieldsref.length;e=(a._classref[e]=h,a._fieldsref[h]=g,h)}f.writeByte(n.TagObject);
f.writeAsciiString(""+e);f.writeByte(n.TagOpenbrace);a._refer.set(b);e=c.length;for(g=0;e>g;g++)y(a,b[c[g]]);f.writeByte(n.TagClosebrace)}var A=b.Map,E=b.hprose.BytesIO,n=b.hprose.Tags,O=b.hprose.ClassManager,K=Object.create(null,{set:{value:function(){}},write:{value:function(){return!1}},reset:{value:function(){}}});Object.defineProperties(z.prototype,{_refcount:{value:0,writable:!0},set:{value:function(a){this._ref.set(a,this._refcount++)}},write:{value:function(a){a=this._ref.get(a);return a!==
B?(this._stream.writeByte(n.TagRef),this._stream.writeString(""+a),this._stream.writeByte(n.TagSemicolon),!0):!1}},reset:{value:function(){this._ref=new A;this._refcount=0}}});Object.defineProperties(g.prototype,{serialize:{value:function(a){y(this,a)}},writeInteger:{value:function(a){u(this,a)}},writeDouble:{value:function(a){R(this,a)}},writeBoolean:{value:function(a){this.stream.writeByte(a.valueOf()?n.TagTrue:n.TagFalse)}},writeUTCDate:{value:function(b){a(this,b)}},writeUTCDateWithRef:{value:function(b){this._refer.write(b)||
a(this,b)}},writeDate:{value:function(a){f(this,a)}},writeDateWithRef:{value:function(a){this._refer.write(a)||f(this,a)}},writeTime:{value:function(a){h(this,a)}},writeTimeWithRef:{value:function(a){this._refer.write(a)||h(this,a)}},writeBytes:{value:function(a){r(this,a)}},writeBytesWithRef:{value:function(a){this._refer.write(a)||r(this,a)}},writeString:{value:function(a){x(this,a)}},writeStringWithRef:{value:function(a){this._refer.write(a)||x(this,a)}},writeList:{value:function(a){c(this,a,y)}},
writeListWithRef:{value:function(a){this._refer.write(a)||c(this,a,y)}},writeMap:{value:function(a){a instanceof A?w(this,a):C(this,a)}},writeMapWithRef:{value:function(a){this._refer.write(a)||(a instanceof A?w(this,a):C(this,a))}},writeObject:{value:function(a){D(this,a)}},writeObjectWithRef:{value:function(a){this._refer.write(a)||D(this,a)}},reset:{value:function(){this._classref=Object.create(null);this._fieldsref.length=0;this._refer.reset()}}});b.hprose.Writer=g})(function(){return this||(0,eval)("this")}());
(function(b,B){function l(a,b){if(a&&b){var c="";throw c="number"==typeof b?String.fromCharCode(b):String.fromCharCode.apply(String,b),Error('Tag "'+c+'" expected, but "'+String.fromCharCode(a)+'" found in stream');}throw a?Error('Unexpected serialize tag "'+String.fromCharCode(a)+'" in stream'):Error("No byte found in stream");}function z(a,b,c){switch(b.writeByte(c),c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case t.TagNull:case t.TagEmpty:case t.TagTrue:case t.TagFalse:case t.TagNaN:break;
case t.TagInfinity:b.writeByte(a.readByte());break;case t.TagInteger:case t.TagLong:case t.TagDouble:case t.TagRef:do c=a.readByte(),b.writeByte(c);while(c!==t.TagSemicolon);break;case t.TagDate:case t.TagTime:do c=a.readByte(),b.writeByte(c);while(c!==t.TagSemicolon&&c!==t.TagUTC);break;case t.TagUTF8Char:b.writeString(a.readString(1));break;case t.TagBytes:c=0;var e=48;do c*=10,c+=e-48,e=a.readByte(),b.writeByte(e);while(e!==t.TagQuote);b.write(a.read(c+1));break;case t.TagString:c=0;e=48;do c*=
10,c+=e-48,e=a.readByte(),b.writeByte(e);while(e!==t.TagQuote);b.write(a.readStringAsBytes(c+1));break;case t.TagGuid:b.write(a.read(38));break;case t.TagList:case t.TagMap:case t.TagObject:g(a,b);break;case t.TagClass:g(a,b);z(a,b,a.readByte());break;case t.TagError:z(a,b,a.readByte());break;default:l(c)}}function g(a,b){var c;do c=a.readByte(),b.writeByte(c);while(c!==t.TagOpenbrace);for(;(c=a.readByte())!==t.TagClosebrace;)z(a,b,c);b.writeByte(c)}function y(a){Object.defineProperties(this,{stream:{value:a},
readRaw:{value:function(){var b=new Ca;z(a,b,a.readByte());return b.bytes}}})}function u(){Object.defineProperties(this,{ref:{value:[]}})}function R(a){var c=b,e=a.split(".");for(a=0;a<e.length;a++)if(c=c[e[a]],c===B)return null;return c}function a(b,c,e,f){if(e<c.length){b[c[e]]=f;var g=a(b,c,e+1,".");return e+1<c.length&&null===g&&(g=a(b,c,e+1,"_")),g}b=b.join("");try{return g=R(b),"function"==typeof g?g:null}catch(h){return null}}function f(b){var c=Fa.getClass(b);if(c)return c;if(c=R(b),"function"==
typeof c)return Fa.register(c,b),c;for(var e=[],f=b.indexOf("_");0<=f;)e[e.length]=f,f=b.indexOf("_",f+1);return 0<e.length&&(f=b.split(""),c=a(f,e,0,"."),null===c&&(c=a(f,e,0,"_")),"function"==typeof c)?(Fa.register(c,b),c):(c=function(){},Object.defineProperty(c.prototype,"getClassName",{value:function(){return b}}),Fa.register(c,b),c)}function h(a,b){var c=a.readUntil(b);return 0===c.length?0:parseInt(c,10)}function r(a){var b=a.stream,c=b.readByte();switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return c-
48;case t.TagInteger:return h(b,t.TagSemicolon);case t.TagLong:return x(b);case t.TagDouble:return parseFloat(b.readUntil(t.TagSemicolon));case t.TagNull:return null;case t.TagEmpty:return"";case t.TagTrue:return!0;case t.TagFalse:return!1;case t.TagNaN:return NaN;case t.TagInfinity:return b.readByte()===t.TagNeg?-(1/0):1/0;case t.TagDate:return C(a);case t.TagTime:return w(a);case t.TagBytes:return D(a);case t.TagUTF8Char:return a.stream.readString(1);case t.TagString:return n(a);case t.TagGuid:return K(a);
case t.TagList:return m(a);case t.TagMap:return a.useHarmonyMap?M(a):P(a);case t.TagClass:return L(a),q(a);case t.TagObject:return e(a);case t.TagRef:return H(a);case t.TagError:throw Error(O(a));default:l(c)}}function x(a){a=a.readUntil(t.TagSemicolon);var b=parseInt(a,10);return b.toString()===a?b:a}function c(a){var b=a.readByte();switch(b){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return b-48;case t.TagInteger:case t.TagLong:case t.TagDouble:return parseFloat(a.readUntil(t.TagSemicolon));
case t.TagNaN:return NaN;case t.TagInfinity:return a.readByte()===t.TagNeg?-(1/0):1/0;default:l(b)}}function C(a){var b;b=a.stream;var c=parseInt(b.readAsciiString(4),10),e=parseInt(b.readAsciiString(2),10)-1,f=parseInt(b.readAsciiString(2),10),g=b.readByte();if(g===t.TagTime){var h=parseInt(b.readAsciiString(2),10),n=parseInt(b.readAsciiString(2),10),m=parseInt(b.readAsciiString(2),10),l=0,g=b.readByte();g===t.TagPoint&&(l=parseInt(b.readAsciiString(3),10),g=b.readByte(),48<=g&&57>=g&&(b.skip(2),
g=b.readByte(),48<=g&&57>=g&&(b.skip(2),g=b.readByte())));b=g===t.TagUTC?new Date(Date.UTC(c,e,f,h,n,m,l)):new Date(c,e,f,h,n,m,l)}else b=g===t.TagUTC?new Date(Date.UTC(c,e,f)):new Date(c,e,f);return a.refer.set(b),b}function w(a){var b,c=a.stream,e=parseInt(c.readAsciiString(2),10),f=parseInt(c.readAsciiString(2),10),g=parseInt(c.readAsciiString(2),10),h=0,n=c.readByte();return n===t.TagPoint&&(h=parseInt(c.readAsciiString(3),10),n=c.readByte(),48<=n&&57>=n&&(c.skip(2),n=c.readByte(),48<=n&&57>=
n&&(c.skip(2),n=c.readByte()))),b=n===t.TagUTC?new Date(Date.UTC(1970,0,1,e,f,g,h)):new Date(1970,0,1,e,f,g,h),a.refer.set(b),b}function D(a){var b=a.stream,c=h(b,t.TagQuote),c=b.read(c);return b.skip(1),a.refer.set(c),c}function A(a){var b=a.stream.readByte();switch(b){case t.TagNull:return null;case t.TagEmpty:return new Uint8Array(0);case t.TagBytes:return D(a);case t.TagRef:return H(a);default:l(b)}}function E(a){a=a.stream;var b=a.readString(h(a,t.TagQuote));return a.skip(1),b}function n(a){var b=
E(a);return a.refer.set(b),b}function O(a){var b=a.stream.readByte();switch(b){case t.TagNull:return null;case t.TagEmpty:return"";case t.TagUTF8Char:return a.stream.readString(1);case t.TagString:return n(a);case t.TagRef:return H(a);default:l(b)}}function K(a){var b=a.stream;b.skip(1);var c=b.readAsciiString(36);return b.skip(1),a.refer.set(c),c}function m(a){var b=a.stream,c=[];a.refer.set(c);for(var e=h(b,t.TagOpenbrace),f=0;e>f;f++)c[f]=r(a);return b.skip(1),c}function P(a){var b=a.stream,c=
{};a.refer.set(c);for(var e=h(b,t.TagOpenbrace),f=0;e>f;f++){var g=r(a),n=r(a);c[g]=n}return b.skip(1),c}function M(a){var b=a.stream,c=new Q;a.refer.set(c);for(var e=h(b,t.TagOpenbrace),f=0;e>f;f++){var g=r(a),n=r(a);c.set(g,n)}return b.skip(1),c}function e(a){var b=a.stream,c=a.classref[h(b,t.TagOpenbrace)],e=new c.classname;a.refer.set(e);for(var f=0;f<c.count;f++)e[c.fields[f]]=r(a);return b.skip(1),e}function q(a){var b=a.stream.readByte();switch(b){case t.TagNull:return null;case t.TagClass:return L(a),
q(a);case t.TagObject:return e(a);case t.TagRef:return H(a);default:l(b)}}function L(a){for(var b=a.stream,c=E(a),e=h(b,t.TagOpenbrace),g=[],n=0;e>n;n++)g[n]=O(a);b.skip(1);c=f(c);a.classref.push({classname:c,count:e,fields:g})}function H(a){return a.refer.read(h(a.stream,t.TagSemicolon))}function J(a,b,c){y.call(this,a);this.useHarmonyMap=!!c;Object.defineProperties(this,{classref:{value:[]},refer:{value:b?Ga:new u}})}var Q=b.Map,Ca=b.hprose.BytesIO,t=b.hprose.Tags,Fa=b.hprose.ClassManager;b.hprose.RawReader=
y;var Ga=Object.create(null,{set:{value:function(){}},read:{value:function(){l(t.TagRef)}},reset:{value:function(){}}});Object.defineProperties(u.prototype,{set:{value:function(a){this.ref.push(a)}},read:{value:function(a){return this.ref[a]}},reset:{value:function(){this.ref.length=0}}});J.prototype=Object.create(y.prototype);J.prototype.constructor=J;Object.defineProperties(J.prototype,{useHarmonyMap:{value:!1,writable:!0},checkTag:{value:function(a,b){b===B&&(b=this.stream.readByte());b!==a&&l(b,
a)}},checkTags:{value:function(a,b){return b===B&&(b=this.stream.readByte()),0<=a.indexOf(b)?b:void l(b,a)}},unserialize:{value:function(){return r(this)}},readInteger:{value:function(){var a;a:{a=this.stream;var b=a.readByte();switch(b){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:a=b-48;break a;case t.TagInteger:a=h(a,t.TagSemicolon);break a;default:l(b)}a=void 0}return a}},readLong:{value:function(){var a;a:{a=this.stream;var b=a.readByte();switch(b){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:a=
b-48;break a;case t.TagInteger:case t.TagLong:a=x(a);break a;default:l(b)}a=void 0}return a}},readDouble:{value:function(){return c(this.stream)}},readBoolean:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case t.TagTrue:a=!0;break a;case t.TagFalse:a=!1;break a;default:l(a)}a=void 0}return a}},readDateWithoutTag:{value:function(){return C(this)}},readDate:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case t.TagNull:a=null;break a;case t.TagDate:a=C(this);break a;case t.TagRef:a=
H(this);break a;default:l(a)}a=void 0}return a}},readTimeWithoutTag:{value:function(){return w(this)}},readTime:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case t.TagNull:a=null;break a;case t.TagTime:a=w(this);break a;case t.TagRef:a=H(this);break a;default:l(a)}a=void 0}return a}},readBytesWithoutTag:{value:function(){return D(this)}},readBytes:{value:function(){return A(this)}},readStringWithoutTag:{value:function(){return n(this)}},readString:{value:function(){return O(this)}},
readGuidWithoutTag:{value:function(){return K(this)}},readGuid:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case t.TagNull:a=null;break a;case t.TagGuid:a=K(this);break a;case t.TagRef:a=H(this);break a;default:l(a)}a=void 0}return a}},readListWithoutTag:{value:function(){return m(this)}},readList:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case t.TagNull:a=null;break a;case t.TagList:a=m(this);break a;case t.TagRef:a=H(this);break a;default:l(a)}a=void 0}return a}},
readMapWithoutTag:{value:function(){return this.useHarmonyMap?M(this):P(this)}},readMap:{value:function(){var a;if(this.useHarmonyMap)a:{a=this.stream.readByte();switch(a){case t.TagNull:a=null;break a;case t.TagMap:a=M(this);break a;case t.TagRef:a=H(this);break a;default:l(a)}a=void 0}else a:{a=this.stream.readByte();switch(a){case t.TagNull:a=null;break a;case t.TagMap:a=P(this);break a;case t.TagRef:a=H(this);break a;default:l(a)}a=void 0}return a}},readObjectWithoutTag:{value:function(){return e(this)}},
readObject:{value:function(){return q(this)}},reset:{value:function(){this.classref.length=0;this.refer.reset()}}});b.hprose.Reader=J})(function(){return this||(0,eval)("this")}());(function(b){function B(b,l){var a=new z;return(new g(a,l)).serialize(b),a}function l(b,g,a){return b instanceof z||(b=new z(b)),(new y(b,g,a)).unserialize()}var z=b.hprose.BytesIO,g=b.hprose.Writer,y=b.hprose.Reader;b.hprose.Formatter={serialize:function(b,g){return B(b,g).bytes},unserialize:l};b.hprose.serialize=B;b.hprose.unserialize=
l})(function(){return this||(0,eval)("this")}());(function(b){b.hprose.ResultMode={Normal:0,Serialized:1,Raw:2,RawWithEndTag:3};b.hprose.Normal=b.hprose.ResultMode.Normal;b.hprose.Serialized=b.hprose.ResultMode.Serialized;b.hprose.Raw=b.hprose.ResultMode.Raw;b.hprose.RawWithEndTag=b.hprose.ResultMode.RawWithEndTag})(function(){return this||(0,eval)("this")}());(function(b,B){function l(){}function z(g,z,K){function m(a,b){for(var c=0,d=I.length;d>c;c++)a=I[c].outputFilter(a,b);return a}function P(a,
b){return a=m(a,b),V(a,b).then(function(a){if(b.oneway)a=void 0;else for(var c=I.length-1;0<=c;c--)a=I[c].inputFilter(a,b);return a})}function M(a,b){return fa.sendAndReceive(a,b)}function e(a,b,c,d){Da(a,b).then(c,function(e){q(a,b,c,d)||d(e)})}function q(a,c,d,f){if(c.failswitch&&++aa>=za.length&&(aa=0,ra=za[aa]),c.idempotent&&0<=--c.retry){var g=500*(10-c.retry);return 10<c.retry&&(g=500),b.setTimeout(function(){e(a,c,d,f)},g),!0}return!1}function L(b){e(c,{retry:Ea,idempotent:!0,failswitch:!0,
timeout:ha,client:fa,userdata:{}},function(c){var d=null;try{var e=new a(c),f=new h(e,!0);switch(e.readByte()){case u.TagError:d=Error(f.readString());break;case u.TagFunctions:var g=f.readList();f.checkTag(u.TagEnd);sa(b,g);break;default:d=Error("Wrong Response:\r\n"+a.toString(c))}}catch(n){d=n}null!==d?ba.reject(d):ba.resolve(b)},ba.reject)}function J(a,b){return function(){return T?Ga(a,b,C(arguments),!0):r.all(arguments).then(function(c){return Ga(a,b,c,!1)})}}function Q(a,b,c,d,e){if(b[d]===
B&&(b[d]={},(typeof e===w||e.constructor===Object)&&(e=[e]),Array.isArray(e)))for(var f=0;f<e.length;f++){var g=e[f];if(typeof g===w)b[d][g]=J(a,c+d+"_"+g);else for(var h in g)Q(a,b[d],d+"_",h,g[h])}}function sa(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(typeof d===w)a[d]===B&&(a[d]=J(a,d));else for(var e in d)Q(a,a,"",e,d[e])}}function Ca(a,b){for(var c=Math.min(a.length,b.length),d=0;c>d;++d)b[d]=a[d]}function t(b,c,d){var e=new a;e.writeByte(u.TagCall);var g=new f(e,d.simple);return g.writeString(b),
(0<c.length||d.byref)&&(g.reset(),g.writeList(c),d.byref&&g.writeBoolean(!0)),e}function Fa(a,b,c,d){return oa?r.promise(function(e,f){pa.push({batch:d,name:a,args:b,context:c,resolve:e,reject:f})}):d?ja(a,b,c):S(a,b,c)}function Ga(a,b,c,d){var e=Fa;var f=d?{mode:x.Normal,byref:Aa,simple:Ba,onsuccess:B,onerror:B,useHarmonyMap:Y,client:fa,userdata:{}}:{mode:x.Normal,byref:Aa,simple:Ba,timeout:ha,retry:Ea,idempotent:xa,failswitch:Ha,oneway:!1,sync:!1,onsuccess:B,onerror:B,useHarmonyMap:Y,client:fa,
userdata:{}};if(b in a){a=a[b];for(var g in a)g in f&&(f[g]=a[g])}g=0;for(a=c.length;a>g&&typeof c[g]!==A;++g);if(g!==a){var h=c.splice(g,a-g);f.onsuccess=h[0];a=h.length;for(g=1;a>g;++g){var n=h[g];switch(typeof n){case A:f.onerror=n;break;case E:f.byref=n;break;case D:f.mode=n;break;case H:for(var m in n)m in f&&(f[m]=n[m])}}}return e(b,c,f,d)}function d(a,b,c,d){try{c.onerror?c.onerror(a,b):ta(a,b),d(b)}catch(e){d(e)}}function F(b,c,d){var f=d.args,g=d.context,n=t(d.name,f,g);n.writeByte(u.TagEnd);
e(n.bytes,g,function(e){if(g.oneway)return void b();var n=null,m=null;try{if(g.mode===x.RawWithEndTag)n=e;else if(g.mode===x.Raw)n=e.subarray(0,e.byteLength-1);else{var l=new a(e),q=new h(l,!1,g.useHarmonyMap),r=l.readByte();if(r===u.TagResult){if(n=g.mode===x.Serialized?q.readRaw():q.unserialize(),r=l.readByte(),r===u.TagArgument){q.reset();var t=q.readList();Ca(t,f);r=l.readByte()}}else r===u.TagError&&(m=Error(q.readString()),r=l.readByte());r!==u.TagEnd&&(m=Error("Wrong Response:\r\n"+a.toString(e)))}if(m)throw m;
}catch(w){m=w}m?c(m,d):b(n,d)},c)}function N(a,c,d){return 0<c.length&&c[c.length-1]&&"function"==typeof c[c.length-1].handler?r.promise(function(b,e){var f=c[c.length-1],g={name:a,args:c.slice(0,c.length-1),udata:f,invoke:F,context:d},n;for(n in f)"handler"!=n&&f.hasOwnProperty(n)&&(g[n]=f[n]);f.handler(g,b,e)}):"function"==typeof b.hprose.userdefInvoke?r.promise(function(e,f){b.hprose.userdefInvoke({name:a,args:c,udata:null,invoke:F,context:d},e,f)}):r.promise(function(b,e){F(b,e,{name:a,args:c,
context:d})})}function wa(a){return function(){a&&(oa=!1,y(function(a){a.forEach(function(a){"settings"in a?Ua(a.settings).then(a.resolve,a.reject):Fa(a.name,a.args,a.context,a.batch).then(a.resolve,a.reject)})},pa),pa=[])}}function S(a,b,c){c.sync&&(oa=!0);var e=r.promise(function(e,f){ua(a,b,c).then(function(d){try{if(c.onsuccess)try{c.onsuccess(d,b)}catch(g){c.onerror&&c.onerror(a,g),f(g)}e(d)}catch(g){f(g)}},function(b){d(a,b,c,f)})});return e.whenComplete(wa(c.sync)),e}function ja(a,b,c){return r.promise(function(d,
e){ca.push({args:b,name:a,context:c,resolve:d,reject:e})})}function ka(a){var b={timeout:ha,retry:Ea,idempotent:xa,failswitch:Ha,oneway:!1,sync:!1,client:fa,userdata:{}},c;for(c in a)c in b&&(b[c]=a[c]);return b}function Pa(b,c){var d=b.reduce(function(a,b){return a.write(t(b.name,b.args,b.context)),a},new a);return d.writeByte(u.TagEnd),r.promise(function(f,g){e(d.bytes,c,function(d){if(c.oneway)return void f(b);var e=-1,n=new a(d),p=new h(n,!1),m=n.readByte();try{for(;m!==u.TagEnd;){var l=null,
q=null,r=b[++e].context.mode;if(r>=x.Raw&&(l=new a),m===u.TagResult){if(r===x.Serialized?l=p.readRaw():r>=x.Raw?(l.writeByte(u.TagResult),l.write(p.readRaw())):(p.useHarmonyMap=b[e].context.useHarmonyMap,p.reset(),l=p.unserialize()),m=n.readByte(),m===u.TagArgument){if(r>=x.Raw)l.writeByte(u.TagArgument),l.write(p.readRaw());else{p.reset();var t=p.readList();Ca(t,b[e].args)}m=n.readByte()}}else m===u.TagError&&(r>=x.Raw?(l.writeByte(u.TagError),l.write(p.readRaw())):(p.reset(),q=Error(p.readString())),
m=n.readByte());if(0>[u.TagEnd,u.TagResult,u.TagError].indexOf(m))return void g(Error("Wrong Response:\r\n"+a.toString(d)));r>=x.Raw?(r===x.RawWithEndTag&&l.writeByte(u.TagEnd),b[e].result=l.bytes):b[e].result=l;b[e].error=q}}catch(w){return void g(w)}f(b)},g)})}function Ua(a){if(a=a||{},T=!1,oa)return r.promise(function(b,c){pa.push({batch:!0,settings:a,resolve:b,reject:c})});if(0!==ca.length){var b=ka(a);b.sync&&(oa=!0);var c=ca;ca=[];var e=r.promise(function(a,e){qa(c,b).then(function(b){b.forEach(function(a){if(a.error)d(a.name,
a.error,a.context,a.reject);else try{if(a.context.onsuccess)try{a.context.onsuccess(a.result,a.args)}catch(b){a.context.onerror&&a.context.onerror(a.name,b),a.reject(b)}a.resolve(a.result)}catch(b){a.reject(b)}delete a.context;delete a.resolve;delete a.reject});a(b)},function(a){c.forEach(function(b){"reject"in b&&d(b.name,a,b.context,b.reject)});e(a)})});return e.whenComplete(wa(b.sync)),e}}function Ta(){return ta}function Va(a){typeof a===A&&(ta=a)}function La(a){a&&"function"==typeof a.inputFilter&&
"function"==typeof a.outputFilter&&I.push(a)}function Ma(a,b,c){c===B&&(typeof b===E&&(c=b,b=!1),b||(typeof a===E?(c=a,a=!1):(a&&a.constructor===Object||Array.isArray(a))&&(b=a,a=!1)));var d=fa;return c&&(d={}),a||ra?(a&&(ra=a),(typeof b===w||b&&b.constructor===Object)&&(b=[b]),Array.isArray(b)?(sa(d,b),ba.resolve(d),d):(y(L,d),ba)):Error("You should set server uri first!")}function ga(a,b,c){return W[a]?(a=W[a],a[b]?a[b]:null):(c&&(W[a]=Object.create(null)),null)}function ya(a,b,c,d){if(typeof a!==
w)throw new TypeError("topic name must be a string.");if(b===B||null===b){if(typeof c!==A)throw new TypeError("callback must be a function.");b=c}if(typeof b===A)return d=c,c=b,null===ma&&(ma=da()),void ma.then(function(b){ya(a,b,c,d)});if(typeof c!==A)throw new TypeError("callback must be a function.");if(r.isPromise(b))return void b.then(function(b){ya(a,b,c,d)});d===B&&(d=ha);var e=ga(a,b,!0);if(null===e){var f=function(){Ga(fa,a,[b,e.handler,f,{idempotent:!0,failswitch:!1,timeout:d}],!1)},e={handler:function(c){var d=
ga(a,b,!1);if(d){if(null!==c)for(var d=d.callbacks,e=0,g=d.length;g>e;++e)try{d[e](c)}catch(n){}null!==ga(a,b,!1)&&f()}},callbacks:[c]};W[a][b]=e;f()}else 0>e.callbacks.indexOf(c)&&e.callbacks.push(c)}function Wa(a,b,c){if(a)if(typeof c===A){var d=a[b];d&&(d=d.callbacks,c=d.indexOf(c),0<=c&&(d[c]=d[d.length-1],d.length--),0===d.length&&delete a[b])}else delete a[b]}function na(a,b,c){if(typeof a!==w)throw new TypeError("topic name must be a string.");if(b===B||null===b){if(typeof c!==A)return void delete W[a];
b=c}if(typeof b===A&&(c=b,b=null),null===b)if(null===ma){if(W[a]){var d=W[a];for(b in d)Wa(d,b,c)}}else ma.then(function(b){na(a,b,c)});else r.isPromise(b)?b.then(function(b){na(a,b,c)}):Wa(W[a],b,c)}function da(){return Ga(fa,"#",[],!1)}function Za(a){G.push(a);ua=G.reduceRight(function(a,b){return function(c,d,e){try{var f=b(c,d,e,a);return r.isFuture(f)?f:r.value(f)}catch(g){return r.error(g)}}},N)}function $a(a){ia.push(a);qa=ia.reduceRight(function(a,b){return function(c,d){try{var e=b(c,d,a);
return r.isFuture(e)?e:r.value(e)}catch(f){return r.error(f)}}},Pa)}function Ia(a){va.push(a);Da=va.reduceRight(function(a,b){return function(c,d){try{var e=b(c,d,a);return r.isFuture(e)?e:r.value(e)}catch(f){return r.error(f)}}},P)}function Na(a){Ja.push(a);V=Ja.reduceRight(function(a,b){return function(c,d){try{var e=b(c,d,a);return r.isFuture(e)?e:r.value(e)}catch(f){return r.error(f)}}},M)}var ra,za=[],aa=-1,Aa=!1,Ba=!1,ha=3E4,Ea=10,xa=!1,Ha=!1,oa=!1,pa=[],Y=!1,ta=l,I=[],T=!1,ca=[],ba=new r,W=
Object.create(null),ma=null,U=!0,ua=N,qa=Pa,Da=P,V=M,G=[],ia=[],va=[],Ja=[],fa=this;da.sync=!0;da.idempotent=!0;da.failswitch=!0;var Qa=Object.create(null,{begin:{value:function(){T=!0}},end:{value:Ua},use:{value:function(a){return $a(a),Qa}}}),Ra=Object.create(null,{use:{value:function(a){return Ia(a),Ra}}}),Sa=Object.create(null,{use:{value:function(a){return Na(a),Sa}}});Object.defineProperties(this,{"#":{value:da},onError:{get:Ta,set:Va},onerror:{get:Ta,set:Va},uri:{get:function(){return ra}},
id:{get:function(){return ma}},failswitch:{get:function(){return Ha},set:function(a){Ha=!!a}},timeout:{get:function(){return ha},set:function(a){ha="number"==typeof a?0|a:0}},retry:{get:function(){return Ea},set:function(a){Ea="number"==typeof a?0|a:0}},idempotent:{get:function(){return xa},set:function(a){xa=!!a}},keepAlive:{get:function(){return U},set:function(a){U=!!a}},byref:{get:function(){return Aa},set:function(a){Aa=!!a}},simple:{get:function(){return Ba},set:function(a){Ba=!!a}},useHarmonyMap:{get:function(){return Y},
set:function(a){Y=!!a}},filter:{get:function(){return 0===I.length?null:1===I.length?I[0]:I.slice()},set:function(a){I.length=0;Array.isArray(a)?a.forEach(function(a){La(a)}):La(a)}},addFilter:{value:La},removeFilter:{value:function(a){a=I.indexOf(a);return-1===a?!1:(I.splice(a,1),!0)}},useService:{value:Ma},invoke:{value:function(a,b,c){var d=arguments.length;if(1>d||typeof a!==w)throw Error("name must be a string");if(1===d&&(b=[]),2===d&&!Array.isArray(b)){var e=[];typeof b!==A&&e.push(l);e.push(b);
b=e}if(2<d)for(typeof c!==A&&b.push(l),e=2;d>e;e++)b.push(arguments[e]);return Ga(fa,a,b,T)}},ready:{value:function(a,b){return ba.then(a,b)}},subscribe:{value:ya},unsubscribe:{value:na},use:{value:function(a){return Za(a),fa}},batch:{value:Qa},beforeFilter:{value:Ra},afterFilter:{value:Sa}});K&&typeof K===H&&"failswitch timeout retry idempotent keepAlive byref simple useHarmonyMap filter".split(" ").forEach(function(a){a in K&&(fa[a]=K[a])});typeof g===w?(za=[g],aa=0,Ma(g,z)):Array.isArray(g)&&(za=
g,aa=Math.floor(Math.random()*za.length),Ma(za[aa],z))}function g(a){var b=document.createElement("a");if(b.href=a,"http:"!==b.protocol&&"https:"!==b.protocol&&"ws:"!==b.protocol&&"wss:"!==b.protocol)throw Error("The "+b.protocol+" client isn't implemented.");}var y=b.setImmediate,u=b.hprose.Tags,x=b.hprose.ResultMode,a=b.hprose.BytesIO,f=b.hprose.Writer,h=b.hprose.Reader,r=b.hprose.Future,C=Function.prototype.call.bind(Array.prototype.slice),c=new Uint8Array(1);c[0]=u.TagEnd;var E="boolean",w="string",
D="number",A="function",H="object";Object.defineProperty(z,"create",{value:function(a,c,f){try{return b.hprose.HttpClient.create(a,c,f)}catch(h){}try{return b.hprose.WebSocketClient.create(a,c,f)}catch(h){}if("string"==typeof a)g(a);else if(Array.isArray(a))throw a.forEach(function(a){g(a)}),Error("Not support multiple protocol.");throw Error("You should set server uri first!");}});b.hprose.Client=z})(function(){return this||(0,eval)("this")}());(function(b,x){function l(){}function z(g,a,f){function h(a,
f){var g=new XMLHttpRequest;g.open("POST",D.uri,!0);b.location!==x&&"file:"!==b.location.protocol&&(g.withCredentials="true");g.responseType="arraybuffer";for(var h in c)g.setRequestHeader(h,c[h]);return g.onload=function(){g.onload=l;g.status&&(200===g.status?f.resolve(new Uint8Array(g.response)):f.reject(Error(g.status+":"+g.statusText)))},g.onerror=function(){f.reject(Error("error"))},g.upload!==x&&(g.upload.onprogress=E),g.onprogress=w,a.constructor===String||ArrayBuffer.isView?g.send(a):a.buffer.slice?
g.send(a.buffer.slice(0,a.length)):g.send(a.buffer),g}function r(a){"function"==typeof a&&(E=a)}function C(){return E}if(this.constructor!==z)return new z(g,a,f);y.call(this,g,a,f);var c=Object.create(null),E=l,w=l,D=this;Object.defineProperties(this,{onProgress:{get:C,set:r},onprogress:{get:C,set:r},onRequestProgress:{get:C,set:r},onResponseProgress:{get:function(){return w},set:function(a){"function"==typeof a&&(w=a)}},setHeader:{value:function(a,b){"content-type"!==a.toLowerCase()&&"content-length"!==
a.toLowerCase()&&(b?c[a]=b:delete c[a])}},sendAndReceive:{value:function(a,b){var c=new u,f=h(a,c);return 0<b.timeout&&(c=c.timeout(b.timeout).catchError(function(a){throw f.onload=l,f.onerror=l,f.abort(),a;},function(a){return a instanceof L})),b.oneway&&c.resolve(),c}}})}function g(b){var a=document.createElement("a");if(a.href=b,"http:"!==a.protocol&&"https:"!==a.protocol)throw Error("This client desn't support "+a.protocol+" scheme.");}var y=b.hprose.Client,u=b.hprose.Future;Object.defineProperty(z,
"create",{value:function(b,a,f){if("string"==typeof b)g(b);else{if(!Array.isArray(b))return Error("You should set server uri first!");b.forEach(function(a){g(a)})}return new z(b,a,f)}});b.hprose.HttpClient=z})(function(){return this||(0,eval)("this")}());(function(b,x){function l(){}function z(a,b,g){function r(a,b){var c=new u;c.writeInt32BE(a);b.constructor===String?c.writeString(b):c.write(b);c=c.bytes;ArrayBuffer.isView?K.send(c):c.buffer.slice?K.send(c.buffer.slice(0,c.length)):K.send(c.buffer)}
function E(a){O.resolve(a)}function c(a){a=new u(a.data);var b=a.readInt32BE(),c=J[b];if(delete J[b],c!==x&&(--A,c.resolve(a.read(a.length-4))),100>A&&0<n.length){++A;var f=n.shift();O.then(function(){r(f[0],f[1])})}0===A&&(m.keepAlive||w())}function H(a){J.forEach(function(b,c){b.reject(Error(a.code+":"+a.reason));delete J[c]});A=0;K=null}function w(){null!==K&&(K.onopen=l,K.onmessage=l,K.onclose=l,K.close())}if(this.constructor!==z)return new z(a,b,g);y.call(this,a,b,g);var D=0,A=0,J=[],n=[],O=
null,K=null,m=this;Object.defineProperties(this,{sendAndReceive:{value:function(a,b){if(null===K||K.readyState===WebSocket.CLOSING||K.readyState===WebSocket.CLOSED)O=new C,K=new WebSocket(m.uri),K.binaryType="arraybuffer",K.onopen=E,K.onmessage=c,K.onerror=l,K.onclose=H;var e=2147483647>D?++D:D=0,f=new C;return J[e]=f,0<m.timeout&&(f=f.timeout(m.timeout).catchError(function(a){throw delete J[e],--A,a;},function(a){return a instanceof L})),100>A?(++A,O.then(function(){r(e,a)})):n.push([e,a]),b.oneway&&
f.resolve(),f}},close:{value:w}})}function g(a){var b=document.createElement("a");if(b.href=a,"ws:"!==b.protocol&&"wss:"!==b.protocol)throw Error("This client desn't support "+b.protocol+" scheme.");}var y=b.hprose.Client,u=b.hprose.BytesIO,C=b.hprose.Future;Object.defineProperty(z,"create",{value:function(a,b,h){if("string"==typeof a)g(a);else{if(!Array.isArray(a))return Error("You should set server uri first!");a.forEach(function(a){g(a)})}return new z(a,b,h)}});b.hprose.WebSocketClient=z})(function(){return this||
(0,eval)("this")}());(function(b){function x(b){this.version=b||"2.0"}var l=b.hprose.Tags,z=b.hprose.BytesIO,g=b.hprose.Writer,y=b.hprose.Reader,u=1;x.prototype.inputFilter=function(b,a){var f=z.toString(b);"{"===f.charAt(0)&&(f="["+f+"]");for(var f=JSON.parse(f),h=new z,r=new g(h,!0),u=0,c=f.length;c>u;++u){var x=f[u];x.error?(h.writeByte(l.TagError),r.writeString(x.error.message)):(h.writeByte(l.TagResult),r.serialize(x.result))}return h.writeByte(l.TagEnd),h.bytes};x.prototype.outputFilter=function(b,
a){var f=[],g=new z(b),r=new y(g,!1,!1),x=g.readByte();do{var c={};x===l.TagCall&&(c.method=r.readString(),x=g.readByte(),x===l.TagList&&(c.params=r.readListWithoutTag(),x=g.readByte()),x===l.TagTrue&&(x=g.readByte()));"1.1"===this.version?c.version="1.1":"2.0"===this.version&&(c.jsonrpc="2.0");c.id=u++;f.push(c)}while(x===l.TagCall);return 1<f.length?JSON.stringify(f):JSON.stringify(f[0])};b.hprose.JSONRPCClientFilter=x})(function(){return this||(0,eval)("this")}());(function(b){b.hprose.common=
{Completer:b.hprose.Completer,Future:b.hprose.Future,ResultMode:b.hprose.ResultMode};b.hprose.io={BytesIO:b.hprose.BytesIO,ClassManager:b.hprose.ClassManager,Tags:b.hprose.Tags,RawReader:b.hprose.RawReader,Reader:b.hprose.Reader,Writer:b.hprose.Writer,Formatter:b.hprose.Formatter};b.hprose.client={Client:b.hprose.Client,HttpClient:b.hprose.HttpClient,WebSocketClient:b.hprose.WebSocketClient};b.hprose.filter={JSONRPCClientFilter:b.hprose.JSONRPCClientFilter};J(5).cmd?!(x=[],H=b.hprose,C="function"===
typeof H?H.apply(E,x):H,void 0!==C&&(Q.exports=C)):J(6)&&!(x=[],C=function(){return b.hprose}.apply(E,x),void 0!==C&&(Q.exports=C));"object"==typeof Q&&"object"==typeof Q.exports&&(Q.exports=b.hprose)})(function(){return this||(0,eval)("this")}())},function(Q,E){Q.exports=function(){throw Error("define cannot be used indirect");}},function(Q,E){(function(E){Q.exports=E}).call(E,{})}]);
