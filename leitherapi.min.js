(function(P){function E(L){if(J[L])return J[L].exports;var H=J[L]={exports:{},id:L,loaded:!1};P[L].call(H.exports,H,H.exports,E);H.loaded=!0;return H.exports}var J={};E.m=P;E.c=J;E.p="";return E(0)})([function(P,E,J){function L(){function a(c,b,x){c.invoke(function(a,c){var n=q.some(function(a){return-1!==c.name.indexOf(a)});debug.log("do cache? : ",n,c.name,c.args);if(!n||c.nocache||null===a)return b(a);n=null;"string"==typeof a&&"{"==a[0]?n={__is:"string",value:JSON.parse(a)}:"object"==typeof a&&
null!=a?n=Array.isArray(a)?{__is:"array",value:a}:{__is:"object",value:a}:null===a&&(n={__is:"null",value:"__null__"});var e=1<c.args.length?c.args.slice(1).join(""):null;n&&e&&(n.__id=e,n.__score=0,n.__ts=Date.now(),C.db[C.table].put(n).then(function(a){},function(a){debug.warn("save to db error: ",a)}));c.skipResolve?"function"==typeof c.asyncCall&&c.asyncCall(a):b(a)},x,c)}function b(c,x,g){var f=null;q.some(function(a){return-1!==c.name.indexOf(a)})&&(f=1<c.args.length?c.args.slice(1).join(""):
null);f?C.db[C.table].get(f).then(function(b){if(b){var q=null;if("string"==b.__is)q=JSON.stringify(b.value);else{if("null"==b.__is)return a(c,x,g);q=b.value}c.background||"undefined"==typeof c.background&&C.background?(debug.log("fetching from icache.db with background enabled: ",f,q,c.name,c.args),x(q),c.skipResolve=!0,a(c,x,g)):("undefined"==typeof c.ttl?"undefined"==typeof b.__ttl&&(b.__ttl=C.DEFAULT_TTL):b.__ttl=c.ttl,b.__ttl<Date.now()-b.__ts?(debug.log("ttl timeout, reload from server: ",f,
c.name,c),a(c,x,g)):(debug.log("fetching from icache.db: ",f,q,c.name,c.args),x(q)))}else a(c,x,g)},function(b){debug.log("not in icache.db, fetching from server");a(c,x,g)}):a(c,x,g)}var q=["get"],C={};window.icache=C;C.db=new l(c.AppName);var g={};C.table="icache";g[C.table]="__id,__score,__ts";try{C.db.version(2).stores(g),C.db.open()}catch(n){debug.warn("can't use indexedDB: ",n);return}C.DEFAULT_TTL=72E5;C.handler=b;window.hprose.userdefInvoke=b;C.tools={};C.tools.makeurl=function(a,b,x,f){return"http://"+
a+"/loadres?type=text/html&AppName="+b+"&AppBid="+x+"&ip="+a+"&bid="+c.SystemBid+"&name=AppTemplate&ver=last&userid="+f}}function H(a){var c=2;if("boolean"===typeof a)a||(c=X.length);else if("number"===typeof a)c=a;else if("string"===typeof a)try{c=parseInt(a)}catch(b){c=2}a=function(){};for(var q=c;q<X.length;q++)window.debug[X[q]]=window.console[X[q]].bind(window.console);for(q=0;q<c;q++)window.debug[X[q]]=a}function w(a){var b=c.ayFE[a];return b?(debug.log("PE: seted"),b):function(b){debug.log("PE:default mark");
if(c.ayFE[a])return c.ayFE[a](b);c.ayErr[a]=b;debug.error(a+":"+b)}}function D(){return null!=c.api}function b(a){debug.log("setMain: ",a);if(c.Running)debug.warn("setMain: app running");else if("function"==typeof InitErrFunc&&InitErrFunc(),"undefined"!=typeof main)if(debug.log("main function ok run it"),c.Main=main,debug.log("isok",D),D()){c.Running=!0;debug.log("s1");for(var b=0;b<c.InitFunc.length;b++)c.InitFunc[b]();debug.log("s2",L);L();debug.log("s3");main();debug.log("called main()")}else for(b in debug.log("Leither is not OK"),
c.ayErr)a=c.ayFE[b],err=c.ayErr[b],null!=err&&null!=a&&(c.ayErr[b]=null,debug.log("errReply err:",err),a(err))}function B(a,c){var b=localStorage[a];if(b)return JSON.parse(b);"undefined"!=typeof c&&(localStorage[a]=JSON.stringify(c));return c}function m(){debug.log("InitDb");var a=new hprose.Future,b=b||2,q=window.indexedDB.open("LeitherApi",b);c.ApptbName=c.appBid+"_"+c.AppName;debug.log(c.ApptbName);q.onerror=function(c){debug.error(c.currentTarget.error.message);a.reject(c)};q.onsuccess=function(b){debug.log("InitDb ok");
b=b.target.result;c.LeitherDb=b;a.resolve(b)};q.onupgradeneeded=function(a){a=a.target.result;a.objectStoreNames.contains("res")||a.createObjectStore("res",{keyPath:"id"});a.objectStoreNames.contains(c.ApptbName)&&a.deleteObjectStore(c.ApptbName);debug.log("DB version changed to "+b)};return a}function A(a){var b=c.LeitherDb.transaction("res","readwrite").objectStore("res"),q=new hprose.Future;debug.log("getdbdata ");request=b.get(a);request.onerror=function(a){q.reject(a)};request.onsuccess=function(a){q.resolve(a.target.result);
debug.log("getdbdata2 ",a.target.result)};return q}function h(a){var b=c.LeitherDb.transaction("res","readwrite").objectStore("res"),q=new hprose.Future;request=b.put(a);request.onerror=function(a){debug.log("setdbdata err",a);q.reject(a)};request.onsuccess=function(a){q.resolve(a.target.result);debug.log("setdbdata: ",a.target.result)};return q}function z(c,b,q){var g=new hprose.Future,h=JSON.parse(q),n=function(a,b){var f="last";if("last"==b||"release"==b)f=a[b];debug.log("loading resfiles for app: ",
c,", version:",f,h);return a.ResFile[f]}(h,b);(function(b){for(var q=[];b<n.length;b++){var f=n[b];debug.log("load resfile with key:",f);""==f?debug.error("invliad key:",f):q.push(a(c,f))}hprose.Future.all(q).then(function(a){debug.log("all promise",a);g.resolve()},function(a){debug.log(a);g.reject(a)})})(0);return g}function y(a){c.loginData=a;c.sid=a.sid;c.user=a.user;c.username=c.user.name;c.bid=null!==a.user?a.user.id:c.uid;c.leClient=c.api;c.swarm=a.swarm}function R(a){0<a.length?c.currentIP=
a:a=c.currentIP;c.api=u(a);m().then(function(a){debug.log("hprose ready",a);c.api.ready(function(a){debug.log("hprose ready ok");debug.log("G.uid=",c.uid);g(a,c.AppName,c.AppBid,c.AppVer).then(function(){var g=w("login");c.postLogin=y;"undefined"!==typeof ENABLE_UAC&&ENABLE_UAC?b("UAC enabled, must redirect to the login page first"):a.login(c.uid,c.userppt).then(function(a){debug.log("login ok");y(a);c.swarm=a.swarm;debug.log("LeitherIsOK:",D());debug.log("login ok sid=",a.sid);debug.log("user= ",
a.user);debug.log("swarm=",a.swarm);debug.log("appName=",c.AppName);b("after loaded app and logedin")},g);c.Local||(debug.log("use remote files"),a.getresbyname(c.sid,c.SystemBid,"LeitherApi",c.AppVer,{handler:icache.handler,ttl:0}).then(function(a){var b=new FileReader;b.onload=function(a){debug.log("leitherApi re get ok");localStorage.leitherApi=a.target.result};b.readAsText(new Blob([a]))}),a.hget(c.sid,c.AppBid,"applist",c.AppName,{handler:icache.handler,ttl:0}).then(function(a){debug.log("manifest re hget ok");
h({id:c.AppName,data:a,tbname:c.ApptbName}).then()}))})},w("api.ready"))},w("InitDb"))}function a(a,b){var q=new hprose.Future;debug.log("load js ",b);var g=document.createElement("script");g.type="text/javascript";A(b).then(function(l){if(l)g.textContent=l.data,document.getElementsByTagName("head")[0].appendChild(g),q.resolve(b);else if(debug.log("check leither"),"function"==typeof D&&D()){debug.log("check leither ok");var n=function(a){debug.error(a);q.reject(b)};c.api.ready(function(l){debug.log(" G.api.ready");
l.get("",a,b,function(n){debug.log("get ok: (appBid, key)  ",a,b);if(n){debug.log(" if (data)");var f=new FileReader;f.onload=function(a){debug.log(" SetDbData");h({id:b,data:a.target.result,tbname:c.ApptbName});g.textContent=a.target.result;document.getElementsByTagName("head")[0].appendChild(g);q.resolve(b)};f.readAsText(new Blob([n]))}else debug.error("data is null"),q.reject(b)},n)},n)}else debug.error("leither is not ok"),q.reject(b)},function(a){debug.error(a);q.reject(a)});return q}function g(a,
b,g,l){debug.log("load app name:",b,", appBid:",g);var u=new hprose.Future;if(c.Local)return debug.log("use local file"),u.resolve(),u;A(b).then(function(c){c?(debug.log("get app manifest from db successed: ",b),z(g,l,c.data).then(function(){u.resolve()},function(a){debug.warn("LoadApp: ",a);u.reject(a)})):(debug.log("app :",b," resfiles not found in DB, fetching ... "),a.hget("",g,"applist",b).then(function(a){h({id:b,data:a,tbname:g+"_"+b});z(g,l,a).then(function(a){u.resolve()},function(a){debug.warn("LoadApp 2: ",
a);u.reject(a)})}))},function(a){debug.error(a)});return u}var l=J(1);J(4);"use strict";var u=function(a){if("http://"==a.substr(0,7)){a=a.substr(7);var b=a.indexOf("/");0<b&&(a=a.substr(0,b))}b="ws://"+a+"/ws/";-1!=navigator.userAgent.indexOf("Firefox")&&(b="http://"+a+"/webapi/");return hprose.Client.create(b,"login register getvar act setdata set get del expire hmclear hset hget hdel hlen hkeys hgetall hmset hmget exit restart lpush lpop rpush rpop lrange zadd zrange sadd scard sclear sdiff sinter smclear smembers srem sunion sendmsg readmsg pullmsg invite accept test veni sethostip proxyget createinvcode getinvcodeinfo updateinvcode deleteinvcode setinvtemplate getinvtemplate getappdownloadkey getresbyname getgshorturlkey getlshorturlkey incr zcard zcount zrem zscore zrank zrangebyscore lindex lexpire lexpireat lttl lpersist llen sendmail lset".split(" "))},
X=["log","info","warn","error"];window.debug={};window.setLog=H;var c={ayFE:{},ayErr:{},IPList:[],InitFunc:[]};window.G=c;window.LeitherIsOK=D;window.RunApp=function(a,b){if(0!=arguments.length){"undefined"===typeof a.Log?H(!1):H(a.Log);c.I=a;c.appBid=a.AppBid;c.Running=!1;c.AppVer=a.AppVer?a.AppVer:"last";debug.log("RunApp");var g;if(g=0==b)debug.log("InitCfg"),c.Local=a.Local,c.SystemBid=a.SystemBid,c.AppBid=a.AppBid,c.IPList=a.IPList&&a.IPList.length&&0<a.IPList.length?a.IPList:B(c.AppBid+"/iplist"),
c.userppt=a.userppt||B(window.location.pathname+"/"+c.AppBid+"/ppt"),c.AppName=a.AppName||B(c.AppBid+"/appname"),c.uid=a.userid||B(window.location.pathname+"/"+c.AppBid+"/uid"),g=!1;g||(c.IPList.length<=b?console.error("iplist.length [",c.IPList.length,"]<ipnum[",b,"]"):R(c.IPList[b]))}};window.RunApp()},function(P,E,J){var L;(function(H){(function(w,D,b){function B(a,d){return"object"!=typeof d&&(d=d()),Object.keys(d).forEach(function(b){a[b]=d[b]}),a}function m(a){return{from:function(d){return a.prototype=
Object.create(d.prototype),a.prototype.constructor=a,{extend:function(b){B(a.prototype,"object"!=typeof b?b(d.prototype):b)}}}}}function A(a,d){return d(a)}function h(a,Da){function pa(a){this._cfg={version:a,storesSource:null,dbschema:{},tables:{},contentUpgrade:null};this.stores({})}function M(a,c,e,f){var k,t,p,Y,aa;if(0===a)Object.keys(T).forEach(function(a){C(c,a,T[a].primKey,T[a].indexes)}),k=F._createTransaction(V,ca,T),k.idbtrans=c,k.idbtrans.onerror=v(e,["populating database"]),k.on("error").subscribe(e),
d.newPSD(function(){d.PSD.trans=k;try{F.on("populate").fire(k)}catch(a){f.onerror=c.onerror=function(a){a.preventDefault()};try{c.abort()}catch(p){}c.db.close();e(a)}});else{if(t=[],p=da.filter(function(p){return p._cfg.version===a})[0],!p)throw new I("Dexie specification of currently installed DB version is missing");T=F._dbSchema=p._cfg.dbschema;Y=!1;p=da.filter(function(p){return p._cfg.version>a});p.forEach(function(a){var p=T,k=a._cfg.dbschema;wa(p,c);wa(k,c);T=F._dbSchema=k;p=u(p,k);p.add.forEach(function(a){t.push(function(p,
k){C(p,a[0],a[1].primKey,a[1].indexes);k()})});p.change.forEach(function(a){if(a.recreate)throw new I("Not yet support for changing primary key");t.push(function(p,k){var t=p.objectStore(a.name);a.add.forEach(function(a){w(t,a)});a.change.forEach(function(a){t.deleteIndex(a.name);w(t,a)});a.del.forEach(function(a){t.deleteIndex(a)});k()})});a._cfg.contentUpgrade&&t.push(function(p,t){var d,b;Y=!0;d=F._createTransaction(V,[].slice.call(p.db.objectStoreNames,0),k);d.idbtrans=p;b=0;d._promise=A(d._promise,
function(a){return function(p,k,d){function Y(a){return function(){a.apply(this,arguments);0==--b&&t()}}return++b,a.call(this,p,function(a,p){arguments[0]=Y(a);arguments[1]=Y(p);k.apply(this,arguments)},d)}});p.onerror=v(e,["running upgrader function for version",a._cfg.version]);d.on("error").subscribe(e);a._cfg.contentUpgrade(d);0===b&&t()});Y&&(0<=navigator.userAgent.indexOf("Trident")||0<=navigator.userAgent.indexOf("MSIE"))||t.push(function(a,p){for(var t,d=0;d<a.db.objectStoreNames.length;++d)t=
a.db.objectStoreNames[d],null!==k[t]&&k[t]!==b||a.db.deleteObjectStore(t);p()})});aa=function(){try{t.length?t.shift()(c,aa):va(T,c)}catch(a){f.onerror=c.onerror=function(a){a.preventDefault()};try{c.abort()}catch(p){}c.db.close();e(a)}};aa()}}function u(a,d){var b={del:[],add:[],change:[]},c,k,t,p,Y,e,v,f;for(c in a)d[c]||b.del.push(c);for(c in d)if(k=a[c],t=d[c],k)if(p={name:c,def:d[c],recreate:!1,del:[],add:[],change:[]},k.primKey.src!==t.primKey.src)p.recreate=!0,b.change.push(p);else{Y=k.indexes.reduce(function(a,
p){return a[p.name]=p,a},{});t=t.indexes.reduce(function(a,p){return a[p.name]=p,a},{});for(e in Y)t[e]||p.del.push(e);for(e in t)v=Y[e],f=t[e],v?v.src!==f.src&&p.change.push(f):p.add.push(f);(p.recreate||0<p.del.length||0<p.add.length||0<p.change.length)&&b.change.push(p)}else b.add.push([c,t]);return b}function C(a,d,b,c){var k=a.db.createObjectStore(d,b.keyPath?{keyPath:b.keyPath,autoIncrement:b.auto}:{autoIncrement:b.auto});return c.forEach(function(a){w(k,a)}),k}function va(a,d){Object.keys(a).forEach(function(b){d.db.objectStoreNames.contains(b)||
C(d,b,a[b].primKey,a[b].indexes)})}function w(a,d){a.createIndex(d.name,d.keyPath,{unique:d.unique,multiEntry:d.multi})}function D(a,d){throw new I("Table "+d[0]+" not part of transaction. Original Scope Function Source: "+h.Promise.PSD.trans.scopeFunc.toString());}function ga(a,d,b,e){this.name=a;this.schema=b;this.hook=W[a]?W[a].hook:x(null,{creating:[g,z],reading:[R,y],updating:[l,z],deleting:[c,z]});this._tpf=d;this._collClass=e||ea}function xa(a,d,b,c){ga.call(this,a,d,b,c||J)}function H(a,d,
b,c){function k(a,p,k,d){return t._promise(a,k,d)}var t=this,p,Y;this.db=F;this.mode=a;this.storeNames=d;this.idbtrans=null;this.on=x(this,["complete","error"],"abort");this._reculock=0;this._blockedFuncs=[];this._psd=null;this.active=!0;this._dbschema=b;c&&(this.parent=c);this._tpf=k;this.tables=Object.create(ka);for(c=d.length-1;-1!==c;--c)p=d[c],Y=F._tableFactory(a,b[p],k),this.tables[p]=Y,this[p]||(this[p]=Y)}function la(a,d,b){this._ctx={table:a,index:":id"===d?null:d,collClass:a._collClass,
or:b}}function ea(a,d){var b=null,c=null,k;if(d)try{b=d()}catch(t){c=t}k=a._ctx;this._ctx={table:k.table,index:k.index,isPrimKey:!k.index||k.table.schema.primKey.keyPath&&k.index===k.table.schema.primKey.name,range:b,op:"openCursor",dir:"next",unique:"",algorithm:null,filter:null,isMatch:null,offset:0,limit:Infinity,error:c,or:k.or}}function J(){ea.apply(this,arguments)}function P(a,d){return a._cfg.version-d._cfg.version}function Ia(a,b,c,e,k,t){c.forEach(function(p){var c=F._tableFactory(e,k[p],
b);a.forEach(function(a){a[p]||(t?Object.defineProperty(a,p,{configurable:!0,enumerable:!0,get:function(){var a=d.PSD&&d.PSD.trans;return a&&a.db===F?a.tables[p]:c}}):a[p]=c)})})}function Na(a){a.forEach(function(a){for(var d in a)a[d]instanceof ga&&delete a[d]})}function qa(a,b,c,e,k,t){var p=d.PSD;t=t||y;a.onerror||(a.onerror=v(k));a.onsuccess=b?Ka(function(){var p=a.result,d;p?(d=function(){p.continue()},b(p,function(a){d=a},e,k)&&c(t(p.value),p,function(a){d=a}),d()):e()},k,p):Ka(function(){var p=
a.result,k;p?(k=function(){p.continue()},c(t(p.value),p,function(a){k=a}),k()):e()},k,p)}function ya(a){var d=[];return a.split(",").forEach(function(a){a=a.trim();var b=a.replace("&","").replace("++","").replace("*",""),k=0!==b.indexOf("[")?b:a.substring(a.indexOf("[")+1,a.indexOf("]")).split("+");d.push(new ra(b,k||null,-1!==a.indexOf("&"),-1!==a.indexOf("*"),-1!==a.indexOf("++"),Array.isArray(k),-1!==k.indexOf(".")))}),d}function ba(a,d){return a<d?-1:a>d?1:0}function za(a,d){return a<d?1:a>d?
-1:0}function Aa(a){return function(d,b){for(var c=0,k;;){if(k=a(d[c],b[c]),0!==k)return k;if(++c,c===d.length||c===b.length)return a(d.length,b.length)}}}function ha(a,d){return a?d?function(){return a.apply(this,arguments)&&d.apply(this,arguments)}:a:d}function Ea(){if(F.verno=U.version/10,F._dbSchema=T={},ca=[].slice.call(U.objectStoreNames,0),0!==ca.length){var a=U.transaction(E(ca),"readonly");ca.forEach(function(d){for(var b,c=a.objectStore(d),k=c.keyPath,t=k&&"string"==typeof k&&-1!==k.indexOf("."),
p=new ra(k,k||"",!1,!1,!!c.autoIncrement,k&&"string"!=typeof k,t),e=[],aa=0;aa<c.indexNames.length;++aa)b=c.index(c.indexNames[aa]),t=(k=b.keyPath)&&"string"==typeof k&&-1!==k.indexOf("."),b=new ra(b.name,k,!!b.unique,!!b.multiEntry,!1,k&&"string"!=typeof k,t),e.push(b);T[d]=new Ba(d,p,e,{})});Ia([W],F._transPromiseFactory,Object.keys(T),V,T)}}function wa(a,d){for(var b,c,k,t,p=d.db.objectStoreNames,e=0;e<p.length;++e)for(b=p[e],c=d.objectStore(b),k=0;k<c.indexNames.length;++k){var aa=c.indexNames[k],
f=c.index(aa).keyPath,f="string"==typeof f?f:"["+[].slice.call(f).join("+")+"]";a[b]&&(t=a[b].idxByName[f],t&&(t.name=aa))}}var Ha=Da&&Da.addons||h.addons,ma=h.dependencies,na=ma.indexedDB,Z=ma.IDBKeyRange,sa=ma.TypeError,I=ma.Error,T=this._dbSchema={},da=[],ca=[],W={},ka={},U=null,ta=!0,oa=null,Ca=!1,V="readwrite",F=this,ia=[],ua=!0,Ja=!!L();this.version=function(a){if(U)throw new I("Cannot add version when database is open");this.verno=Math.max(this.verno,a);var d=da.filter(function(d){return d._cfg.version===
a})[0];return d?d:(d=new pa(a),da.push(d),da.sort(P),d)};B(pa.prototype,{stores:function(a){var d,b;return this._cfg.storesSource=this._cfg.storesSource?B(this._cfg.storesSource,a):a,d={},da.forEach(function(a){B(d,a._cfg.storesSource)}),b=this._cfg.dbschema={},this._parseStoresSpec(d,b),T=F._dbSchema=b,Na([W,F,ka]),Ia([ka],D,Object.keys(b),V,b),Ia([W,F,this._cfg.tables],F._transPromiseFactory,Object.keys(b),V,b,!0),ca=Object.keys(b),this},upgrade:function(a){var d=this;return G(function(){a(F._createTransaction(V,
Object.keys(d._cfg.dbschema),d._cfg.dbschema))}),this._cfg.contentUpgrade=a,this},_parseStoresSpec:function(a,d){Object.keys(a).forEach(function(b){if(null!==a[b]){var c={},k=ya(a[b]),t=k.shift();if(t.multi)throw new I("Primary key cannot be multi-valued");t.keyPath&&N(c,t.keyPath,t.auto?0:t.keyPath);k.forEach(function(a){if(a.auto)throw new I("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new I("Index must have a name and cannot be an empty string");N(c,a.keyPath,a.compound?
a.keyPath.map(function(){return""}):"")});d[b]=new Ba(b,t,k,c)}})}});this._allTables=W;this._tableFactory=function(a,d,b){return"readonly"===a?new ga(d.name,b,d,ea):new xa(d.name,b,d)};this._createTransaction=function(a,d,b,c){return new H(a,d,b,c)};this._transPromiseFactory=function(a,b,c){var e,k;return!ta||d.PSD&&d.PSD.letThrough?(k=F._createTransaction(a,b,T),k._promise(a,function(a,p){k.error(function(a){F.on("error").fire(a)});c(function(p){k.complete(function(){a(p)})},p,k)})):e=new d(function(d,
p){ia.push({resume:function(){var k=F._transPromiseFactory(a,b,c);e.onuncatched=k.onuncatched;k.then(d,p)}})})};this._whenReady=function(a){return O||!ta||d.PSD&&d.PSD.letThrough?new d(a):new d(function(d,b){ia.push({resume:function(){a(d,b)}})})};this.verno=0;this.open=function(){return new d(function(b,c){function e(a){try{f.transaction.abort()}catch(d){}Ca=!1;oa=a;ta=!1;c(oa);ia.forEach(function(a){a.resume()});ia=[]}if(O&&b(F),U||Ca)throw new I("Database already opened or being opened");var f;
try{if(oa=null,Ca=!0,0<da.length&&(ua=!1),!na)throw new I("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");if(f=ua?na.open(a):na.open(a,Math.round(10*F.verno)),!f)throw new I("IndexedDB API not available");f.onerror=v(e,["opening database",a]);f.onblocked=function(a){F.on("blocked").fire(a)};f.onupgradeneeded=Ka(function(d){var b,p;ua&&!F._allowEmptyDB?(f.onerror=function(a){a.preventDefault()},
f.transaction.abort(),f.result.close(),b=na.deleteDatabase(a),b.onsuccess=b.onerror=function(){e(new I("Database '"+a+"' doesnt exist"))}):(f.transaction.onerror=v(e),p=d.oldVersion>Math.pow(2,62)?0:d.oldVersion,M(p/10,f.transaction,e,f))},e);f.onsuccess=Ka(function(){Ca=!1;U=f.result;ua?Ea():0<U.objectStoreNames.length&&wa(T,U.transaction(E(U.objectStoreNames),"readonly"));U.onversionchange=F.on("versionchange").fire;Ja||Oa(function(d){if(-1===d.indexOf(a))return d.push(a)});d.newPSD(function(){function a(){ta=
!1;ia.forEach(function(a){a.resume()});ia=[];b(F)}d.PSD.letThrough=!0;try{var t=F.on.ready.fire();t&&"function"==typeof t.then?t.then(a,function(a){U.close();U=null;e(a)}):q(a)}catch(p){e(p)}})},e)}catch(k){e(k)}})};this.close=function(){U&&(U.close(),U=null,ta=!0,oa=null)};this.delete=function(){var b=arguments;return new d(function(d,c){function e(){F.close();var b=na.deleteDatabase(a);b.onsuccess=function(){Ja||Oa(function(d){var p=d.indexOf(a);if(0<=p)return d.splice(p,1)});d()};b.onerror=v(c,
["deleting",a]);b.onblocked=function(){F.on("blocked").fire()}}if(0<b.length)throw new I("Arguments not allowed in db.delete()");Ca?ia.push({resume:e}):e()})};this.backendDB=function(){return U};this.isOpen=function(){return null!==U};this.hasFailed=function(){return null!==oa};this.dynamicallyOpened=function(){return ua};this.name=a;Object.defineProperty(this,"tables",{get:function(){return Object.keys(W).map(function(a){return W[a]})}});this.on=x(this,"error","populate","blocked",{ready:[Ya,z],
versionchange:[X,z]});this.on.ready.subscribe=A(this.on.ready.subscribe,function(a){return function(d,b){function c(){return b||F.on.ready.unsubscribe(c),d.apply(this,arguments)}a.call(this,c);F.isOpen()&&(ta?ia.push({resume:c}):c())}});G(function(){F.on("populate").fire(F._createTransaction(V,ca,T));F.on("error").fire(new I)});this.transaction=function(a,b,c){function e(b,t){var f=null,v,S,g;try{if(p)throw p;f=F._createTransaction(a,Y,T,k);v=Y.map(function(a){return f.tables[a]});v.push(f);g=0;d.newPSD(function(){d.PSD.trans=
f;f.scopeFunc=c;k&&(f.idbtrans=k.idbtrans,f._promise=A(f._promise,function(a){return function(p,b,k){function t(a){return function(p){var b;return d._rootExec(function(){b=a(p);d._tickFinalize(function(){0==--g&&f.active&&(f.active=!1,f.on.complete.fire())})}),b}}return++g,a.call(this,p,function(a,p,d){return b(t(a),t(p),d)},k)}}));f.complete(function(){b(S)});f.error(function(a){f.idbtrans&&(f.idbtrans.onerror=Xa);try{f.abort()}catch(p){}k&&(k.active=!1,k.on.error.fire(a));var d=t(a);k||d||F.on.error.fire(a)});
d._rootExec(function(){S=c.apply(f,v)})});(!f.idbtrans||k&&0===g)&&f._nop()}catch(n){f&&f.idbtrans&&(f.idbtrans.onerror=Xa),f&&f.abort(),k&&k.on.error.fire(n),q(function(){t(n)||F.on("error").fire(n)})}}var k,t;b=[].slice.call(arguments,1,arguments.length-1);c=arguments[arguments.length-1];(k=d.PSD&&d.PSD.trans)&&k.db===F&&-1===a.indexOf("!")||(k=null);t=-1!==a.indexOf("?");a=a.replace("!","").replace("?","");var p=null,Y=(Array.isArray(b[0])?b.reduce(function(a,p){return a.concat(p)}):b).map(function(a){return"string"==
typeof a?a:(a instanceof ga||(p=p||new sa("Invalid type. Arguments following mode must be instances of Table or String")),a.name)});return"r"==a||"readonly"==a?a="readonly":"rw"==a||a==V?a=V:p=new I("Invalid transaction mode: "+a),k&&(p||(k&&"readonly"===k.mode&&a===V&&(t?k=null:p=p||new I("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")),k&&Y.forEach(function(a){k.tables.hasOwnProperty(a)||(t?k=null:p=p||new I("Table "+a+" not included in parent transaction. Parent Transaction function: "+
k.scopeFunc.toString()))}))),k?k._promise(a,e,"lock"):F._whenReady(e)};this.table=function(a){if(O&&ua)return new xa(a);if(!W.hasOwnProperty(a))throw new I("Table does not exist");return W[a]};B(ga.prototype,function(){function a(){throw new I("Current Transaction is READONLY");}return{_trans:function(a,d,b){return this._tpf(a,[this.name],d,b)},_idbstore:function(a,b,c){if(O)return new d(b);var k=this;return this._tpf(a,[this.name],function(a,d,c){b(a,d,c.idbtrans.objectStore(k.name),c)},c)},get:function(a,
d){var b=this;return this._idbstore("readonly",function(d,t,p){O&&d(b.schema.instanceTemplate);var c=p.get(a);c.onerror=v(t,["getting",a,"from",b.name]);c.onsuccess=function(){d(b.hook.reading.fire(c.result))}}).then(d)},where:function(a){return new la(this,a)},count:function(a){return this.toCollection().count(a)},offset:function(a){return this.toCollection().offset(a)},limit:function(a){return this.toCollection().limit(a)},reverse:function(){return this.toCollection().reverse()},filter:function(a){return this.toCollection().and(a)},
each:function(a){var d=this;return O&&a(d.schema.instanceTemplate),this._idbstore("readonly",function(b,k,t){t=t.openCursor();t.onerror=v(k,["calling","Table.each()","on",d.name]);qa(t,null,a,b,k,d.hook.reading.fire)})},toArray:function(a){var d=this;return this._idbstore("readonly",function(a,b,t){O&&a([d.schema.instanceTemplate]);var p=[];t=t.openCursor();t.onerror=v(b,["calling","Table.toArray()","on",d.name]);qa(t,null,function(a){p.push(a)},function(){a(p)},b,d.hook.reading.fire)}).then(a)},
orderBy:function(a){return new this._collClass(new la(this,a))},toCollection:function(){return new this._collClass(new la(this))},mapToClass:function(a,d){var b,k;return this.schema.mappedClass=a,b=Object.create(a.prototype),d&&e(b,d),this.schema.instanceTemplate=b,k=function(d){var p,b;if(!d)return d;p=Object.create(a.prototype);for(b in d)d.hasOwnProperty(b)&&(p[b]=d[b]);return p},this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=k,this.hook("reading",
k),a},defineClass:function(a){return this.mapToClass(h.defineClass(a),a)},add:a,put:a,"delete":a,clear:a,update:a}});m(xa).from(ga).extend(function(){return{add:function(a,d){var c=this,e=this.hook.creating.fire;return this._idbstore(V,function(k,t,p,f){var aa={},g,S,G;e!==z&&(g=d||(p.keyPath?n(a,p.keyPath):b),S=e.call(aa,g,a,f),g===b&&S!==b&&(p.keyPath?N(a,p.keyPath,S):d=S));G=d?p.add(a,d):p.add(a);G.onerror=v(function(a){if(aa.onerror)aa.onerror(a);return t(a)},["adding",a,"into",c.name]);G.onsuccess=
function(d){var b=p.keyPath;if(b&&N(a,b,d.target.result),aa.onsuccess)aa.onsuccess(d.target.result);k(G.result)}})},put:function(a,d){var c=this,e=this.hook.updating.fire;return this.hook.creating.fire!==z||e!==z?this._trans(V,function(k,t,p){var e=d||c.schema.primKey.keyPath&&n(a,c.schema.primKey.keyPath);e===b?p.tables[c.name].add(a).then(k,t):(p._lock(),a=f(a),p.tables[c.name].where(":id").equals(e).modify(function(){this.value=a}).then(function(b){return 0===b?p.tables[c.name].add(a,d):e}).finally(function(){p._unlock()}).then(k,
t))}):this._idbstore(V,function(b,t,p){var e=d?p.put(a,d):p.put(a);e.onerror=v(t,["putting",a,"into",c.name]);e.onsuccess=function(d){var c=p.keyPath;c&&N(a,c,d.target.result);b(e.result)}})},"delete":function(a){return this.hook.deleting.subscribers.length?this.where(":id").equals(a).delete():this._idbstore(V,function(d,b,c){var k=c.delete(a);k.onerror=v(b,["deleting",a,"from",c.name]);k.onsuccess=function(){d(k.result)}})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():
this._idbstore(V,function(a,d,b){var c=b.clear();c.onerror=v(d,["clearing",b.name]);c.onsuccess=function(){a(c.result)}})},update:function(a,c){if("object"!=typeof c||Array.isArray(c))throw new I("db.update(keyOrObject, modifications). modifications must be an object.");if("object"!=typeof a||Array.isArray(a))return this.where(":id").equals(a).modify(c);Object.keys(c).forEach(function(d){N(a,d,c[d])});var e=n(a,this.schema.primKey.keyPath);return e===b&&d.reject(new I("Object does not contain its primary key")),
this.where(":id").equals(e).modify(c)}}});B(H.prototype,{_lock:function(){return++this._reculock,1===this._reculock&&d.PSD&&(d.PSD.lockOwnerFor=this),this},_unlock:function(){if(0==--this._reculock)for(d.PSD&&(d.PSD.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var a=this._blockedFuncs.shift();try{a()}catch(b){}}return this},_locked:function(){return this._reculock&&(!d.PSD||d.PSD.lockOwnerFor!==this)},_nop:function(a){this.tables[this.storeNames[0]].get(0).then(a)},_promise:function(a,
b,c){var e=this;return d.newPSD(function(){var k;return e._locked()?k=new d(function(d,p){e._blockedFuncs.push(function(){e._promise(a,b,c).then(d,p)})}):(k=e.active?new d(function(d,p){if(!e.idbtrans&&a){if(!U)throw oa?new I("Database not open. Following error in populate, ready or upgrade function made Dexie.open() fail: "+oa):new I("Database not open");var k=e.idbtrans=U.transaction(E(e.storeNames),e.mode);k.onerror=function(a){e.on("error").fire(a&&a.target.error);a.preventDefault();e.abort()};
k.onabort=function(a){q(function(){e.on("error").fire(new I("Transaction aborted for unknown reason"))});e.active=!1;e.on("abort").fire(a)};k.oncomplete=function(a){e.active=!1;e.on("complete").fire(a)}}c&&e._lock();try{b(d,p,e)}catch(f){h.ignoreTransaction(function(){e.on("error").fire(f)}),e.abort(),p(f)}}):d.reject(ja(new I("Transaction is inactive. Original Scope Function Source: "+e.scopeFunc.toString()))),e.active&&c&&k.finally(function(){e._unlock()})),k.onuncatched=function(a){h.ignoreTransaction(function(){e.on("error").fire(a)});
e.abort()},k})},complete:function(a){return this.on("complete",a)},error:function(a){return this.on("error",a)},abort:function(){if(this.idbtrans&&this.active)try{this.active=!1,this.idbtrans.abort(),this.on.error.fire(new I("Transaction Aborted"))}catch(a){}},table:function(a){if(!this.tables.hasOwnProperty(a))throw new I("Table "+a+" not in transaction");return this.tables[a]}});B(la.prototype,function(){function a(d,b){try{throw b;}catch(c){d._ctx.error=c}return d}function d(a){return Array.prototype.slice.call(1===
a.length&&Array.isArray(a[0])?a[0]:a)}function b(a){return"next"===a?function(a){return a.toUpperCase()}:function(a){return a.toLowerCase()}}function c(a){return"next"===a?function(a){return a.toLowerCase()}:function(a){return a.toUpperCase()}}function k(a,d,b,c,k,t){for(var e,f=Math.min(a.length,c.length),v=-1,g=0;g<f;++g){if(e=d[g],e!==c[g])return 0>k(a[g],b[g])?a.substr(0,g)+b[g]+b.substr(g+1):0>k(a[g],c[g])?a.substr(0,g)+c[g]+b.substr(g+1):0<=v?a.substr(0,v)+d[v]+b.substr(v+1):null;0>k(a[g],e)&&
(v=g)}return f<c.length&&"next"===t?a+b.substr(a.length):f<a.length&&"prev"===t?a.substr(0,b.length):0>v?null:a.substr(0,v)+c[v]+b.substr(v+1)}function t(a,d,t){function e(a){f=b(a);v=c(a);g="next"===a?ba:za;S=f(t);n=v(t);G=a}var f,v,g,S,n,G;e("next");a._ondirectionchange=function(a){e(a)};a._addAlgorithm(function(a,b,p){var c=a.key,t,e;return"string"!=typeof c?!1:(t=v(c),d(t,n)?(b(function(){a.continue()}),!0):(e=k(c,t,S,n,g,G),e?b(function(){a.continue(e)}):b(p),!1))})}return{between:function(a,
d,b,c){return(b=!1!==b,c=!0===c,a>d||!(a!==d||!b&&!c||b&&c))?(new this._ctx.collClass(this,function(){return Z.only(a)})).limit(0):new this._ctx.collClass(this,function(){return Z.bound(a,d,!b,!c)})},equals:function(a){return new this._ctx.collClass(this,function(){return Z.only(a)})},above:function(a){return new this._ctx.collClass(this,function(){return Z.lowerBound(a,!0)})},aboveOrEqual:function(a){return new this._ctx.collClass(this,function(){return Z.lowerBound(a)})},below:function(a){return new this._ctx.collClass(this,
function(){return Z.upperBound(a,!0)})},belowOrEqual:function(a){return new this._ctx.collClass(this,function(){return Z.upperBound(a)})},startsWith:function(d){return"string"!=typeof d?a(new this._ctx.collClass(this),new sa("String expected")):this.between(d,d+String.fromCharCode(65535),!0,!0)},startsWithIgnoreCase:function(d){if("string"!=typeof d)return a(new this._ctx.collClass(this),new sa("String expected"));if(""===d)return this.startsWith(d);var b=new this._ctx.collClass(this,function(){return Z.bound(d.toUpperCase(),
d.toLowerCase()+String.fromCharCode(65535))});return t(b,function(a,d){return 0===a.indexOf(d)},d),b._ondirectionchange=function(){a(b,new I("reverse() not supported with WhereClause.startsWithIgnoreCase()"))},b},equalsIgnoreCase:function(d){if("string"!=typeof d)return a(new this._ctx.collClass(this),new sa("String expected"));var b=new this._ctx.collClass(this,function(){return Z.bound(d.toUpperCase(),d.toLowerCase())});return t(b,function(a,d){return a===d},d),b},anyOf:function(){var a=this._ctx,
b=a.table.schema,c=(a=a.index?b.idxByName[a.index]:b.primKey)&&a.compound,k=d(arguments),t=c?Aa(ba):ba,e,f;return(k.sort(t),0===k.length)?(new this._ctx.collClass(this,function(){return Z.only("")})).limit(0):(e=new this._ctx.collClass(this,function(){return Z.bound(k[0],k[k.length-1])}),e._ondirectionchange=function(a){t="next"===a?ba:za;c&&(t=Aa(t));k.sort(t)},f=0,e._addAlgorithm(function(a,d,b){for(var c=a.key;0<t(c,k[f]);)if(++f,f===k.length)return d(b),!1;return 0===t(c,k[f])?(d(function(){a.continue()}),
!0):(d(function(){a.continue(k[f])}),!1)}),e)},notEqual:function(a){return this.below(a).or(this._ctx.index).above(a)},noneOf:function(){var a=this._ctx,b=a.table.schema,b=(b=a.index?b.idxByName[a.index]:b.primKey)&&b.compound,c=d(arguments),k,t,e,f;return 0===c.length?new this._ctx.collClass(this):(k=b?Aa(ba):ba,c.sort(k),t=c.reduce(function(a,d){return a?a.concat([[a[a.length-1][1],d]]):[[null,d]]},null),t.push([c[c.length-1],null]),e=this,f=a.index,t.reduce(function(a,d){return a?null===d[1]?a.or(f).above(d[0]):
a.or(f).between(d[0],d[1],!1,!1):e.below(d[1])},null))},startsWithAnyOf:function(){function b(a){return a>e[v]}function c(a){return a<t[v]}var k=this._ctx,t=d(arguments),e,f,v,g,S;return t.every(function(a){return"string"==typeof a})?0===t.length?(new k.collClass(this,function(){return Z.only("")})).limit(0):(e=t.map(function(a){return a+String.fromCharCode(65535)}),f=ba,t.sort(f),v=0,g=b,S=new k.collClass(this,function(){return Z.bound(t[0],t[t.length-1]+String.fromCharCode(65535))}),S._ondirectionchange=
function(a){"next"===a?(g=b,f=ba):(g=c,f=za);t.sort(f);e.sort(f)},S._addAlgorithm(function(a,d,b){for(var c=a.key;g(c);)if(++v,v===t.length)return d(b),!1;return c>=t[v]&&c<=e[v]?(d(function(){a.continue()}),!0):(d(function(){f===ba?a.continue(t[v]):a.continue(e[v])}),!1)}),S):a(new k.collClass(this),new sa("startsWithAnyOf() only works with strings"))}}});B(ea.prototype,function(){function a(d,b){d.filter=ha(d.filter,b)}function b(a,d){a.isMatch=ha(a.isMatch,d)}function c(a,d){if(a.isPrimKey)return d;
var b=a.table.schema.idxByName[a.index];if(!b)throw new I("KeyPath "+a.index+" on object store "+d.name+" is not indexed");return a.isPrimKey?d:d.index(b.name)}function e(a,d){return c(a,d)[a.op](a.range||null,a.dir+a.unique)}function k(a,d,b,c,k){a.or?function(){function f(){2==++n&&b()}function v(a,b,k){if(!g||g(b,k,f,c)){var e=b.primaryKey.toString();S.hasOwnProperty(e)||(S[e]=!0,d(a,b,k))}}var g=a.filter,S={},n=0;a.or._iterate(v,f,c,k);qa(e(a,k),a.algorithm,v,f,c,a.table.hook.reading.fire)}():
qa(e(a,k),ha(a.algorithm,a.filter),d,b,c,a.table.hook.reading.fire)}return{_read:function(a,d){var b=this._ctx;return b.error?b.table._trans(null,function(a,d){d(b.error)}):b.table._idbstore("readonly",a).then(d)},_write:function(a){var d=this._ctx;return d.error?d.table._trans(null,function(a,b){b(d.error)}):d.table._idbstore(V,a,"locked")},_addAlgorithm:function(a){var d=this._ctx;d.algorithm=ha(d.algorithm,a)},_iterate:function(a,d,b,c){return k(this._ctx,a,d,b,c)},each:function(a){var d=this._ctx;
return O&&a(d.table.schema.instanceTemplate),this._read(function(b,c,e){k(d,a,b,c,e)})},count:function(a){var b,e,f;return O?d.resolve(0).then(a):(b=this,e=this._ctx,e.filter||e.algorithm||e.or?(f=0,this._read(function(a,d,b){k(e,function(){return++f,!1},function(){a(f)},d,b)},a)):this._read(function(a,d,k){k=c(e,k);k=e.range?k.count(e.range):k.count();k.onerror=v(d,["calling","count()","on",b.name]);k.onsuccess=function(d){a(Math.min(d.target.result,Math.max(0,e.limit-e.offset)))}},a))},sortBy:function(a,
d){function b(a,d){return d?b(a[k[d]],d-1):a[e]}function c(a,d){var k=b(a,f),e=b(d,f);return k<e?-v:k>e?v:0}var k=a.split(".").reverse(),e=k[0],f=k.length-1,v="next"===this._ctx.dir?1:-1;return this.toArray(function(a){return a.sort(c)}).then(d)},toArray:function(a){var d=this._ctx;return this._read(function(a,b,c){O&&a([d.table.schema.instanceTemplate]);var e=[];k(d,function(a){e.push(a)},function(){a(e)},b,c)},a)},offset:function(d){var b=this._ctx;return 0>=d?this:(b.offset+=d,b.or||b.algorithm||
b.filter?a(b,function(){return 0>--d}):a(b,function(a,b){return 0===d?!0:1===d?(--d,!1):(b(function(){a.advance(d);d=0}),!1)}),this)},limit:function(d){return this._ctx.limit=Math.min(this._ctx.limit,d),a(this._ctx,function(a,b,c){return 0>=--d&&b(c),0<=d}),this},until:function(d,b){var c=this._ctx;return O&&d(c.table.schema.instanceTemplate),a(this._ctx,function(a,c,k){return d(a.value)?(c(k),b):!0}),this},first:function(a){return this.limit(1).toArray(function(a){return a[0]}).then(a)},last:function(a){return this.reverse().first(a)},
and:function(d){return O&&d(this._ctx.table.schema.instanceTemplate),a(this._ctx,function(a){return d(a.value)}),b(this._ctx,d),this},or:function(a){return new la(this._ctx.table,a,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(a){var d=this._ctx;return O&&a(n(this._ctx.table.schema.instanceTemplate,this._ctx.index?this._ctx.table.schema.idxByName[this._ctx.index].keyPath:
this._ctx.table.schema.primKey.keyPath)),d.isPrimKey||(d.op="openKeyCursor"),this.each(function(d,b){a(b.key,b)})},eachUniqueKey:function(a){return this._ctx.unique="unique",this.eachKey(a)},keys:function(a){var b=this._ctx,c;return(b.isPrimKey||(b.op="openKeyCursor"),c=[],O)?(new d(this.eachKey.bind(this))).then(function(a){return[a]}).then(a):this.each(function(a,d){c.push(d.key)}).then(function(){return c}).then(a)},uniqueKeys:function(a){return this._ctx.unique="unique",this.keys(a)},firstKey:function(a){return this.limit(1).keys(function(a){return a[0]}).then(a)},
lastKey:function(a){return this.reverse().firstKey(a)},distinct:function(){var d={};return a(this._ctx,function(a){a=a.primaryKey.toString();var b=d.hasOwnProperty(a);return d[a]=!0,!b}),this}}});m(J).from(ea).extend({modify:function(a){var d=this,b=this._ctx,c=b.table.hook,k=c.updating.fire,e=c.deleting.fire;return O&&"function"==typeof a&&a.call({value:b.table.schema.instanceTemplate},b.table.schema.instanceTemplate),this._write(function(c,g,S,G){function Da(a){return a&&(x.push(a),C.push(X)),g(new r("Error modifying one or more objects",
x,l,C))}function q(){O&&l+x.length===u&&(0<x.length?Da():c(l))}var ja,pa,h,M;"function"==typeof a?ja=k===z&&e===z?a:function(d){var b=f(d),c,p;if(!1===a.call(this,d))return!1;this.hasOwnProperty("value")?(c=Q(b,this.value),p=k.call(this,c,this.primKey,b,G),p&&(d=this.value,Object.keys(p).forEach(function(a){N(d,a,p[a])}))):e.call(this,this.primKey,d,G)}:k===z?(pa=Object.keys(a),h=pa.length,ja=function(d){for(var b,c,k=!1,e=0;e<h;++e)b=pa[e],c=a[b],n(d,b)!==c&&(N(d,b,c),k=!0);return k}):(M=a,a=K(M),
ja=function(d){var b=!1,c=k.call(this,a,this.primKey,f(d),G);return c&&B(a,c),Object.keys(a).forEach(function(c){var k=a[c];n(d,c)!==k&&(N(d,c,k),b=!0)}),c&&(a=K(M)),b});var u=0,l=0,O=!1,x=[],C=[],X=null;d._iterate(function(a,d){var c,k,e;if(X=d.primaryKey,c={primKey:d.primaryKey,value:a},!1!==ja.call(c,a))e=(k=!c.hasOwnProperty("value"))?d.delete():d.update(c.value),++u,e.onerror=v(function(a){if(x.push(a),C.push(c.primKey),c.onerror)c.onerror(a);return q(),!0},k?["deleting",a,"from",b.table.name]:
["modifying",a,"on",b.table.name]),e.onsuccess=function(){if(c.onsuccess)c.onsuccess(c.value);++l;q()};else if(c.onsuccess)c.onsuccess(c.value)},function(){O=!0;q()},Da,S)})},"delete":function(){return this.modify(function(){delete this.value})}});B(this,{Collection:ea,Table:ga,Transaction:H,Version:pa,WhereClause:la,WriteableCollection:J,WriteableTable:xa});(function(){F.on("versionchange",function(){F.close();F.on("error").fire(new I("Database version changed by other database connection."))})})();
Ha.forEach(function(a){a(F)})}function z(){}function y(a){return a}function R(a,d){return a===y?d:function(b){return d(a(b))}}function a(a,d){return function(){a.apply(this,arguments);d.apply(this,arguments)}}function g(d,c){return d===z?c:function(){var e=d.apply(this,arguments),f,v,g;return e!==b&&(arguments[0]=e),f=this.onsuccess,v=this.onerror,delete this.onsuccess,delete this.onerror,g=c.apply(this,arguments),f&&(this.onsuccess=this.onsuccess?a(f,this.onsuccess):f),v&&(this.onerror=this.onerror?
a(v,this.onerror):v),g!==b?g:e}}function l(d,c){return d===z?c:function(){var e=d.apply(this,arguments),f,v,g;return e!==b&&B(arguments[0],e),f=this.onsuccess,v=this.onerror,delete this.onsuccess,delete this.onerror,g=c.apply(this,arguments),f&&(this.onsuccess=this.onsuccess?a(f,this.onsuccess):f),v&&(this.onerror=this.onerror?a(v,this.onerror):v),e===b?g===b?b:g:g===b?e:B(e,g)}}function u(a,d){return a===z?d:function(){return!1===a.apply(this,arguments)?!1:d.apply(this,arguments)}}function X(a,d){return a===
z?d:function(){return!1===d.apply(this,arguments)?!1:a.apply(this,arguments)}}function c(a,d){return a===z?d:function(){a.apply(this,arguments);d.apply(this,arguments)}}function Ya(a,d){return a===z?d:function(){var b=a.apply(this,arguments),c,e;return b&&"function"==typeof b.then?(c=this,e=arguments,b.then(function(){return d.apply(c,e)})):d.apply(this,arguments)}}function x(a){function d(a,e,g){if(Array.isArray(a))return c(a);if("object"==typeof a)return b(a);e||(e=u);g||(g=z);var G={subscribers:[],
fire:g,subscribe:function(a){G.subscribers.push(a);G.fire=e(G.fire,a)},unsubscribe:function(a){G.subscribers=G.subscribers.filter(function(d){return d!==a});G.fire=G.subscribers.reduce(e,g)}};return f[a]=v[a]=G,G}function b(a){Object.keys(a).forEach(function(b){var c=a[b],e;if(Array.isArray(c))d(b,a[b][0],a[b][1]);else if("asap"===c)e=d(b,null,function(){var a=arguments;e.subscribers.forEach(function(d){q(function(){d.apply(w,a)})})}),e.subscribe=function(a){-1===e.subscribers.indexOf(a)&&e.subscribers.push(a)},
e.unsubscribe=function(a){a=e.subscribers.indexOf(a);-1!==a&&e.subscribers.splice(a,1)};else throw Error("Invalid event config");})}function c(a){function b(){if(e)return!1;e=!0}var e=!1;a.forEach(function(a){d(a).subscribe(b)})}var e=arguments,f={},v=function(d,b){if(b){var c=[].slice.call(arguments,1),e=f[d];return e.subscribe.apply(e,c),a}if("string"==typeof d)return f[d]},g,G;v.addEventType=d;g=1;for(G=e.length;g<G;++g)d(e[g]);return v}function q(a){w.setImmediate?H(a):setTimeout(a,0)}function C(a){a=
setTimeout(a,1E3);clearTimeout(a)}function Ka(a,b,c){return function(){var e=d.PSD;d.PSD=c;try{a.apply(this,arguments)}catch(f){b(f)}finally{d.PSD=e}}}function n(a,d){var c,e,f,v;if(a.hasOwnProperty(d))return a[d];if(!d)return a;if("string"!=typeof d){c=[];e=0;for(f=d.length;e<f;++e)v=n(a,d[e]),c.push(v);return c}return(c=d.indexOf("."),-1!==c)?(e=a[d.substr(0,c)],e===b?b:n(e,d.substr(c+1))):b}function N(a,d,c){var e,f,v,g;if(a&&d!==b)if("string"!=typeof d&&"length"in d){if(!("string"!=typeof c&&
"length"in c))throw Error("Assertion failed");e=0;for(f=d.length;e<f;++e)N(a,d[e],c[e])}else e=d.indexOf("."),-1!==e?(f=d.substr(0,e),v=d.substr(e+1),""===v?c===b?delete a[f]:a[f]=c:(g=a[f],g||(g=a[f]={}),N(g,v,c))):c===b?delete a[d]:a[d]=c}function K(a){var d={},b;for(b in a)a.hasOwnProperty(b)&&(d[b]=a[b]);return d}function f(a){var d,b,c;if(!a||"object"!=typeof a)return a;if(Array.isArray(a))for(d=[],b=0,c=a.length;b<c;++b)d.push(f(a[b]));else if(a instanceof Date)d=new Date,d.setTime(a.getTime());
else for(b in d=a.constructor?Object.create(a.constructor.prototype):{},a)a.hasOwnProperty(b)&&(d[b]=f(a[b]));return d}function Q(a,d){var c={},e;for(e in a)a.hasOwnProperty(e)&&(d.hasOwnProperty(e)?a[e]!==d[e]&&JSON.stringify(a[e])!=JSON.stringify(d[e])&&(c[e]=d[e]):c[e]=b);for(e in d)d.hasOwnProperty(e)&&!a.hasOwnProperty(e)&&(c[e]=d[e]);return c}function M(a){if("function"==typeof a)return new a;if(Array.isArray(a))return[M(a[0])];if(a&&"object"==typeof a){var d={};return e(d,a),d}return a}function e(a,
d){Object.keys(d).forEach(function(b){var c=M(d[b]);a[b]=c})}function v(a,d){return function(b){var c=b&&b.target.error||Error(),e;return d&&(e=" occurred when "+d.map(function(a){switch(typeof a){case "function":return a();case "string":return a;default:return JSON.stringify(a)}}).join(" "),c.name?c.toString=function(){return c.name+e+(c.message?". "+c.message:"")}:c+=e),a(c),b&&(b.stopPropagation&&b.stopPropagation(),b.preventDefault&&b.preventDefault()),!1}}function ja(a){try{throw a;}catch(d){return d}}
function Xa(a){a.preventDefault()}function Oa(a){var d,b=h.dependencies.localStorage;if(!b)return a([]);try{d=JSON.parse(b.getItem("Dexie.DatabaseNames")||"[]")}catch(c){d=[]}a(d)&&b.setItem("Dexie.DatabaseNames",JSON.stringify(d))}function ra(a,d,b,c,e,f,v){this.name=a;this.keyPath=d;this.unique=b;this.multi=c;this.auto=e;this.compound=f;this.dotted=v;a="string"==typeof d?d:d&&"["+[].join.call(d,"+")+"]";this.src=(b?"&":"")+(c?"*":"")+(e?"++":"")+a}function Ba(a,d,b,c){this.name=a;this.primKey=d||
new ra;this.indexes=b||[new ra];this.instanceTemplate=c;this.mappedClass=null;this.idxByName=b.reduce(function(a,d){return a[d.name]=d,a},{})}function r(a,d,b,c){this.name="ModifyError";this.failures=d;this.failedKeys=c;this.successCount=b;this.message=d.join("\n")}function E(a){return 1===a.length?a[0]:a}function L(){var a=h.dependencies.indexedDB,d=a&&(a.getDatabaseNames||a.webkitGetDatabaseNames);return d&&d.bind(a)}var d=function(){function a(d){Q.push([d,q.call(arguments,1)])}function d(){var a=
Q,b,c,e;Q=[];b=0;for(c=a.length;b<c;++b)e=a[b],e[0].apply(w,e[1])}function b(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._value=this._state=null;this._deferreds=[];this._catched=!1;var d=this,c=!0;this._PSD=b.PSD;try{n(this,a,function(a){c?h(f,d,a):f(d,a)},function(a){return c?(h(v,d,a),!1):v(d,a)})}finally{c=!1}}function c(f,v){var g,G,n,q,r,u;if(null===f._state)f._deferreds.push(v);else{if(g=
f._state?v.onFulfilled:v.onRejected,null===g)return(f._state?v.resolve:v.reject)(f._value);n=M;M=!1;h=a;try{q=b.PSD,b.PSD=f._PSD,G=g(f._value),f._state||G&&"function"==typeof G.then&&!1===G._state||e(f),v.resolve(G)}catch(O){if(r=v.reject(O),!r&&f.onuncatched)try{f.onuncatched(O)}catch(x){}}finally{if(b.PSD=q,n){do{for(;0<Q.length;)d();if(u=l.pop(),u)try{u()}catch(O){}}while(0<l.length||0<Q.length);h=ja;M=!0}}}}function e(a){a._catched=!0;a._parent&&e(a._parent)}function f(a,d){var c=b.PSD;b.PSD=
a._PSD;try{if(d===a)throw new TypeError("A promise cannot be resolved with itself.");!d||"object"!=typeof d&&"function"!=typeof d||"function"!=typeof d.then?(a._state=!0,a._value=d,g.call(a)):n(a,function(a,b){d.then(a,b)},function(d){f(a,d)},function(d){v(a,d)})}catch(e){v(e)}finally{b.PSD=c}}function v(a,d){var c=b.PSD;if(b.PSD=a._PSD,a._state=!1,a._value=d,g.call(a),!a._catched)try{if(a.onuncatched)a.onuncatched(a._value);b.on.error.fire(a._value)}catch(e){}return b.PSD=c,a._catched}function g(){for(var a=
0,d=this._deferreds.length;a<d;a++)c(this,this._deferreds[a]);this._deferreds=[]}function G(a,d,b,c){this.onFulfilled="function"==typeof a?a:null;this.onRejected="function"==typeof d?d:null;this.resolve=b;this.reject=c}function n(a,d,b,c){var e=!1;try{d(function(a){e||(e=!0,b(a))},function(d){return e?a._catched:(e=!0,c(d))})}catch(f){return e?void 0:c(f)}}var q=[].slice,ja="undefined"==typeof H?function(a){var d=arguments;setTimeout(function(){a.apply(w,q.call(d,1))},0)}:H;C(function(){ja=h=a=function(a){var d=
arguments;setTimeout(function(){a.apply(w,q.call(d,1))},0)}});var h=ja,M=!0,Q=[],l=[];return b.on=x(null,"error"),b.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&Array.isArray(arguments[0])?arguments[0]:arguments);return new b(function(d,b){function c(f,v){try{if(v&&("object"==typeof v||"function"==typeof v)){var g=v.then;if("function"==typeof g){g.call(v,function(a){c(f,a)},b);return}}a[f]=v;0==--e&&d(a)}catch(G){b(G)}}var e,f;if(0===a.length)return d([]);e=a.length;for(f=
0;f<a.length;f++)c(f,a[f])})},b.prototype.then=function(a,d){var e=this,f=new b(function(b,f){null===e._state?c(e,new G(a,d,b,f)):h(c,e,new G(a,d,b,f))});return f._PSD=this._PSD,f.onuncatched=this.onuncatched,f._parent=this,f},b.prototype._then=function(a,d){c(this,new G(a,d,z,z))},b.prototype["catch"]=function(a){if(1===arguments.length)return this.then(null,a);var d=arguments[0],c=arguments[1];return"function"==typeof d?this.then(null,function(a){return a instanceof d?c(a):b.reject(a)}):this.then(null,
function(a){return a&&a.name===d?c(a):b.reject(a)})},b.prototype["finally"]=function(a){return this.then(function(d){return a(),d},function(d){return a(),b.reject(d)})},b.prototype.onuncatched=null,b.resolve=function(a){var d=new b(function(){});return d._state=!0,d._value=a,d},b.reject=function(a){var d=new b(function(){});return d._state=!1,d._value=a,d},b.race=function(a){return new b(function(d,b){a.map(function(a){a.then(d,b)})})},b.PSD=null,b.newPSD=function(a){var d=b.PSD;b.PSD=d?Object.create(d):
{};try{return a()}finally{b.PSD=d}},b._rootExec=function(b){var c=M,e;M=!1;h=a;try{b()}finally{if(c){do{for(;0<Q.length;)d();if(e=l.pop(),e)try{e()}catch(f){}}while(0<l.length||0<Q.length);h=ja;M=!0}}},b._tickFinalize=function(a){if(M)throw Error("Not in a virtual tick");l.push(a)},b}(),G=function(){},O=!1,va;m(r).from(Error);h.delete=function(a){var d=new h(a);a=d.delete();return a.onblocked=function(a){d.on("blocked",a);return this},a};h.exists=function(a){return(new h(a)).open().then(function(a){return a.close(),
!0},function(){return!1})};h.getDatabaseNames=function(a){return(new d(function(a,d){var b=L(),c;b?(c=b(),c.onsuccess=function(d){a([].slice.call(d.target.result,0))},c.onerror=v(d)):Oa(function(d){return a(d),!1})})).then(a)};h.defineClass=function(a){return function(d){d?B(this,d):O&&e(this,a)}};h.ignoreTransaction=function(a){return d.newPSD(function(){return d.PSD.trans=null,a()})};h.spawn=function(){return w.console&&console.warn("Dexie.spawn() is deprecated. Use Dexie.ignoreTransaction() instead."),
h.ignoreTransaction.apply(this,arguments)};h.vip=function(a){return d.newPSD(function(){return d.PSD.letThrough=!0,a()})};Object.defineProperty(h,"currentTransaction",{get:function(){return d.PSD&&d.PSD.trans||null}});h.Promise=d;h.derive=m;h.extend=B;h.override=A;h.events=x;h.getByKeyPath=n;h.setByKeyPath=N;h.delByKeyPath=function(a,d){"string"==typeof d?N(a,d,b):"length"in d&&[].map.call(d,function(d){N(a,d,b)})};h.shallowClone=K;h.deepClone=f;h.addons=[];h.fakeAutoComplete=G;h.asap=q;h.ModifyError=
r;h.MultiModifyError=r;h.IndexSpec=ra;h.TableSchema=Ba;va=w.idbModules&&w.idbModules.shimIndexedDB?w.idbModules:{};h.dependencies={indexedDB:va.shimIndexedDB||w.indexedDB||w.mozIndexedDB||w.webkitIndexedDB||w.msIndexedDB,IDBKeyRange:va.IDBKeyRange||w.IDBKeyRange||w.webkitIDBKeyRange,IDBTransaction:va.IDBTransaction||w.IDBTransaction||w.webkitIDBTransaction,Error:w.Error||String,SyntaxError:w.SyntaxError||String,TypeError:w.TypeError||String,DOMError:w.DOMError||String,localStorage:null!=("undefined"!=
typeof chrome&&null!==chrome?chrome.storage:void 0)?null:w.localStorage};h.version=1.2;D("Dexie",h);C(function(){h.fakeAutoComplete=G=C;h.fake=O=!0})}).apply(null,[self||window,function(w,D){!(L=function(){return D}.call(E,J,E,P),void 0!==L&&(P.exports=L))}])}).call(E,J(2).setImmediate)},function(P,E,J){(function(L,H){function w(b,m){this._id=b;this._clearFn=m}var D=J(3).nextTick,b=Function.prototype.apply,B=Array.prototype.slice,m={},A=0;E.setTimeout=function(){return new w(b.call(setTimeout,window,
arguments),clearTimeout)};E.setInterval=function(){return new w(b.call(setInterval,window,arguments),clearInterval)};E.clearTimeout=E.clearInterval=function(b){b.close()};w.prototype.unref=w.prototype.ref=function(){};w.prototype.close=function(){this._clearFn.call(window,this._id)};E.enroll=function(b,m){clearTimeout(b._idleTimeoutId);b._idleTimeout=m};E.unenroll=function(b){clearTimeout(b._idleTimeoutId);b._idleTimeout=-1};E._unrefActive=E.active=function(b){clearTimeout(b._idleTimeoutId);var m=
b._idleTimeout;0<=m&&(b._idleTimeoutId=setTimeout(function(){b._onTimeout&&b._onTimeout()},m))};E.setImmediate="function"===typeof L?L:function(b){var z=A++,y=2>arguments.length?!1:B.call(arguments,1);m[z]=!0;D(function(){m[z]&&(y?b.apply(null,y):b.call(null),E.clearImmediate(z))});return z};E.clearImmediate="function"===typeof H?H:function(b){delete m[b]}}).call(E,J(2).setImmediate,J(2).clearImmediate)},function(P,E){function J(){B=!1;m.length?b=m.concat(b):A=-1;b.length&&L()}function L(){if(!B){var h=
setTimeout(J);B=!0;for(var z=b.length;z;){m=b;for(b=[];++A<z;)m&&m[A].run();A=-1;z=b.length}m=null;B=!1;clearTimeout(h)}}function H(b,m){this.fun=b;this.array=m}function w(){}var D=P.exports={},b=[],B=!1,m,A=-1;D.nextTick=function(h){var m=Array(arguments.length-1);if(1<arguments.length)for(var y=1;y<arguments.length;y++)m[y-1]=arguments[y];b.push(new H(h,m));1!==b.length||B||setTimeout(L,0)};H.prototype.run=function(){this.fun.apply(null,this.array)};D.title="browser";D.browser=!0;D.env={};D.argv=
[];D.version="";D.versions={};D.on=w;D.addListener=w;D.once=w;D.off=w;D.removeListener=w;D.removeAllListeners=w;D.emit=w;D.binding=function(b){throw Error("process.binding is not supported");};D.cwd=function(){return"/"};D.chdir=function(b){throw Error("process.chdir is not supported");};D.umask=function(){return 0}},function(P,E,J){function L(b){Error.call(this);this.message=b;this.name=L.name;"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,L)}var H,w,D;!function(b){b.hprose=
Object.create(null)}(function(){return this||(0,eval)("this")}());(function(b){var B="WeakMap"in b,m="Map"in b,A=!0;if(m&&(A="forEach"in new b.Map),!(B&&m&&A)){var h=Object.create(null),z=0,y=function(a){var b=Object.create(null),c=a.valueOf;Object.defineProperty(a,"valueOf",{value:function(g,l){return this===a&&l in h&&h[l]===g?(l in b||(b[l]=Object.create(null)),b[l]):c.apply(this,arguments)},writable:!0,configurable:!0,enumerable:!1})};if(B||(b.WeakMap=function X(){var a=Object.create(null),b=
z++;h[b]=a;var g=function(g){if(g!==Object(g))throw Error("value is not a non-null object");var n=g.valueOf(a,b);return n!==g.valueOf()?n:(y(g),g.valueOf(a,b))},q=Object.create(X.prototype,{get:{value:function(a){return g(a).value}},set:{value:function(a,b){g(a).value=b}},has:{value:function(a){return"value"in g(a)}},"delete":{value:function(a){return delete g(a).value}},clear:{value:function(){delete h[b];b=z++;h[b]=a}}});if(0<arguments.length&&Array.isArray(arguments[0]))for(var l=arguments[0],
m=0,n=l.length;n>m;m++)q.set(l[m][0],l[m][1]);return q}),!m){var R=function(){var a=Object.create(null),b=z++,g=Object.create(null);h[b]=a;var l=function(q){if(null===q)return g;var l=q.valueOf(a,b);return l!==q.valueOf()?l:(y(q),q.valueOf(a,b))};return{get:function(a){return l(a).value},set:function(a,b){l(a).value=b},has:function(a){return"value"in l(a)},"delete":function(a){return delete l(a).value},clear:function(){delete h[b];b=z++;h[b]=a}}},a=function(){var a=Object.create(null);return{get:function(){return a.value},
set:function(b,g){a.value=g},has:function(){return"value"in a},"delete":function(){return delete a.value},clear:function(){a=Object.create(null)}}},g=function(){var a=Object.create(null);return{get:function(b){return a[b]},set:function(b,g){a[b]=g},has:function(b){return b in a},"delete":function(b){return delete a[b]},clear:function(){a=Object.create(null)}}};b.Map=function c(){var b={number:g(),string:g(),"boolean":g(),object:R(),"function":R(),unknown:R(),undefined:a(),"null":a()},l=0,q=[],h=Object.create(c.prototype,
{size:{get:function(){return l}},get:{value:function(a){return b[typeof a].get(a)}},set:{value:function(a,c){this.has(a)||(q.push(a),l++);b[typeof a].set(a,c)}},has:{value:function(a){return b[typeof a].has(a)}},"delete":{value:function(a){return this.has(a)?(l--,q.splice(q.indexOf(a),1),b[typeof a]["delete"](a)):!1}},clear:{value:function(){q.length=0;for(var a in b)b[a].clear();l=0}},forEach:{value:function(a,b){for(var c=0,g=q.length;g>c;c++)a.call(b,this.get(q[c]),q[c],this)}}});if(0<arguments.length&&
Array.isArray(arguments[0]))for(var m=arguments[0],n=0,y=m.length;y>n;n++)h.set(m[n][0],m[n][1]);return h}}if(!A){var l=b.Map;b.Map=function c(){var a=new l,b=0,g=[],h=Object.create(c.prototype,{size:{get:function(){return b}},get:{value:function(b){return a.get(b)}},set:{value:function(c,f){a.has(c)||(g.push(c),b++);a.set(c,f)}},has:{value:function(b){return a.has(b)}},"delete":{value:function(c){return a.has(c)?(b--,g.splice(g.indexOf(c),1),a["delete"](c)):!1}},clear:{value:function(){if("clear"in
a)a.clear();else for(var c=0,f=g.length;f>c;c++)a["delete"](g[c]);b=g.length=0}},forEach:{value:function(a,b){for(var c=0,n=g.length;n>c;c++)a.call(b,this.get(g[c]),g[c],this)}}});if(0<arguments.length&&Array.isArray(arguments[0]))for(var m=arguments[0],n=0,y=m.length;y>n;n++)h.set(m[n][0],m[n][1]);return h}}}})(function(){return this||(0,eval)("this")}());L.prototype=Object.create(Error.prototype);L.prototype.constructor=L;(function(b,B){function m(a){var b=g(arguments,1);return function(){a.apply(B,
b)}}function A(a){if(w)b.setTimeout(m(A,a),0);else{var g=c[a];if(g){w=!0;try{g()}finally{z(a),w=!1}}}}function h(a){return c[X]=m.apply(B,a),X++}function z(a){delete c[a]}function y(){if(b.postMessage&&!b.importScripts){var a=!0,c=b.onmessage;return b.onmessage=function(){a=!1},b.postMessage("","*"),b.onmessage=c,a}}var R=b.navigator&&/Trident/.test(b.navigator.userAgent);if(!R&&(b.msSetImmediate||b.setImmediate))return void(b.setImmediate||(b.setImmediate=b.msSetImmediate,b.clearImmediate=b.msClearImmediate));
var a=b.document,g=Function.prototype.call.bind(Array.prototype.slice),l=Function.prototype.call.bind(Object.prototype.toString),u={},X=1,c={},w=!1;u.messageChannel=function(){var a=new b.MessageChannel;return a.port1.onmessage=function(a){A(Number(a.data))},function(){var b=h(arguments);return a.port2.postMessage(b),b}};u.nextTick=function(){return function(){var a=h(arguments);return b.process.nextTick(m(A,a)),a}};u.postMessage=function(){var a="setImmediate$"+Math.random()+"$",c=function(c){c.source===
b&&"string"==typeof c.data&&0===c.data.indexOf(a)&&A(Number(c.data.slice(a.length)))};return b.addEventListener?b.addEventListener("message",c,!1):b.attachEvent("onmessage",c),function(){var c=h(arguments);return b.postMessage(a+c,"*"),c}};u.readyStateChange=function(){var b=a.documentElement;return function(){var c=h(arguments),g=a.createElement("script");return g.onreadystatechange=function(){A(c);g.onreadystatechange=null;b.removeChild(g);g=null},b.appendChild(g),c}};u.setTimeout=function(){return function(){var a=
h(arguments);return b.setTimeout(m(A,a),0),a}};var x=Object.getPrototypeOf&&Object.getPrototypeOf(b),x=x&&x.setTimeout?x:b;R?x.setImmediate=u.setTimeout():"[object process]"===l(b.process)?x.setImmediate=u.nextTick():y()?x.setImmediate=u.postMessage():b.MessageChannel?x.setImmediate=u.messageChannel():a&&"onreadystatechange"in a.createElement("script")?x.setImmediate=u.readyStateChange():x.setImmediate=u.setTimeout();x.msSetImmediate=x.setImmediate;x.clearImmediate=z;x.msClearImmediate=z})(function(){return this||
(0,eval)("this")}());(function(b,B){function m(a){Object.defineProperties(this,{_subscribers:{value:[]},resolve:{value:this.resolve.bind(this)},reject:{value:this.reject.bind(this)}});var b=this;"function"==typeof a&&N(function(){try{b.resolve(a())}catch(c){b.reject(c)}})}function A(a){return a instanceof m}function h(a){return A(a)||n&&a instanceof b.Promise&&typeof("function"===a.then)}function z(a){var b=new m;return b.reject(a),b}function y(a){var b=new m;return b.resolve(a),b}function R(a){var b=
0;return Q(a,function(){++b}),b}function a(a){return a=h(a)?a:y(a),a.then(function(a){var b=a.length,c=R(a),e=Array(b);if(0===c)return y(e);var f=new m;return Q(a,function(a,b){(h(a)?a:y(a)).then(function(a){e[b]=a;0===--c&&f.resolve(e)},f.reject)}),f})}function g(a){return a=h(a)?a:y(a),a.then(function(a){var b=new m;return Q(a,function(a){(h(a)?a:y(a)).then(b.resolve,b.reject)}),b})}function l(b,c,f){return a(b).then(function(a){return a.forEach(c,f)})}function u(b,c,f){return a(b).then(function(a){return a.every(c,
f)})}function X(b,c,f){return a(b).then(function(a){return a.some(c,f)})}function c(b,c,f){return a(b).then(function(a){return a.filter(c,f)})}function w(b,c,f){return a(b).then(function(a){return a.map(c,f)})}function x(b,c,f){return 2<arguments.length?a(b).then(function(a){return h(f)||(f=y(f)),f.then(function(b){return a.reduce(c,b)})}):a(b).then(function(a){return a.reduce(c)})}function q(b,c,f){return 2<arguments.length?a(b).then(function(a){return h(f)||(f=y(f)),f.then(function(b){return a.reduceRight(c,
b)})}):a(b).then(function(a){return a.reduceRight(c)})}function C(a,b,c){N(function(){try{var f=a(c);b.resolve(f)}catch(g){b.reject(g)}})}function D(a,b,c,f,g){function n(g){D(a,b,c,f,g)}function l(a){b?C(b,f,a):f.reject(a)}if(h(g))return g===c?void l(new TypeError("Self resolution")):void g.then(n,l);if(null!==g&&"object"==typeof g||"function"==typeof g){var M;try{M=g.then}catch(Q){return void l(Q)}if("function"==typeof M){var u=!0;try{return void M.call(g,function(a){u&&(u=!1,n(a))},function(a){u&&
(u=!1,l(a))})}catch(Q){u&&(u=!1,l(Q))}return}}a?C(a,f,g):f.resolve(g)}var n="Promise"in b,N=b.setImmediate,K=b.setTimeout,f=b.clearTimeout,Q=Function.prototype.call.bind(Array.prototype.forEach),M=Function.prototype.call.bind(Array.prototype.slice);Object.defineProperties(m,{delayed:{value:function(a,b){var c="function"==typeof b?b:function(){return b},f=new m;return K(function(){try{f.resolve(c())}catch(a){f.reject(a)}},a),f}},error:{value:z},sync:{value:function(a){try{var b=a();return y(b)}catch(c){return z(c)}}},
value:{value:y},all:{value:a},race:{value:g},resolve:{value:y},reject:{value:z},promise:{value:function(a){var b=new m;return a(b.resolve,b.reject),b}},isFuture:{value:A},isPromise:{value:h},join:{value:function(){return a(arguments)}},any:{value:function(a){return a=h(a)?a:y(a),a.then(function(a){var b=a.length,c=R(a);if(0===c)throw new RangeError("any(): array must not be empty");var e=Array(b),f=new m;return Q(a,function(a,b){(h(a)?a:y(a)).then(f.resolve,function(a){e[b]=a;0===--c&&f.reject(e)})}),
f})}},settle:{value:function(a){return a=h(a)?a:y(a),a.then(function(a){var b=a.length,c=R(a),e=Array(b);if(0===c)return y(e);var f=new m;return Q(a,function(a,b){var g=h(a)?a:y(a);g.whenComplete(function(){e[b]=g.inspect();0===--c&&f.resolve(e)})}),f})}},attempt:{value:function(b){var c=M(arguments,1);return a(c).then(function(a){return b.apply(B,a)})}},run:{value:function(b,c){var f=M(arguments,2);return a(f).then(function(a){return b.apply(c,a)})}},wrap:{value:function(b,c){return function(){return a(arguments).then(function(a){return b.apply(c,
a)})}}},forEach:{value:l},every:{value:u},some:{value:X},filter:{value:c},map:{value:w},reduce:{value:x},reduceRight:{value:q}});Object.defineProperties(m.prototype,{_value:{writable:!0},_reason:{writable:!0},_state:{value:0,writable:!0},resolve:{value:function(a){if(0===this._state){this._state=1;this._value=a;for(var b=this._subscribers;0<b.length;){var c=b.shift();D(c.onfulfill,c.onreject,this,c.next,a)}}}},reject:{value:function(a){if(0===this._state){this._state=2;this._reason=a;for(var b=this._subscribers;0<
b.length;){var c=b.shift();c.onreject?C(c.onreject,c.next,a):c.next.reject(a)}}}},then:{value:function(a,b){if("function"!=typeof a&&(a=null),"function"!=typeof b&&(b=null),a||b){var c=new m;return 1===this._state?a?D(a,b,this,c,this._value):c.resolve(this._value):2===this._state?b?C(b,c,this._reason):c.reject(this._reason):this._subscribers.push({onfulfill:a,onreject:b,next:c}),c}return this}},inspect:{value:function(){switch(this._state){case 0:return{state:"pending"};case 1:return{state:"fulfilled",
value:this._value};case 2:return{state:"rejected",reason:this._reason}}}},catchError:{value:function(a,b){if("function"==typeof b){var c=this;return this["catch"](function(f){if(b(f))return c["catch"](a);throw f;})}return this["catch"](a)}},"catch":{value:function(a){return this.then(null,a)}},whenComplete:{value:function(a){return this.then(function(b){var c=a();return c===B?b:(c=h(c)?c:y(c),c.then(function(){return b}))},function(b){var c=a();if(c===B)throw b;return c=h(c)?c:y(c),c.then(function(){throw b;
})})}},timeout:{value:function(a,b){var c=new m,g=K(function(){c.reject(b||new L("timeout"))},a);return this.whenComplete(function(){f(g)}).then(c.resolve,c.reject),c}},delay:{value:function(a){var b=new m;return this.then(function(c){K(function(){b.resolve(c)},a)},b.reject),b}},tap:{value:function(a,b){return this.then(function(c){return a.call(b,c),c})}},spread:{value:function(a,b){return this.then(function(c){return a.apply(b,c)})}},get:{value:function(a){return this.then(function(b){return b[a]})}},
set:{value:function(a,b){return this.then(function(c){return c[a]=b,c})}},apply:{value:function(b,c){return c=c||[],this.then(function(f){return a(c).then(function(a){return f[b].apply(f,a)})})}},call:{value:function(b){var c=M(arguments,1);return this.then(function(f){return a(c).then(function(a){return f[b].apply(f,a)})})}},bind:{value:function(b){var c=M(arguments);if(!Array.isArray(b)){c.shift();var f=this;return Object.defineProperty(this,b,{value:function(){var g=M(arguments);return f.then(function(f){return a(c.concat(g)).then(function(a){return f[b].apply(f,
a)})})}}),this}for(var g=0,n=b.length;n>g;++g)c[0]=b[g],this.bind.apply(this,c)}},forEach:{value:function(a,b){return l(this,a,b)}},every:{value:function(a,b){return u(this,a,b)}},some:{value:function(a,b){return X(this,a,b)}},filter:{value:function(a,b){return c(this,a,b)}},map:{value:function(a,b){return w(this,a,b)}},reduce:{value:function(a,b){return 1<arguments.length?x(this,a,b):x(this,a)}},reduceRight:{value:function(a,b){return 1<arguments.length?q(this,a,b):q(this,a)}}});b.hprose.Future=
m;b.hprose.Completer=function(){var a=new m;Object.defineProperties(this,{future:{value:a},complete:{value:a.resolve},completeError:{value:a.reject},isCompleted:{get:function(){return 0!==a._state}}})};b.hprose.resolved=y;b.hprose.rejected=z;b.hprose.deferred=function(){var a=new m;return Object.create(null,{promise:{value:a},resolve:{value:a.resolve},reject:{value:a.reject}})};n||(b.Promise=function(a){m.call(this);a(this.resolve,this.reject)},b.Promise.prototype=Object.create(m.prototype),b.Promise.prototype.constructor=
m,Object.defineProperties(b.Promise,{all:{value:a},race:{value:g},resolve:{value:y},reject:{value:z}}))})(function(){return this||(0,eval)("this")}());(function(b,B){function m(a,b,l){return a[b++]=l>>>24&255,a[b++]=l>>>16&255,a[b++]=l>>>8&255,a[b++]=255&l,b}function A(a,b,l){return a[b++]=255&l,a[b++]=l>>>8&255,a[b++]=l>>>16&255,a[b++]=l>>>24&255,b}function h(a,b){(b===B||null===b||0>b)&&(b=a.length);var l;if(0===b)l=["",0];else{var u;if(1E5>b){u=b;l=new Uint16Array(u);for(var h=0,c=0,m=a.length;u>
h&&m>c;h++){var x=a[c++];switch(x>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l[h]=x;break;case 12:case 13:if(!(m>c))throw Error("Unfinished UTF-8 octet sequence");l[h]=(31&x)<<6|63&a[c++];break;case 14:if(!(m>c+1))throw Error("Unfinished UTF-8 octet sequence");l[h]=(15&x)<<12|(63&a[c++])<<6|63&a[c++];break;case 15:if(!(m>c+2))throw Error("Unfinished UTF-8 octet sequence");x=((7&x)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;if(!(0<=x&&1048575>=x))throw Error("Character outside valid Unicode range: 0x"+
x.toString(16));l[h++]=x>>10&1023|55296;l[h]=1023&x|56320;break;default:throw Error("Bad UTF-8 encoding 0x"+x.toString(16));}}u=(u>h&&(l=l.subarray(0,h)),[String.fromCharCode.apply(String,l),c])}else{l=b;u=[];h=new Uint16Array(65535);c=x=0;for(m=a.length;l>x&&m>c;x++){var q=a[c++];switch(q>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:h[x]=q;break;case 12:case 13:if(!(m>c))throw Error("Unfinished UTF-8 octet sequence");h[x]=(31&q)<<6|63&a[c++];break;case 14:if(!(m>c+1))throw Error("Unfinished UTF-8 octet sequence");
h[x]=(15&q)<<12|(63&a[c++])<<6|63&a[c++];break;case 15:if(!(m>c+2))throw Error("Unfinished UTF-8 octet sequence");q=((7&q)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;if(!(0<=q&&1048575>=q))throw Error("Character outside valid Unicode range: 0x"+q.toString(16));h[x++]=q>>10&1023|55296;h[x]=1023&q|56320;break;default:throw Error("Bad UTF-8 encoding 0x"+q.toString(16));}65534<=x&&(x+=1,u.push(String.fromCharCode.apply(String,h.subarray(0,x))),l-=x,x=-1)}u=(0<x&&u.push(String.fromCharCode.apply(String,
h.subarray(0,x))),[u.join(""),c])}l=u}return l}function z(){var a=arguments;switch(a.length){case 1:switch(a[0].constructor){case Uint8Array:this._bytes=a[0];this._length=a[0].length;break;case z:this._bytes=a[0].toBytes();this._length=a[0].length;break;case String:this.writeString(a[0]);break;case Number:this._bytes=new Uint8Array(a[0]);break;default:this._bytes=new Uint8Array(a[0]),this._length=this._bytes.length}break;case 2:this._bytes=new Uint8Array(a[0],a[1]);this._length=a[1];break;case 3:this._bytes=
new Uint8Array(a[0],a[1],a[2]),this._length=a[2]}this.mark()}var y=(b.hprose.Future,new Uint8Array(0)),R=Function.prototype.call.bind(Array.prototype.indexOf);Object.defineProperties(z.prototype,{_bytes:{value:null,writable:!0},_length:{value:0,writable:!0},_wmark:{value:0,writable:!0},_off:{value:0,writable:!0},_rmark:{value:0,writable:!0},_grow:{value:function(a){var b=this._bytes,l=this._length+a;a=(--l,l|=l>>1,l|=l>>2,l|=l>>4,l|=l>>8,l|=l>>16,l+1);if(b){if(a*=2,a>b.length)a=new Uint8Array(a),
a.set(b),this._bytes=a}else a=Math.max(a,1024),this._bytes=new Uint8Array(a)}},length:{get:function(){return this._length}},capacity:{get:function(){return this._bytes?this._bytes.length:0}},position:{get:function(){return this._off}},bytes:{get:function(){return null===this._bytes?y:this._bytes.subarray(0,this._length)}},mark:{value:function(){this._wmark=this._length;this._rmark=this._off}},reset:{value:function(){this._length=this._wmark;this._off=this._rmark}},clear:{value:function(){this._bytes=
null;this._rmark=this._off=this._wmark=this._length=0}},writeByte:{value:function(a){this._grow(1);this._bytes[this._length++]=a}},writeInt32BE:{value:function(a){if(a===(0|a)&&2147483647>=a)return this._grow(4),void(this._length=m(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},writeUInt32BE:{value:function(a){if(a===(0|a)&&0<=a)return this._grow(4),void(this._length=m(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},writeInt32LE:{value:function(a){if(a===
(0|a)&&2147483647>=a)return this._grow(4),void(this._length=A(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},writeUInt32LE:{value:function(a){if(a===(0|a)&&0<=a)return this._grow(4),void(this._length=A(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},write:{value:function(a){var b=a.byteLength||a.length;if(0!==b){this._grow(b);var l=this._bytes,h=this._length;switch(a.constructor){case ArrayBuffer:l.set(new Uint8Array(a),h);break;case Uint8Array:l.set(a,
h);break;case z:l.set(a.bytes,h);break;default:for(var m=0;b>m;m++)l[h+m]=a[m]}this._length+=b}}},writeAsciiString:{value:function(a){var b=a.length;if(0!==b){this._grow(b);for(var l=this._bytes,h=this._length,m=0;b>m;++m,++h)l[h]=a.charCodeAt(m);this._length=h}}},writeString:{value:function(a){var b=a.length;if(0!==b){this._grow(3*b);for(var b=this._bytes,l=this._length,h=a.length,m=0;h>m;++m){var c=a.charCodeAt(m);if(128>c)b[l++]=c;else{if(2048>c)b[l++]=192|c>>6;else{if(!(55296>c||57343<c)){if(h>
m+1){var y=a.charCodeAt(m+1);if(56320>c&&56320<=y&&57343>=y){c=((1023&c)<<10|1023&y)+65536;b[l++]=240|c>>18;b[l++]=128|c>>12&63;b[l++]=128|c>>6&63;b[l++]=128|63&c;++m;continue}}throw Error("Malformed string");}b[l++]=224|c>>12;b[l++]=128|c>>6&63}b[l++]=128|63&c}}this._length=l}}},readByte:{value:function(){return this._off<this._length?this._bytes[this._off++]:-1}},readInt32BE:{value:function(){var a=this._bytes,b=this._off;if(b+3<this._length)return a=a[b++]<<24|a[b++]<<16|a[b++]<<8|a[b++],this._off=
b,a;throw Error("EOF");}},readUInt32BE:{value:function(){var a=this.readInt32BE();return 0>a?(2147483647&a)+2147483648:a}},readInt32LE:{value:function(){var a=this._bytes,b=this._off;if(b+3<this._length)return a=a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24,this._off=b,a;throw Error("EOF");}},readUInt32LE:{value:function(){var a=this.readInt32LE();return 0>a?(2147483647&a)+2147483648:a}},read:{value:function(a){return this._off+a>this._length&&(a=this._length-this._off),0===a?y:this._bytes.subarray(this._off,
this._off+=a)}},skip:{value:function(a){return this._off+a>this._length?(a=this._length-this._off,this._off=this._length):this._off+=a,a}},readBytes:{value:function(a){var b;a=R(this._bytes,a,this._off);return-1===a?(b=this._bytes.subarray(this._off,this._length),this._off=this._length):(b=this._bytes.subarray(this._off,a+1),this._off=a+1),b}},readUntil:{value:function(a){a=R(this._bytes,a,this._off);var b="";return a===this._off?this._off++:-1===a?(b=h(this._bytes.subarray(this._off,this._length))[0],
this._off=this._length):(b=h(this._bytes.subarray(this._off,a))[0],this._off=a+1),b}},readAsciiString:{value:function(a){if(this._off+a>this._length&&(a=this._length-this._off),0===a)return"";var b=this._bytes.subarray(this._off,this._off+=a);if(1E5>a)return String.fromCharCode.apply(String,b);for(var l=65535&a,h=a>>16,m=Array(l?h+1:h),c=0;h>c;++c)m[c]=String.fromCharCode.apply(String,b.subarray(c<<16,c+1<<16));return l&&(m[h]=String.fromCharCode.apply(String,b.subarray(h<<16,a))),m.join("")}},readStringAsBytes:{value:function(a){var b;
b=this._bytes.subarray(this._off,this._length);if(a===B&&(a=b.length),0===a)b=y;else{for(var l=0,h=0,m=b.length;a>l&&m>h;l++){var c=b[h++];switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:if(!(m>h))throw Error("Unfinished UTF-8 octet sequence");h++;break;case 14:if(!(m>h+1))throw Error("Unfinished UTF-8 octet sequence");h+=2;break;case 15:if(!(m>h+2))throw Error("Unfinished UTF-8 octet sequence");c=((7&c)<<18|(63&b[h++])<<12|(63&b[h++])<<6|63&b[h++])-65536;
if(!(0<=c&&1048575>=c))throw Error("Character outside valid Unicode range: 0x"+c.toString(16));l++;break;default:throw Error("Bad UTF-8 encoding 0x"+c.toString(16));}}b=[b.subarray(0,h),h]}return this._off+=b[1],b[0]}},readString:{value:function(a){a=h(this._bytes.subarray(this._off,this._length),a);return this._off+=a[1],a[0]}},takeBytes:{value:function(){var a=this.bytes;return this.clear(),a}},toBytes:{value:function(){return new Uint8Array(this.bytes)}},toString:{value:function(){return h(this.bytes,
this._length)[0]}},clone:{value:function(){return new z(this.toBytes())}},trunc:{value:function(){this._bytes=this._bytes.subarray(this._off,this._length);this._length=this._bytes.length;this._rmark=this._wmark=this._off=0}}});Object.defineProperty(z,"toString",{value:function(a){if(0===a.length)return"";switch(a.constructor){case String:return a;case z:a=a.bytes;case ArrayBuffer:a=new Uint8Array(a);case Uint8Array:return h(a,a.length)[0];default:return String.fromCharCode.apply(String,a)}}});b.hprose.BytesIO=
z})(function(){return this||(0,eval)("this")}());(function(b){b.hprose.Tags={TagInteger:105,TagLong:108,TagDouble:100,TagNull:110,TagEmpty:101,TagTrue:116,TagFalse:102,TagNaN:78,TagInfinity:73,TagDate:68,TagTime:84,TagUTC:90,TagBytes:98,TagUTF8Char:117,TagString:115,TagGuid:103,TagList:97,TagMap:109,TagClass:99,TagObject:111,TagRef:114,TagPos:43,TagNeg:45,TagSemicolon:59,TagOpenbrace:123,TagClosebrace:125,TagQuote:34,TagPoint:46,TagFunctions:70,TagCall:67,TagResult:82,TagArgument:65,TagError:69,TagEnd:122}})(function(){return this||
(0,eval)("this")}());(function(b){function B(b,m){h.set(b,m);A[m]=b}var m=b.WeakMap,A=Object.create(null),h=new m;b.hprose.ClassManager=Object.create(null,{register:{value:B},getClassAlias:{value:function(b){return h.get(b)}},getClass:{value:function(b){return A[b]}}});b.hprose.register=B;B(Object,"Object")})(function(){return this||(0,eval)("this")}());(function(b,B){function m(a){var b=a.constructor,c=N.getClassAlias(b);if(c)return c;if(b.name)c=b.name;else{var e=b.toString();if(c=e.substr(0,e.indexOf("(")).replace(/(^\s*function\s*)|(\s*$)/gi,
""),""===c||"Object"===c)return"function"==typeof a.getClassName?a.getClassName():"Object"}return"Object"!==c&&N.register(b,c),c}function A(a){Object.defineProperties(this,{_stream:{value:a},_ref:{value:new C,writable:!0}})}function h(a,b){Object.defineProperties(this,{stream:{value:a},_classref:{value:Object.create(null),writable:!0},_fieldsref:{value:[],writable:!0},_refer:{value:b?K:new A(a)}})}function z(a,b){var g=a.stream;if(b===B||null===b)return void g.writeByte(n.TagNull);switch(b.constructor){case Function:return void g.writeByte(n.TagNull);
case Number:var e=a.stream,g=b.valueOf();g===(0|g)?0<=g&&9>=g?e.writeByte(g+48):(e.writeByte(n.TagInteger),e.writeAsciiString(""+g),e.writeByte(n.TagSemicolon)):isNaN(g)?e.writeByte(n.TagNaN):isFinite(g)?(e.writeByte(n.TagDouble),e.writeAsciiString(""+g),e.writeByte(n.TagSemicolon)):(e.writeByte(n.TagInfinity),e.writeByte(0<g?n.TagPos:n.TagNeg));break;case Boolean:a.stream.writeByte(b.valueOf()?n.TagTrue:n.TagFalse);break;case String:switch(b.length){case 0:return void g.writeByte(n.TagEmpty);case 1:return g.writeByte(n.TagUTF8Char),
void g.writeString(b)}return void a.writeStringWithRef(b);case Date:return void a.writeDateWithRef(b);case C:return void a.writeMapWithRef(b);case ArrayBuffer:case Uint8Array:case E:return void a.writeBytesWithRef(b);case Int8Array:case Int16Array:case Int32Array:case Uint16Array:case Uint32Array:a._refer.write(b)||c(a,b,y);break;case Float32Array:case Float64Array:a._refer.write(b)||c(a,b,R);break;default:Array.isArray(b)?a.writeListWithRef(b):"Object"===m(b)?a.writeMapWithRef(b):a.writeObjectWithRef(b)}}
function y(a,b){var c=a.stream;0<=b&&9>=b?c.writeByte(b+48):(-2147483648>b||2147483647<b?c.writeByte(n.TagLong):c.writeByte(n.TagInteger),c.writeAsciiString(""+b),c.writeByte(n.TagSemicolon))}function R(a,b){var c=a.stream;isNaN(b)?c.writeByte(n.TagNaN):isFinite(b)?(c.writeByte(n.TagDouble),c.writeAsciiString(""+b),c.writeByte(n.TagSemicolon)):(c.writeByte(n.TagInfinity),c.writeByte(0<b?n.TagPos:n.TagNeg))}function a(a,b){a._refer.set(b);var c=a.stream,e=("0000"+b.getUTCFullYear()).slice(-4),g=("00"+
(b.getUTCMonth()+1)).slice(-2),h=("00"+b.getUTCDate()).slice(-2),l=("00"+b.getUTCHours()).slice(-2),m=("00"+b.getUTCMinutes()).slice(-2),q=("00"+b.getUTCSeconds()).slice(-2),u=("000"+b.getUTCMilliseconds()).slice(-3);c.writeByte(n.TagDate);c.writeAsciiString(e+g+h);c.writeByte(n.TagTime);c.writeAsciiString(l+m+q);"000"!==u&&(c.writeByte(n.TagPoint),c.writeAsciiString(u));c.writeByte(n.TagUTC)}function g(a,b){a._refer.set(b);var c=a.stream,e=("0000"+b.getFullYear()).slice(-4),g=("00"+(b.getMonth()+
1)).slice(-2),h=("00"+b.getDate()).slice(-2),l=("00"+b.getHours()).slice(-2),m=("00"+b.getMinutes()).slice(-2),q=("00"+b.getSeconds()).slice(-2),u=("000"+b.getMilliseconds()).slice(-3);"00"===l&&"00"===m&&"00"===q&&"000"===u?(c.writeByte(n.TagDate),c.writeAsciiString(e+g+h)):"1970"===e&&"01"===g&&"01"===h?(c.writeByte(n.TagTime),c.writeAsciiString(l+m+q),"000"!==u&&(c.writeByte(n.TagPoint),c.writeAsciiString(u))):(c.writeByte(n.TagDate),c.writeAsciiString(e+g+h),c.writeByte(n.TagTime),c.writeAsciiString(l+
m+q),"000"!==u&&(c.writeByte(n.TagPoint),c.writeAsciiString(u)));c.writeByte(n.TagSemicolon)}function l(a,b){a._refer.set(b);var c=a.stream,e=("00"+b.getHours()).slice(-2),g=("00"+b.getMinutes()).slice(-2),h=("00"+b.getSeconds()).slice(-2),l=("000"+b.getMilliseconds()).slice(-3);c.writeByte(n.TagTime);c.writeAsciiString(e+g+h);"000"!==l&&(c.writeByte(n.TagPoint),c.writeAsciiString(l));c.writeByte(n.TagSemicolon)}function u(a,b){a._refer.set(b);var c=a.stream;c.writeByte(n.TagBytes);var e=b.byteLength||
b.length;0<e&&c.writeAsciiString(""+e);c.writeByte(n.TagQuote);0<e&&c.write(b);c.writeByte(n.TagQuote)}function w(a,b){a._refer.set(b);var c=a.stream,e=b.length;c.writeByte(n.TagString);0<e&&c.writeAsciiString(""+e);c.writeByte(n.TagQuote);0<e&&c.writeString(b);c.writeByte(n.TagQuote)}function c(a,b,c){a._refer.set(b);var e=a.stream,g=b.length;e.writeByte(n.TagList);0<g&&e.writeAsciiString(""+g);e.writeByte(n.TagOpenbrace);for(var h=0;g>h;h++)c(a,b[h]);e.writeByte(n.TagClosebrace)}function D(a,b){a._refer.set(b);
var c=a.stream,e=[],g;for(g in b)b.hasOwnProperty(g)&&"function"!=typeof b[g]&&(e[e.length]=g);g=e.length;c.writeByte(n.TagMap);0<g&&c.writeAsciiString(""+g);c.writeByte(n.TagOpenbrace);for(var h=0;g>h;h++)z(a,e[h]),z(a,b[e[h]]);c.writeByte(n.TagClosebrace)}function x(a,b){a._refer.set(b);var c=a.stream,e=b.size;c.writeByte(n.TagMap);0<e&&c.writeAsciiString(""+e);c.writeByte(n.TagOpenbrace);b.forEach(function(b,c){z(a,c);z(a,b)});c.writeByte(n.TagClosebrace)}function q(a,b){var c,e,g=a.stream;e=m(b);
if(e in a._classref)e=a._classref[e],c=a._fieldsref[e];else{c=[];for(var h in b)b.hasOwnProperty(h)&&"function"!=typeof b[h]&&(c[c.length]=h.toString());h=c;var l=a.stream,q=h.length;l.writeByte(n.TagClass);l.writeAsciiString(""+e.length);l.writeByte(n.TagQuote);l.writeString(e);l.writeByte(n.TagQuote);0<q&&l.writeAsciiString(""+q);l.writeByte(n.TagOpenbrace);for(var u=0;q>u;u++)w(a,h[u]);l.writeByte(n.TagClosebrace);l=a._fieldsref.length;e=(a._classref[e]=l,a._fieldsref[l]=h,l)}g.writeByte(n.TagObject);
g.writeAsciiString(""+e);g.writeByte(n.TagOpenbrace);a._refer.set(b);e=c.length;for(h=0;e>h;h++)z(a,b[c[h]]);g.writeByte(n.TagClosebrace)}var C=b.Map,E=b.hprose.BytesIO,n=b.hprose.Tags,N=b.hprose.ClassManager,K=Object.create(null,{set:{value:function(){}},write:{value:function(){return!1}},reset:{value:function(){}}});Object.defineProperties(A.prototype,{_refcount:{value:0,writable:!0},set:{value:function(a){this._ref.set(a,this._refcount++)}},write:{value:function(a){a=this._ref.get(a);return a!==
B?(this._stream.writeByte(n.TagRef),this._stream.writeString(""+a),this._stream.writeByte(n.TagSemicolon),!0):!1}},reset:{value:function(){this._ref=new C;this._refcount=0}}});Object.defineProperties(h.prototype,{serialize:{value:function(a){z(this,a)}},writeInteger:{value:function(a){y(this,a)}},writeDouble:{value:function(a){R(this,a)}},writeBoolean:{value:function(a){this.stream.writeByte(a.valueOf()?n.TagTrue:n.TagFalse)}},writeUTCDate:{value:function(b){a(this,b)}},writeUTCDateWithRef:{value:function(b){this._refer.write(b)||
a(this,b)}},writeDate:{value:function(a){g(this,a)}},writeDateWithRef:{value:function(a){this._refer.write(a)||g(this,a)}},writeTime:{value:function(a){l(this,a)}},writeTimeWithRef:{value:function(a){this._refer.write(a)||l(this,a)}},writeBytes:{value:function(a){u(this,a)}},writeBytesWithRef:{value:function(a){this._refer.write(a)||u(this,a)}},writeString:{value:function(a){w(this,a)}},writeStringWithRef:{value:function(a){this._refer.write(a)||w(this,a)}},writeList:{value:function(a){c(this,a,z)}},
writeListWithRef:{value:function(a){this._refer.write(a)||c(this,a,z)}},writeMap:{value:function(a){a instanceof C?x(this,a):D(this,a)}},writeMapWithRef:{value:function(a){this._refer.write(a)||(a instanceof C?x(this,a):D(this,a))}},writeObject:{value:function(a){q(this,a)}},writeObjectWithRef:{value:function(a){this._refer.write(a)||q(this,a)}},reset:{value:function(){this._classref=Object.create(null);this._fieldsref.length=0;this._refer.reset()}}});b.hprose.Writer=h})(function(){return this||(0,eval)("this")}());
(function(b,B){function m(a,b){if(a&&b){var c="";throw c="number"==typeof b?String.fromCharCode(b):String.fromCharCode.apply(String,b),Error('Tag "'+c+'" expected, but "'+String.fromCharCode(a)+'" found in stream');}throw a?Error('Unexpected serialize tag "'+String.fromCharCode(a)+'" in stream'):Error("No byte found in stream");}function A(a,b,c){switch(b.writeByte(c),c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case r.TagNull:case r.TagEmpty:case r.TagTrue:case r.TagFalse:case r.TagNaN:break;
case r.TagInfinity:b.writeByte(a.readByte());break;case r.TagInteger:case r.TagLong:case r.TagDouble:case r.TagRef:do c=a.readByte(),b.writeByte(c);while(c!==r.TagSemicolon);break;case r.TagDate:case r.TagTime:do c=a.readByte(),b.writeByte(c);while(c!==r.TagSemicolon&&c!==r.TagUTC);break;case r.TagUTF8Char:b.writeString(a.readString(1));break;case r.TagBytes:c=0;var e=48;do c*=10,c+=e-48,e=a.readByte(),b.writeByte(e);while(e!==r.TagQuote);b.write(a.read(c+1));break;case r.TagString:c=0;e=48;do c*=
10,c+=e-48,e=a.readByte(),b.writeByte(e);while(e!==r.TagQuote);b.write(a.readStringAsBytes(c+1));break;case r.TagGuid:b.write(a.read(38));break;case r.TagList:case r.TagMap:case r.TagObject:h(a,b);break;case r.TagClass:h(a,b);A(a,b,a.readByte());break;case r.TagError:A(a,b,a.readByte());break;default:m(c)}}function h(a,b){var c;do c=a.readByte(),b.writeByte(c);while(c!==r.TagOpenbrace);for(;(c=a.readByte())!==r.TagClosebrace;)A(a,b,c);b.writeByte(c)}function z(a){Object.defineProperties(this,{stream:{value:a},
readRaw:{value:function(){var b=new Ba;A(a,b,a.readByte());return b.bytes}}})}function y(){Object.defineProperties(this,{ref:{value:[]}})}function R(a){var c=b,e=a.split(".");for(a=0;a<e.length;a++)if(c=c[e[a]],c===B)return null;return c}function a(b,c,e,f){if(e<c.length){b[c[e]]=f;var g=a(b,c,e+1,".");return e+1<c.length&&null===g&&(g=a(b,c,e+1,"_")),g}b=b.join("");try{return g=R(b),"function"==typeof g?g:null}catch(h){return null}}function g(b){var c=Fa.getClass(b);if(c)return c;if(c=R(b),"function"==
typeof c)return Fa.register(c,b),c;for(var e=[],f=b.indexOf("_");0<=f;)e[e.length]=f,f=b.indexOf("_",f+1);return 0<e.length&&(f=b.split(""),c=a(f,e,0,"."),null===c&&(c=a(f,e,0,"_")),"function"==typeof c)?(Fa.register(c,b),c):(c=function(){},Object.defineProperty(c.prototype,"getClassName",{value:function(){return b}}),Fa.register(c,b),c)}function l(a,b){var c=a.readUntil(b);return 0===c.length?0:parseInt(c,10)}function u(a){var b=a.stream,c=b.readByte();switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return c-
48;case r.TagInteger:return l(b,r.TagSemicolon);case r.TagLong:return w(b);case r.TagDouble:return parseFloat(b.readUntil(r.TagSemicolon));case r.TagNull:return null;case r.TagEmpty:return"";case r.TagTrue:return!0;case r.TagFalse:return!1;case r.TagNaN:return NaN;case r.TagInfinity:return b.readByte()===r.TagNeg?-(1/0):1/0;case r.TagDate:return D(a);case r.TagTime:return x(a);case r.TagBytes:return q(a);case r.TagUTF8Char:return a.stream.readString(1);case r.TagString:return n(a);case r.TagGuid:return K(a);
case r.TagList:return f(a);case r.TagMap:return a.useHarmonyMap?M(a):Q(a);case r.TagClass:return L(a),v(a);case r.TagObject:return e(a);case r.TagRef:return H(a);case r.TagError:throw Error(N(a));default:m(c)}}function w(a){a=a.readUntil(r.TagSemicolon);var b=parseInt(a,10);return b.toString()===a?b:a}function c(a){var b=a.readByte();switch(b){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return b-48;case r.TagInteger:case r.TagLong:case r.TagDouble:return parseFloat(a.readUntil(r.TagSemicolon));
case r.TagNaN:return NaN;case r.TagInfinity:return a.readByte()===r.TagNeg?-(1/0):1/0;default:m(b)}}function D(a){var b;b=a.stream;var c=parseInt(b.readAsciiString(4),10),e=parseInt(b.readAsciiString(2),10)-1,f=parseInt(b.readAsciiString(2),10),g=b.readByte();if(g===r.TagTime){var h=parseInt(b.readAsciiString(2),10),l=parseInt(b.readAsciiString(2),10),n=parseInt(b.readAsciiString(2),10),m=0,g=b.readByte();g===r.TagPoint&&(m=parseInt(b.readAsciiString(3),10),g=b.readByte(),48<=g&&57>=g&&(b.skip(2),
g=b.readByte(),48<=g&&57>=g&&(b.skip(2),g=b.readByte())));b=g===r.TagUTC?new Date(Date.UTC(c,e,f,h,l,n,m)):new Date(c,e,f,h,l,n,m)}else b=g===r.TagUTC?new Date(Date.UTC(c,e,f)):new Date(c,e,f);return a.refer.set(b),b}function x(a){var b,c=a.stream,e=parseInt(c.readAsciiString(2),10),f=parseInt(c.readAsciiString(2),10),g=parseInt(c.readAsciiString(2),10),h=0,l=c.readByte();return l===r.TagPoint&&(h=parseInt(c.readAsciiString(3),10),l=c.readByte(),48<=l&&57>=l&&(c.skip(2),l=c.readByte(),48<=l&&57>=
l&&(c.skip(2),l=c.readByte()))),b=l===r.TagUTC?new Date(Date.UTC(1970,0,1,e,f,g,h)):new Date(1970,0,1,e,f,g,h),a.refer.set(b),b}function q(a){var b=a.stream,c=l(b,r.TagQuote),c=b.read(c);return b.skip(1),a.refer.set(c),c}function C(a){var b=a.stream.readByte();switch(b){case r.TagNull:return null;case r.TagEmpty:return new Uint8Array(0);case r.TagBytes:return q(a);case r.TagRef:return H(a);default:m(b)}}function E(a){a=a.stream;var b=a.readString(l(a,r.TagQuote));return a.skip(1),b}function n(a){var b=
E(a);return a.refer.set(b),b}function N(a){var b=a.stream.readByte();switch(b){case r.TagNull:return null;case r.TagEmpty:return"";case r.TagUTF8Char:return a.stream.readString(1);case r.TagString:return n(a);case r.TagRef:return H(a);default:m(b)}}function K(a){var b=a.stream;b.skip(1);var c=b.readAsciiString(36);return b.skip(1),a.refer.set(c),c}function f(a){var b=a.stream,c=[];a.refer.set(c);for(var e=l(b,r.TagOpenbrace),f=0;e>f;f++)c[f]=u(a);return b.skip(1),c}function Q(a){var b=a.stream,c=
{};a.refer.set(c);for(var e=l(b,r.TagOpenbrace),f=0;e>f;f++){var g=u(a),h=u(a);c[g]=h}return b.skip(1),c}function M(a){var b=a.stream,c=new P;a.refer.set(c);for(var e=l(b,r.TagOpenbrace),f=0;e>f;f++){var g=u(a),h=u(a);c.set(g,h)}return b.skip(1),c}function e(a){var b=a.stream,c=a.classref[l(b,r.TagOpenbrace)],e=new c.classname;a.refer.set(e);for(var f=0;f<c.count;f++)e[c.fields[f]]=u(a);return b.skip(1),e}function v(a){var b=a.stream.readByte();switch(b){case r.TagNull:return null;case r.TagClass:return L(a),
v(a);case r.TagObject:return e(a);case r.TagRef:return H(a);default:m(b)}}function L(a){for(var b=a.stream,c=E(a),e=l(b,r.TagOpenbrace),f=[],h=0;e>h;h++)f[h]=N(a);b.skip(1);c=g(c);a.classref.push({classname:c,count:e,fields:f})}function H(a){return a.refer.read(l(a.stream,r.TagSemicolon))}function J(a,b,c){z.call(this,a);this.useHarmonyMap=!!c;Object.defineProperties(this,{classref:{value:[]},refer:{value:b?Ga:new y}})}var P=b.Map,Ba=b.hprose.BytesIO,r=b.hprose.Tags,Fa=b.hprose.ClassManager;b.hprose.RawReader=
z;var Ga=Object.create(null,{set:{value:function(){}},read:{value:function(){m(r.TagRef)}},reset:{value:function(){}}});Object.defineProperties(y.prototype,{set:{value:function(a){this.ref.push(a)}},read:{value:function(a){return this.ref[a]}},reset:{value:function(){this.ref.length=0}}});J.prototype=Object.create(z.prototype);J.prototype.constructor=J;Object.defineProperties(J.prototype,{useHarmonyMap:{value:!1,writable:!0},checkTag:{value:function(a,b){b===B&&(b=this.stream.readByte());b!==a&&m(b,
a)}},checkTags:{value:function(a,b){return b===B&&(b=this.stream.readByte()),0<=a.indexOf(b)?b:void m(b,a)}},unserialize:{value:function(){return u(this)}},readInteger:{value:function(){var a;a:{a=this.stream;var b=a.readByte();switch(b){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:a=b-48;break a;case r.TagInteger:a=l(a,r.TagSemicolon);break a;default:m(b)}a=void 0}return a}},readLong:{value:function(){var a;a:{a=this.stream;var b=a.readByte();switch(b){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:a=
b-48;break a;case r.TagInteger:case r.TagLong:a=w(a);break a;default:m(b)}a=void 0}return a}},readDouble:{value:function(){return c(this.stream)}},readBoolean:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case r.TagTrue:a=!0;break a;case r.TagFalse:a=!1;break a;default:m(a)}a=void 0}return a}},readDateWithoutTag:{value:function(){return D(this)}},readDate:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case r.TagNull:a=null;break a;case r.TagDate:a=D(this);break a;case r.TagRef:a=
H(this);break a;default:m(a)}a=void 0}return a}},readTimeWithoutTag:{value:function(){return x(this)}},readTime:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case r.TagNull:a=null;break a;case r.TagTime:a=x(this);break a;case r.TagRef:a=H(this);break a;default:m(a)}a=void 0}return a}},readBytesWithoutTag:{value:function(){return q(this)}},readBytes:{value:function(){return C(this)}},readStringWithoutTag:{value:function(){return n(this)}},readString:{value:function(){return N(this)}},
readGuidWithoutTag:{value:function(){return K(this)}},readGuid:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case r.TagNull:a=null;break a;case r.TagGuid:a=K(this);break a;case r.TagRef:a=H(this);break a;default:m(a)}a=void 0}return a}},readListWithoutTag:{value:function(){return f(this)}},readList:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case r.TagNull:a=null;break a;case r.TagList:a=f(this);break a;case r.TagRef:a=H(this);break a;default:m(a)}a=void 0}return a}},
readMapWithoutTag:{value:function(){return this.useHarmonyMap?M(this):Q(this)}},readMap:{value:function(){var a;if(this.useHarmonyMap)a:{a=this.stream.readByte();switch(a){case r.TagNull:a=null;break a;case r.TagMap:a=M(this);break a;case r.TagRef:a=H(this);break a;default:m(a)}a=void 0}else a:{a=this.stream.readByte();switch(a){case r.TagNull:a=null;break a;case r.TagMap:a=Q(this);break a;case r.TagRef:a=H(this);break a;default:m(a)}a=void 0}return a}},readObjectWithoutTag:{value:function(){return e(this)}},
readObject:{value:function(){return v(this)}},reset:{value:function(){this.classref.length=0;this.refer.reset()}}});b.hprose.Reader=J})(function(){return this||(0,eval)("this")}());(function(b){function B(b,m){var a=new A;return(new h(a,m)).serialize(b),a}function m(b,h,a){return b instanceof A||(b=new A(b)),(new z(b,h,a)).unserialize()}var A=b.hprose.BytesIO,h=b.hprose.Writer,z=b.hprose.Reader;b.hprose.Formatter={serialize:function(b,h){return B(b,h).bytes},unserialize:m};b.hprose.serialize=B;b.hprose.unserialize=
m})(function(){return this||(0,eval)("this")}());(function(b){b.hprose.ResultMode={Normal:0,Serialized:1,Raw:2,RawWithEndTag:3};b.hprose.Normal=b.hprose.ResultMode.Normal;b.hprose.Serialized=b.hprose.ResultMode.Serialized;b.hprose.Raw=b.hprose.ResultMode.Raw;b.hprose.RawWithEndTag=b.hprose.ResultMode.RawWithEndTag})(function(){return this||(0,eval)("this")}());(function(b,B){function m(){}function A(h,A,K){function f(a,b){for(var c=0,d=I.length;d>c;c++)a=I[c].outputFilter(a,b);return a}function Q(a,
b){return a=f(a,b),V(a,b).then(function(a){if(b.oneway)a=void 0;else for(var c=I.length-1;0<=c;c--)a=I[c].inputFilter(a,b);return a})}function M(a,b){return fa.sendAndReceive(a,b)}function e(a,b,c,d){Ca(a,b).then(c,function(e){v(a,b,c,d)||d(e)})}function v(a,c,d,f){if(c.failswitch&&++ba>=ya.length&&(ba=0,qa=ya[ba]),c.idempotent&&0<=--c.retry){var g=500*(10-c.retry);return 10<c.retry&&(g=500),b.setTimeout(function(){e(a,c,d,f)},g),!0}return!1}function L(b){e(c,{retry:Ea,idempotent:!0,failswitch:!0,
timeout:ha,client:fa,userdata:{}},function(c){var d=null;try{var e=new a(c),f=new l(e,!0);switch(e.readByte()){case y.TagError:d=Error(f.readString());break;case y.TagFunctions:var g=f.readList();f.checkTag(y.TagEnd);ra(b,g);break;default:d=Error("Wrong Response:\r\n"+a.toString(c))}}catch(h){d=h}null!==d?ca.reject(d):ca.resolve(b)},ca.reject)}function J(a,b){return function(){return T?Ga(a,b,D(arguments),!0):u.all(arguments).then(function(c){return Ga(a,b,c,!1)})}}function P(a,b,c,d,e){if(b[d]===
B&&(b[d]={},(typeof e===x||e.constructor===Object)&&(e=[e]),Array.isArray(e)))for(var f=0;f<e.length;f++){var g=e[f];if(typeof g===x)b[d][g]=J(a,c+d+"_"+g);else for(var h in g)P(a,b[d],d+"_",h,g[h])}}function ra(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(typeof d===x)a[d]===B&&(a[d]=J(a,d));else for(var e in d)P(a,a,"",e,d[e])}}function Ba(a,b){for(var c=Math.min(a.length,b.length),d=0;c>d;++d)b[d]=a[d]}function r(b,c,d){var e=new a;e.writeByte(y.TagCall);var f=new g(e,d.simple);return f.writeString(b),
(0<c.length||d.byref)&&(f.reset(),f.writeList(c),d.byref&&f.writeBoolean(!0)),e}function Fa(a,b,c,d){return ma?u.promise(function(e,f){na.push({batch:d,name:a,args:b,context:c,resolve:e,reject:f})}):d?Da(a,b,c):S(a,b,c)}function Ga(a,b,c,d){var e=Fa;var f=d?{mode:w.Normal,byref:za,simple:Aa,onsuccess:B,onerror:B,useHarmonyMap:Z,client:fa,userdata:{}}:{mode:w.Normal,byref:za,simple:Aa,timeout:ha,retry:Ea,idempotent:wa,failswitch:Ha,oneway:!1,sync:!1,onsuccess:B,onerror:B,useHarmonyMap:Z,client:fa,
userdata:{}};if(b in a){a=a[b];for(var g in a)g in f&&(f[g]=a[g])}g=0;for(a=c.length;a>g&&typeof c[g]!==C;++g);if(g!==a){var h=c.splice(g,a-g);f.onsuccess=h[0];a=h.length;for(g=1;a>g;++g){var l=h[g];switch(typeof l){case C:f.onerror=l;break;case E:f.byref=l;break;case q:f.mode=l;break;case H:for(var n in l)n in f&&(f[n]=l[n])}}}return e(b,c,f,d)}function d(a,b,c,d){try{c.onerror?c.onerror(a,b):sa(a,b),d(b)}catch(e){d(e)}}function G(b,c,d){var f=d.args,g=d.context,h=r(d.name,f,g);h.writeByte(y.TagEnd);
e(h.bytes,g,function(e){if(g.oneway)return void b();var h=null,n=null;try{if(g.mode===w.RawWithEndTag)h=e;else if(g.mode===w.Raw)h=e.subarray(0,e.byteLength-1);else{var m=new a(e),r=new l(m,!1,g.useHarmonyMap),q=m.readByte();if(q===y.TagResult){if(h=g.mode===w.Serialized?r.readRaw():r.unserialize(),q=m.readByte(),q===y.TagArgument){r.reset();var u=r.readList();Ba(u,f);q=m.readByte()}}else q===y.TagError&&(n=Error(r.readString()),q=m.readByte());q!==y.TagEnd&&(n=Error("Wrong Response:\r\n"+a.toString(e)))}if(n)throw n;
}catch(v){n=v}n?c(n,d):b(h,d)},c)}function O(a,c,d){return 0<c.length&&c[c.length-1]&&"function"==typeof c[c.length-1].handler?u.promise(function(b,e){var f=c[c.length-1],g={name:a,args:c.slice(0,c.length-1),udata:f,invoke:G,context:d},h;for(h in f)"handler"!=h&&f.hasOwnProperty(h)&&(g[h]=f[h]);f.handler(g,b,e)}):"function"==typeof b.hprose.userdefInvoke?u.promise(function(e,f){b.hprose.userdefInvoke({name:a,args:c,udata:null,invoke:G,context:d},e,f)}):u.promise(function(b,e){G(b,e,{name:a,args:c,
context:d})})}function va(a){return function(){a&&(ma=!1,z(function(a){a.forEach(function(a){"settings"in a?Ua(a.settings).then(a.resolve,a.reject):Fa(a.name,a.args,a.context,a.batch).then(a.resolve,a.reject)})},na),na=[])}}function S(a,b,c){c.sync&&(ma=!0);var e=u.promise(function(e,f){ta(a,b,c).then(function(d){try{if(c.onsuccess)try{c.onsuccess(d,b)}catch(g){c.onerror&&c.onerror(a,g),f(g)}e(d)}catch(g){f(g)}},function(b){d(a,b,c,f)})});return e.whenComplete(va(c.sync)),e}function Da(a,b,c){return u.promise(function(d,
e){da.push({args:b,name:a,context:c,resolve:d,reject:e})})}function pa(a){var b={timeout:ha,retry:Ea,idempotent:wa,failswitch:Ha,oneway:!1,sync:!1,client:fa,userdata:{}},c;for(c in a)c in b&&(b[c]=a[c]);return b}function Pa(b,c){var d=b.reduce(function(a,b){return a.write(r(b.name,b.args,b.context)),a},new a);return d.writeByte(y.TagEnd),u.promise(function(f,g){e(d.bytes,c,function(d){if(c.oneway)return void f(b);var e=-1,h=new a(d),p=new l(h,!1),n=h.readByte();try{for(;n!==y.TagEnd;){var m=null,
r=null,q=b[++e].context.mode;if(q>=w.Raw&&(m=new a),n===y.TagResult){if(q===w.Serialized?m=p.readRaw():q>=w.Raw?(m.writeByte(y.TagResult),m.write(p.readRaw())):(p.useHarmonyMap=b[e].context.useHarmonyMap,p.reset(),m=p.unserialize()),n=h.readByte(),n===y.TagArgument){if(q>=w.Raw)m.writeByte(y.TagArgument),m.write(p.readRaw());else{p.reset();var u=p.readList();Ba(u,b[e].args)}n=h.readByte()}}else n===y.TagError&&(q>=w.Raw?(m.writeByte(y.TagError),m.write(p.readRaw())):(p.reset(),r=Error(p.readString())),
n=h.readByte());if(0>[y.TagEnd,y.TagResult,y.TagError].indexOf(n))return void g(Error("Wrong Response:\r\n"+a.toString(d)));q>=w.Raw?(q===w.RawWithEndTag&&m.writeByte(y.TagEnd),b[e].result=m.bytes):b[e].result=m;b[e].error=r}}catch(v){return void g(v)}f(b)},g)})}function Ua(a){if(a=a||{},T=!1,ma)return u.promise(function(b,c){na.push({batch:!0,settings:a,resolve:b,reject:c})});if(0!==da.length){var b=pa(a);b.sync&&(ma=!0);var c=da;da=[];var e=u.promise(function(a,e){oa(c,b).then(function(b){b.forEach(function(a){if(a.error)d(a.name,
a.error,a.context,a.reject);else try{if(a.context.onsuccess)try{a.context.onsuccess(a.result,a.args)}catch(b){a.context.onerror&&a.context.onerror(a.name,b),a.reject(b)}a.resolve(a.result)}catch(b){a.reject(b)}delete a.context;delete a.resolve;delete a.reject});a(b)},function(a){c.forEach(function(b){"reject"in b&&d(b.name,a,b.context,b.reject)});e(a)})});return e.whenComplete(va(b.sync)),e}}function Ta(){return sa}function Va(a){typeof a===C&&(sa=a)}function La(a){a&&"function"==typeof a.inputFilter&&
"function"==typeof a.outputFilter&&I.push(a)}function Ma(a,b,c){c===B&&(typeof b===E&&(c=b,b=!1),b||(typeof a===E?(c=a,a=!1):(a&&a.constructor===Object||Array.isArray(a))&&(b=a,a=!1)));var d=fa;return c&&(d={}),a||qa?(a&&(qa=a),(typeof b===x||b&&b.constructor===Object)&&(b=[b]),Array.isArray(b)?(ra(d,b),ca.resolve(d),d):(z(L,d),ca)):Error("You should set server uri first!")}function ga(a,b,c){return W[a]?(a=W[a],a[b]?a[b]:null):(c&&(W[a]=Object.create(null)),null)}function xa(a,b,c,d){if(typeof a!==
x)throw new TypeError("topic name must be a string.");if(b===B||null===b){if(typeof c!==C)throw new TypeError("callback must be a function.");b=c}if(typeof b===C)return d=c,c=b,null===ka&&(ka=ea()),void ka.then(function(b){xa(a,b,c,d)});if(typeof c!==C)throw new TypeError("callback must be a function.");if(u.isPromise(b))return void b.then(function(b){xa(a,b,c,d)});d===B&&(d=ha);var e=ga(a,b,!0);if(null===e){var f=function(){Ga(fa,a,[b,e.handler,f,{idempotent:!0,failswitch:!1,timeout:d}],!1)},e={handler:function(c){var d=
ga(a,b,!1);if(d){if(null!==c)for(var d=d.callbacks,e=0,g=d.length;g>e;++e)try{d[e](c)}catch(h){}null!==ga(a,b,!1)&&f()}},callbacks:[c]};W[a][b]=e;f()}else 0>e.callbacks.indexOf(c)&&e.callbacks.push(c)}function Wa(a,b,c){if(a)if(typeof c===C){var d=a[b];d&&(d=d.callbacks,c=d.indexOf(c),0<=c&&(d[c]=d[d.length-1],d.length--),0===d.length&&delete a[b])}else delete a[b]}function la(a,b,c){if(typeof a!==x)throw new TypeError("topic name must be a string.");if(b===B||null===b){if(typeof c!==C)return void delete W[a];
b=c}if(typeof b===C&&(c=b,b=null),null===b)if(null===ka){if(W[a]){var d=W[a];for(b in d)Wa(d,b,c)}}else ka.then(function(b){la(a,b,c)});else u.isPromise(b)?b.then(function(b){la(a,b,c)}):Wa(W[a],b,c)}function ea(){return Ga(fa,"#",[],!1)}function Za(a){F.push(a);ta=F.reduceRight(function(a,b){return function(c,d,e){try{var f=b(c,d,e,a);return u.isFuture(f)?f:u.value(f)}catch(g){return u.error(g)}}},O)}function $a(a){ia.push(a);oa=ia.reduceRight(function(a,b){return function(c,d){try{var e=b(c,d,a);
return u.isFuture(e)?e:u.value(e)}catch(f){return u.error(f)}}},Pa)}function Ia(a){ua.push(a);Ca=ua.reduceRight(function(a,b){return function(c,d){try{var e=b(c,d,a);return u.isFuture(e)?e:u.value(e)}catch(f){return u.error(f)}}},Q)}function Na(a){Ja.push(a);V=Ja.reduceRight(function(a,b){return function(c,d){try{var e=b(c,d,a);return u.isFuture(e)?e:u.value(e)}catch(f){return u.error(f)}}},M)}var qa,ya=[],ba=-1,za=!1,Aa=!1,ha=3E4,Ea=10,wa=!1,Ha=!1,ma=!1,na=[],Z=!1,sa=m,I=[],T=!1,da=[],ca=new u,W=
Object.create(null),ka=null,U=!0,ta=O,oa=Pa,Ca=Q,V=M,F=[],ia=[],ua=[],Ja=[],fa=this;ea.sync=!0;ea.idempotent=!0;ea.failswitch=!0;var Qa=Object.create(null,{begin:{value:function(){T=!0}},end:{value:Ua},use:{value:function(a){return $a(a),Qa}}}),Ra=Object.create(null,{use:{value:function(a){return Ia(a),Ra}}}),Sa=Object.create(null,{use:{value:function(a){return Na(a),Sa}}});Object.defineProperties(this,{"#":{value:ea},onError:{get:Ta,set:Va},onerror:{get:Ta,set:Va},uri:{get:function(){return qa}},
id:{get:function(){return ka}},failswitch:{get:function(){return Ha},set:function(a){Ha=!!a}},timeout:{get:function(){return ha},set:function(a){ha="number"==typeof a?0|a:0}},retry:{get:function(){return Ea},set:function(a){Ea="number"==typeof a?0|a:0}},idempotent:{get:function(){return wa},set:function(a){wa=!!a}},keepAlive:{get:function(){return U},set:function(a){U=!!a}},byref:{get:function(){return za},set:function(a){za=!!a}},simple:{get:function(){return Aa},set:function(a){Aa=!!a}},useHarmonyMap:{get:function(){return Z},
set:function(a){Z=!!a}},filter:{get:function(){return 0===I.length?null:1===I.length?I[0]:I.slice()},set:function(a){I.length=0;Array.isArray(a)?a.forEach(function(a){La(a)}):La(a)}},addFilter:{value:La},removeFilter:{value:function(a){a=I.indexOf(a);return-1===a?!1:(I.splice(a,1),!0)}},useService:{value:Ma},invoke:{value:function(a,b,c){var d=arguments.length;if(1>d||typeof a!==x)throw Error("name must be a string");if(1===d&&(b=[]),2===d&&!Array.isArray(b)){var e=[];typeof b!==C&&e.push(m);e.push(b);
b=e}if(2<d)for(typeof c!==C&&b.push(m),e=2;d>e;e++)b.push(arguments[e]);return Ga(fa,a,b,T)}},ready:{value:function(a,b){return ca.then(a,b)}},subscribe:{value:xa},unsubscribe:{value:la},use:{value:function(a){return Za(a),fa}},batch:{value:Qa},beforeFilter:{value:Ra},afterFilter:{value:Sa}});K&&typeof K===H&&"failswitch timeout retry idempotent keepAlive byref simple useHarmonyMap filter".split(" ").forEach(function(a){a in K&&(fa[a]=K[a])});typeof h===x?(ya=[h],ba=0,Ma(h,A)):Array.isArray(h)&&(ya=
h,ba=Math.floor(Math.random()*ya.length),Ma(ya[ba],A))}function h(a){var b=document.createElement("a");if(b.href=a,"http:"!==b.protocol&&"https:"!==b.protocol&&"ws:"!==b.protocol&&"wss:"!==b.protocol)throw Error("The "+b.protocol+" client isn't implemented.");}var z=b.setImmediate,y=b.hprose.Tags,w=b.hprose.ResultMode,a=b.hprose.BytesIO,g=b.hprose.Writer,l=b.hprose.Reader,u=b.hprose.Future,D=Function.prototype.call.bind(Array.prototype.slice),c=new Uint8Array(1);c[0]=y.TagEnd;var E="boolean",x="string",
q="number",C="function",H="object";Object.defineProperty(A,"create",{value:function(a,c,g){try{return b.hprose.HttpClient.create(a,c,g)}catch(f){}try{return b.hprose.WebSocketClient.create(a,c,g)}catch(f){}if("string"==typeof a)h(a);else if(Array.isArray(a))throw a.forEach(function(a){h(a)}),Error("Not support multiple protocol.");throw Error("You should set server uri first!");}});b.hprose.Client=A})(function(){return this||(0,eval)("this")}());(function(b,w){function m(){}function A(h,a,g){function l(a,
g){var h=new XMLHttpRequest;h.open("POST",q.uri,!0);b.location!==w&&"file:"!==b.location.protocol&&(h.withCredentials="true");h.responseType="arraybuffer";for(var l in c)h.setRequestHeader(l,c[l]);return h.onload=function(){h.onload=m;h.status&&(200===h.status?g.resolve(new Uint8Array(h.response)):g.reject(Error(h.status+":"+h.statusText)))},h.onerror=function(){g.reject(Error("error"))},h.upload!==w&&(h.upload.onprogress=E),h.onprogress=x,a.constructor===String||ArrayBuffer.isView?h.send(a):a.buffer.slice?
h.send(a.buffer.slice(0,a.length)):h.send(a.buffer),h}function u(a){"function"==typeof a&&(E=a)}function D(){return E}if(this.constructor!==A)return new A(h,a,g);z.call(this,h,a,g);var c=Object.create(null),E=m,x=m,q=this;Object.defineProperties(this,{onProgress:{get:D,set:u},onprogress:{get:D,set:u},onRequestProgress:{get:D,set:u},onResponseProgress:{get:function(){return x},set:function(a){"function"==typeof a&&(x=a)}},setHeader:{value:function(a,b){"content-type"!==a.toLowerCase()&&"content-length"!==
a.toLowerCase()&&(b?c[a]=b:delete c[a])}},sendAndReceive:{value:function(a,b){var c=new y,g=l(a,c);return 0<b.timeout&&(c=c.timeout(b.timeout).catchError(function(a){throw g.onload=m,g.onerror=m,g.abort(),a;},function(a){return a instanceof L})),b.oneway&&c.resolve(),c}}})}function h(b){var a=document.createElement("a");if(a.href=b,"http:"!==a.protocol&&"https:"!==a.protocol)throw Error("This client desn't support "+a.protocol+" scheme.");}var z=b.hprose.Client,y=b.hprose.Future;Object.defineProperty(A,
"create",{value:function(b,a,g){if("string"==typeof b)h(b);else{if(!Array.isArray(b))return Error("You should set server uri first!");b.forEach(function(a){h(a)})}return new A(b,a,g)}});b.hprose.HttpClient=A})(function(){return this||(0,eval)("this")}());(function(b,w){function m(){}function A(a,b,h){function u(a,b){var c=new y;c.writeInt32BE(a);b.constructor===String?c.writeString(b):c.write(b);c=c.bytes;ArrayBuffer.isView?K.send(c):c.buffer.slice?K.send(c.buffer.slice(0,c.length)):K.send(c.buffer)}
function E(a){N.resolve(a)}function c(a){a=new y(a.data);var b=a.readInt32BE(),c=J[b];if(delete J[b],c!==w&&(--C,c.resolve(a.read(a.length-4))),100>C&&0<n.length){++C;var g=n.shift();N.then(function(){u(g[0],g[1])})}0===C&&(f.keepAlive||x())}function H(a){J.forEach(function(b,c){b.reject(Error(a.code+":"+a.reason));delete J[c]});C=0;K=null}function x(){null!==K&&(K.onopen=m,K.onmessage=m,K.onclose=m,K.close())}if(this.constructor!==A)return new A(a,b,h);z.call(this,a,b,h);var q=0,C=0,J=[],n=[],N=
null,K=null,f=this;Object.defineProperties(this,{sendAndReceive:{value:function(a,b){if(null===K||K.readyState===WebSocket.CLOSING||K.readyState===WebSocket.CLOSED)N=new D,K=new WebSocket(f.uri),K.binaryType="arraybuffer",K.onopen=E,K.onmessage=c,K.onerror=m,K.onclose=H;var e=2147483647>q?++q:q=0,g=new D;return J[e]=g,0<f.timeout&&(g=g.timeout(f.timeout).catchError(function(a){throw delete J[e],--C,a;},function(a){return a instanceof L})),100>C?(++C,N.then(function(){u(e,a)})):n.push([e,a]),b.oneway&&
g.resolve(),g}},close:{value:x}})}function h(a){var b=document.createElement("a");if(b.href=a,"ws:"!==b.protocol&&"wss:"!==b.protocol)throw Error("This client desn't support "+b.protocol+" scheme.");}var z=b.hprose.Client,y=b.hprose.BytesIO,D=b.hprose.Future;Object.defineProperty(A,"create",{value:function(a,b,l){if("string"==typeof a)h(a);else{if(!Array.isArray(a))return Error("You should set server uri first!");a.forEach(function(a){h(a)})}return new A(a,b,l)}});b.hprose.WebSocketClient=A})(function(){return this||
(0,eval)("this")}());(function(b){function w(b){this.version=b||"2.0"}var m=b.hprose.Tags,A=b.hprose.BytesIO,h=b.hprose.Writer,z=b.hprose.Reader,y=1;w.prototype.inputFilter=function(b,a){var g=A.toString(b);"{"===g.charAt(0)&&(g="["+g+"]");for(var g=JSON.parse(g),l=new A,u=new h(l,!0),y=0,c=g.length;c>y;++y){var w=g[y];w.error?(l.writeByte(m.TagError),u.writeString(w.error.message)):(l.writeByte(m.TagResult),u.serialize(w.result))}return l.writeByte(m.TagEnd),l.bytes};w.prototype.outputFilter=function(b,
a){var g=[],h=new A(b),u=new z(h,!1,!1),w=h.readByte();do{var c={};w===m.TagCall&&(c.method=u.readString(),w=h.readByte(),w===m.TagList&&(c.params=u.readListWithoutTag(),w=h.readByte()),w===m.TagTrue&&(w=h.readByte()));"1.1"===this.version?c.version="1.1":"2.0"===this.version&&(c.jsonrpc="2.0");c.id=y++;g.push(c)}while(w===m.TagCall);return 1<g.length?JSON.stringify(g):JSON.stringify(g[0])};b.hprose.JSONRPCClientFilter=w})(function(){return this||(0,eval)("this")}());(function(b){b.hprose.common=
{Completer:b.hprose.Completer,Future:b.hprose.Future,ResultMode:b.hprose.ResultMode};b.hprose.io={BytesIO:b.hprose.BytesIO,ClassManager:b.hprose.ClassManager,Tags:b.hprose.Tags,RawReader:b.hprose.RawReader,Reader:b.hprose.Reader,Writer:b.hprose.Writer,Formatter:b.hprose.Formatter};b.hprose.client={Client:b.hprose.Client,HttpClient:b.hprose.HttpClient,WebSocketClient:b.hprose.WebSocketClient};b.hprose.filter={JSONRPCClientFilter:b.hprose.JSONRPCClientFilter};J(5).cmd?!(w=[],H=b.hprose,D="function"===
typeof H?H.apply(E,w):H,void 0!==D&&(P.exports=D)):J(6)&&!(w=[],D=function(){return b.hprose}.apply(E,w),void 0!==D&&(P.exports=D));"object"==typeof P&&"object"==typeof P.exports&&(P.exports=b.hprose)})(function(){return this||(0,eval)("this")}())},function(P,E){P.exports=function(){throw Error("define cannot be used indirect");}},function(P,E){(function(E){P.exports=E}).call(E,{})}]);
