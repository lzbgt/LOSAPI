(function(P){function E(M){if(J[M])return J[M].exports;var H=J[M]={exports:{},id:M,loaded:!1};P[M].call(H.exports,H,H.exports,E);H.loaded=!0;return H.exports}var J={};E.m=P;E.c=J;E.p="";return E(0)})([function(P,E,J){function M(){function a(c,b,u){c.invoke(function(a,c){var q="",e=r.some(function(a){return-1!==c.name.indexOf(a)});void 0!==c.ttl&&0>=c.ttl?(q="cache disabled",e=!1):q=e?"ttl timeout":"false";debug.log("do cache?: ",q,c.name,c.args,c.udata,a);if(!e||c.nocache||null===a)return b(a);q=
null;"string"==typeof a&&"{"==a[0]?q={__is:"string",value:JSON.parse(a)}:"object"==typeof a&&null!=a?q=Array.isArray(a)?{__is:"array",value:a}:{__is:"object",value:a}:null===a&&(q={__is:"null",value:"__null__"});e=1<c.args.length?c.args.slice(1).join(""):null;q&&e&&(q.__id=e,q.__score=0,q.__ts=Date.now(),C.db[C.table].put(q).then(function(a){},function(a){debug.warn("save to db error: ",a)}));c.skipResolve?"function"==typeof c.asyncCall&&c.asyncCall(a):b(a)},u,c)}function b(c,u,f){var h=null;r.some(function(a){return-1!==
c.name.indexOf(a)})&&(h=1<c.args.length?c.args.slice(1).join(""):null);h?C.db[C.table].get(h).then(function(b){if(b){var r=null;if("string"==b.__is)r=JSON.stringify(b.value);else{if("null"==b.__is)return a(c,u,f);r=b.value}c.background||"undefined"==typeof c.background&&C.background?(debug.log("fetching from icache.db with background enabled: ",h,r,c.name,c.args),u(r),c.skipResolve=!0,a(c,u,f)):("undefined"==typeof c.ttl?"undefined"==typeof b.__ttl&&(b.__ttl=C.DEFAULT_TTL):b.__ttl=c.ttl,b.__ttl<Date.now()-
b.__ts?a(c,u,f):(debug.log("fetching from icache.db: ",h,r,c.name,c.args),u(r)))}else a(c,u,f)},function(b){debug.log("not in icache.db, fetching from server");a(c,u,f)}):a(c,u,f)}var r=["get"],C={};window.icache=C;C.db=new k(c.AppName);var f={};C.table="icache";f[C.table]="__id,__score,__ts";try{C.db.version(2).stores(f),C.db.open()}catch(q){debug.warn("can't use indexedDB: ",q);return}C.DEFAULT_TTL=31536E6;C.handler=b;window.hprose.userdefInvoke=b;C.tools={};C.tools.makeurl=function(a,b,u,h){return"http://"+
a+"/loadres?type=text/html&AppName="+b+"&AppBid="+u+"&ip="+a+"&bid="+c.SystemBid+"&name=AppTemplate&ver=last&userid="+h}}function H(a){var c=2;if("boolean"===typeof a)a||(c=X.length);else if("number"===typeof a)c=a;else if("string"===typeof a)try{c=parseInt(a)}catch(b){c=2}a=function(){};for(var r=c;r<X.length;r++)window.debug[X[r]]=window.console[X[r]].bind(window.console);for(r=0;r<c;r++)window.debug[X[r]]=a}function x(a){var b=c.ayFE[a];return b?(debug.log("PE: seted"),b):function(b){debug.log("PE:default mark");
if(c.ayFE[a])return c.ayFE[a](b);c.ayErr[a]=b;debug.error(a+":"+b)}}function D(){return null!=c.api}function b(a){debug.log("setMain: ",a);if(c.Running)debug.warn("setMain: app running");else if("function"==typeof InitErrFunc&&InitErrFunc(),"undefined"!=typeof main)if(debug.log("main function ok run it"),c.Main=main,debug.log("isok",D),D()){c.Running=!0;for(var b=0;b<c.InitFunc.length;b++)c.InitFunc[b]();debug.log("setMain s1",M);M();debug.log("setMain s2");main();debug.log("setMain s3 main()")}else for(b in debug.log("Leither is not OK"),
c.ayErr)a=c.ayFE[b],err=c.ayErr[b],null!=err&&null!=a&&(c.ayErr[b]=null,debug.log("errReply err:",err),a(err))}function B(a,c){var b=localStorage[a];if(b)return JSON.parse(b);"undefined"!=typeof c&&(localStorage[a]=JSON.stringify(c));return c}function m(){var a=new hprose.Future,b=b||2,r=window.indexedDB.open("LeitherApi",b);c.ApptbName=c.appBid+"_"+c.AppName;debug.log(c.ApptbName);r.onerror=function(c){debug.error(c.currentTarget.error.message);a.reject(c)};r.onsuccess=function(b){debug.log("InitDb ok");
b=b.target.result;c.LeitherDb=b;a.resolve(b)};r.onupgradeneeded=function(a){a=a.target.result;a.objectStoreNames.contains("res")||a.createObjectStore("res",{keyPath:"id"});a.objectStoreNames.contains(c.ApptbName)&&a.deleteObjectStore(c.ApptbName);debug.log("DB version changed to "+b)};return a}function A(a){var b=c.LeitherDb.transaction("res","readwrite").objectStore("res"),r=new hprose.Future;request=b.get(a);request.onerror=function(a){r.reject(a)};request.onsuccess=function(a){r.resolve(a.target.result)};
return r}function g(a){var b=c.LeitherDb.transaction("res","readwrite").objectStore("res"),r=new hprose.Future;request=b.put(a);request.onerror=function(a){debug.log("setdbdata err",a);r.reject(a)};request.onsuccess=function(a){r.resolve(a.target.result);debug.log("setdbdata: ",a.target.result)};return r}function z(c,b,r){var f=new hprose.Future,g=function(a,c){var b="last";if("last"==c||"release"==c)b=a[c];return a.ResFile[b]}(JSON.parse(r),b);(function(b){for(var r=[];b<g.length;b++){var u=g[b];
""==u?debug.error("invliad key:",u):r.push(a(c,u))}hprose.Future.all(r).then(function(a){f.resolve()},function(a){debug.log(a);f.reject(a)})})(0);return f}function y(a){c.loginData=a;c.sid=a.sid;c.user=a.user;c.username=c.user.name;c.bid=null!==a.user?a.user.id:c.uid;c.leClient=c.api;c.swarm=a.swarm}function S(a){0<a.length?c.currentIP=a:a=c.currentIP;c.api=w(a);m().then(function(a){debug.log("hprose ready",a);c.api.ready(function(a){debug.log("hprose ready ok");debug.log("G.uid=",c.uid);f(a,c.AppName,
c.AppBid,c.AppVer).then(function(){var u=x("login");c.postLogin=y;"undefined"!==typeof ENABLE_UAC&&ENABLE_UAC?b("UAC enabled, must redirect to the login page first"):a.login(c.uid,c.userppt).then(function(a){debug.log("login ok");y(a);c.swarm=a.swarm;debug.log("LeitherIsOK:",D());debug.log("login ok sid=",a.sid);debug.log("user= ",a.user);debug.log("swarm=",a.swarm);debug.log("appName=",c.AppName);b("after loaded app and logedin")},u);c.Local||(debug.log("use remote files"),a.getresbyname(c.sid,c.SystemBid,
"LeitherApi",c.AppVer,{handler:icache.handler,ttl:0}).then(function(a){var c=new FileReader;c.onload=function(a){debug.log("leitherApi re get ok");localStorage.leitherApi=a.target.result};c.readAsText(new Blob([a]))}),a.hget(c.sid,c.AppBid,"applist",c.AppName,{handler:icache.handler,ttl:0}).then(function(a){debug.log("manifest re hget ok");g({id:c.AppName,data:a,tbname:c.ApptbName}).then()}))})},x("api.ready"))},x("InitDb"))}function a(a,b){var r=new hprose.Future,f=document.createElement("script");
f.type="text/javascript";A(b).then(function(k){if(k)debug.log("load js res from db: ",b,a),f.textContent=k.data,document.getElementsByTagName("head")[0].appendChild(f),r.resolve(b);else if(debug.log("check leither"),"function"==typeof D&&D()){debug.log("check leither ok");var q=function(a){debug.error(a);r.reject(b)};c.api.ready(function(k){k.get("",a,b,function(q){if(q){debug.log("load js res from server: ",b,a);var h=new FileReader;h.onload=function(a){g({id:b,data:a.target.result,tbname:c.ApptbName});
f.textContent=a.target.result;document.getElementsByTagName("head")[0].appendChild(f);r.resolve(b)};h.readAsText(new Blob([q]))}else debug.error("data is null"),r.reject(b)},q)},q)}else debug.error("leither is not ok"),r.reject(b)},function(a){debug.error(a);r.reject(a)});return r}function f(a,b,r,f){debug.log("load app name:",b,", appBid:",r);var k=new hprose.Future;if(c.Local)return debug.log("use local file"),k.resolve(),k;A(b).then(function(c){c?(debug.log("get app manifest from db successed: ",
b),z(r,f,c.data).then(function(){k.resolve()},function(a){debug.warn("LoadApp: ",a);k.reject(a)})):(debug.log("app :",b," resfiles not found in DB, fetching ... "),a.hget("",r,"applist",b).then(function(a){g({id:b,data:a,tbname:r+"_"+b});z(r,f,a).then(function(a){k.resolve()},function(a){debug.warn("LoadApp 2: ",a);k.reject(a)})}))},function(a){debug.error(a)});return k}var k=J(1);J(4);"use strict";var w=function(a){if("http://"==a.substr(0,7)){a=a.substr(7);var b=a.indexOf("/");0<b&&(a=a.substr(0,
b))}b="ws://"+a+"/ws/";-1!=navigator.userAgent.indexOf("Firefox")&&(b="http://"+a+"/webapi/");return hprose.Client.create(b,"login register getvar act setdata set get del expire hmclear hset hget hdel hlen hkeys hgetall hmset hmget exit restart lpush lpop rpush rpop lrange zadd zrange sadd scard sclear sdiff sinter smclear smembers srem sunion sendmsg readmsg pullmsg invite accept test veni sethostip proxyget createinvcode getinvcodeinfo updateinvcode deleteinvcode setinvtemplate getinvtemplate getappdownloadkey getresbyname getgshorturlkey getlshorturlkey incr zcard zcount zrem zscore zrank zrangebyscore lindex lexpire lexpireat lttl lpersist llen sendmail lset".split(" "))},
X=["log","info","warn","error"];window.debug={};window.setLog=H;var c={ayFE:{},ayErr:{},IPList:[],InitFunc:[]};window.G=c;window.LeitherIsOK=D;window.RunApp=function(a,b){if(0!=arguments.length){"undefined"===typeof a.Log?H(!1):H(a.Log);c.I=a;c.appBid=a.AppBid;c.Running=!1;c.AppVer=a.AppVer?a.AppVer:"last";debug.log("RunApp");var f;if(f=0==b)debug.log("InitCfg"),c.Local=a.Local,c.SystemBid=a.SystemBid,c.AppBid=a.AppBid,c.IPList=a.IPList&&a.IPList.length&&0<a.IPList.length?a.IPList:B(c.AppBid+"/iplist"),
c.userppt=a.userppt||B(window.location.pathname+"/"+c.AppBid+"/ppt"),c.AppName=a.AppName||B(c.AppBid+"/appname"),c.uid=a.userid||B(window.location.pathname+"/"+c.AppBid+"/uid"),f=!1;f||(c.IPList.length<=b?console.error("iplist.length [",c.IPList.length,"]<ipnum[",b,"]"):S(c.IPList[b]))}};window.RunApp()},function(P,E,J){var M;(function(H){(function(x,D,b){function B(a,d){return"object"!=typeof d&&(d=d()),Object.keys(d).forEach(function(b){a[b]=d[b]}),a}function m(a){return{from:function(d){return a.prototype=
Object.create(d.prototype),a.prototype.constructor=a,{extend:function(b){B(a.prototype,"object"!=typeof b?b(d.prototype):b)}}}}}function A(a,d){return d(a)}function g(a,wa){function pa(a){this._cfg={version:a,storesSource:null,dbschema:{},tables:{},contentUpgrade:null};this.stores({})}function N(a,c,e,h){var l,v,n,Z,ja;if(0===a)Object.keys(T).forEach(function(a){C(c,a,T[a].primKey,T[a].indexes)}),l=G._createTransaction(V,ba,T),l.idbtrans=c,l.idbtrans.onerror=p(e,["populating database"]),l.on("error").subscribe(e),
d.newPSD(function(){d.PSD.trans=l;try{G.on("populate").fire(l)}catch(a){h.onerror=c.onerror=function(a){a.preventDefault()};try{c.abort()}catch(n){}c.db.close();e(a)}});else{if(v=[],n=ca.filter(function(n){return n._cfg.version===a})[0],!n)throw new I("Dexie specification of currently installed DB version is missing");T=G._dbSchema=n._cfg.dbschema;Z=!1;n=ca.filter(function(n){return n._cfg.version>a});n.forEach(function(a){var n=T,l=a._cfg.dbschema;xa(n,c);xa(l,c);T=G._dbSchema=l;n=w(n,l);n.add.forEach(function(a){v.push(function(n,
l){C(n,a[0],a[1].primKey,a[1].indexes);l()})});n.change.forEach(function(a){if(a.recreate)throw new I("Not yet support for changing primary key");v.push(function(n,l){var v=n.objectStore(a.name);a.add.forEach(function(a){x(v,a)});a.change.forEach(function(a){v.deleteIndex(a.name);x(v,a)});a.del.forEach(function(a){v.deleteIndex(a)});l()})});a._cfg.contentUpgrade&&v.push(function(n,v){var d,b;Z=!0;d=G._createTransaction(V,[].slice.call(n.db.objectStoreNames,0),l);d.idbtrans=n;b=0;d._promise=A(d._promise,
function(a){return function(n,l,d){function c(a){return function(){a.apply(this,arguments);0==--b&&v()}}return++b,a.call(this,n,function(a,n){arguments[0]=c(a);arguments[1]=c(n);l.apply(this,arguments)},d)}});n.onerror=p(e,["running upgrader function for version",a._cfg.version]);d.on("error").subscribe(e);a._cfg.contentUpgrade(d);0===b&&v()});Z&&(0<=navigator.userAgent.indexOf("Trident")||0<=navigator.userAgent.indexOf("MSIE"))||v.push(function(a,n){for(var v,d=0;d<a.db.objectStoreNames.length;++d)v=
a.db.objectStoreNames[d],null!==l[v]&&l[v]!==b||a.db.deleteObjectStore(v);n()})});ja=function(){try{v.length?v.shift()(c,ja):va(T,c)}catch(a){h.onerror=c.onerror=function(a){a.preventDefault()};try{c.abort()}catch(n){}c.db.close();e(a)}};ja()}}function w(a,d){var b={del:[],add:[],change:[]},c,l,v,n,Z,e,p,h;for(c in a)d[c]||b.del.push(c);for(c in d)if(l=a[c],v=d[c],l)if(n={name:c,def:d[c],recreate:!1,del:[],add:[],change:[]},l.primKey.src!==v.primKey.src)n.recreate=!0,b.change.push(n);else{Z=l.indexes.reduce(function(a,
n){return a[n.name]=n,a},{});v=v.indexes.reduce(function(a,n){return a[n.name]=n,a},{});for(e in Z)v[e]||n.del.push(e);for(e in v)p=Z[e],h=v[e],p?p.src!==h.src&&n.change.push(h):n.add.push(h);(n.recreate||0<n.del.length||0<n.add.length||0<n.change.length)&&b.change.push(n)}else b.add.push([c,v]);return b}function C(a,d,b,c){var l=a.db.createObjectStore(d,b.keyPath?{keyPath:b.keyPath,autoIncrement:b.auto}:{autoIncrement:b.auto});return c.forEach(function(a){x(l,a)}),l}function va(a,d){Object.keys(a).forEach(function(b){d.db.objectStoreNames.contains(b)||
C(d,b,a[b].primKey,a[b].indexes)})}function x(a,d){a.createIndex(d.name,d.keyPath,{unique:d.unique,multiEntry:d.multi})}function D(a,d){throw new I("Table "+d[0]+" not part of transaction. Original Scope Function Source: "+g.Promise.PSD.trans.scopeFunc.toString());}function fa(a,d,b,e){this.name=a;this.schema=b;this.hook=W[a]?W[a].hook:u(null,{creating:[f,z],reading:[S,y],updating:[k,z],deleting:[c,z]});this._tpf=d;this._collClass=e||da}function ya(a,d,b,c){fa.call(this,a,d,b,c||J)}function H(a,d,
b,c){function l(a,n,l,d){return v._promise(a,l,d)}var v=this,n,Z;this.db=G;this.mode=a;this.storeNames=d;this.idbtrans=null;this.on=u(this,["complete","error"],"abort");this._reculock=0;this._blockedFuncs=[];this._psd=null;this.active=!0;this._dbschema=b;c&&(this.parent=c);this._tpf=l;this.tables=Object.create(ka);for(c=d.length-1;-1!==c;--c)n=d[c],Z=G._tableFactory(a,b[n],l),this.tables[n]=Z,this[n]||(this[n]=Z)}function la(a,d,b){this._ctx={table:a,index:":id"===d?null:d,collClass:a._collClass,
or:b}}function da(a,d){var b=null,c=null,l;if(d)try{b=d()}catch(v){c=v}l=a._ctx;this._ctx={table:l.table,index:l.index,isPrimKey:!l.index||l.table.schema.primKey.keyPath&&l.index===l.table.schema.primKey.name,range:b,op:"openCursor",dir:"next",unique:"",algorithm:null,filter:null,isMatch:null,offset:0,limit:Infinity,error:c,or:l.or}}function J(){da.apply(this,arguments)}function P(a,d){return a._cfg.version-d._cfg.version}function Ia(a,b,c,e,l,v){c.forEach(function(n){var c=G._tableFactory(e,l[n],
b);a.forEach(function(a){a[n]||(v?Object.defineProperty(a,n,{configurable:!0,enumerable:!0,get:function(){var a=d.PSD&&d.PSD.trans;return a&&a.db===G?a.tables[n]:c}}):a[n]=c)})})}function Na(a){a.forEach(function(a){for(var d in a)a[d]instanceof fa&&delete a[d]})}function qa(a,b,c,e,l,v){var n=d.PSD;v=v||y;a.onerror||(a.onerror=p(l));a.onsuccess=b?Ka(function(){var n=a.result,d;n?(d=function(){n.continue()},b(n,function(a){d=a},e,l)&&c(v(n.value),n,function(a){d=a}),d()):e()},l,n):Ka(function(){var n=
a.result,l;n?(l=function(){n.continue()},c(v(n.value),n,function(a){l=a}),l()):e()},l,n)}function za(a){var d=[];return a.split(",").forEach(function(a){a=a.trim();var b=a.replace("&","").replace("++","").replace("*",""),l=0!==b.indexOf("[")?b:a.substring(a.indexOf("[")+1,a.indexOf("]")).split("+");d.push(new ra(b,l||null,-1!==a.indexOf("&"),-1!==a.indexOf("*"),-1!==a.indexOf("++"),Array.isArray(l),-1!==l.indexOf(".")))}),d}function aa(a,d){return a<d?-1:a>d?1:0}function Aa(a,d){return a<d?1:a>d?
-1:0}function Ba(a){return function(d,b){for(var c=0,l;;){if(l=a(d[c],b[c]),0!==l)return l;if(++c,c===d.length||c===b.length)return a(d.length,b.length)}}}function ga(a,d){return a?d?function(){return a.apply(this,arguments)&&d.apply(this,arguments)}:a:d}function Ea(){if(G.verno=U.version/10,G._dbSchema=T={},ba=[].slice.call(U.objectStoreNames,0),0!==ba.length){var a=U.transaction(E(ba),"readonly");ba.forEach(function(d){for(var b,c=a.objectStore(d),l=c.keyPath,v=l&&"string"==typeof l&&-1!==l.indexOf("."),
n=new ra(l,l||"",!1,!1,!!c.autoIncrement,l&&"string"!=typeof l,v),e=[],ja=0;ja<c.indexNames.length;++ja)b=c.index(c.indexNames[ja]),v=(l=b.keyPath)&&"string"==typeof l&&-1!==l.indexOf("."),b=new ra(b.name,l,!!b.unique,!!b.multiEntry,!1,l&&"string"!=typeof l,v),e.push(b);T[d]=new Ca(d,n,e,{})});Ia([W],G._transPromiseFactory,Object.keys(T),V,T)}}function xa(a,d){for(var b,c,l,v,n=d.db.objectStoreNames,e=0;e<n.length;++e)for(b=n[e],c=d.objectStore(b),l=0;l<c.indexNames.length;++l){var ja=c.indexNames[l],
p=c.index(ja).keyPath,p="string"==typeof p?p:"["+[].slice.call(p).join("+")+"]";a[b]&&(v=a[b].idxByName[p],v&&(v.name=ja))}}var Ha=wa&&wa.addons||g.addons,ma=g.dependencies,na=ma.indexedDB,Y=ma.IDBKeyRange,sa=ma.TypeError,I=ma.Error,T=this._dbSchema={},ca=[],ba=[],W={},ka={},U=null,ta=!0,oa=null,Da=!1,V="readwrite",G=this,ha=[],ua=!0,Ja=!!M();this.version=function(a){if(U)throw new I("Cannot add version when database is open");this.verno=Math.max(this.verno,a);var d=ca.filter(function(d){return d._cfg.version===
a})[0];return d?d:(d=new pa(a),ca.push(d),ca.sort(P),d)};B(pa.prototype,{stores:function(a){var d,b;return this._cfg.storesSource=this._cfg.storesSource?B(this._cfg.storesSource,a):a,d={},ca.forEach(function(a){B(d,a._cfg.storesSource)}),b=this._cfg.dbschema={},this._parseStoresSpec(d,b),T=G._dbSchema=b,Na([W,G,ka]),Ia([ka],D,Object.keys(b),V,b),Ia([W,G,this._cfg.tables],G._transPromiseFactory,Object.keys(b),V,b,!0),ba=Object.keys(b),this},upgrade:function(a){var d=this;return F(function(){a(G._createTransaction(V,
Object.keys(d._cfg.dbschema),d._cfg.dbschema))}),this._cfg.contentUpgrade=a,this},_parseStoresSpec:function(a,d){Object.keys(a).forEach(function(b){if(null!==a[b]){var c={},l=za(a[b]),v=l.shift();if(v.multi)throw new I("Primary key cannot be multi-valued");v.keyPath&&O(c,v.keyPath,v.auto?0:v.keyPath);l.forEach(function(a){if(a.auto)throw new I("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new I("Index must have a name and cannot be an empty string");O(c,a.keyPath,a.compound?
a.keyPath.map(function(){return""}):"")});d[b]=new Ca(b,v,l,c)}})}});this._allTables=W;this._tableFactory=function(a,d,b){return"readonly"===a?new fa(d.name,b,d,da):new ya(d.name,b,d)};this._createTransaction=function(a,d,b,c){return new H(a,d,b,c)};this._transPromiseFactory=function(a,b,c){var e,l;return!ta||d.PSD&&d.PSD.letThrough?(l=G._createTransaction(a,b,T),l._promise(a,function(a,n){l.error(function(a){G.on("error").fire(a)});c(function(n){l.complete(function(){a(n)})},n,l)})):e=new d(function(d,
n){ha.push({resume:function(){var l=G._transPromiseFactory(a,b,c);e.onuncatched=l.onuncatched;l.then(d,n)}})})};this._whenReady=function(a){return R||!ta||d.PSD&&d.PSD.letThrough?new d(a):new d(function(d,b){ha.push({resume:function(){a(d,b)}})})};this.verno=0;this.open=function(){return new d(function(b,c){function e(a){try{h.transaction.abort()}catch(d){}Da=!1;oa=a;ta=!1;c(oa);ha.forEach(function(a){a.resume()});ha=[]}if(R&&b(G),U||Da)throw new I("Database already opened or being opened");var h;
try{if(oa=null,Da=!0,0<ca.length&&(ua=!1),!na)throw new I("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");if(h=ua?na.open(a):na.open(a,Math.round(10*G.verno)),!h)throw new I("IndexedDB API not available");h.onerror=p(e,["opening database",a]);h.onblocked=function(a){G.on("blocked").fire(a)};h.onupgradeneeded=Ka(function(d){var b,n;ua&&!G._allowEmptyDB?(h.onerror=function(a){a.preventDefault()},
h.transaction.abort(),h.result.close(),b=na.deleteDatabase(a),b.onsuccess=b.onerror=function(){e(new I("Database '"+a+"' doesnt exist"))}):(h.transaction.onerror=p(e),n=d.oldVersion>Math.pow(2,62)?0:d.oldVersion,N(n/10,h.transaction,e,h))},e);h.onsuccess=Ka(function(){Da=!1;U=h.result;ua?Ea():0<U.objectStoreNames.length&&xa(T,U.transaction(E(U.objectStoreNames),"readonly"));U.onversionchange=G.on("versionchange").fire;Ja||Oa(function(d){if(-1===d.indexOf(a))return d.push(a)});d.newPSD(function(){function a(){ta=
!1;ha.forEach(function(a){a.resume()});ha=[];b(G)}d.PSD.letThrough=!0;try{var v=G.on.ready.fire();v&&"function"==typeof v.then?v.then(a,function(a){U.close();U=null;e(a)}):r(a)}catch(n){e(n)}})},e)}catch(l){e(l)}})};this.close=function(){U&&(U.close(),U=null,ta=!0,oa=null)};this.delete=function(){var b=arguments;return new d(function(d,c){function e(){G.close();var b=na.deleteDatabase(a);b.onsuccess=function(){Ja||Oa(function(d){var n=d.indexOf(a);if(0<=n)return d.splice(n,1)});d()};b.onerror=p(c,
["deleting",a]);b.onblocked=function(){G.on("blocked").fire()}}if(0<b.length)throw new I("Arguments not allowed in db.delete()");Da?ha.push({resume:e}):e()})};this.backendDB=function(){return U};this.isOpen=function(){return null!==U};this.hasFailed=function(){return null!==oa};this.dynamicallyOpened=function(){return ua};this.name=a;Object.defineProperty(this,"tables",{get:function(){return Object.keys(W).map(function(a){return W[a]})}});this.on=u(this,"error","populate","blocked",{ready:[Ya,z],
versionchange:[X,z]});this.on.ready.subscribe=A(this.on.ready.subscribe,function(a){return function(d,b){function c(){return b||G.on.ready.unsubscribe(c),d.apply(this,arguments)}a.call(this,c);G.isOpen()&&(ta?ha.push({resume:c}):c())}});F(function(){G.on("populate").fire(G._createTransaction(V,ba,T));G.on("error").fire(new I)});this.transaction=function(a,b,c){function e(b,v){var p=null,h,K,f;try{if(n)throw n;p=G._createTransaction(a,Z,T,l);h=Z.map(function(a){return p.tables[a]});h.push(p);f=0;d.newPSD(function(){d.PSD.trans=
p;p.scopeFunc=c;l&&(p.idbtrans=l.idbtrans,p._promise=A(p._promise,function(a){return function(n,b,l){function v(a){return function(n){var b;return d._rootExec(function(){b=a(n);d._tickFinalize(function(){0==--f&&p.active&&(p.active=!1,p.on.complete.fire())})}),b}}return++f,a.call(this,n,function(a,n,d){return b(v(a),v(n),d)},l)}}));p.complete(function(){b(K)});p.error(function(a){p.idbtrans&&(p.idbtrans.onerror=Xa);try{p.abort()}catch(n){}l&&(l.active=!1,l.on.error.fire(a));var d=v(a);l||d||G.on.error.fire(a)});
d._rootExec(function(){K=c.apply(p,h)})});(!p.idbtrans||l&&0===f)&&p._nop()}catch(F){p&&p.idbtrans&&(p.idbtrans.onerror=Xa),p&&p.abort(),l&&l.on.error.fire(F),r(function(){v(F)||G.on("error").fire(F)})}}var l,v;b=[].slice.call(arguments,1,arguments.length-1);c=arguments[arguments.length-1];(l=d.PSD&&d.PSD.trans)&&l.db===G&&-1===a.indexOf("!")||(l=null);v=-1!==a.indexOf("?");a=a.replace("!","").replace("?","");var n=null,Z=(Array.isArray(b[0])?b.reduce(function(a,n){return a.concat(n)}):b).map(function(a){return"string"==
typeof a?a:(a instanceof fa||(n=n||new sa("Invalid type. Arguments following mode must be instances of Table or String")),a.name)});return"r"==a||"readonly"==a?a="readonly":"rw"==a||a==V?a=V:n=new I("Invalid transaction mode: "+a),l&&(n||(l&&"readonly"===l.mode&&a===V&&(v?l=null:n=n||new I("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")),l&&Z.forEach(function(a){l.tables.hasOwnProperty(a)||(v?l=null:n=n||new I("Table "+a+" not included in parent transaction. Parent Transaction function: "+
l.scopeFunc.toString()))}))),l?l._promise(a,e,"lock"):G._whenReady(e)};this.table=function(a){if(R&&ua)return new ya(a);if(!W.hasOwnProperty(a))throw new I("Table does not exist");return W[a]};B(fa.prototype,function(){function a(){throw new I("Current Transaction is READONLY");}return{_trans:function(a,d,b){return this._tpf(a,[this.name],d,b)},_idbstore:function(a,b,c){if(R)return new d(b);var l=this;return this._tpf(a,[this.name],function(a,d,c){b(a,d,c.idbtrans.objectStore(l.name),c)},c)},get:function(a,
d){var b=this;return this._idbstore("readonly",function(d,c,n){R&&d(b.schema.instanceTemplate);var e=n.get(a);e.onerror=p(c,["getting",a,"from",b.name]);e.onsuccess=function(){d(b.hook.reading.fire(e.result))}}).then(d)},where:function(a){return new la(this,a)},count:function(a){return this.toCollection().count(a)},offset:function(a){return this.toCollection().offset(a)},limit:function(a){return this.toCollection().limit(a)},reverse:function(){return this.toCollection().reverse()},filter:function(a){return this.toCollection().and(a)},
each:function(a){var d=this;return R&&a(d.schema.instanceTemplate),this._idbstore("readonly",function(b,c,v){v=v.openCursor();v.onerror=p(c,["calling","Table.each()","on",d.name]);qa(v,null,a,b,c,d.hook.reading.fire)})},toArray:function(a){var d=this;return this._idbstore("readonly",function(a,b,c){R&&a([d.schema.instanceTemplate]);var n=[];c=c.openCursor();c.onerror=p(b,["calling","Table.toArray()","on",d.name]);qa(c,null,function(a){n.push(a)},function(){a(n)},b,d.hook.reading.fire)}).then(a)},
orderBy:function(a){return new this._collClass(new la(this,a))},toCollection:function(){return new this._collClass(new la(this))},mapToClass:function(a,d){var b,c;return this.schema.mappedClass=a,b=Object.create(a.prototype),d&&e(b,d),this.schema.instanceTemplate=b,c=function(d){var n,b;if(!d)return d;n=Object.create(a.prototype);for(b in d)d.hasOwnProperty(b)&&(n[b]=d[b]);return n},this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=c,this.hook("reading",
c),a},defineClass:function(a){return this.mapToClass(g.defineClass(a),a)},add:a,put:a,"delete":a,clear:a,update:a}});m(ya).from(fa).extend(function(){return{add:function(a,d){var c=this,e=this.hook.creating.fire;return this._idbstore(V,function(l,v,n,Z){var h={},K,f,F;e!==z&&(K=d||(n.keyPath?q(a,n.keyPath):b),f=e.call(h,K,a,Z),K===b&&f!==b&&(n.keyPath?O(a,n.keyPath,f):d=f));F=d?n.add(a,d):n.add(a);F.onerror=p(function(a){if(h.onerror)h.onerror(a);return v(a)},["adding",a,"into",c.name]);F.onsuccess=
function(d){var b=n.keyPath;if(b&&O(a,b,d.target.result),h.onsuccess)h.onsuccess(d.target.result);l(F.result)}})},put:function(a,d){var c=this,e=this.hook.updating.fire;return this.hook.creating.fire!==z||e!==z?this._trans(V,function(l,v,n){var e=d||c.schema.primKey.keyPath&&q(a,c.schema.primKey.keyPath);e===b?n.tables[c.name].add(a).then(l,v):(n._lock(),a=h(a),n.tables[c.name].where(":id").equals(e).modify(function(){this.value=a}).then(function(b){return 0===b?n.tables[c.name].add(a,d):e}).finally(function(){n._unlock()}).then(l,
v))}):this._idbstore(V,function(b,v,n){var e=d?n.put(a,d):n.put(a);e.onerror=p(v,["putting",a,"into",c.name]);e.onsuccess=function(d){var c=n.keyPath;c&&O(a,c,d.target.result);b(e.result)}})},"delete":function(a){return this.hook.deleting.subscribers.length?this.where(":id").equals(a).delete():this._idbstore(V,function(d,b,c){var l=c.delete(a);l.onerror=p(b,["deleting",a,"from",c.name]);l.onsuccess=function(){d(l.result)}})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():
this._idbstore(V,function(a,d,b){var c=b.clear();c.onerror=p(d,["clearing",b.name]);c.onsuccess=function(){a(c.result)}})},update:function(a,c){if("object"!=typeof c||Array.isArray(c))throw new I("db.update(keyOrObject, modifications). modifications must be an object.");if("object"!=typeof a||Array.isArray(a))return this.where(":id").equals(a).modify(c);Object.keys(c).forEach(function(d){O(a,d,c[d])});var e=q(a,this.schema.primKey.keyPath);return e===b&&d.reject(new I("Object does not contain its primary key")),
this.where(":id").equals(e).modify(c)}}});B(H.prototype,{_lock:function(){return++this._reculock,1===this._reculock&&d.PSD&&(d.PSD.lockOwnerFor=this),this},_unlock:function(){if(0==--this._reculock)for(d.PSD&&(d.PSD.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var a=this._blockedFuncs.shift();try{a()}catch(b){}}return this},_locked:function(){return this._reculock&&(!d.PSD||d.PSD.lockOwnerFor!==this)},_nop:function(a){this.tables[this.storeNames[0]].get(0).then(a)},_promise:function(a,
b,c){var e=this;return d.newPSD(function(){var l;return e._locked()?l=new d(function(d,n){e._blockedFuncs.push(function(){e._promise(a,b,c).then(d,n)})}):(l=e.active?new d(function(d,n){if(!e.idbtrans&&a){if(!U)throw oa?new I("Database not open. Following error in populate, ready or upgrade function made Dexie.open() fail: "+oa):new I("Database not open");var l=e.idbtrans=U.transaction(E(e.storeNames),e.mode);l.onerror=function(a){e.on("error").fire(a&&a.target.error);a.preventDefault();e.abort()};
l.onabort=function(a){r(function(){e.on("error").fire(new I("Transaction aborted for unknown reason"))});e.active=!1;e.on("abort").fire(a)};l.oncomplete=function(a){e.active=!1;e.on("complete").fire(a)}}c&&e._lock();try{b(d,n,e)}catch(p){g.ignoreTransaction(function(){e.on("error").fire(p)}),e.abort(),n(p)}}):d.reject(ia(new I("Transaction is inactive. Original Scope Function Source: "+e.scopeFunc.toString()))),e.active&&c&&l.finally(function(){e._unlock()})),l.onuncatched=function(a){g.ignoreTransaction(function(){e.on("error").fire(a)});
e.abort()},l})},complete:function(a){return this.on("complete",a)},error:function(a){return this.on("error",a)},abort:function(){if(this.idbtrans&&this.active)try{this.active=!1,this.idbtrans.abort(),this.on.error.fire(new I("Transaction Aborted"))}catch(a){}},table:function(a){if(!this.tables.hasOwnProperty(a))throw new I("Table "+a+" not in transaction");return this.tables[a]}});B(la.prototype,function(){function a(d,b){try{throw b;}catch(c){d._ctx.error=c}return d}function d(a){return Array.prototype.slice.call(1===
a.length&&Array.isArray(a[0])?a[0]:a)}function b(a){return"next"===a?function(a){return a.toUpperCase()}:function(a){return a.toLowerCase()}}function c(a){return"next"===a?function(a){return a.toLowerCase()}:function(a){return a.toUpperCase()}}function l(a,d,b,c,l,e){for(var v,p=Math.min(a.length,c.length),h=-1,K=0;K<p;++K){if(v=d[K],v!==c[K])return 0>l(a[K],b[K])?a.substr(0,K)+b[K]+b.substr(K+1):0>l(a[K],c[K])?a.substr(0,K)+c[K]+b.substr(K+1):0<=h?a.substr(0,h)+d[h]+b.substr(h+1):null;0>l(a[K],v)&&
(h=K)}return p<c.length&&"next"===e?a+b.substr(a.length):p<a.length&&"prev"===e?a.substr(0,b.length):0>h?null:a.substr(0,h)+c[h]+b.substr(h+1)}function e(a,d,v){function p(a){h=b(a);K=c(a);f="next"===a?aa:Aa;F=h(v);q=K(v);r=a}var h,K,f,F,q,r;p("next");a._ondirectionchange=function(a){p(a)};a._addAlgorithm(function(a,b,c){var n=a.key,e,v;return"string"!=typeof n?!1:(e=K(n),d(e,q)?(b(function(){a.continue()}),!0):(v=l(n,e,F,q,f,r),v?b(function(){a.continue(v)}):b(c),!1))})}return{between:function(a,
d,b,c){return(b=!1!==b,c=!0===c,a>d||!(a!==d||!b&&!c||b&&c))?(new this._ctx.collClass(this,function(){return Y.only(a)})).limit(0):new this._ctx.collClass(this,function(){return Y.bound(a,d,!b,!c)})},equals:function(a){return new this._ctx.collClass(this,function(){return Y.only(a)})},above:function(a){return new this._ctx.collClass(this,function(){return Y.lowerBound(a,!0)})},aboveOrEqual:function(a){return new this._ctx.collClass(this,function(){return Y.lowerBound(a)})},below:function(a){return new this._ctx.collClass(this,
function(){return Y.upperBound(a,!0)})},belowOrEqual:function(a){return new this._ctx.collClass(this,function(){return Y.upperBound(a)})},startsWith:function(d){return"string"!=typeof d?a(new this._ctx.collClass(this),new sa("String expected")):this.between(d,d+String.fromCharCode(65535),!0,!0)},startsWithIgnoreCase:function(d){if("string"!=typeof d)return a(new this._ctx.collClass(this),new sa("String expected"));if(""===d)return this.startsWith(d);var b=new this._ctx.collClass(this,function(){return Y.bound(d.toUpperCase(),
d.toLowerCase()+String.fromCharCode(65535))});return e(b,function(a,d){return 0===a.indexOf(d)},d),b._ondirectionchange=function(){a(b,new I("reverse() not supported with WhereClause.startsWithIgnoreCase()"))},b},equalsIgnoreCase:function(d){if("string"!=typeof d)return a(new this._ctx.collClass(this),new sa("String expected"));var b=new this._ctx.collClass(this,function(){return Y.bound(d.toUpperCase(),d.toLowerCase())});return e(b,function(a,d){return a===d},d),b},anyOf:function(){var a=this._ctx,
b=a.table.schema,c=(a=a.index?b.idxByName[a.index]:b.primKey)&&a.compound,l=d(arguments),e=c?Ba(aa):aa,v,p;return(l.sort(e),0===l.length)?(new this._ctx.collClass(this,function(){return Y.only("")})).limit(0):(v=new this._ctx.collClass(this,function(){return Y.bound(l[0],l[l.length-1])}),v._ondirectionchange=function(a){e="next"===a?aa:Aa;c&&(e=Ba(e));l.sort(e)},p=0,v._addAlgorithm(function(a,d,b){for(var c=a.key;0<e(c,l[p]);)if(++p,p===l.length)return d(b),!1;return 0===e(c,l[p])?(d(function(){a.continue()}),
!0):(d(function(){a.continue(l[p])}),!1)}),v)},notEqual:function(a){return this.below(a).or(this._ctx.index).above(a)},noneOf:function(){var a=this._ctx,b=a.table.schema,b=(b=a.index?b.idxByName[a.index]:b.primKey)&&b.compound,c=d(arguments),l,e,v,p;return 0===c.length?new this._ctx.collClass(this):(l=b?Ba(aa):aa,c.sort(l),e=c.reduce(function(a,d){return a?a.concat([[a[a.length-1][1],d]]):[[null,d]]},null),e.push([c[c.length-1],null]),v=this,p=a.index,e.reduce(function(a,d){return a?null===d[1]?a.or(p).above(d[0]):
a.or(p).between(d[0],d[1],!1,!1):v.below(d[1])},null))},startsWithAnyOf:function(){function b(a){return a>v[h]}function c(a){return a<e[h]}var l=this._ctx,e=d(arguments),v,p,h,K,f;return e.every(function(a){return"string"==typeof a})?0===e.length?(new l.collClass(this,function(){return Y.only("")})).limit(0):(v=e.map(function(a){return a+String.fromCharCode(65535)}),p=aa,e.sort(p),h=0,K=b,f=new l.collClass(this,function(){return Y.bound(e[0],e[e.length-1]+String.fromCharCode(65535))}),f._ondirectionchange=
function(a){"next"===a?(K=b,p=aa):(K=c,p=Aa);e.sort(p);v.sort(p)},f._addAlgorithm(function(a,d,b){for(var c=a.key;K(c);)if(++h,h===e.length)return d(b),!1;return c>=e[h]&&c<=v[h]?(d(function(){a.continue()}),!0):(d(function(){p===aa?a.continue(e[h]):a.continue(v[h])}),!1)}),f):a(new l.collClass(this),new sa("startsWithAnyOf() only works with strings"))}}});B(da.prototype,function(){function a(d,b){d.filter=ga(d.filter,b)}function b(a,d){a.isMatch=ga(a.isMatch,d)}function c(a,d){if(a.isPrimKey)return d;
var b=a.table.schema.idxByName[a.index];if(!b)throw new I("KeyPath "+a.index+" on object store "+d.name+" is not indexed");return a.isPrimKey?d:d.index(b.name)}function e(a,d){return c(a,d)[a.op](a.range||null,a.dir+a.unique)}function l(a,d,b,c,l){a.or?function(){function p(){2==++F&&b()}function h(a,b,e){if(!K||K(b,e,p,c)){var l=b.primaryKey.toString();f.hasOwnProperty(l)||(f[l]=!0,d(a,b,e))}}var K=a.filter,f={},F=0;a.or._iterate(h,p,c,l);qa(e(a,l),a.algorithm,h,p,c,a.table.hook.reading.fire)}():
qa(e(a,l),ga(a.algorithm,a.filter),d,b,c,a.table.hook.reading.fire)}return{_read:function(a,d){var b=this._ctx;return b.error?b.table._trans(null,function(a,d){d(b.error)}):b.table._idbstore("readonly",a).then(d)},_write:function(a){var d=this._ctx;return d.error?d.table._trans(null,function(a,b){b(d.error)}):d.table._idbstore(V,a,"locked")},_addAlgorithm:function(a){var d=this._ctx;d.algorithm=ga(d.algorithm,a)},_iterate:function(a,d,b,c){return l(this._ctx,a,d,b,c)},each:function(a){var d=this._ctx;
return R&&a(d.table.schema.instanceTemplate),this._read(function(b,c,e){l(d,a,b,c,e)})},count:function(a){var b,e,h;return R?d.resolve(0).then(a):(b=this,e=this._ctx,e.filter||e.algorithm||e.or?(h=0,this._read(function(a,d,b){l(e,function(){return++h,!1},function(){a(h)},d,b)},a)):this._read(function(a,d,l){l=c(e,l);l=e.range?l.count(e.range):l.count();l.onerror=p(d,["calling","count()","on",b.name]);l.onsuccess=function(d){a(Math.min(d.target.result,Math.max(0,e.limit-e.offset)))}},a))},sortBy:function(a,
d){function b(a,d){return d?b(a[e[d]],d-1):a[l]}function c(a,d){var e=b(a,p),l=b(d,p);return e<l?-h:e>l?h:0}var e=a.split(".").reverse(),l=e[0],p=e.length-1,h="next"===this._ctx.dir?1:-1;return this.toArray(function(a){return a.sort(c)}).then(d)},toArray:function(a){var d=this._ctx;return this._read(function(a,b,c){R&&a([d.table.schema.instanceTemplate]);var e=[];l(d,function(a){e.push(a)},function(){a(e)},b,c)},a)},offset:function(d){var b=this._ctx;return 0>=d?this:(b.offset+=d,b.or||b.algorithm||
b.filter?a(b,function(){return 0>--d}):a(b,function(a,b){return 0===d?!0:1===d?(--d,!1):(b(function(){a.advance(d);d=0}),!1)}),this)},limit:function(d){return this._ctx.limit=Math.min(this._ctx.limit,d),a(this._ctx,function(a,b,c){return 0>=--d&&b(c),0<=d}),this},until:function(d,b){var c=this._ctx;return R&&d(c.table.schema.instanceTemplate),a(this._ctx,function(a,c,e){return d(a.value)?(c(e),b):!0}),this},first:function(a){return this.limit(1).toArray(function(a){return a[0]}).then(a)},last:function(a){return this.reverse().first(a)},
and:function(d){return R&&d(this._ctx.table.schema.instanceTemplate),a(this._ctx,function(a){return d(a.value)}),b(this._ctx,d),this},or:function(a){return new la(this._ctx.table,a,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(a){var d=this._ctx;return R&&a(q(this._ctx.table.schema.instanceTemplate,this._ctx.index?this._ctx.table.schema.idxByName[this._ctx.index].keyPath:
this._ctx.table.schema.primKey.keyPath)),d.isPrimKey||(d.op="openKeyCursor"),this.each(function(d,b){a(b.key,b)})},eachUniqueKey:function(a){return this._ctx.unique="unique",this.eachKey(a)},keys:function(a){var b=this._ctx,c;return(b.isPrimKey||(b.op="openKeyCursor"),c=[],R)?(new d(this.eachKey.bind(this))).then(function(a){return[a]}).then(a):this.each(function(a,d){c.push(d.key)}).then(function(){return c}).then(a)},uniqueKeys:function(a){return this._ctx.unique="unique",this.keys(a)},firstKey:function(a){return this.limit(1).keys(function(a){return a[0]}).then(a)},
lastKey:function(a){return this.reverse().firstKey(a)},distinct:function(){var d={};return a(this._ctx,function(a){a=a.primaryKey.toString();var b=d.hasOwnProperty(a);return d[a]=!0,!b}),this}}});m(J).from(da).extend({modify:function(a){var d=this,b=this._ctx,c=b.table.hook,e=c.updating.fire,v=c.deleting.fire;return R&&"function"==typeof a&&a.call({value:b.table.schema.instanceTemplate},b.table.schema.instanceTemplate),this._write(function(c,K,f,F){function r(a){return a&&(w.push(a),C.push(X)),K(new t("Error modifying one or more objects",
w,u,C))}function wa(){R&&u+w.length===k&&(0<w.length?r():c(u))}var ia,pa,g,N;"function"==typeof a?ia=e===z&&v===z?a:function(d){var b=h(d),c,n;if(!1===a.call(this,d))return!1;this.hasOwnProperty("value")?(c=Q(b,this.value),n=e.call(this,c,this.primKey,b,F),n&&(d=this.value,Object.keys(n).forEach(function(a){O(d,a,n[a])}))):v.call(this,this.primKey,d,F)}:e===z?(pa=Object.keys(a),g=pa.length,ia=function(d){for(var b,c,e=!1,l=0;l<g;++l)b=pa[l],c=a[b],q(d,b)!==c&&(O(d,b,c),e=!0);return e}):(N=a,a=L(N),
ia=function(d){var b=!1,c=e.call(this,a,this.primKey,h(d),F);return c&&B(a,c),Object.keys(a).forEach(function(c){var e=a[c];q(d,c)!==e&&(O(d,c,e),b=!0)}),c&&(a=L(N)),b});var k=0,u=0,R=!1,w=[],C=[],X=null;d._iterate(function(a,d){var c,e,l;if(X=d.primaryKey,c={primKey:d.primaryKey,value:a},!1!==ia.call(c,a))l=(e=!c.hasOwnProperty("value"))?d.delete():d.update(c.value),++k,l.onerror=p(function(a){if(w.push(a),C.push(c.primKey),c.onerror)c.onerror(a);return wa(),!0},e?["deleting",a,"from",b.table.name]:
["modifying",a,"on",b.table.name]),l.onsuccess=function(){if(c.onsuccess)c.onsuccess(c.value);++u;wa()};else if(c.onsuccess)c.onsuccess(c.value)},function(){R=!0;wa()},r,f)})},"delete":function(){return this.modify(function(){delete this.value})}});B(this,{Collection:da,Table:fa,Transaction:H,Version:pa,WhereClause:la,WriteableCollection:J,WriteableTable:ya});(function(){G.on("versionchange",function(){G.close();G.on("error").fire(new I("Database version changed by other database connection."))})})();
Ha.forEach(function(a){a(G)})}function z(){}function y(a){return a}function S(a,d){return a===y?d:function(b){return d(a(b))}}function a(a,d){return function(){a.apply(this,arguments);d.apply(this,arguments)}}function f(d,c){return d===z?c:function(){var e=d.apply(this,arguments),p,h,f;return e!==b&&(arguments[0]=e),p=this.onsuccess,h=this.onerror,delete this.onsuccess,delete this.onerror,f=c.apply(this,arguments),p&&(this.onsuccess=this.onsuccess?a(p,this.onsuccess):p),h&&(this.onerror=this.onerror?
a(h,this.onerror):h),f!==b?f:e}}function k(d,c){return d===z?c:function(){var e=d.apply(this,arguments),p,h,f;return e!==b&&B(arguments[0],e),p=this.onsuccess,h=this.onerror,delete this.onsuccess,delete this.onerror,f=c.apply(this,arguments),p&&(this.onsuccess=this.onsuccess?a(p,this.onsuccess):p),h&&(this.onerror=this.onerror?a(h,this.onerror):h),e===b?f===b?b:f:f===b?e:B(e,f)}}function w(a,d){return a===z?d:function(){return!1===a.apply(this,arguments)?!1:d.apply(this,arguments)}}function X(a,d){return a===
z?d:function(){return!1===d.apply(this,arguments)?!1:a.apply(this,arguments)}}function c(a,d){return a===z?d:function(){a.apply(this,arguments);d.apply(this,arguments)}}function Ya(a,d){return a===z?d:function(){var b=a.apply(this,arguments),c,e;return b&&"function"==typeof b.then?(c=this,e=arguments,b.then(function(){return d.apply(c,e)})):d.apply(this,arguments)}}function u(a){function d(a,e,f){if(Array.isArray(a))return c(a);if("object"==typeof a)return b(a);e||(e=w);f||(f=z);var F={subscribers:[],
fire:f,subscribe:function(a){F.subscribers.push(a);F.fire=e(F.fire,a)},unsubscribe:function(a){F.subscribers=F.subscribers.filter(function(d){return d!==a});F.fire=F.subscribers.reduce(e,f)}};return p[a]=h[a]=F,F}function b(a){Object.keys(a).forEach(function(b){var c=a[b],e;if(Array.isArray(c))d(b,a[b][0],a[b][1]);else if("asap"===c)e=d(b,null,function(){var a=arguments;e.subscribers.forEach(function(d){r(function(){d.apply(x,a)})})}),e.subscribe=function(a){-1===e.subscribers.indexOf(a)&&e.subscribers.push(a)},
e.unsubscribe=function(a){a=e.subscribers.indexOf(a);-1!==a&&e.subscribers.splice(a,1)};else throw Error("Invalid event config");})}function c(a){function b(){if(e)return!1;e=!0}var e=!1;a.forEach(function(a){d(a).subscribe(b)})}var e=arguments,p={},h=function(d,b){if(b){var c=[].slice.call(arguments,1),e=p[d];return e.subscribe.apply(e,c),a}if("string"==typeof d)return p[d]},f,F;h.addEventType=d;f=1;for(F=e.length;f<F;++f)d(e[f]);return h}function r(a){x.setImmediate?H(a):setTimeout(a,0)}function C(a){a=
setTimeout(a,1E3);clearTimeout(a)}function Ka(a,b,c){return function(){var e=d.PSD;d.PSD=c;try{a.apply(this,arguments)}catch(p){b(p)}finally{d.PSD=e}}}function q(a,d){var c,e,p,h;if(a.hasOwnProperty(d))return a[d];if(!d)return a;if("string"!=typeof d){c=[];e=0;for(p=d.length;e<p;++e)h=q(a,d[e]),c.push(h);return c}return(c=d.indexOf("."),-1!==c)?(e=a[d.substr(0,c)],e===b?b:q(e,d.substr(c+1))):b}function O(a,d,c){var e,p,h,f;if(a&&d!==b)if("string"!=typeof d&&"length"in d){if(!("string"!=typeof c&&
"length"in c))throw Error("Assertion failed");e=0;for(p=d.length;e<p;++e)O(a,d[e],c[e])}else e=d.indexOf("."),-1!==e?(p=d.substr(0,e),h=d.substr(e+1),""===h?c===b?delete a[p]:a[p]=c:(f=a[p],f||(f=a[p]={}),O(f,h,c))):c===b?delete a[d]:a[d]=c}function L(a){var d={},b;for(b in a)a.hasOwnProperty(b)&&(d[b]=a[b]);return d}function h(a){var d,b,c;if(!a||"object"!=typeof a)return a;if(Array.isArray(a))for(d=[],b=0,c=a.length;b<c;++b)d.push(h(a[b]));else if(a instanceof Date)d=new Date,d.setTime(a.getTime());
else for(b in d=a.constructor?Object.create(a.constructor.prototype):{},a)a.hasOwnProperty(b)&&(d[b]=h(a[b]));return d}function Q(a,d){var c={},e;for(e in a)a.hasOwnProperty(e)&&(d.hasOwnProperty(e)?a[e]!==d[e]&&JSON.stringify(a[e])!=JSON.stringify(d[e])&&(c[e]=d[e]):c[e]=b);for(e in d)d.hasOwnProperty(e)&&!a.hasOwnProperty(e)&&(c[e]=d[e]);return c}function N(a){if("function"==typeof a)return new a;if(Array.isArray(a))return[N(a[0])];if(a&&"object"==typeof a){var d={};return e(d,a),d}return a}function e(a,
d){Object.keys(d).forEach(function(b){var c=N(d[b]);a[b]=c})}function p(a,d){return function(b){var c=b&&b.target.error||Error(),e;return d&&(e=" occurred when "+d.map(function(a){switch(typeof a){case "function":return a();case "string":return a;default:return JSON.stringify(a)}}).join(" "),c.name?c.toString=function(){return c.name+e+(c.message?". "+c.message:"")}:c+=e),a(c),b&&(b.stopPropagation&&b.stopPropagation(),b.preventDefault&&b.preventDefault()),!1}}function ia(a){try{throw a;}catch(d){return d}}
function Xa(a){a.preventDefault()}function Oa(a){var d,b=g.dependencies.localStorage;if(!b)return a([]);try{d=JSON.parse(b.getItem("Dexie.DatabaseNames")||"[]")}catch(c){d=[]}a(d)&&b.setItem("Dexie.DatabaseNames",JSON.stringify(d))}function ra(a,d,b,c,e,p,h){this.name=a;this.keyPath=d;this.unique=b;this.multi=c;this.auto=e;this.compound=p;this.dotted=h;a="string"==typeof d?d:d&&"["+[].join.call(d,"+")+"]";this.src=(b?"&":"")+(c?"*":"")+(e?"++":"")+a}function Ca(a,d,b,c){this.name=a;this.primKey=d||
new ra;this.indexes=b||[new ra];this.instanceTemplate=c;this.mappedClass=null;this.idxByName=b.reduce(function(a,d){return a[d.name]=d,a},{})}function t(a,d,b,c){this.name="ModifyError";this.failures=d;this.failedKeys=c;this.successCount=b;this.message=d.join("\n")}function E(a){return 1===a.length?a[0]:a}function M(){var a=g.dependencies.indexedDB,d=a&&(a.getDatabaseNames||a.webkitGetDatabaseNames);return d&&d.bind(a)}var d=function(){function a(d){Q.push([d,r.call(arguments,1)])}function d(){var a=
Q,b,c,e;Q=[];b=0;for(c=a.length;b<c;++b)e=a[b],e[0].apply(x,e[1])}function b(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._value=this._state=null;this._deferreds=[];this._catched=!1;var d=this,c=!0;this._PSD=b.PSD;try{q(this,a,function(a){c?g(p,d,a):p(d,a)},function(a){return c?(g(h,d,a),!1):h(d,a)})}finally{c=!1}}function c(p,h){var f,F,q,r,t,u;if(null===p._state)p._deferreds.push(h);else{if(f=
p._state?h.onFulfilled:h.onRejected,null===f)return(p._state?h.resolve:h.reject)(p._value);q=N;N=!1;g=a;try{r=b.PSD,b.PSD=p._PSD,F=f(p._value),p._state||F&&"function"==typeof F.then&&!1===F._state||e(p),h.resolve(F)}catch(w){if(t=h.reject(w),!t&&p.onuncatched)try{p.onuncatched(w)}catch(R){}}finally{if(b.PSD=r,q){do{for(;0<Q.length;)d();if(u=k.pop(),u)try{u()}catch(w){}}while(0<k.length||0<Q.length);g=ia;N=!0}}}}function e(a){a._catched=!0;a._parent&&e(a._parent)}function p(a,d){var c=b.PSD;b.PSD=
a._PSD;try{if(d===a)throw new TypeError("A promise cannot be resolved with itself.");!d||"object"!=typeof d&&"function"!=typeof d||"function"!=typeof d.then?(a._state=!0,a._value=d,f.call(a)):q(a,function(a,b){d.then(a,b)},function(d){p(a,d)},function(d){h(a,d)})}catch(e){h(e)}finally{b.PSD=c}}function h(a,d){var c=b.PSD;if(b.PSD=a._PSD,a._state=!1,a._value=d,f.call(a),!a._catched)try{if(a.onuncatched)a.onuncatched(a._value);b.on.error.fire(a._value)}catch(e){}return b.PSD=c,a._catched}function f(){for(var a=
0,d=this._deferreds.length;a<d;a++)c(this,this._deferreds[a]);this._deferreds=[]}function F(a,d,b,c){this.onFulfilled="function"==typeof a?a:null;this.onRejected="function"==typeof d?d:null;this.resolve=b;this.reject=c}function q(a,d,b,c){var e=!1;try{d(function(a){e||(e=!0,b(a))},function(d){return e?a._catched:(e=!0,c(d))})}catch(p){return e?void 0:c(p)}}var r=[].slice,ia="undefined"==typeof H?function(a){var d=arguments;setTimeout(function(){a.apply(x,r.call(d,1))},0)}:H;C(function(){ia=g=a=function(a){var d=
arguments;setTimeout(function(){a.apply(x,r.call(d,1))},0)}});var g=ia,N=!0,Q=[],k=[];return b.on=u(null,"error"),b.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&Array.isArray(arguments[0])?arguments[0]:arguments);return new b(function(d,b){function c(p,h){try{if(h&&("object"==typeof h||"function"==typeof h)){var f=h.then;if("function"==typeof f){f.call(h,function(a){c(p,a)},b);return}}a[p]=h;0==--e&&d(a)}catch(F){b(F)}}var e,p;if(0===a.length)return d([]);e=a.length;for(p=
0;p<a.length;p++)c(p,a[p])})},b.prototype.then=function(a,d){var e=this,p=new b(function(b,p){null===e._state?c(e,new F(a,d,b,p)):g(c,e,new F(a,d,b,p))});return p._PSD=this._PSD,p.onuncatched=this.onuncatched,p._parent=this,p},b.prototype._then=function(a,d){c(this,new F(a,d,z,z))},b.prototype["catch"]=function(a){if(1===arguments.length)return this.then(null,a);var d=arguments[0],c=arguments[1];return"function"==typeof d?this.then(null,function(a){return a instanceof d?c(a):b.reject(a)}):this.then(null,
function(a){return a&&a.name===d?c(a):b.reject(a)})},b.prototype["finally"]=function(a){return this.then(function(d){return a(),d},function(d){return a(),b.reject(d)})},b.prototype.onuncatched=null,b.resolve=function(a){var d=new b(function(){});return d._state=!0,d._value=a,d},b.reject=function(a){var d=new b(function(){});return d._state=!1,d._value=a,d},b.race=function(a){return new b(function(d,b){a.map(function(a){a.then(d,b)})})},b.PSD=null,b.newPSD=function(a){var d=b.PSD;b.PSD=d?Object.create(d):
{};try{return a()}finally{b.PSD=d}},b._rootExec=function(b){var c=N,e;N=!1;g=a;try{b()}finally{if(c){do{for(;0<Q.length;)d();if(e=k.pop(),e)try{e()}catch(p){}}while(0<k.length||0<Q.length);g=ia;N=!0}}},b._tickFinalize=function(a){if(N)throw Error("Not in a virtual tick");k.push(a)},b}(),F=function(){},R=!1,va;m(t).from(Error);g.delete=function(a){var d=new g(a);a=d.delete();return a.onblocked=function(a){d.on("blocked",a);return this},a};g.exists=function(a){return(new g(a)).open().then(function(a){return a.close(),
!0},function(){return!1})};g.getDatabaseNames=function(a){return(new d(function(a,d){var b=M(),c;b?(c=b(),c.onsuccess=function(d){a([].slice.call(d.target.result,0))},c.onerror=p(d)):Oa(function(d){return a(d),!1})})).then(a)};g.defineClass=function(a){return function(d){d?B(this,d):R&&e(this,a)}};g.ignoreTransaction=function(a){return d.newPSD(function(){return d.PSD.trans=null,a()})};g.spawn=function(){return x.console&&console.warn("Dexie.spawn() is deprecated. Use Dexie.ignoreTransaction() instead."),
g.ignoreTransaction.apply(this,arguments)};g.vip=function(a){return d.newPSD(function(){return d.PSD.letThrough=!0,a()})};Object.defineProperty(g,"currentTransaction",{get:function(){return d.PSD&&d.PSD.trans||null}});g.Promise=d;g.derive=m;g.extend=B;g.override=A;g.events=u;g.getByKeyPath=q;g.setByKeyPath=O;g.delByKeyPath=function(a,d){"string"==typeof d?O(a,d,b):"length"in d&&[].map.call(d,function(d){O(a,d,b)})};g.shallowClone=L;g.deepClone=h;g.addons=[];g.fakeAutoComplete=F;g.asap=r;g.ModifyError=
t;g.MultiModifyError=t;g.IndexSpec=ra;g.TableSchema=Ca;va=x.idbModules&&x.idbModules.shimIndexedDB?x.idbModules:{};g.dependencies={indexedDB:va.shimIndexedDB||x.indexedDB||x.mozIndexedDB||x.webkitIndexedDB||x.msIndexedDB,IDBKeyRange:va.IDBKeyRange||x.IDBKeyRange||x.webkitIDBKeyRange,IDBTransaction:va.IDBTransaction||x.IDBTransaction||x.webkitIDBTransaction,Error:x.Error||String,SyntaxError:x.SyntaxError||String,TypeError:x.TypeError||String,DOMError:x.DOMError||String,localStorage:null!=("undefined"!=
typeof chrome&&null!==chrome?chrome.storage:void 0)?null:x.localStorage};g.version=1.2;D("Dexie",g);C(function(){g.fakeAutoComplete=F=C;g.fake=R=!0})}).apply(null,[self||window,function(x,D){!(M=function(){return D}.call(E,J,E,P),void 0!==M&&(P.exports=M))}])}).call(E,J(2).setImmediate)},function(P,E,J){(function(M,H){function x(b,m){this._id=b;this._clearFn=m}var D=J(3).nextTick,b=Function.prototype.apply,B=Array.prototype.slice,m={},A=0;E.setTimeout=function(){return new x(b.call(setTimeout,window,
arguments),clearTimeout)};E.setInterval=function(){return new x(b.call(setInterval,window,arguments),clearInterval)};E.clearTimeout=E.clearInterval=function(b){b.close()};x.prototype.unref=x.prototype.ref=function(){};x.prototype.close=function(){this._clearFn.call(window,this._id)};E.enroll=function(b,m){clearTimeout(b._idleTimeoutId);b._idleTimeout=m};E.unenroll=function(b){clearTimeout(b._idleTimeoutId);b._idleTimeout=-1};E._unrefActive=E.active=function(b){clearTimeout(b._idleTimeoutId);var m=
b._idleTimeout;0<=m&&(b._idleTimeoutId=setTimeout(function(){b._onTimeout&&b._onTimeout()},m))};E.setImmediate="function"===typeof M?M:function(b){var z=A++,y=2>arguments.length?!1:B.call(arguments,1);m[z]=!0;D(function(){m[z]&&(y?b.apply(null,y):b.call(null),E.clearImmediate(z))});return z};E.clearImmediate="function"===typeof H?H:function(b){delete m[b]}}).call(E,J(2).setImmediate,J(2).clearImmediate)},function(P,E){function J(){B=!1;m.length?b=m.concat(b):A=-1;b.length&&M()}function M(){if(!B){var g=
setTimeout(J);B=!0;for(var z=b.length;z;){m=b;for(b=[];++A<z;)m&&m[A].run();A=-1;z=b.length}m=null;B=!1;clearTimeout(g)}}function H(b,m){this.fun=b;this.array=m}function x(){}var D=P.exports={},b=[],B=!1,m,A=-1;D.nextTick=function(g){var m=Array(arguments.length-1);if(1<arguments.length)for(var y=1;y<arguments.length;y++)m[y-1]=arguments[y];b.push(new H(g,m));1!==b.length||B||setTimeout(M,0)};H.prototype.run=function(){this.fun.apply(null,this.array)};D.title="browser";D.browser=!0;D.env={};D.argv=
[];D.version="";D.versions={};D.on=x;D.addListener=x;D.once=x;D.off=x;D.removeListener=x;D.removeAllListeners=x;D.emit=x;D.binding=function(b){throw Error("process.binding is not supported");};D.cwd=function(){return"/"};D.chdir=function(b){throw Error("process.chdir is not supported");};D.umask=function(){return 0}},function(P,E,J){function M(b){Error.call(this);this.message=b;this.name=M.name;"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,M)}var H,x,D;!function(b){b.hprose=
Object.create(null)}(function(){return this||(0,eval)("this")}());(function(b){var B="WeakMap"in b,m="Map"in b,A=!0;if(m&&(A="forEach"in new b.Map),!(B&&m&&A)){var g=Object.create(null),z=0,y=function(a){var b=Object.create(null),c=a.valueOf;Object.defineProperty(a,"valueOf",{value:function(f,k){return this===a&&k in g&&g[k]===f?(k in b||(b[k]=Object.create(null)),b[k]):c.apply(this,arguments)},writable:!0,configurable:!0,enumerable:!1})};if(B||(b.WeakMap=function X(){var a=Object.create(null),b=
z++;g[b]=a;var f=function(f){if(f!==Object(f))throw Error("value is not a non-null object");var q=f.valueOf(a,b);return q!==f.valueOf()?q:(y(f),f.valueOf(a,b))},r=Object.create(X.prototype,{get:{value:function(a){return f(a).value}},set:{value:function(a,b){f(a).value=b}},has:{value:function(a){return"value"in f(a)}},"delete":{value:function(a){return delete f(a).value}},clear:{value:function(){delete g[b];b=z++;g[b]=a}}});if(0<arguments.length&&Array.isArray(arguments[0]))for(var k=arguments[0],
m=0,q=k.length;q>m;m++)r.set(k[m][0],k[m][1]);return r}),!m){var S=function(){var a=Object.create(null),b=z++,f=Object.create(null);g[b]=a;var k=function(r){if(null===r)return f;var k=r.valueOf(a,b);return k!==r.valueOf()?k:(y(r),r.valueOf(a,b))};return{get:function(a){return k(a).value},set:function(a,b){k(a).value=b},has:function(a){return"value"in k(a)},"delete":function(a){return delete k(a).value},clear:function(){delete g[b];b=z++;g[b]=a}}},a=function(){var a=Object.create(null);return{get:function(){return a.value},
set:function(b,f){a.value=f},has:function(){return"value"in a},"delete":function(){return delete a.value},clear:function(){a=Object.create(null)}}},f=function(){var a=Object.create(null);return{get:function(b){return a[b]},set:function(b,f){a[b]=f},has:function(b){return b in a},"delete":function(b){return delete a[b]},clear:function(){a=Object.create(null)}}};b.Map=function c(){var b={number:f(),string:f(),"boolean":f(),object:S(),"function":S(),unknown:S(),undefined:a(),"null":a()},k=0,r=[],g=Object.create(c.prototype,
{size:{get:function(){return k}},get:{value:function(a){return b[typeof a].get(a)}},set:{value:function(a,c){this.has(a)||(r.push(a),k++);b[typeof a].set(a,c)}},has:{value:function(a){return b[typeof a].has(a)}},"delete":{value:function(a){return this.has(a)?(k--,r.splice(r.indexOf(a),1),b[typeof a]["delete"](a)):!1}},clear:{value:function(){r.length=0;for(var a in b)b[a].clear();k=0}},forEach:{value:function(a,b){for(var c=0,f=r.length;f>c;c++)a.call(b,this.get(r[c]),r[c],this)}}});if(0<arguments.length&&
Array.isArray(arguments[0]))for(var m=arguments[0],q=0,y=m.length;y>q;q++)g.set(m[q][0],m[q][1]);return g}}if(!A){var k=b.Map;b.Map=function c(){var a=new k,b=0,f=[],g=Object.create(c.prototype,{size:{get:function(){return b}},get:{value:function(b){return a.get(b)}},set:{value:function(c,h){a.has(c)||(f.push(c),b++);a.set(c,h)}},has:{value:function(b){return a.has(b)}},"delete":{value:function(c){return a.has(c)?(b--,f.splice(f.indexOf(c),1),a["delete"](c)):!1}},clear:{value:function(){if("clear"in
a)a.clear();else for(var c=0,h=f.length;h>c;c++)a["delete"](f[c]);b=f.length=0}},forEach:{value:function(a,b){for(var c=0,q=f.length;q>c;c++)a.call(b,this.get(f[c]),f[c],this)}}});if(0<arguments.length&&Array.isArray(arguments[0]))for(var m=arguments[0],q=0,y=m.length;y>q;q++)g.set(m[q][0],m[q][1]);return g}}}})(function(){return this||(0,eval)("this")}());M.prototype=Object.create(Error.prototype);M.prototype.constructor=M;(function(b,B){function m(a){var b=f(arguments,1);return function(){a.apply(B,
b)}}function A(a){if(x)b.setTimeout(m(A,a),0);else{var f=c[a];if(f){x=!0;try{f()}finally{z(a),x=!1}}}}function g(a){return c[X]=m.apply(B,a),X++}function z(a){delete c[a]}function y(){if(b.postMessage&&!b.importScripts){var a=!0,c=b.onmessage;return b.onmessage=function(){a=!1},b.postMessage("","*"),b.onmessage=c,a}}var S=b.navigator&&/Trident/.test(b.navigator.userAgent);if(!S&&(b.msSetImmediate||b.setImmediate))return void(b.setImmediate||(b.setImmediate=b.msSetImmediate,b.clearImmediate=b.msClearImmediate));
var a=b.document,f=Function.prototype.call.bind(Array.prototype.slice),k=Function.prototype.call.bind(Object.prototype.toString),w={},X=1,c={},x=!1;w.messageChannel=function(){var a=new b.MessageChannel;return a.port1.onmessage=function(a){A(Number(a.data))},function(){var b=g(arguments);return a.port2.postMessage(b),b}};w.nextTick=function(){return function(){var a=g(arguments);return b.process.nextTick(m(A,a)),a}};w.postMessage=function(){var a="setImmediate$"+Math.random()+"$",c=function(c){c.source===
b&&"string"==typeof c.data&&0===c.data.indexOf(a)&&A(Number(c.data.slice(a.length)))};return b.addEventListener?b.addEventListener("message",c,!1):b.attachEvent("onmessage",c),function(){var c=g(arguments);return b.postMessage(a+c,"*"),c}};w.readyStateChange=function(){var b=a.documentElement;return function(){var c=g(arguments),f=a.createElement("script");return f.onreadystatechange=function(){A(c);f.onreadystatechange=null;b.removeChild(f);f=null},b.appendChild(f),c}};w.setTimeout=function(){return function(){var a=
g(arguments);return b.setTimeout(m(A,a),0),a}};var u=Object.getPrototypeOf&&Object.getPrototypeOf(b),u=u&&u.setTimeout?u:b;S?u.setImmediate=w.setTimeout():"[object process]"===k(b.process)?u.setImmediate=w.nextTick():y()?u.setImmediate=w.postMessage():b.MessageChannel?u.setImmediate=w.messageChannel():a&&"onreadystatechange"in a.createElement("script")?u.setImmediate=w.readyStateChange():u.setImmediate=w.setTimeout();u.msSetImmediate=u.setImmediate;u.clearImmediate=z;u.msClearImmediate=z})(function(){return this||
(0,eval)("this")}());(function(b,B){function m(a){Object.defineProperties(this,{_subscribers:{value:[]},resolve:{value:this.resolve.bind(this)},reject:{value:this.reject.bind(this)}});var b=this;"function"==typeof a&&O(function(){try{b.resolve(a())}catch(c){b.reject(c)}})}function A(a){return a instanceof m}function g(a){return A(a)||q&&a instanceof b.Promise&&typeof("function"===a.then)}function z(a){var b=new m;return b.reject(a),b}function y(a){var b=new m;return b.resolve(a),b}function S(a){var b=
0;return Q(a,function(){++b}),b}function a(a){return a=g(a)?a:y(a),a.then(function(a){var b=a.length,c=S(a),e=Array(b);if(0===c)return y(e);var h=new m;return Q(a,function(a,b){(g(a)?a:y(a)).then(function(a){e[b]=a;0===--c&&h.resolve(e)},h.reject)}),h})}function f(a){return a=g(a)?a:y(a),a.then(function(a){var b=new m;return Q(a,function(a){(g(a)?a:y(a)).then(b.resolve,b.reject)}),b})}function k(b,c,h){return a(b).then(function(a){return a.forEach(c,h)})}function w(b,c,h){return a(b).then(function(a){return a.every(c,
h)})}function X(b,c,h){return a(b).then(function(a){return a.some(c,h)})}function c(b,c,h){return a(b).then(function(a){return a.filter(c,h)})}function x(b,c,h){return a(b).then(function(a){return a.map(c,h)})}function u(b,c,h){return 2<arguments.length?a(b).then(function(a){return g(h)||(h=y(h)),h.then(function(b){return a.reduce(c,b)})}):a(b).then(function(a){return a.reduce(c)})}function r(b,c,h){return 2<arguments.length?a(b).then(function(a){return g(h)||(h=y(h)),h.then(function(b){return a.reduceRight(c,
b)})}):a(b).then(function(a){return a.reduceRight(c)})}function C(a,b,c){O(function(){try{var h=a(c);b.resolve(h)}catch(f){b.reject(f)}})}function D(a,b,c,h,f){function q(f){D(a,b,c,h,f)}function k(a){b?C(b,h,a):h.reject(a)}if(g(f))return f===c?void k(new TypeError("Self resolution")):void f.then(q,k);if(null!==f&&"object"==typeof f||"function"==typeof f){var N;try{N=f.then}catch(Q){return void k(Q)}if("function"==typeof N){var w=!0;try{return void N.call(f,function(a){w&&(w=!1,q(a))},function(a){w&&
(w=!1,k(a))})}catch(Q){w&&(w=!1,k(Q))}return}}a?C(a,h,f):h.resolve(f)}var q="Promise"in b,O=b.setImmediate,L=b.setTimeout,h=b.clearTimeout,Q=Function.prototype.call.bind(Array.prototype.forEach),N=Function.prototype.call.bind(Array.prototype.slice);Object.defineProperties(m,{delayed:{value:function(a,b){var c="function"==typeof b?b:function(){return b},h=new m;return L(function(){try{h.resolve(c())}catch(a){h.reject(a)}},a),h}},error:{value:z},sync:{value:function(a){try{var b=a();return y(b)}catch(c){return z(c)}}},
value:{value:y},all:{value:a},race:{value:f},resolve:{value:y},reject:{value:z},promise:{value:function(a){var b=new m;return a(b.resolve,b.reject),b}},isFuture:{value:A},isPromise:{value:g},join:{value:function(){return a(arguments)}},any:{value:function(a){return a=g(a)?a:y(a),a.then(function(a){var b=a.length,c=S(a);if(0===c)throw new RangeError("any(): array must not be empty");var e=Array(b),h=new m;return Q(a,function(a,b){(g(a)?a:y(a)).then(h.resolve,function(a){e[b]=a;0===--c&&h.reject(e)})}),
h})}},settle:{value:function(a){return a=g(a)?a:y(a),a.then(function(a){var b=a.length,c=S(a),e=Array(b);if(0===c)return y(e);var h=new m;return Q(a,function(a,b){var f=g(a)?a:y(a);f.whenComplete(function(){e[b]=f.inspect();0===--c&&h.resolve(e)})}),h})}},attempt:{value:function(b){var c=N(arguments,1);return a(c).then(function(a){return b.apply(B,a)})}},run:{value:function(b,c){var h=N(arguments,2);return a(h).then(function(a){return b.apply(c,a)})}},wrap:{value:function(b,c){return function(){return a(arguments).then(function(a){return b.apply(c,
a)})}}},forEach:{value:k},every:{value:w},some:{value:X},filter:{value:c},map:{value:x},reduce:{value:u},reduceRight:{value:r}});Object.defineProperties(m.prototype,{_value:{writable:!0},_reason:{writable:!0},_state:{value:0,writable:!0},resolve:{value:function(a){if(0===this._state){this._state=1;this._value=a;for(var b=this._subscribers;0<b.length;){var c=b.shift();D(c.onfulfill,c.onreject,this,c.next,a)}}}},reject:{value:function(a){if(0===this._state){this._state=2;this._reason=a;for(var b=this._subscribers;0<
b.length;){var c=b.shift();c.onreject?C(c.onreject,c.next,a):c.next.reject(a)}}}},then:{value:function(a,b){if("function"!=typeof a&&(a=null),"function"!=typeof b&&(b=null),a||b){var c=new m;return 1===this._state?a?D(a,b,this,c,this._value):c.resolve(this._value):2===this._state?b?C(b,c,this._reason):c.reject(this._reason):this._subscribers.push({onfulfill:a,onreject:b,next:c}),c}return this}},inspect:{value:function(){switch(this._state){case 0:return{state:"pending"};case 1:return{state:"fulfilled",
value:this._value};case 2:return{state:"rejected",reason:this._reason}}}},catchError:{value:function(a,b){if("function"==typeof b){var c=this;return this["catch"](function(h){if(b(h))return c["catch"](a);throw h;})}return this["catch"](a)}},"catch":{value:function(a){return this.then(null,a)}},whenComplete:{value:function(a){return this.then(function(b){var c=a();return c===B?b:(c=g(c)?c:y(c),c.then(function(){return b}))},function(b){var c=a();if(c===B)throw b;return c=g(c)?c:y(c),c.then(function(){throw b;
})})}},timeout:{value:function(a,b){var c=new m,f=L(function(){c.reject(b||new M("timeout"))},a);return this.whenComplete(function(){h(f)}).then(c.resolve,c.reject),c}},delay:{value:function(a){var b=new m;return this.then(function(c){L(function(){b.resolve(c)},a)},b.reject),b}},tap:{value:function(a,b){return this.then(function(c){return a.call(b,c),c})}},spread:{value:function(a,b){return this.then(function(c){return a.apply(b,c)})}},get:{value:function(a){return this.then(function(b){return b[a]})}},
set:{value:function(a,b){return this.then(function(c){return c[a]=b,c})}},apply:{value:function(b,c){return c=c||[],this.then(function(h){return a(c).then(function(a){return h[b].apply(h,a)})})}},call:{value:function(b){var c=N(arguments,1);return this.then(function(h){return a(c).then(function(a){return h[b].apply(h,a)})})}},bind:{value:function(b){var c=N(arguments);if(!Array.isArray(b)){c.shift();var h=this;return Object.defineProperty(this,b,{value:function(){var f=N(arguments);return h.then(function(h){return a(c.concat(f)).then(function(a){return h[b].apply(h,
a)})})}}),this}for(var f=0,q=b.length;q>f;++f)c[0]=b[f],this.bind.apply(this,c)}},forEach:{value:function(a,b){return k(this,a,b)}},every:{value:function(a,b){return w(this,a,b)}},some:{value:function(a,b){return X(this,a,b)}},filter:{value:function(a,b){return c(this,a,b)}},map:{value:function(a,b){return x(this,a,b)}},reduce:{value:function(a,b){return 1<arguments.length?u(this,a,b):u(this,a)}},reduceRight:{value:function(a,b){return 1<arguments.length?r(this,a,b):r(this,a)}}});b.hprose.Future=
m;b.hprose.Completer=function(){var a=new m;Object.defineProperties(this,{future:{value:a},complete:{value:a.resolve},completeError:{value:a.reject},isCompleted:{get:function(){return 0!==a._state}}})};b.hprose.resolved=y;b.hprose.rejected=z;b.hprose.deferred=function(){var a=new m;return Object.create(null,{promise:{value:a},resolve:{value:a.resolve},reject:{value:a.reject}})};q||(b.Promise=function(a){m.call(this);a(this.resolve,this.reject)},b.Promise.prototype=Object.create(m.prototype),b.Promise.prototype.constructor=
m,Object.defineProperties(b.Promise,{all:{value:a},race:{value:f},resolve:{value:y},reject:{value:z}}))})(function(){return this||(0,eval)("this")}());(function(b,B){function m(a,b,k){return a[b++]=k>>>24&255,a[b++]=k>>>16&255,a[b++]=k>>>8&255,a[b++]=255&k,b}function A(a,b,k){return a[b++]=255&k,a[b++]=k>>>8&255,a[b++]=k>>>16&255,a[b++]=k>>>24&255,b}function g(a,b){(b===B||null===b||0>b)&&(b=a.length);var k;if(0===b)k=["",0];else{var w;if(1E5>b){w=b;k=new Uint16Array(w);for(var g=0,c=0,m=a.length;w>
g&&m>c;g++){var u=a[c++];switch(u>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:k[g]=u;break;case 12:case 13:if(!(m>c))throw Error("Unfinished UTF-8 octet sequence");k[g]=(31&u)<<6|63&a[c++];break;case 14:if(!(m>c+1))throw Error("Unfinished UTF-8 octet sequence");k[g]=(15&u)<<12|(63&a[c++])<<6|63&a[c++];break;case 15:if(!(m>c+2))throw Error("Unfinished UTF-8 octet sequence");u=((7&u)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;if(!(0<=u&&1048575>=u))throw Error("Character outside valid Unicode range: 0x"+
u.toString(16));k[g++]=u>>10&1023|55296;k[g]=1023&u|56320;break;default:throw Error("Bad UTF-8 encoding 0x"+u.toString(16));}}w=(w>g&&(k=k.subarray(0,g)),[String.fromCharCode.apply(String,k),c])}else{k=b;w=[];g=new Uint16Array(65535);c=u=0;for(m=a.length;k>u&&m>c;u++){var r=a[c++];switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:g[u]=r;break;case 12:case 13:if(!(m>c))throw Error("Unfinished UTF-8 octet sequence");g[u]=(31&r)<<6|63&a[c++];break;case 14:if(!(m>c+1))throw Error("Unfinished UTF-8 octet sequence");
g[u]=(15&r)<<12|(63&a[c++])<<6|63&a[c++];break;case 15:if(!(m>c+2))throw Error("Unfinished UTF-8 octet sequence");r=((7&r)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536;if(!(0<=r&&1048575>=r))throw Error("Character outside valid Unicode range: 0x"+r.toString(16));g[u++]=r>>10&1023|55296;g[u]=1023&r|56320;break;default:throw Error("Bad UTF-8 encoding 0x"+r.toString(16));}65534<=u&&(u+=1,w.push(String.fromCharCode.apply(String,g.subarray(0,u))),k-=u,u=-1)}w=(0<u&&w.push(String.fromCharCode.apply(String,
g.subarray(0,u))),[w.join(""),c])}k=w}return k}function z(){var a=arguments;switch(a.length){case 1:switch(a[0].constructor){case Uint8Array:this._bytes=a[0];this._length=a[0].length;break;case z:this._bytes=a[0].toBytes();this._length=a[0].length;break;case String:this.writeString(a[0]);break;case Number:this._bytes=new Uint8Array(a[0]);break;default:this._bytes=new Uint8Array(a[0]),this._length=this._bytes.length}break;case 2:this._bytes=new Uint8Array(a[0],a[1]);this._length=a[1];break;case 3:this._bytes=
new Uint8Array(a[0],a[1],a[2]),this._length=a[2]}this.mark()}var y=(b.hprose.Future,new Uint8Array(0)),S=Function.prototype.call.bind(Array.prototype.indexOf);Object.defineProperties(z.prototype,{_bytes:{value:null,writable:!0},_length:{value:0,writable:!0},_wmark:{value:0,writable:!0},_off:{value:0,writable:!0},_rmark:{value:0,writable:!0},_grow:{value:function(a){var b=this._bytes,k=this._length+a;a=(--k,k|=k>>1,k|=k>>2,k|=k>>4,k|=k>>8,k|=k>>16,k+1);if(b){if(a*=2,a>b.length)a=new Uint8Array(a),
a.set(b),this._bytes=a}else a=Math.max(a,1024),this._bytes=new Uint8Array(a)}},length:{get:function(){return this._length}},capacity:{get:function(){return this._bytes?this._bytes.length:0}},position:{get:function(){return this._off}},bytes:{get:function(){return null===this._bytes?y:this._bytes.subarray(0,this._length)}},mark:{value:function(){this._wmark=this._length;this._rmark=this._off}},reset:{value:function(){this._length=this._wmark;this._off=this._rmark}},clear:{value:function(){this._bytes=
null;this._rmark=this._off=this._wmark=this._length=0}},writeByte:{value:function(a){this._grow(1);this._bytes[this._length++]=a}},writeInt32BE:{value:function(a){if(a===(0|a)&&2147483647>=a)return this._grow(4),void(this._length=m(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},writeUInt32BE:{value:function(a){if(a===(0|a)&&0<=a)return this._grow(4),void(this._length=m(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},writeInt32LE:{value:function(a){if(a===
(0|a)&&2147483647>=a)return this._grow(4),void(this._length=A(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},writeUInt32LE:{value:function(a){if(a===(0|a)&&0<=a)return this._grow(4),void(this._length=A(this._bytes,this._length,a));throw new TypeError("value is out of bounds");}},write:{value:function(a){var b=a.byteLength||a.length;if(0!==b){this._grow(b);var k=this._bytes,g=this._length;switch(a.constructor){case ArrayBuffer:k.set(new Uint8Array(a),g);break;case Uint8Array:k.set(a,
g);break;case z:k.set(a.bytes,g);break;default:for(var m=0;b>m;m++)k[g+m]=a[m]}this._length+=b}}},writeAsciiString:{value:function(a){var b=a.length;if(0!==b){this._grow(b);for(var k=this._bytes,g=this._length,m=0;b>m;++m,++g)k[g]=a.charCodeAt(m);this._length=g}}},writeString:{value:function(a){var b=a.length;if(0!==b){this._grow(3*b);for(var b=this._bytes,k=this._length,g=a.length,m=0;g>m;++m){var c=a.charCodeAt(m);if(128>c)b[k++]=c;else{if(2048>c)b[k++]=192|c>>6;else{if(!(55296>c||57343<c)){if(g>
m+1){var y=a.charCodeAt(m+1);if(56320>c&&56320<=y&&57343>=y){c=((1023&c)<<10|1023&y)+65536;b[k++]=240|c>>18;b[k++]=128|c>>12&63;b[k++]=128|c>>6&63;b[k++]=128|63&c;++m;continue}}throw Error("Malformed string");}b[k++]=224|c>>12;b[k++]=128|c>>6&63}b[k++]=128|63&c}}this._length=k}}},readByte:{value:function(){return this._off<this._length?this._bytes[this._off++]:-1}},readInt32BE:{value:function(){var a=this._bytes,b=this._off;if(b+3<this._length)return a=a[b++]<<24|a[b++]<<16|a[b++]<<8|a[b++],this._off=
b,a;throw Error("EOF");}},readUInt32BE:{value:function(){var a=this.readInt32BE();return 0>a?(2147483647&a)+2147483648:a}},readInt32LE:{value:function(){var a=this._bytes,b=this._off;if(b+3<this._length)return a=a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24,this._off=b,a;throw Error("EOF");}},readUInt32LE:{value:function(){var a=this.readInt32LE();return 0>a?(2147483647&a)+2147483648:a}},read:{value:function(a){return this._off+a>this._length&&(a=this._length-this._off),0===a?y:this._bytes.subarray(this._off,
this._off+=a)}},skip:{value:function(a){return this._off+a>this._length?(a=this._length-this._off,this._off=this._length):this._off+=a,a}},readBytes:{value:function(a){var b;a=S(this._bytes,a,this._off);return-1===a?(b=this._bytes.subarray(this._off,this._length),this._off=this._length):(b=this._bytes.subarray(this._off,a+1),this._off=a+1),b}},readUntil:{value:function(a){a=S(this._bytes,a,this._off);var b="";return a===this._off?this._off++:-1===a?(b=g(this._bytes.subarray(this._off,this._length))[0],
this._off=this._length):(b=g(this._bytes.subarray(this._off,a))[0],this._off=a+1),b}},readAsciiString:{value:function(a){if(this._off+a>this._length&&(a=this._length-this._off),0===a)return"";var b=this._bytes.subarray(this._off,this._off+=a);if(1E5>a)return String.fromCharCode.apply(String,b);for(var k=65535&a,g=a>>16,m=Array(k?g+1:g),c=0;g>c;++c)m[c]=String.fromCharCode.apply(String,b.subarray(c<<16,c+1<<16));return k&&(m[g]=String.fromCharCode.apply(String,b.subarray(g<<16,a))),m.join("")}},readStringAsBytes:{value:function(a){var b;
b=this._bytes.subarray(this._off,this._length);if(a===B&&(a=b.length),0===a)b=y;else{for(var k=0,g=0,m=b.length;a>k&&m>g;k++){var c=b[g++];switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break;case 12:case 13:if(!(m>g))throw Error("Unfinished UTF-8 octet sequence");g++;break;case 14:if(!(m>g+1))throw Error("Unfinished UTF-8 octet sequence");g+=2;break;case 15:if(!(m>g+2))throw Error("Unfinished UTF-8 octet sequence");c=((7&c)<<18|(63&b[g++])<<12|(63&b[g++])<<6|63&b[g++])-65536;
if(!(0<=c&&1048575>=c))throw Error("Character outside valid Unicode range: 0x"+c.toString(16));k++;break;default:throw Error("Bad UTF-8 encoding 0x"+c.toString(16));}}b=[b.subarray(0,g),g]}return this._off+=b[1],b[0]}},readString:{value:function(a){a=g(this._bytes.subarray(this._off,this._length),a);return this._off+=a[1],a[0]}},takeBytes:{value:function(){var a=this.bytes;return this.clear(),a}},toBytes:{value:function(){return new Uint8Array(this.bytes)}},toString:{value:function(){return g(this.bytes,
this._length)[0]}},clone:{value:function(){return new z(this.toBytes())}},trunc:{value:function(){this._bytes=this._bytes.subarray(this._off,this._length);this._length=this._bytes.length;this._rmark=this._wmark=this._off=0}}});Object.defineProperty(z,"toString",{value:function(a){if(0===a.length)return"";switch(a.constructor){case String:return a;case z:a=a.bytes;case ArrayBuffer:a=new Uint8Array(a);case Uint8Array:return g(a,a.length)[0];default:return String.fromCharCode.apply(String,a)}}});b.hprose.BytesIO=
z})(function(){return this||(0,eval)("this")}());(function(b){b.hprose.Tags={TagInteger:105,TagLong:108,TagDouble:100,TagNull:110,TagEmpty:101,TagTrue:116,TagFalse:102,TagNaN:78,TagInfinity:73,TagDate:68,TagTime:84,TagUTC:90,TagBytes:98,TagUTF8Char:117,TagString:115,TagGuid:103,TagList:97,TagMap:109,TagClass:99,TagObject:111,TagRef:114,TagPos:43,TagNeg:45,TagSemicolon:59,TagOpenbrace:123,TagClosebrace:125,TagQuote:34,TagPoint:46,TagFunctions:70,TagCall:67,TagResult:82,TagArgument:65,TagError:69,TagEnd:122}})(function(){return this||
(0,eval)("this")}());(function(b){function B(b,m){g.set(b,m);A[m]=b}var m=b.WeakMap,A=Object.create(null),g=new m;b.hprose.ClassManager=Object.create(null,{register:{value:B},getClassAlias:{value:function(b){return g.get(b)}},getClass:{value:function(b){return A[b]}}});b.hprose.register=B;B(Object,"Object")})(function(){return this||(0,eval)("this")}());(function(b,B){function m(a){var b=a.constructor,c=O.getClassAlias(b);if(c)return c;if(b.name)c=b.name;else{var e=b.toString();if(c=e.substr(0,e.indexOf("(")).replace(/(^\s*function\s*)|(\s*$)/gi,
""),""===c||"Object"===c)return"function"==typeof a.getClassName?a.getClassName():"Object"}return"Object"!==c&&O.register(b,c),c}function A(a){Object.defineProperties(this,{_stream:{value:a},_ref:{value:new C,writable:!0}})}function g(a,b){Object.defineProperties(this,{stream:{value:a},_classref:{value:Object.create(null),writable:!0},_fieldsref:{value:[],writable:!0},_refer:{value:b?L:new A(a)}})}function z(a,b){var f=a.stream;if(b===B||null===b)return void f.writeByte(q.TagNull);switch(b.constructor){case Function:return void f.writeByte(q.TagNull);
case Number:var e=a.stream,f=b.valueOf();f===(0|f)?0<=f&&9>=f?e.writeByte(f+48):(e.writeByte(q.TagInteger),e.writeAsciiString(""+f),e.writeByte(q.TagSemicolon)):isNaN(f)?e.writeByte(q.TagNaN):isFinite(f)?(e.writeByte(q.TagDouble),e.writeAsciiString(""+f),e.writeByte(q.TagSemicolon)):(e.writeByte(q.TagInfinity),e.writeByte(0<f?q.TagPos:q.TagNeg));break;case Boolean:a.stream.writeByte(b.valueOf()?q.TagTrue:q.TagFalse);break;case String:switch(b.length){case 0:return void f.writeByte(q.TagEmpty);case 1:return f.writeByte(q.TagUTF8Char),
void f.writeString(b)}return void a.writeStringWithRef(b);case Date:return void a.writeDateWithRef(b);case C:return void a.writeMapWithRef(b);case ArrayBuffer:case Uint8Array:case E:return void a.writeBytesWithRef(b);case Int8Array:case Int16Array:case Int32Array:case Uint16Array:case Uint32Array:a._refer.write(b)||c(a,b,y);break;case Float32Array:case Float64Array:a._refer.write(b)||c(a,b,S);break;default:Array.isArray(b)?a.writeListWithRef(b):"Object"===m(b)?a.writeMapWithRef(b):a.writeObjectWithRef(b)}}
function y(a,b){var c=a.stream;0<=b&&9>=b?c.writeByte(b+48):(-2147483648>b||2147483647<b?c.writeByte(q.TagLong):c.writeByte(q.TagInteger),c.writeAsciiString(""+b),c.writeByte(q.TagSemicolon))}function S(a,b){var c=a.stream;isNaN(b)?c.writeByte(q.TagNaN):isFinite(b)?(c.writeByte(q.TagDouble),c.writeAsciiString(""+b),c.writeByte(q.TagSemicolon)):(c.writeByte(q.TagInfinity),c.writeByte(0<b?q.TagPos:q.TagNeg))}function a(a,b){a._refer.set(b);var c=a.stream,e=("0000"+b.getUTCFullYear()).slice(-4),f=("00"+
(b.getUTCMonth()+1)).slice(-2),g=("00"+b.getUTCDate()).slice(-2),k=("00"+b.getUTCHours()).slice(-2),m=("00"+b.getUTCMinutes()).slice(-2),r=("00"+b.getUTCSeconds()).slice(-2),u=("000"+b.getUTCMilliseconds()).slice(-3);c.writeByte(q.TagDate);c.writeAsciiString(e+f+g);c.writeByte(q.TagTime);c.writeAsciiString(k+m+r);"000"!==u&&(c.writeByte(q.TagPoint),c.writeAsciiString(u));c.writeByte(q.TagUTC)}function f(a,b){a._refer.set(b);var c=a.stream,e=("0000"+b.getFullYear()).slice(-4),f=("00"+(b.getMonth()+
1)).slice(-2),g=("00"+b.getDate()).slice(-2),k=("00"+b.getHours()).slice(-2),m=("00"+b.getMinutes()).slice(-2),r=("00"+b.getSeconds()).slice(-2),u=("000"+b.getMilliseconds()).slice(-3);"00"===k&&"00"===m&&"00"===r&&"000"===u?(c.writeByte(q.TagDate),c.writeAsciiString(e+f+g)):"1970"===e&&"01"===f&&"01"===g?(c.writeByte(q.TagTime),c.writeAsciiString(k+m+r),"000"!==u&&(c.writeByte(q.TagPoint),c.writeAsciiString(u))):(c.writeByte(q.TagDate),c.writeAsciiString(e+f+g),c.writeByte(q.TagTime),c.writeAsciiString(k+
m+r),"000"!==u&&(c.writeByte(q.TagPoint),c.writeAsciiString(u)));c.writeByte(q.TagSemicolon)}function k(a,b){a._refer.set(b);var c=a.stream,e=("00"+b.getHours()).slice(-2),f=("00"+b.getMinutes()).slice(-2),g=("00"+b.getSeconds()).slice(-2),k=("000"+b.getMilliseconds()).slice(-3);c.writeByte(q.TagTime);c.writeAsciiString(e+f+g);"000"!==k&&(c.writeByte(q.TagPoint),c.writeAsciiString(k));c.writeByte(q.TagSemicolon)}function w(a,b){a._refer.set(b);var c=a.stream;c.writeByte(q.TagBytes);var e=b.byteLength||
b.length;0<e&&c.writeAsciiString(""+e);c.writeByte(q.TagQuote);0<e&&c.write(b);c.writeByte(q.TagQuote)}function x(a,b){a._refer.set(b);var c=a.stream,e=b.length;c.writeByte(q.TagString);0<e&&c.writeAsciiString(""+e);c.writeByte(q.TagQuote);0<e&&c.writeString(b);c.writeByte(q.TagQuote)}function c(a,b,c){a._refer.set(b);var e=a.stream,f=b.length;e.writeByte(q.TagList);0<f&&e.writeAsciiString(""+f);e.writeByte(q.TagOpenbrace);for(var g=0;f>g;g++)c(a,b[g]);e.writeByte(q.TagClosebrace)}function D(a,b){a._refer.set(b);
var c=a.stream,e=[],f;for(f in b)b.hasOwnProperty(f)&&"function"!=typeof b[f]&&(e[e.length]=f);f=e.length;c.writeByte(q.TagMap);0<f&&c.writeAsciiString(""+f);c.writeByte(q.TagOpenbrace);for(var g=0;f>g;g++)z(a,e[g]),z(a,b[e[g]]);c.writeByte(q.TagClosebrace)}function u(a,b){a._refer.set(b);var c=a.stream,e=b.size;c.writeByte(q.TagMap);0<e&&c.writeAsciiString(""+e);c.writeByte(q.TagOpenbrace);b.forEach(function(b,c){z(a,c);z(a,b)});c.writeByte(q.TagClosebrace)}function r(a,b){var c,e,f=a.stream;e=m(b);
if(e in a._classref)e=a._classref[e],c=a._fieldsref[e];else{c=[];for(var g in b)b.hasOwnProperty(g)&&"function"!=typeof b[g]&&(c[c.length]=g.toString());g=c;var k=a.stream,r=g.length;k.writeByte(q.TagClass);k.writeAsciiString(""+e.length);k.writeByte(q.TagQuote);k.writeString(e);k.writeByte(q.TagQuote);0<r&&k.writeAsciiString(""+r);k.writeByte(q.TagOpenbrace);for(var u=0;r>u;u++)x(a,g[u]);k.writeByte(q.TagClosebrace);k=a._fieldsref.length;e=(a._classref[e]=k,a._fieldsref[k]=g,k)}f.writeByte(q.TagObject);
f.writeAsciiString(""+e);f.writeByte(q.TagOpenbrace);a._refer.set(b);e=c.length;for(g=0;e>g;g++)z(a,b[c[g]]);f.writeByte(q.TagClosebrace)}var C=b.Map,E=b.hprose.BytesIO,q=b.hprose.Tags,O=b.hprose.ClassManager,L=Object.create(null,{set:{value:function(){}},write:{value:function(){return!1}},reset:{value:function(){}}});Object.defineProperties(A.prototype,{_refcount:{value:0,writable:!0},set:{value:function(a){this._ref.set(a,this._refcount++)}},write:{value:function(a){a=this._ref.get(a);return a!==
B?(this._stream.writeByte(q.TagRef),this._stream.writeString(""+a),this._stream.writeByte(q.TagSemicolon),!0):!1}},reset:{value:function(){this._ref=new C;this._refcount=0}}});Object.defineProperties(g.prototype,{serialize:{value:function(a){z(this,a)}},writeInteger:{value:function(a){y(this,a)}},writeDouble:{value:function(a){S(this,a)}},writeBoolean:{value:function(a){this.stream.writeByte(a.valueOf()?q.TagTrue:q.TagFalse)}},writeUTCDate:{value:function(b){a(this,b)}},writeUTCDateWithRef:{value:function(b){this._refer.write(b)||
a(this,b)}},writeDate:{value:function(a){f(this,a)}},writeDateWithRef:{value:function(a){this._refer.write(a)||f(this,a)}},writeTime:{value:function(a){k(this,a)}},writeTimeWithRef:{value:function(a){this._refer.write(a)||k(this,a)}},writeBytes:{value:function(a){w(this,a)}},writeBytesWithRef:{value:function(a){this._refer.write(a)||w(this,a)}},writeString:{value:function(a){x(this,a)}},writeStringWithRef:{value:function(a){this._refer.write(a)||x(this,a)}},writeList:{value:function(a){c(this,a,z)}},
writeListWithRef:{value:function(a){this._refer.write(a)||c(this,a,z)}},writeMap:{value:function(a){a instanceof C?u(this,a):D(this,a)}},writeMapWithRef:{value:function(a){this._refer.write(a)||(a instanceof C?u(this,a):D(this,a))}},writeObject:{value:function(a){r(this,a)}},writeObjectWithRef:{value:function(a){this._refer.write(a)||r(this,a)}},reset:{value:function(){this._classref=Object.create(null);this._fieldsref.length=0;this._refer.reset()}}});b.hprose.Writer=g})(function(){return this||(0,eval)("this")}());
(function(b,B){function m(a,b){if(a&&b){var c="";throw c="number"==typeof b?String.fromCharCode(b):String.fromCharCode.apply(String,b),Error('Tag "'+c+'" expected, but "'+String.fromCharCode(a)+'" found in stream');}throw a?Error('Unexpected serialize tag "'+String.fromCharCode(a)+'" in stream'):Error("No byte found in stream");}function A(a,b,c){switch(b.writeByte(c),c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case t.TagNull:case t.TagEmpty:case t.TagTrue:case t.TagFalse:case t.TagNaN:break;
case t.TagInfinity:b.writeByte(a.readByte());break;case t.TagInteger:case t.TagLong:case t.TagDouble:case t.TagRef:do c=a.readByte(),b.writeByte(c);while(c!==t.TagSemicolon);break;case t.TagDate:case t.TagTime:do c=a.readByte(),b.writeByte(c);while(c!==t.TagSemicolon&&c!==t.TagUTC);break;case t.TagUTF8Char:b.writeString(a.readString(1));break;case t.TagBytes:c=0;var e=48;do c*=10,c+=e-48,e=a.readByte(),b.writeByte(e);while(e!==t.TagQuote);b.write(a.read(c+1));break;case t.TagString:c=0;e=48;do c*=
10,c+=e-48,e=a.readByte(),b.writeByte(e);while(e!==t.TagQuote);b.write(a.readStringAsBytes(c+1));break;case t.TagGuid:b.write(a.read(38));break;case t.TagList:case t.TagMap:case t.TagObject:g(a,b);break;case t.TagClass:g(a,b);A(a,b,a.readByte());break;case t.TagError:A(a,b,a.readByte());break;default:m(c)}}function g(a,b){var c;do c=a.readByte(),b.writeByte(c);while(c!==t.TagOpenbrace);for(;(c=a.readByte())!==t.TagClosebrace;)A(a,b,c);b.writeByte(c)}function z(a){Object.defineProperties(this,{stream:{value:a},
readRaw:{value:function(){var b=new Ca;A(a,b,a.readByte());return b.bytes}}})}function y(){Object.defineProperties(this,{ref:{value:[]}})}function S(a){var c=b,e=a.split(".");for(a=0;a<e.length;a++)if(c=c[e[a]],c===B)return null;return c}function a(b,c,e,f){if(e<c.length){b[c[e]]=f;var g=a(b,c,e+1,".");return e+1<c.length&&null===g&&(g=a(b,c,e+1,"_")),g}b=b.join("");try{return g=S(b),"function"==typeof g?g:null}catch(h){return null}}function f(b){var c=Fa.getClass(b);if(c)return c;if(c=S(b),"function"==
typeof c)return Fa.register(c,b),c;for(var e=[],f=b.indexOf("_");0<=f;)e[e.length]=f,f=b.indexOf("_",f+1);return 0<e.length&&(f=b.split(""),c=a(f,e,0,"."),null===c&&(c=a(f,e,0,"_")),"function"==typeof c)?(Fa.register(c,b),c):(c=function(){},Object.defineProperty(c.prototype,"getClassName",{value:function(){return b}}),Fa.register(c,b),c)}function k(a,b){var c=a.readUntil(b);return 0===c.length?0:parseInt(c,10)}function w(a){var b=a.stream,c=b.readByte();switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return c-
48;case t.TagInteger:return k(b,t.TagSemicolon);case t.TagLong:return x(b);case t.TagDouble:return parseFloat(b.readUntil(t.TagSemicolon));case t.TagNull:return null;case t.TagEmpty:return"";case t.TagTrue:return!0;case t.TagFalse:return!1;case t.TagNaN:return NaN;case t.TagInfinity:return b.readByte()===t.TagNeg?-(1/0):1/0;case t.TagDate:return D(a);case t.TagTime:return u(a);case t.TagBytes:return r(a);case t.TagUTF8Char:return a.stream.readString(1);case t.TagString:return q(a);case t.TagGuid:return L(a);
case t.TagList:return h(a);case t.TagMap:return a.useHarmonyMap?N(a):Q(a);case t.TagClass:return M(a),p(a);case t.TagObject:return e(a);case t.TagRef:return H(a);case t.TagError:throw Error(O(a));default:m(c)}}function x(a){a=a.readUntil(t.TagSemicolon);var b=parseInt(a,10);return b.toString()===a?b:a}function c(a){var b=a.readByte();switch(b){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return b-48;case t.TagInteger:case t.TagLong:case t.TagDouble:return parseFloat(a.readUntil(t.TagSemicolon));
case t.TagNaN:return NaN;case t.TagInfinity:return a.readByte()===t.TagNeg?-(1/0):1/0;default:m(b)}}function D(a){var b;b=a.stream;var c=parseInt(b.readAsciiString(4),10),e=parseInt(b.readAsciiString(2),10)-1,f=parseInt(b.readAsciiString(2),10),g=b.readByte();if(g===t.TagTime){var h=parseInt(b.readAsciiString(2),10),k=parseInt(b.readAsciiString(2),10),q=parseInt(b.readAsciiString(2),10),m=0,g=b.readByte();g===t.TagPoint&&(m=parseInt(b.readAsciiString(3),10),g=b.readByte(),48<=g&&57>=g&&(b.skip(2),
g=b.readByte(),48<=g&&57>=g&&(b.skip(2),g=b.readByte())));b=g===t.TagUTC?new Date(Date.UTC(c,e,f,h,k,q,m)):new Date(c,e,f,h,k,q,m)}else b=g===t.TagUTC?new Date(Date.UTC(c,e,f)):new Date(c,e,f);return a.refer.set(b),b}function u(a){var b,c=a.stream,e=parseInt(c.readAsciiString(2),10),f=parseInt(c.readAsciiString(2),10),g=parseInt(c.readAsciiString(2),10),h=0,k=c.readByte();return k===t.TagPoint&&(h=parseInt(c.readAsciiString(3),10),k=c.readByte(),48<=k&&57>=k&&(c.skip(2),k=c.readByte(),48<=k&&57>=
k&&(c.skip(2),k=c.readByte()))),b=k===t.TagUTC?new Date(Date.UTC(1970,0,1,e,f,g,h)):new Date(1970,0,1,e,f,g,h),a.refer.set(b),b}function r(a){var b=a.stream,c=k(b,t.TagQuote),c=b.read(c);return b.skip(1),a.refer.set(c),c}function C(a){var b=a.stream.readByte();switch(b){case t.TagNull:return null;case t.TagEmpty:return new Uint8Array(0);case t.TagBytes:return r(a);case t.TagRef:return H(a);default:m(b)}}function E(a){a=a.stream;var b=a.readString(k(a,t.TagQuote));return a.skip(1),b}function q(a){var b=
E(a);return a.refer.set(b),b}function O(a){var b=a.stream.readByte();switch(b){case t.TagNull:return null;case t.TagEmpty:return"";case t.TagUTF8Char:return a.stream.readString(1);case t.TagString:return q(a);case t.TagRef:return H(a);default:m(b)}}function L(a){var b=a.stream;b.skip(1);var c=b.readAsciiString(36);return b.skip(1),a.refer.set(c),c}function h(a){var b=a.stream,c=[];a.refer.set(c);for(var e=k(b,t.TagOpenbrace),f=0;e>f;f++)c[f]=w(a);return b.skip(1),c}function Q(a){var b=a.stream,c=
{};a.refer.set(c);for(var e=k(b,t.TagOpenbrace),f=0;e>f;f++){var g=w(a),h=w(a);c[g]=h}return b.skip(1),c}function N(a){var b=a.stream,c=new P;a.refer.set(c);for(var e=k(b,t.TagOpenbrace),f=0;e>f;f++){var g=w(a),h=w(a);c.set(g,h)}return b.skip(1),c}function e(a){var b=a.stream,c=a.classref[k(b,t.TagOpenbrace)],e=new c.classname;a.refer.set(e);for(var f=0;f<c.count;f++)e[c.fields[f]]=w(a);return b.skip(1),e}function p(a){var b=a.stream.readByte();switch(b){case t.TagNull:return null;case t.TagClass:return M(a),
p(a);case t.TagObject:return e(a);case t.TagRef:return H(a);default:m(b)}}function M(a){for(var b=a.stream,c=E(a),e=k(b,t.TagOpenbrace),g=[],h=0;e>h;h++)g[h]=O(a);b.skip(1);c=f(c);a.classref.push({classname:c,count:e,fields:g})}function H(a){return a.refer.read(k(a.stream,t.TagSemicolon))}function J(a,b,c){z.call(this,a);this.useHarmonyMap=!!c;Object.defineProperties(this,{classref:{value:[]},refer:{value:b?Ga:new y}})}var P=b.Map,Ca=b.hprose.BytesIO,t=b.hprose.Tags,Fa=b.hprose.ClassManager;b.hprose.RawReader=
z;var Ga=Object.create(null,{set:{value:function(){}},read:{value:function(){m(t.TagRef)}},reset:{value:function(){}}});Object.defineProperties(y.prototype,{set:{value:function(a){this.ref.push(a)}},read:{value:function(a){return this.ref[a]}},reset:{value:function(){this.ref.length=0}}});J.prototype=Object.create(z.prototype);J.prototype.constructor=J;Object.defineProperties(J.prototype,{useHarmonyMap:{value:!1,writable:!0},checkTag:{value:function(a,b){b===B&&(b=this.stream.readByte());b!==a&&m(b,
a)}},checkTags:{value:function(a,b){return b===B&&(b=this.stream.readByte()),0<=a.indexOf(b)?b:void m(b,a)}},unserialize:{value:function(){return w(this)}},readInteger:{value:function(){var a;a:{a=this.stream;var b=a.readByte();switch(b){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:a=b-48;break a;case t.TagInteger:a=k(a,t.TagSemicolon);break a;default:m(b)}a=void 0}return a}},readLong:{value:function(){var a;a:{a=this.stream;var b=a.readByte();switch(b){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:a=
b-48;break a;case t.TagInteger:case t.TagLong:a=x(a);break a;default:m(b)}a=void 0}return a}},readDouble:{value:function(){return c(this.stream)}},readBoolean:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case t.TagTrue:a=!0;break a;case t.TagFalse:a=!1;break a;default:m(a)}a=void 0}return a}},readDateWithoutTag:{value:function(){return D(this)}},readDate:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case t.TagNull:a=null;break a;case t.TagDate:a=D(this);break a;case t.TagRef:a=
H(this);break a;default:m(a)}a=void 0}return a}},readTimeWithoutTag:{value:function(){return u(this)}},readTime:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case t.TagNull:a=null;break a;case t.TagTime:a=u(this);break a;case t.TagRef:a=H(this);break a;default:m(a)}a=void 0}return a}},readBytesWithoutTag:{value:function(){return r(this)}},readBytes:{value:function(){return C(this)}},readStringWithoutTag:{value:function(){return q(this)}},readString:{value:function(){return O(this)}},
readGuidWithoutTag:{value:function(){return L(this)}},readGuid:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case t.TagNull:a=null;break a;case t.TagGuid:a=L(this);break a;case t.TagRef:a=H(this);break a;default:m(a)}a=void 0}return a}},readListWithoutTag:{value:function(){return h(this)}},readList:{value:function(){var a;a:{a=this.stream.readByte();switch(a){case t.TagNull:a=null;break a;case t.TagList:a=h(this);break a;case t.TagRef:a=H(this);break a;default:m(a)}a=void 0}return a}},
readMapWithoutTag:{value:function(){return this.useHarmonyMap?N(this):Q(this)}},readMap:{value:function(){var a;if(this.useHarmonyMap)a:{a=this.stream.readByte();switch(a){case t.TagNull:a=null;break a;case t.TagMap:a=N(this);break a;case t.TagRef:a=H(this);break a;default:m(a)}a=void 0}else a:{a=this.stream.readByte();switch(a){case t.TagNull:a=null;break a;case t.TagMap:a=Q(this);break a;case t.TagRef:a=H(this);break a;default:m(a)}a=void 0}return a}},readObjectWithoutTag:{value:function(){return e(this)}},
readObject:{value:function(){return p(this)}},reset:{value:function(){this.classref.length=0;this.refer.reset()}}});b.hprose.Reader=J})(function(){return this||(0,eval)("this")}());(function(b){function B(b,m){var a=new A;return(new g(a,m)).serialize(b),a}function m(b,g,a){return b instanceof A||(b=new A(b)),(new z(b,g,a)).unserialize()}var A=b.hprose.BytesIO,g=b.hprose.Writer,z=b.hprose.Reader;b.hprose.Formatter={serialize:function(b,g){return B(b,g).bytes},unserialize:m};b.hprose.serialize=B;b.hprose.unserialize=
m})(function(){return this||(0,eval)("this")}());(function(b){b.hprose.ResultMode={Normal:0,Serialized:1,Raw:2,RawWithEndTag:3};b.hprose.Normal=b.hprose.ResultMode.Normal;b.hprose.Serialized=b.hprose.ResultMode.Serialized;b.hprose.Raw=b.hprose.ResultMode.Raw;b.hprose.RawWithEndTag=b.hprose.ResultMode.RawWithEndTag})(function(){return this||(0,eval)("this")}());(function(b,B){function m(){}function A(g,A,L){function h(a,b){for(var c=0,d=I.length;d>c;c++)a=I[c].outputFilter(a,b);return a}function Q(a,
b){return a=h(a,b),V(a,b).then(function(a){if(b.oneway)a=void 0;else for(var c=I.length-1;0<=c;c--)a=I[c].inputFilter(a,b);return a})}function N(a,b){return ea.sendAndReceive(a,b)}function e(a,b,c,d){Da(a,b).then(c,function(e){p(a,b,c,d)||d(e)})}function p(a,c,d,f){if(c.failswitch&&++aa>=za.length&&(aa=0,qa=za[aa]),c.idempotent&&0<=--c.retry){var g=500*(10-c.retry);return 10<c.retry&&(g=500),b.setTimeout(function(){e(a,c,d,f)},g),!0}return!1}function M(b){e(c,{retry:Ea,idempotent:!0,failswitch:!0,
timeout:ga,client:ea,userdata:{}},function(c){var d=null;try{var e=new a(c),f=new k(e,!0);switch(e.readByte()){case y.TagError:d=Error(f.readString());break;case y.TagFunctions:var g=f.readList();f.checkTag(y.TagEnd);ra(b,g);break;default:d=Error("Wrong Response:\r\n"+a.toString(c))}}catch(h){d=h}null!==d?ba.reject(d):ba.resolve(b)},ba.reject)}function J(a,b){return function(){return T?Ga(a,b,D(arguments),!0):w.all(arguments).then(function(c){return Ga(a,b,c,!1)})}}function P(a,b,c,d,e){if(b[d]===
B&&(b[d]={},(typeof e===u||e.constructor===Object)&&(e=[e]),Array.isArray(e)))for(var f=0;f<e.length;f++){var g=e[f];if(typeof g===u)b[d][g]=J(a,c+d+"_"+g);else for(var h in g)P(a,b[d],d+"_",h,g[h])}}function ra(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(typeof d===u)a[d]===B&&(a[d]=J(a,d));else for(var e in d)P(a,a,"",e,d[e])}}function Ca(a,b){for(var c=Math.min(a.length,b.length),d=0;c>d;++d)b[d]=a[d]}function t(b,c,d){var e=new a;e.writeByte(y.TagCall);var g=new f(e,d.simple);return g.writeString(b),
(0<c.length||d.byref)&&(g.reset(),g.writeList(c),d.byref&&g.writeBoolean(!0)),e}function Fa(a,b,c,d){return ma?w.promise(function(e,f){na.push({batch:d,name:a,args:b,context:c,resolve:e,reject:f})}):d?wa(a,b,c):K(a,b,c)}function Ga(a,b,c,d){var e=Fa;var f=d?{mode:x.Normal,byref:Aa,simple:Ba,onsuccess:B,onerror:B,useHarmonyMap:Y,client:ea,userdata:{}}:{mode:x.Normal,byref:Aa,simple:Ba,timeout:ga,retry:Ea,idempotent:xa,failswitch:Ha,oneway:!1,sync:!1,onsuccess:B,onerror:B,useHarmonyMap:Y,client:ea,
userdata:{}};if(b in a){a=a[b];for(var g in a)g in f&&(f[g]=a[g])}g=0;for(a=c.length;a>g&&typeof c[g]!==C;++g);if(g!==a){var h=c.splice(g,a-g);f.onsuccess=h[0];a=h.length;for(g=1;a>g;++g){var k=h[g];switch(typeof k){case C:f.onerror=k;break;case E:f.byref=k;break;case r:f.mode=k;break;case H:for(var q in k)q in f&&(f[q]=k[q])}}}return e(b,c,f,d)}function d(a,b,c,d){try{c.onerror?c.onerror(a,b):sa(a,b),d(b)}catch(e){d(e)}}function F(b,c,d){var f=d.args,g=d.context,h=t(d.name,f,g);h.writeByte(y.TagEnd);
e(h.bytes,g,function(e){if(g.oneway)return void b();var h=null,q=null;try{if(g.mode===x.RawWithEndTag)h=e;else if(g.mode===x.Raw)h=e.subarray(0,e.byteLength-1);else{var m=new a(e),p=new k(m,!1,g.useHarmonyMap),r=m.readByte();if(r===y.TagResult){if(h=g.mode===x.Serialized?p.readRaw():p.unserialize(),r=m.readByte(),r===y.TagArgument){p.reset();var t=p.readList();Ca(t,f);r=m.readByte()}}else r===y.TagError&&(q=Error(p.readString()),r=m.readByte());r!==y.TagEnd&&(q=Error("Wrong Response:\r\n"+a.toString(e)))}if(q)throw q;
}catch(u){q=u}q?c(q,d):b(h,d)},c)}function R(a,c,d){return 0<c.length&&c[c.length-1]&&"function"==typeof c[c.length-1].handler?w.promise(function(b,e){var f=c[c.length-1],g={name:a,args:c.slice(0,c.length-1),udata:f,invoke:F,context:d},h;for(h in f)"handler"!=h&&f.hasOwnProperty(h)&&(g[h]=f[h]);f.handler(g,b,e)}):"function"==typeof b.hprose.userdefInvoke?w.promise(function(e,f){b.hprose.userdefInvoke({name:a,args:c,udata:null,invoke:F,context:d},e,f)}):w.promise(function(b,e){F(b,e,{name:a,args:c,
context:d})})}function va(a){return function(){a&&(ma=!1,z(function(a){a.forEach(function(a){"settings"in a?Ua(a.settings).then(a.resolve,a.reject):Fa(a.name,a.args,a.context,a.batch).then(a.resolve,a.reject)})},na),na=[])}}function K(a,b,c){c.sync&&(ma=!0);var e=w.promise(function(e,f){ta(a,b,c).then(function(d){try{if(c.onsuccess)try{c.onsuccess(d,b)}catch(g){c.onerror&&c.onerror(a,g),f(g)}e(d)}catch(g){f(g)}},function(b){d(a,b,c,f)})});return e.whenComplete(va(c.sync)),e}function wa(a,b,c){return w.promise(function(d,
e){ca.push({args:b,name:a,context:c,resolve:d,reject:e})})}function pa(a){var b={timeout:ga,retry:Ea,idempotent:xa,failswitch:Ha,oneway:!1,sync:!1,client:ea,userdata:{}},c;for(c in a)c in b&&(b[c]=a[c]);return b}function Pa(b,c){var d=b.reduce(function(a,b){return a.write(t(b.name,b.args,b.context)),a},new a);return d.writeByte(y.TagEnd),w.promise(function(f,g){e(d.bytes,c,function(d){if(c.oneway)return void f(b);var e=-1,h=new a(d),n=new k(h,!1),q=h.readByte();try{for(;q!==y.TagEnd;){var m=null,
p=null,r=b[++e].context.mode;if(r>=x.Raw&&(m=new a),q===y.TagResult){if(r===x.Serialized?m=n.readRaw():r>=x.Raw?(m.writeByte(y.TagResult),m.write(n.readRaw())):(n.useHarmonyMap=b[e].context.useHarmonyMap,n.reset(),m=n.unserialize()),q=h.readByte(),q===y.TagArgument){if(r>=x.Raw)m.writeByte(y.TagArgument),m.write(n.readRaw());else{n.reset();var t=n.readList();Ca(t,b[e].args)}q=h.readByte()}}else q===y.TagError&&(r>=x.Raw?(m.writeByte(y.TagError),m.write(n.readRaw())):(n.reset(),p=Error(n.readString())),
q=h.readByte());if(0>[y.TagEnd,y.TagResult,y.TagError].indexOf(q))return void g(Error("Wrong Response:\r\n"+a.toString(d)));r>=x.Raw?(r===x.RawWithEndTag&&m.writeByte(y.TagEnd),b[e].result=m.bytes):b[e].result=m;b[e].error=p}}catch(u){return void g(u)}f(b)},g)})}function Ua(a){if(a=a||{},T=!1,ma)return w.promise(function(b,c){na.push({batch:!0,settings:a,resolve:b,reject:c})});if(0!==ca.length){var b=pa(a);b.sync&&(ma=!0);var c=ca;ca=[];var e=w.promise(function(a,e){oa(c,b).then(function(b){b.forEach(function(a){if(a.error)d(a.name,
a.error,a.context,a.reject);else try{if(a.context.onsuccess)try{a.context.onsuccess(a.result,a.args)}catch(b){a.context.onerror&&a.context.onerror(a.name,b),a.reject(b)}a.resolve(a.result)}catch(b){a.reject(b)}delete a.context;delete a.resolve;delete a.reject});a(b)},function(a){c.forEach(function(b){"reject"in b&&d(b.name,a,b.context,b.reject)});e(a)})});return e.whenComplete(va(b.sync)),e}}function Ta(){return sa}function Va(a){typeof a===C&&(sa=a)}function La(a){a&&"function"==typeof a.inputFilter&&
"function"==typeof a.outputFilter&&I.push(a)}function Ma(a,b,c){c===B&&(typeof b===E&&(c=b,b=!1),b||(typeof a===E?(c=a,a=!1):(a&&a.constructor===Object||Array.isArray(a))&&(b=a,a=!1)));var d=ea;return c&&(d={}),a||qa?(a&&(qa=a),(typeof b===u||b&&b.constructor===Object)&&(b=[b]),Array.isArray(b)?(ra(d,b),ba.resolve(d),d):(z(M,d),ba)):Error("You should set server uri first!")}function fa(a,b,c){return W[a]?(a=W[a],a[b]?a[b]:null):(c&&(W[a]=Object.create(null)),null)}function ya(a,b,c,d){if(typeof a!==
u)throw new TypeError("topic name must be a string.");if(b===B||null===b){if(typeof c!==C)throw new TypeError("callback must be a function.");b=c}if(typeof b===C)return d=c,c=b,null===ka&&(ka=da()),void ka.then(function(b){ya(a,b,c,d)});if(typeof c!==C)throw new TypeError("callback must be a function.");if(w.isPromise(b))return void b.then(function(b){ya(a,b,c,d)});d===B&&(d=ga);var e=fa(a,b,!0);if(null===e){var f=function(){Ga(ea,a,[b,e.handler,f,{idempotent:!0,failswitch:!1,timeout:d}],!1)},e={handler:function(c){var d=
fa(a,b,!1);if(d){if(null!==c)for(var d=d.callbacks,e=0,g=d.length;g>e;++e)try{d[e](c)}catch(h){}null!==fa(a,b,!1)&&f()}},callbacks:[c]};W[a][b]=e;f()}else 0>e.callbacks.indexOf(c)&&e.callbacks.push(c)}function Wa(a,b,c){if(a)if(typeof c===C){var d=a[b];d&&(d=d.callbacks,c=d.indexOf(c),0<=c&&(d[c]=d[d.length-1],d.length--),0===d.length&&delete a[b])}else delete a[b]}function la(a,b,c){if(typeof a!==u)throw new TypeError("topic name must be a string.");if(b===B||null===b){if(typeof c!==C)return void delete W[a];
b=c}if(typeof b===C&&(c=b,b=null),null===b)if(null===ka){if(W[a]){var d=W[a];for(b in d)Wa(d,b,c)}}else ka.then(function(b){la(a,b,c)});else w.isPromise(b)?b.then(function(b){la(a,b,c)}):Wa(W[a],b,c)}function da(){return Ga(ea,"#",[],!1)}function Za(a){G.push(a);ta=G.reduceRight(function(a,b){return function(c,d,e){try{var f=b(c,d,e,a);return w.isFuture(f)?f:w.value(f)}catch(g){return w.error(g)}}},R)}function $a(a){ha.push(a);oa=ha.reduceRight(function(a,b){return function(c,d){try{var e=b(c,d,a);
return w.isFuture(e)?e:w.value(e)}catch(f){return w.error(f)}}},Pa)}function Ia(a){ua.push(a);Da=ua.reduceRight(function(a,b){return function(c,d){try{var e=b(c,d,a);return w.isFuture(e)?e:w.value(e)}catch(f){return w.error(f)}}},Q)}function Na(a){Ja.push(a);V=Ja.reduceRight(function(a,b){return function(c,d){try{var e=b(c,d,a);return w.isFuture(e)?e:w.value(e)}catch(f){return w.error(f)}}},N)}var qa,za=[],aa=-1,Aa=!1,Ba=!1,ga=3E4,Ea=10,xa=!1,Ha=!1,ma=!1,na=[],Y=!1,sa=m,I=[],T=!1,ca=[],ba=new w,W=
Object.create(null),ka=null,U=!0,ta=R,oa=Pa,Da=Q,V=N,G=[],ha=[],ua=[],Ja=[],ea=this;da.sync=!0;da.idempotent=!0;da.failswitch=!0;var Qa=Object.create(null,{begin:{value:function(){T=!0}},end:{value:Ua},use:{value:function(a){return $a(a),Qa}}}),Ra=Object.create(null,{use:{value:function(a){return Ia(a),Ra}}}),Sa=Object.create(null,{use:{value:function(a){return Na(a),Sa}}});Object.defineProperties(this,{"#":{value:da},onError:{get:Ta,set:Va},onerror:{get:Ta,set:Va},uri:{get:function(){return qa}},
id:{get:function(){return ka}},failswitch:{get:function(){return Ha},set:function(a){Ha=!!a}},timeout:{get:function(){return ga},set:function(a){ga="number"==typeof a?0|a:0}},retry:{get:function(){return Ea},set:function(a){Ea="number"==typeof a?0|a:0}},idempotent:{get:function(){return xa},set:function(a){xa=!!a}},keepAlive:{get:function(){return U},set:function(a){U=!!a}},byref:{get:function(){return Aa},set:function(a){Aa=!!a}},simple:{get:function(){return Ba},set:function(a){Ba=!!a}},useHarmonyMap:{get:function(){return Y},
set:function(a){Y=!!a}},filter:{get:function(){return 0===I.length?null:1===I.length?I[0]:I.slice()},set:function(a){I.length=0;Array.isArray(a)?a.forEach(function(a){La(a)}):La(a)}},addFilter:{value:La},removeFilter:{value:function(a){a=I.indexOf(a);return-1===a?!1:(I.splice(a,1),!0)}},useService:{value:Ma},invoke:{value:function(a,b,c){var d=arguments.length;if(1>d||typeof a!==u)throw Error("name must be a string");if(1===d&&(b=[]),2===d&&!Array.isArray(b)){var e=[];typeof b!==C&&e.push(m);e.push(b);
b=e}if(2<d)for(typeof c!==C&&b.push(m),e=2;d>e;e++)b.push(arguments[e]);return Ga(ea,a,b,T)}},ready:{value:function(a,b){return ba.then(a,b)}},subscribe:{value:ya},unsubscribe:{value:la},use:{value:function(a){return Za(a),ea}},batch:{value:Qa},beforeFilter:{value:Ra},afterFilter:{value:Sa}});L&&typeof L===H&&"failswitch timeout retry idempotent keepAlive byref simple useHarmonyMap filter".split(" ").forEach(function(a){a in L&&(ea[a]=L[a])});typeof g===u?(za=[g],aa=0,Ma(g,A)):Array.isArray(g)&&(za=
g,aa=Math.floor(Math.random()*za.length),Ma(za[aa],A))}function g(a){var b=document.createElement("a");if(b.href=a,"http:"!==b.protocol&&"https:"!==b.protocol&&"ws:"!==b.protocol&&"wss:"!==b.protocol)throw Error("The "+b.protocol+" client isn't implemented.");}var z=b.setImmediate,y=b.hprose.Tags,x=b.hprose.ResultMode,a=b.hprose.BytesIO,f=b.hprose.Writer,k=b.hprose.Reader,w=b.hprose.Future,D=Function.prototype.call.bind(Array.prototype.slice),c=new Uint8Array(1);c[0]=y.TagEnd;var E="boolean",u="string",
r="number",C="function",H="object";Object.defineProperty(A,"create",{value:function(a,c,f){try{return b.hprose.HttpClient.create(a,c,f)}catch(h){}try{return b.hprose.WebSocketClient.create(a,c,f)}catch(h){}if("string"==typeof a)g(a);else if(Array.isArray(a))throw a.forEach(function(a){g(a)}),Error("Not support multiple protocol.");throw Error("You should set server uri first!");}});b.hprose.Client=A})(function(){return this||(0,eval)("this")}());(function(b,x){function m(){}function A(g,a,f){function k(a,
f){var g=new XMLHttpRequest;g.open("POST",r.uri,!0);b.location!==x&&"file:"!==b.location.protocol&&(g.withCredentials="true");g.responseType="arraybuffer";for(var k in c)g.setRequestHeader(k,c[k]);return g.onload=function(){g.onload=m;g.status&&(200===g.status?f.resolve(new Uint8Array(g.response)):f.reject(Error(g.status+":"+g.statusText)))},g.onerror=function(){f.reject(Error("error"))},g.upload!==x&&(g.upload.onprogress=E),g.onprogress=u,a.constructor===String||ArrayBuffer.isView?g.send(a):a.buffer.slice?
g.send(a.buffer.slice(0,a.length)):g.send(a.buffer),g}function w(a){"function"==typeof a&&(E=a)}function D(){return E}if(this.constructor!==A)return new A(g,a,f);z.call(this,g,a,f);var c=Object.create(null),E=m,u=m,r=this;Object.defineProperties(this,{onProgress:{get:D,set:w},onprogress:{get:D,set:w},onRequestProgress:{get:D,set:w},onResponseProgress:{get:function(){return u},set:function(a){"function"==typeof a&&(u=a)}},setHeader:{value:function(a,b){"content-type"!==a.toLowerCase()&&"content-length"!==
a.toLowerCase()&&(b?c[a]=b:delete c[a])}},sendAndReceive:{value:function(a,b){var c=new y,f=k(a,c);return 0<b.timeout&&(c=c.timeout(b.timeout).catchError(function(a){throw f.onload=m,f.onerror=m,f.abort(),a;},function(a){return a instanceof M})),b.oneway&&c.resolve(),c}}})}function g(b){var a=document.createElement("a");if(a.href=b,"http:"!==a.protocol&&"https:"!==a.protocol)throw Error("This client desn't support "+a.protocol+" scheme.");}var z=b.hprose.Client,y=b.hprose.Future;Object.defineProperty(A,
"create",{value:function(b,a,f){if("string"==typeof b)g(b);else{if(!Array.isArray(b))return Error("You should set server uri first!");b.forEach(function(a){g(a)})}return new A(b,a,f)}});b.hprose.HttpClient=A})(function(){return this||(0,eval)("this")}());(function(b,x){function m(){}function A(a,b,g){function w(a,b){var c=new y;c.writeInt32BE(a);b.constructor===String?c.writeString(b):c.write(b);c=c.bytes;ArrayBuffer.isView?L.send(c):c.buffer.slice?L.send(c.buffer.slice(0,c.length)):L.send(c.buffer)}
function E(a){O.resolve(a)}function c(a){a=new y(a.data);var b=a.readInt32BE(),c=J[b];if(delete J[b],c!==x&&(--C,c.resolve(a.read(a.length-4))),100>C&&0<q.length){++C;var f=q.shift();O.then(function(){w(f[0],f[1])})}0===C&&(h.keepAlive||u())}function H(a){J.forEach(function(b,c){b.reject(Error(a.code+":"+a.reason));delete J[c]});C=0;L=null}function u(){null!==L&&(L.onopen=m,L.onmessage=m,L.onclose=m,L.close())}if(this.constructor!==A)return new A(a,b,g);z.call(this,a,b,g);var r=0,C=0,J=[],q=[],O=
null,L=null,h=this;Object.defineProperties(this,{sendAndReceive:{value:function(a,b){if(null===L||L.readyState===WebSocket.CLOSING||L.readyState===WebSocket.CLOSED)O=new D,L=new WebSocket(h.uri),L.binaryType="arraybuffer",L.onopen=E,L.onmessage=c,L.onerror=m,L.onclose=H;var e=2147483647>r?++r:r=0,f=new D;return J[e]=f,0<h.timeout&&(f=f.timeout(h.timeout).catchError(function(a){throw delete J[e],--C,a;},function(a){return a instanceof M})),100>C?(++C,O.then(function(){w(e,a)})):q.push([e,a]),b.oneway&&
f.resolve(),f}},close:{value:u}})}function g(a){var b=document.createElement("a");if(b.href=a,"ws:"!==b.protocol&&"wss:"!==b.protocol)throw Error("This client desn't support "+b.protocol+" scheme.");}var z=b.hprose.Client,y=b.hprose.BytesIO,D=b.hprose.Future;Object.defineProperty(A,"create",{value:function(a,b,k){if("string"==typeof a)g(a);else{if(!Array.isArray(a))return Error("You should set server uri first!");a.forEach(function(a){g(a)})}return new A(a,b,k)}});b.hprose.WebSocketClient=A})(function(){return this||
(0,eval)("this")}());(function(b){function x(b){this.version=b||"2.0"}var m=b.hprose.Tags,A=b.hprose.BytesIO,g=b.hprose.Writer,z=b.hprose.Reader,y=1;x.prototype.inputFilter=function(b,a){var f=A.toString(b);"{"===f.charAt(0)&&(f="["+f+"]");for(var f=JSON.parse(f),k=new A,w=new g(k,!0),y=0,c=f.length;c>y;++y){var x=f[y];x.error?(k.writeByte(m.TagError),w.writeString(x.error.message)):(k.writeByte(m.TagResult),w.serialize(x.result))}return k.writeByte(m.TagEnd),k.bytes};x.prototype.outputFilter=function(b,
a){var f=[],g=new A(b),w=new z(g,!1,!1),x=g.readByte();do{var c={};x===m.TagCall&&(c.method=w.readString(),x=g.readByte(),x===m.TagList&&(c.params=w.readListWithoutTag(),x=g.readByte()),x===m.TagTrue&&(x=g.readByte()));"1.1"===this.version?c.version="1.1":"2.0"===this.version&&(c.jsonrpc="2.0");c.id=y++;f.push(c)}while(x===m.TagCall);return 1<f.length?JSON.stringify(f):JSON.stringify(f[0])};b.hprose.JSONRPCClientFilter=x})(function(){return this||(0,eval)("this")}());(function(b){b.hprose.common=
{Completer:b.hprose.Completer,Future:b.hprose.Future,ResultMode:b.hprose.ResultMode};b.hprose.io={BytesIO:b.hprose.BytesIO,ClassManager:b.hprose.ClassManager,Tags:b.hprose.Tags,RawReader:b.hprose.RawReader,Reader:b.hprose.Reader,Writer:b.hprose.Writer,Formatter:b.hprose.Formatter};b.hprose.client={Client:b.hprose.Client,HttpClient:b.hprose.HttpClient,WebSocketClient:b.hprose.WebSocketClient};b.hprose.filter={JSONRPCClientFilter:b.hprose.JSONRPCClientFilter};J(5).cmd?!(x=[],H=b.hprose,D="function"===
typeof H?H.apply(E,x):H,void 0!==D&&(P.exports=D)):J(6)&&!(x=[],D=function(){return b.hprose}.apply(E,x),void 0!==D&&(P.exports=D));"object"==typeof P&&"object"==typeof P.exports&&(P.exports=b.hprose)})(function(){return this||(0,eval)("this")}())},function(P,E){P.exports=function(){throw Error("define cannot be used indirect");}},function(P,E){(function(E){P.exports=E}).call(E,{})}]);
